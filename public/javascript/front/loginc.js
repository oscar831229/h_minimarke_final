var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(a){return binb2hex(core_sha1(str2binb(a),a.length*chrsz))}function b64_sha1(a){return binb2b64(core_sha1(str2binb(a),a.length*chrsz))}function str_sha1(a){return binb2str(core_sha1(str2binb(a),a.length*chrsz))}function hex_hmac_sha1(a,b){return binb2hex(core_hmac_sha1(a,b))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(v,o){v[o>>5]|=128<<(24-o%32);v[((o+64>>9)<<4)+15]=o;var y=Array(80);var u=1732584193;var s=-271733879;var r=-1732584194;var q=271733878;var p=-1009589776;for(var l=0;l<v.length;l+=16){var n=u;var m=s;var k=r;var h=q;var f=p;for(var g=0;g<80;g++){if(g<16){y[g]=v[l+g]}else{y[g]=rol(y[g-3]^y[g-8]^y[g-14]^y[g-16],1)}var z=safe_add(safe_add(rol(u,5),sha1_ft(g,s,r,q)),safe_add(safe_add(p,y[g]),sha1_kt(g)));p=q;q=r;r=rol(s,30);s=u;u=z}u=safe_add(u,n);s=safe_add(s,m);r=safe_add(r,k);q=safe_add(q,h);p=safe_add(p,f)}return Array(u,s,r,q,p)}function sha1_ft(e,a,g,f){if(e<20){return(a&g)|((~a)&f)}if(e<40){return a^g^f}if(e<60){return(a&g)|(a&f)|(g&f)}return a^g^f}function sha1_kt(a){return(a<20)?1518500249:(a<40)?1859775393:(a<60)?-1894007588:-899497514}function core_hmac_sha1(c,f){var e=str2binb(c);if(e.length>16){e=core_sha1(e,c.length*chrsz)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=core_sha1(a.concat(str2binb(f)),512+f.length*chrsz);return core_sha1(d.concat(g),512+160)}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function rol(a,b){return(a<<b)|(a>>>(32-b))}function str2binb(d){var c=Array();var a=(1<<chrsz)-1;for(var b=0;b<d.length*chrsz;b+=chrsz){c[b>>5]|=(d.charCodeAt(b/chrsz)&a)<<(32-chrsz-b%32)}return c}function binb2str(c){var d="";var a=(1<<chrsz)-1;for(var b=0;b<c.length*32;b+=chrsz){d+=String.fromCharCode((c[b>>5]>>>(32-chrsz-b%32))&a)}return d}function binb2hex(c){var b=hexcase?"0123456789ABCDEF":"0123456789abcdef";var d="";for(var a=0;a<c.length*4;a++){d+=b.charAt((c[a>>2]>>((3-a%4)*8+4))&15)+b.charAt((c[a>>2]>>((3-a%4)*8))&15)}return d}function binb2b64(d){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var f="";for(var b=0;b<d.length*4;b+=3){var e=(((d[b>>2]>>8*(3-b%4))&255)<<16)|(((d[b+1>>2]>>8*(3-(b+1)%4))&255)<<8)|((d[b+2>>2]>>8*(3-(b+2)%4))&255);for(var a=0;a<4;a++){if(b*8+a*6>d.length*32){f+=b64pad}else{f+=c.charAt((e>>6*(3-a))&63)}}}return f}var Auth={highPerformance:1,authTimeout:null,failedLogin:0,startSession:function(){if($("login").tagName=="INPUT"){if(!$("login").value){$("pass").activate();if(typeof Effect!="undefined"){new Effect.Highlight("login",{startcolor:"#BFB2C4",afterFinish:function(){$("login").activate()}})}return}}else{if($("login").selectedIndex==0){$("pass").activate();if(typeof Effect!="undefined"){new Effect.Highlight("login",{startcolor:"#BFB2C4",afterFinish:function(){$("login").activate()}})}return}}if($("pass").value==""){$("pass").activate();if(typeof Effect!="undefined"){new Effect.Highlight("pass",{startcolor:"#BFB2C4"})}return}$("loginButton").disable();$("pass").disable();$("login").disable();Auth.authTimeout=window.setTimeout(function(){$("logForm").hide();if($Jasmin.high==1){new Effect.Appear("spinner",{duration:0.5})}else{$("spinner").show()}Auth.authTimeout=null},1500);var b=hex_sha1($F("pass"));var a="webServices/Auth.php";new Ajax.Request(a,{parameters:{login:$F("login"),pass:b,high:Auth.highPerformance,captcha:$F("captcha")},onComplete:function(c){if(Auth.authTimeout!=null){window.clearTimeout(Auth.authTimeout);Auth.authTimeout=null}if($("logForm").visible()==false){if($Jasmin.high==1){new Effect.Fade("spinner",{duration:0.3,afterFinish:function(){new Effect.Appear("logForm",{duration:0.3,afterFinish:function(){Auth.logIn(c)}})}})}else{$("spinner").hide();$("logForm").show();Auth.logIn(c)}}else{Auth.logIn(c)}$("loginButton").enable()}})},redirectToIndex:function(){if(Prototype.Browser.Gecko){var a=Auth.isSupportedNavigator();if(a){window.location="index.php?option=9&action=inicio"}else{window.location="index.php?option=9&action=firefox"}}else{if(Prototype.Browser.IE){window.location="index.php?option=9&action=ie"}else{window.location="index.php?option=9&action=inicio"}}},logIn:function(f){var b;try{var a=f.responseXML.getElementsByTagName("row");var d=0;d=a[0].getAttribute("value");if(d==1){if($Jasmin.high==1){new Effect.Fade("appLogo",{duration:0.4});new Effect.Fade("logonTable",{duration:0.4,afterFinish:function(){new Auth.redirectToIndex()}})}else{new Auth.redirectToIndex()}}else{$("pass").enable();$("login").enable();if($Jasmin.high==1){window.setTimeout(function(){$("pass").activate()},550);new Effect.Shake("logonTable",{duration:0.4})}else{alert("Usuario/Clave incorrectos");$("pass").activate()}Auth.failedLogin++;if(Auth.failedLogin>3){Auth.showCaptcha()}}}catch(c){if($("AuthErr").style.display=="none"){new Effect.SlideDown("AuthErr",{duration:0.5})}else{new Effect.Shake("AuthErr",{duration:0.5})}$("loginButton").show()}},showCaptcha:function(){if(!$("recaptcha")){$("captcha_lab").show();$("captcha_con").show();$("captcha_inp").show();["login","pass","pass_dummy","captcha"].each(function(b){$(b).setStyle({fontSize:"11px",padding:"2px",margin:"0px"})});Auth.failedLogin=4}var a=parseInt(Math.random()*10000);$("recapcha_con").update('<img src="scripts/captcha.php?nocache='+a+'" id="recaptcha"/>')},startPreload:function(){var a=["logo2.png","planes.png","keys.png","recep.png","llaves.png","factu.png","cartera.png","audit.png","audit.png","estadisticas.png","eventos.png","basicas.png","mail.png","address.png","modem.png","reminders.png","inactive_top.png","leftp.png"];for(var b=0;b<a.length;b++){var c=$(document.createElement("IMG"));c.src="img/"+a[b];c.setStyle({position:"fixed",top:"0px",left:"0px",visibility:"hidden",opacity:-100});document.body.appendChild(c)}},isSupportedNavigator:function(){return/Firefox\/3\.[6-9]/.test(navigator.userAgent)||/Firefox\/4\.[0-1]/.test(navigator.userAgent)},showTiptip:function(){var d=$("pass");var b=$("tiptip");var a=d.cumulativeOffset();b.style.top=(a[1]-1)+"px";b.style.left=(a[0]+d.getWidth()+17)+"px";b.update("MayÃºsculas Activado");b.setOpacity(1);b.show();var c=$("tiptip_arrow");c.setOpacity(1);c.show();c.style.top=(a[1]+9)+"px";c.style.left=(a[0]+d.getWidth()+12)+"px"},hideTiptip:function(){$("tiptip").hide();$("tiptip_arrow").hide()}};new Event.observe(document,"dom:loaded",function(){Auth.highPerformance=$Jasmin.high;if(Prototype.Browser.Gecko){var a=Auth.isSupportedNavigator();if(a){if(localStorage.high==null){localStorage.high=$Jasmin.high}Auth.highPerformance=localStorage.high}}$("login").activate();new Event.observe("pass","keypress",function(d){var b=d.charCode;if(typeof b=="undefined"){b=d.keyCode}var c=String.fromCharCode(b);if(/^[A-Z]$/.test(c)&&!d.shiftKey){Auth.showTiptip()}else{Auth.hideTiptip()}});new Event.observe("pass","keyup",function(b){if(b.keyCode==Event.KEY_RETURN){Auth.startSession();new Event.stop(b)}});new Event.observe("pass","keydown",function(b){if(b.keyCode==20){if($("tiptip").visible()){Auth.hideTiptip()}else{Auth.showTiptip()}}});new Event.observe("captcha","keyup",function(b){if(b.keyCode==Event.KEY_RETURN){Auth.startSession();new Event.stop(b)}});$("loginButton").observe("click",Auth.startSession);$("pass").observe("blur",function(){if(this.value==""){this.hide();$("pass_dummy").show()}});$("pass_dummy").observe("focus",function(){this.hide();$("pass").show();$("pass").activate()});if($("login").tagName=="SELECT"){$("login").observe("change",function(){this.blur();$("pass").activate()})}if($("captcha_lab").visible()){Auth.showCaptcha()}});new Event.observe(window,"load",Auth.startPreload);