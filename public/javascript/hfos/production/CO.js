var InterfaseSiigo=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"interfaseSiigoForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-interface-siigo","afterCreateOrRestore",function(a){new InterfaseSiigo(a)});var ListadoComprob=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"listadoComprobForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-listado-comprob","afterCreateOrRestore",function(a){new ListadoComprob(a)});var ReciboCaja=Class.create(HfosProcessContainer,{_key:null,_movimientos:[],_formaPago:[],_activeMov:0,_oldTercero:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.getElement("newButton");null!==a&&(a.observe("click",this._newReciboCaja.bind(this)),new HfosForm(this,"buscarReccajForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron recibos de caja");break;case "1":this._key=
a.key;this.go("recibo_caja/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this)});break;case "n":var c=new HfosBrowseData(this,7);c.setEnableDeleteButton(!1);c.build(this.getElement("resultados"),a);a=c.getDetailsButtons();for(c=0;c<a.length;c++)a[c].store("primary",a[c].title),a[c].title="Ver/Editar",a[c].observe("click",this._detailsHandler.bind(this,a[c]));this.scrollToBottom();this._notifyContentChange()}}.bind(this)}))},_detailsHandler:function(a){this._key=a.retrieve("primary");
this.go("recibo_caja/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this)})},_newReciboCaja:function(){this.go("recibo_caja/nuevo",{onSuccess:this._setNewCallbacks.bind(this)})},_setDetailsCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));var a=this.getElement("printButton");if(null!==a){a.observe("click",this._printReciboCaja.bind(this));a=this.getElement("deleteButton");a.observe("click",this._anulaReciboCaja.bind(this));var b=
this.getElement("verComprob");null!==b?b.observe("click",Movimientos.abrir.bind(this,b.title)):a.hide()}},abrirComprobante:function(){},_updateCartera:function(){var a=this.selectOne("input#nit");if(this._oldTercero!=a.value.strip())""==a.value.strip()||"0"==a.getValue()?(this.getElement("infoTercero").update("Seleccione un tercero para visualizar su cartera"),this.getElement("infoTercero").show(),this.getElement("carteraContent").hide()):(this._documentos=[],new HfosAjax.JsonRequest("recibo_caja/getCartera",
{parameters:"nit="+a.getValue(),onSuccess:function(a){if("OK"==a.status)if(0==a.documentos.length)this.getElement("infoTercero").update("El tercero no tiene documentos en cartera asociados"),this.getElement("infoTercero").show(),this.getElement("carteraContent").hide();else{this.getElement("infoTercero").hide();var c;c='<table align="center" width="50%" class="hyBrowseTab zebraSt sortable" cellspacing="0"><thead><th class="nosort sortasc"></th><th class="sortcol">Tipo</th><th class="sortcol">N\u00famero</th><th class="sortcol">Cuenta</th><th class="sortcol">F. Emisi\u00f3n</th><th class="sortcol">F. Vence</th><th class="sortcol">Saldo</th><th class="sortcol">Abono</th></thead><tbody>';
for(var d=0;d<a.documentos.length;d++){var e=a.documentos[d].tipoDoc+"_"+a.documentos[d].numeroDoc+"_"+a.documentos[d].cuenta;c+='<tr><td><input type="checkbox" name="numeroDoc[]" value="'+e+'" id="'+e+'"/></td>';c+="<td>"+a.documentos[d].tipoDoc+"</td>";c+='<td align="right">'+a.documentos[d].numeroDoc+"</td>";c+='<td align="right">'+a.documentos[d].cuenta+"</td>";c+="<td>"+a.documentos[d].fEmision+"</td>";c+="<td>"+a.documentos[d].fVence+"</td>";c+='<td align="right">'+a.documentos[d].saldo+"</td>";
c+='<td align="right"><input type="text" name="abono'+e+'[]" class="abono numeric" value="'+a.documentos[d].saldoValor+'" size="9" maxlength="12"></td>';c+="</tr>"}this.getElement("carteraContent").update(c+"</tbody></table>");this.getElement("carteraContent").show();this._addDocumentoCallbacks();this._documentos=a.documentos}}.bind(this)})),this._oldTercero=a.value.strip()},_addDocumentoCallbacks:function(){for(var a=this.getElement("carteraContent").select('input[type="checkbox"]'),b=0;b<a.length;b++)a[b].observe("click",
this._selectNumeroDoc.bind(this,a[b]));a=this.getElement("carteraContent").select("input.abono");for(b=0;b<a.length;b++)a[b].observe("blur",this._updateDebitosDoc.bind(this))},_selectNumeroDoc:function(a){a.up(1).toggleClassName("selected");this._calculateSumas()},_updateDebitosDoc:function(){this._calculateSumas()},_onChangeTab:function(a){"Cartera"==a&&this._updateCartera()},_showStatusBar:function(){var a;this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option></select><td><td class="totalOrden" align="right"></td></tr></table>');
this._sumasIguales=this.getStatusBarElement("totalOrden");this._sumasIguales.update("")},_setNewCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));this.getElement("saveButton").observe("click",this._grabarReciboCaja.bind(this));new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)});HfosCommon.addCuentaCompleter("cuenta");HfosCommon.addTerceroCompleter("nit",!0);HfosCommon.addTerceroCompleter("nit2");HfosCommon.addComprobCompleter("comprob",
!0);this.selectOne("input#nit_det").observe("blur",this._updateBeneficiario.bind(this));var a=this.selectOne("input#addMovi");a.observe("click",this._addMovimiento.bind(this,a));a=this.selectOne("input#addFormaPago");a.observe("click",this._addFormaPago.bind(this,a));this._showStatusBar();this._updateSumas(0,0);this._movimientos=[];this._activeMov=0},_updateBeneficiario:function(){var a=this.selectOne("input#nit_det"),b=this.selectOne("input#beneficiario");""==b.getValue()&&!1==a.getValue().include("NO EXISTE")&&
b.setValue(a.getValue())},_grabarReciboCaja:function(){var a=this._getTotalFormaPago();this.selectOne("input#valor");for(var b=0,c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&("D"==this._movimientos[c].naturaleza?a+=parseFloat(this._movimientos[c].valor2,10):b+=parseFloat(this._movimientos[c].valor2,10));var d=this._sumCartera();-1<d?b+=d:a+=d;if(a!=b)new HfosModal.alert({title:"Generar ReciboCajas",message:"Movimientos contables descuadrados, por favor revise"});else if(a=
this.selectOne("input#nit"),""==a.value.strip()||"0"==a.value)new HfosModal.alert({title:"Generar ReciboCajas",message:"Debe indicar el tercero del comprobante"}),a.activate();else if(""==this.selectOne("input#beneficiario").getValue()&&this._updateBeneficiario(),b=this.selectOne("textarea#observacion"),""==b.value.strip()||"0"==b.value)new HfosModal.alert({title:"Generar ReciboCajas",message:"Debe indicar la observaci\u00f3n \u00f3 nota del ReciboCaja"}),a.activate();else{var e=this.getElement("formGrabar");
e.select("input.movementHidden").each(function(a){a.erase()});a="nit2,nombre2,cuenta,naturaleza,descripcion,centroCosto,valor2".split(",");for(c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&a.each(function(a){var b=document.createElement("INPUT");b.type="hidden";b.className="movementHidden";b.name="f_"+a+"[]";b.value=this._movimientos[c][a];e.appendChild(b)}.bind(this));e=this.getElement("formGrabar");e.select("input.formaPagoHidden").each(function(a){a.erase()});a=["formaPago",
"formaPago_det","numero","descripcion","valor"];for(c=0;c<this._formaPago.length;c++)"A"==this._formaPago[c].estado&&a.each(function(a){var b=document.createElement("INPUT");b.type="hidden";b.className="formaPagoHidden";b.name="fp_"+a+"[]";b.value=this._formaPago[c][a];e.appendChild(b)}.bind(this));new HfosAjax.JsonFormRequest(e,{onSuccess:function(a){if("FAILED"==a.status)this.getMessages().error(a.message);else if("OK"==a.status)this._key=a.id,this._movimientos=[],this._formaPago=[],this.go("recibo_caja/ver",
{parameters:this._key+"&new=1",onSuccess:this._setDetailsCallbacks.bind(this)})}.bind(this)})}},_addMovimiento:function(a){try{var b=this.selectOne("input#cuenta");if(""==b.getValue())new HfosModal.alert({title:"Generar ReciboCajas",message:"Debe indicar la cuenta"}),b.activate();else{var c=this.selectOne("input#valor2");if(""==c.getValue()||"0"==c.getValue())new HfosModal.alert({title:"Generar ReciboCajas",message:"Debe indicar el valor"}),c.activate();else{var d=this.selectOne("select#centroCosto"),
e=this.selectOne("input#nit2"),f=this.selectOne("input#nit2_det"),g=this.selectOne("select#naturaleza"),h=this.selectOne("input#descripcion"),i=this.selectOne("input#cuenta_det");this._movimientos[-1==this._activeMov?this._movimientos.length:this._activeMov]={cuenta:b.getValue(),detalleCuenta:i.getValue(),naturaleza:g.getValue(),descripcion:h.getValue(),centroCosto:d.getValue(),textoCentro:d.options[d.selectedIndex].text,nit2:e.getValue(),nombre2:f.getValue(),valor2:parseFloat(c.getValue(),10),estado:"A"};
this._generarTabla();e.setValue("");g.setValue("");d.setValue("");i.setValue("");c.setValue("");this._activeMov=-1;this.selectOne("input#nuevoMovi").hide();a.value="Agregar"}}}catch(j){HfosException.show(j)}},_addFormaPago:function(a){try{var b=this.selectOne("select#fp_formaPago");if(""==b.getValue())new HfosModal.alert({title:"Generar Recibo de Caja",message:"Debe indicar la forma de pago"}),cuentaElement.activate();else{var c="",d=this.selectOne("input#fp_numero");d&&(c=d.getValue());var e=this.selectOne("input#fp_descripcion");
e&&(descripcionValue=e.getValue());var f=this.selectOne("input#fp_valor");if(""==f.getValue()||"0"==f.getValue())new HfosModal.alert({title:"Generar Recibo de Caja",message:"Debe indicar el valor"}),f.activate();else{var g;g=-1==this._activeFormaPago?this._formaPago.length:this._activeFormaPago;void 0==g&&(g=0);this._formaPago[g]={formaPago:b.getValue(),formaPago_det:b.options[b.selectedIndex].text,numero:c,descripcion:descripcionValue,valor:f.getValue(),naturaleza:"D",estado:"A"};this._generarTablaFp();
b.setValue("");d.setValue("");f.setValue("");this._activeFormaPago=-1;this.selectOne("input#nuevoFormaPago").hide();a.value="Agregar"}}}catch(h){HfosException.show(h)}},_sumCartera:function(){for(var a=0,b=this.getElement("carteraContent").select('input[type="checkbox"]:checked'),c=this.getElement("carteraContent").select("input.abono"),d=0;d<b.length;d++)if(b[d].checked)for(var e=0;e<this._documentos.length;e++){var f=b[d].getValue().split("_");this._documentos[e].tipoDoc==f[0]&&this._documentos[e].numeroDoc==
f[1]&&this._documentos[e].cuenta==f[2]&&(f=c[e].getValue(),""!==f&&(a+=parseFloat(f,10)))}return a},_generarTabla:function(){var a=this.selectOne("tbody#cmovi");a.innerHTML="";for(var b=0,c=this._getTotalFormaPago(),d=0,e=0;e<this._movimientos.length;e++)"A"==this._movimientos[e].estado&&(a.innerHTML+="<tr><td align='center'>"+(e+1)+"</td><td>"+this._movimientos[e].cuenta+"</td><td>"+this._movimientos[e].detalleCuenta+"</td><td>"+this._movimientos[e].textoCentro+"</td><td align='right'>"+this._movimientos[e].valor2+
"</td><td align='center'><div class='hyDetails'></div></td><td align='center'><div class='hyDelete'></div></td></tr>",b+=this._movimientos[e].valor2,"D"==this._movimientos[e].naturaleza?c+=parseFloat(this._movimientos[e].valor2,10):d+=parseFloat(this._movimientos[e].valor2,10));for(var f=a.select("div.hyDetails"),e=0;e<f.length;e++)f[e].observe("click",this._editar.bind(this,e));a=a.select("div.hyDelete");for(e=0;e<a.length;e++)a[e].observe("click",this._eliminar.bind(this,e));e=this._sumCartera();
-1<e?d+=e:c+=e;this._updateSumas(c,d);return b},_getTotalFormaPago:function(){for(var a=0,b=0;b<this._formaPago.length;b++)this._formaPago[b]&&this._formaPago[b].estado&&"A"==this._formaPago[b].estado&&(a+=parseFloat(this._formaPago[b].valor,10));return a},_getTotalMovi:function(){for(var a=0,b=0,c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&("D"==this._movimientos[c].naturaleza?a+=parseFloat(this._movimientos[c].valor2,10):b+=parseFloat(this._movimientos[c].valor2,10));for(c=
0;c<this._formaPago.length;c++)"A"==this._formaPago[c].estado&&("D"==this._formaPago[c].naturaleza?a+=parseFloat(this._formaPago[c].valor,10):b+=parseFloat(this._formaPago[c].valor,10));c=this._sumCartera();-1<c?b+=c:a+=c;return{debitos:a,creditos:b}},_generarTablaFp:function(){var a=this.selectOne("tbody#cFormaPago");a.innerHTML="";var b=0,c=this._getTotalFormaPago();c&&parseFloat(c,10);for(c=0;c<this._formaPago.length;c++)"A"==this._formaPago[c].estado&&(a.innerHTML+="<tr><td align='center'>"+(c+
1)+"</td><td>"+this._formaPago[c].formaPago_det+"</td><td>"+this._formaPago[c].numero+"</td><td>"+this._formaPago[c].descripcion+"</td><td align='right'>"+this._formaPago[c].valor+"</td><td align='center'><div class='hyDetails'></div></td><td align='center'><div class='hyDelete'></div></td></tr>",b+=this._formaPago[c].valor);for(var d=a.select("div.hyDetails"),c=0;c<d.length;c++)d[c].observe("click",this._editarFp.bind(this,c));a=a.select("div.hyDelete");for(c=0;c<a.length;c++)a[c].observe("click",
this._eliminarFp.bind(this,c));sumasContab=this._getTotalMovi();this._updateSumas(parseFloat(sumasContab.debitos,10),parseFloat(sumasContab.creditos,10));return b},_updateSumas:function(a,b){isNaN(b)&&(b=0);isNaN(a)&&(a=0);var c;c='<table class="sumasTable"><tr><td>D\u00e9bitos <b>'+a+"</b></td>"+("<td>Cr\u00e9ditos <b>"+b+"</b></td>");this._sumasIguales.update((0!=a-b?c+('<td>Diferencia <b class="descuadre">'+(a-b)+"</b></td>"):c+("<td>Diferencia <b>"+(a-b)+"</b></td>"))+"</tr></table>")},_editar:function(a){this.selectOne("input#nit2").setValue(this._movimientos[a].nit2);
this.selectOne("input#nit2_det").setValue(this._movimientos[a].nombre2);this.selectOne("input#cuenta").setValue(this._movimientos[a].cuenta);this.selectOne("input#cuenta_det").setValue(this._movimientos[a].detalleCuenta);this.selectOne("select#naturaleza").setValue(this._movimientos[a].naturaleza);this.selectOne("input#descripcion").setValue(this._movimientos[a].descripcion);this.selectOne("select#centroCosto").setValue(this._movimientos[a].centroCosto);this.selectOne("input#valor2").setValue(this._movimientos[a].valor2);
this._activeMov=a;this.selectOne("input#addMovi").value="Guardar";this.selectOne("input#nuevoMovi").show()},_editarFp:function(a){this.selectOne("select#fp_formaPago").setValue(this._formaPago[a].formaPago);this.selectOne("input#fp_numero").setValue(this._formaPago[a].numero);this.selectOne("input#fp_descripcion").setValue(this._formaPago[a].descripcion);this.selectOne("input#fp_valor").setValue(this._formaPago[a].valor);this._activeFormaPago=a;this.selectOne("input#addFormaPago").value="Guardar";
this.selectOne("input#nuevoFormaPago").show()},_eliminar:function(a){this._movimientos[a].estado="B";this._generarTabla()},_eliminarFp:function(a){this._formaPago[a].estado="B";this._generarTablaFp()},_calculateSumas:function(){for(var a=0,b=this.selectOne("input#valor"),b=!b||""===b.getValue()?0:parseFloat(b.getValue(),10),c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&("D"==this._movimientos[c].naturaleza?a+=parseFloat(this._movimientos[c].valor2,10):b+=parseFloat(this._movimientos[c].valor2,
10));for(c=0;c<this._formaPago.length;c++)"A"==this._formaPago[c].estado&&(a+=parseFloat(this._formaPago[c].valor,10));c=this._sumCartera();-1<c?b+=c:a+=c;this._updateSumas(a,b)},_onChangeReciboCajara:function(a){if("@"!=a.getValue()){var b=this.selectOne("select#numeroReciboCaja");b.selectedIndex=0;new HfosAjax.JsonRequest("recibo_caja/nextReciboCaja",{parameters:{ReciboCajaraId:a.getValue()},onSuccess:function(a,b){a.innerHTML="";if("OK"==b.status){var e="";b.lista.each(function(a){e+="<option value='"+
a+"'>"+a});a.innerHTML=e}else new HfosModal.alert({title:"Generar ReciboCajas",message:"La ReciboCajara tiene todos sus ReciboCajas emitidos"})}.bind(this,b)})}a.blur()},_backToSearch:function(){this._oldTercero=null;this.go("recibo_caja/index",{onSuccess:this._setIndexCallbacks.bind(this)});this.hideStatusBar()},_printReciboCaja:function(){window.open(Utils.getKumbiaURL("recibo_caja/imprimir?"+this._key))},_anulaReciboCaja:function(){new HfosModal.confirm({title:"ReciboCajas",message:"Seguro desea anular el ReciboCaja?",
onAccept:function(){new HfosAjax.JsonRequest("recibo_caja/anular",{checkAcl:!0,parameters:this._key,onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message);window.setTimeout(function(){this._backToSearch()}.bind(this),2E3)}.bind(this)})}.bind(this)})}});HfosBindings.late("win-recibo-caja","afterCreate",function(a){new ReciboCaja(a)});var ReabrirAno=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._reabrirAno.bind(this,a))},_reabrirAno:function(a){var b=this.getElement("reabrirAnoForm");null!==b?(a.disable(),this.setIgnoreTermSignal(!0),new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 re-abriendo el a\u00f1o...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?this.getMessages().error(a.message):this.getMessages().success("Se re-abri\u00f3 el a\u00f1o correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})):this.getMessages().error("No se puede reabrir el a\u00f1o en este momento")}});HfosBindings.late("win-reabrir-ano","afterCreateOrRestore",function(a){new ReabrirAno(a)});var CierreAnual=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("saveButton");a.observe("click",this._cierreAnual.bind(this,a))},_cierreAnual:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cierreForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cierre anual...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success("Se realiz\u00f3 el cierre anual correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cierre-anual","afterCreateOrRestore",function(a){new CierreAnual(a)});var CertificadoIca=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"certificadoIcaForm",{update:"resultados",onCreate:function(){alert("aaaaa")},onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el certificado correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-certificado-ica","afterCreateOrRestore",function(a){new CertificadoIca(a)});var CertificadoRetencion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"certificadoRetencionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el certificado correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-certificado-retencion","afterCreateOrRestore",function(a){new CertificadoRetencion(a)});var BalanceGeneral=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"balanceGeneralForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-balance-general","afterCreateOrRestore",function(a){new BalanceGeneral(a)});var Caratulas=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"caratulasForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-caratulas","afterCreateOrRestore",function(a){new Caratulas(a)});var ReabrirCuentas=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._reabrirCuentas.bind(this,a))},_reabrirCuentas:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("reabrirCuentasForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1n reabriendo las cuentas...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success("Se reabrieron las cuentas correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-reabrir-cuentas","afterCreateOrRestore",function(a){new ReabrirCuentas(a)});var CierreCuentas=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cierreForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1n cerrando las cuentas...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success("Se realiz\u00f3 el cierre correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cierre-cuentas","afterCreateOrRestore",function(a){new CierreCuentas(a)});var EjecucionPres=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"ejecucionPresForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-ejecucion-pres","afterCreateOrRestore",function(a){new EjecucionPres(a)});var PyG=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"pygForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-pyg","afterCreateOrRestore",function(a){new PyG(a)});var OrdenesServicio=Class.create(HfosProcessContainer,{_key:null,_movimientos:[],_activeMov:0,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.getElement("newButton");null!==a&&(a.observe("click",this._newOrden.bind(this)),new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron ordenes de servicio");break;case "1":this._key=a.key;this.go("ordenes/editar",
{parameters:this._key,onSuccess:this._setEditCallbacks.bind(this)});break;case "n":var c=new HfosBrowseData(this,7);c.setEnableDeleteButton(!1);c.build(this.getElement("resultados"),a);a=c.getDetailsButtons();for(c=0;c<a.length;c++)a[c].store("primary",a[c].title),a[c].title="Ver/Editar",a[c].observe("click",this._detailsHandler.bind(this,a[c]));this.scrollToBottom();this._notifyContentChange()}}.bind(this)}));this.hideStatusBar()},_detailsHandler:function(a){this._key=a.retrieve("primary");this.go("ordenes/editar",
{parameters:this._key,onSuccess:this._setEditCallbacks.bind(this)})},_newOrden:function(){this.go("ordenes/nueva",{onSuccess:this._setNewCallbacks.bind(this)})},_setEditCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));var a=this.getElement("printButton");null!==a&&a.observe("click",this._printOrden.bind(this));a=this.getElement("deleteButton");if(null!==a){a.observe("click",this._eliminaOrden.bind(this));this.getElement("loadButton").observe("click",
this._contabilizaOrden.bind(this));a=this.getElement("saveButton");a.observe("click",this._saveOrden.bind(this,a));this.selectOne("input#nit").activate();for(var a=this.select("tr.orden-linea"),b=0;b<a.length;b++)this._addGridCallbacks(b+1);this._notifyContentChange();this.scrollToBottom();this._showTotalBar();this._totalizeOrden()}},_selectRow:function(a){var b=a.up(1);b.hasClassName("lineaError")||(a.checked?b.addClassName("selectedRow"):b.removeClassName("selectedRow"));for(var a=0,b=this.select('input[type="checkbox"]'),
c=0;c<b.length;c++)b[c].checked&&a++;b=this.getStatusBarElement("movimientoSeleccion");0<a?b.show():b.hide()},abrirComprobante:function(){},_printOrden:function(){window.open(Utils.getKumbiaURL("ordenes/imprimir?codigoComprob="+this.selectOne("input#codigoComprob").getValue()+"&numero="+this.selectOne("input#numero").getValue()))},_onChangeFecha:function(){},_saveOrden:function(){var a=this.getElement("grabarForm");new HfosAjax.JsonFormRequest(a,{onCreate:function(a){this.getElement("headerSpinner").show();
a.disable()}.bind(this,a),onSuccess:function(a){"OK"==a.status?this.getMessages().success(a.message):"FAILED"==a.status&&this.getMessages().error(a.message)}.bind(this),onComplete:function(a){this.getElement("headerSpinner").hide();a.enable()}.bind(this,a)})},_setNewCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));DateField.observe("fechaOrden","change",this._onChangeFecha.bind(this));var a=this.getElement("saveButton");a.observe("click",this._saveOrden.bind(this,
a));this.selectOne("input#nit").activate();this._addGridCallbacks(1);this._showTotalBar()},_showTotalBar:function(){var a;this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option></select><td><td class="totalOrden" align="right"></td></tr></table>');a=this.getStatusBarElement("opcionesSeleccion");
a.observe("change",function(a){try{switch($F(a)){case "D":this._deleteRows()}a.setValue("@")}catch(c){HfosException.show(c)}}.bind(this,a));this._totalOrden=this.getStatusBarElement("totalOrden");this._totalOrden.update("")},_deleteRows:function(){for(var a=0,b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a++;0<a&&(b.length==a?new HfosModal.alert({title:"Ordenes de servicio",message:"La orden de servicio debe tener al menos un item"}):new HfosModal.confirm({title:"Ordenes de servicio",
message:"Seguro desea eliminar los items seleccionados?",onAccept:function(){for(var a=[],b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a.push(b[c].up(1).retrieve("position"));for(c=0;c<a.length;c++)this.getElement("linea"+a[c]).erase();this._totalizeOrden()}.bind(this)}))},_pushRowForUpdate:function(a){var b=a.up(1).retrieve("position")+1;if(null===this.getElement("linea"+b)){var c=document.createElement("TR");c.addClassName("linea"+b);var d=document.createElement("TD");
d.addClassName("numero");d.update(b);c.appendChild(d);d=document.createElement("TD");d.update('<input type="checkbox" class="itemCheck" id="itemCheck'+b+'"/>');c.appendChild(d);d=document.createElement("TD");d.addClassName("numero");d.update('<input type="text" class="item" name="item[]" id="item'+b+'" size="10"/>');c.appendChild(d);d=document.createElement("TD");d.addClassName("numero");d.update('<input type="text" class="descripcion" name="descripcion[]" id="descripcion'+b+'" size="27"/>');c.appendChild(d);
d=document.createElement("TD");d.addClassName("centros");var e=this.select("select.centroCosto")[0];d.appendChild(e.cloneNode(!0));c.appendChild(d);d=document.createElement("TD");d.update('<input type="text" class="valor numeric" name="valor[]" id="valor'+b+'" size="15"/>');c.appendChild(d);this.getElement("ordenes-body").appendChild(c);this._addGridCallbacks(b);a.hasClassName("valor")&&window.setTimeout(function(){this.select("input.item")[b-1].activate()}.bind(this),100);this._notifyContentChange();
this.scrollToBottom()}},_updateCodigoItem:function(a,b){a&&a.setValue(b.value)},_addGridCallbacks:function(a){var b=this.getElement("linea"+a);b.store("position",a);a=b.getElement("itemCheck");a.observe("change",this._selectRow.bind(this,a));a=b.getElement("descripcion");a.observe("blur",this._onBlurDescripcion.bind(this,a));var c=b.getElement("item");c.observe("blur",this._onBlurItem.bind(this,c,a));new HfosAutocompleter(a,"refe/queryByDescription",{paramName:"descripcion",afterUpdateElement:this._updateCodigoItem.bind(this,
c)});a=b.getElement("valor");a.observe("blur",this._onBlurValor.bind(this,a));b=b.getElement("centroCosto");b.observe("blur",this._onChangeCentro.bind(this,b))},_onBlurItem:function(a,b){""!=a.getValue()&&new HfosAjax.JsonRequest("refe/getItem",{parameters:"item="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?(b.setValue(e.descripcion),this.getMessages().setDefault(),this._pushRowForUpdate(a)):"FAILED"==e.status&&this.getMessages().error(e.message)}.bind(this,a,b)})},_onBlurDescripcion:function(a){""!=
a.getValue()&&this._pushRowForUpdate(a)},_onBlurValor:function(a){""!=a.getValue()&&this._pushRowForUpdate(a);this._totalizeOrden()},_onChangeCentro:function(a){this._pushRowForUpdate(a)},_eliminaOrden:function(){new HfosModal.confirm({title:"Ordenes de Servicio",message:"Seguro desea eliminar la orden de servicio?",onAccept:function(){new HfosAjax.JsonRequest("ordenes/eliminar",{checkAcl:!0,parameters:this._key,onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):(this.getMessages().success(a.message),
window.setTimeout(function(){this.go("ordenes/index",{onSuccess:this._setIndexCallbacks.bind(this)})}.bind(this),1E3))}.bind(this)})}.bind(this)})},_contabilizaOrden:function(){new HfosModal.confirm({title:"Ordenes de Servicio",message:"Seguro desea contabilizar la orden de servicio?",onAccept:function(){new HfosAjax.JsonRequest("ordenes/contabilizar",{checkAcl:!0,parameters:this._key,onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message)}.bind(this)})}.bind(this)})},
_totalizeOrden:function(){for(var a=this.select("input.valor"),b=0,c=0;c<a.length;c++)""!=a[c].getValue()&&(b+=parseFloat(a[c].getValue(),10));b=Utils.numberFormat(b);this._totalOrden.update('<table class="sumasTable"><tr><td>Total Orden <b>'+b+"</b></td></tr></table>")},_backToSearch:function(){this.go("ordenes/index",{onSuccess:this._setIndexCallbacks.bind(this)})}});HfosBindings.late("win-ordenes-servicio","afterCreate",function(a){new OrdenesServicio(a)});var ComprobanteCierre=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("saveButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cierreForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 generando el comprobante de cierre anual...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success("Se gener\u00f3 el comprobante de cierre anual correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-comprobante-cierre","afterCreateOrRestore",function(a){new ComprobanteCierre(a)});var ReabrirMes=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._reabrirCierre.bind(this,a))},_reabrirCierre:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("reabrirForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 re-abriendo el mes...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?this.getMessages().error(a.message):(this.getMessages().success("Se re-abri\u00f3 el mes correctamente"),this.selectOne("#anteriorCierre").update(a.anteriorCierre),this.selectOne("#cierreActual").update(a.cierreActual))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-reabrir-mes","afterCreateOrRestore",function(a){new ReabrirMes(a)});var LibroMayor=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"libroMayorForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-libro-mayor","afterCreateOrRestore",function(a){new LibroMayor(a)});var LibroDiario=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"libroDiarioForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-libro-diario","afterCreateOrRestore",function(a){new LibroDiario(a)});var NovedadActivos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"novedadActivosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-novedad-activos","afterCreateOrRestore",function(a){new NovedadActivos(a)});var Numeracion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"numeracionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-numeracion","afterCreateOrRestore",function(a){new Numeracion(a)});var Ejecucion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);"undefined"==typeof a.tagName&&a.getContentElement().addClassName("window-content-dark");Hfos.loadSource("canvas/chart")}});HfosBindings.late("win-ejecucion","afterCreateOrRestore",function(a){new Ejecucion(a)});var LibroTerceros=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"libroTercerosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-libro-terceros","afterCreateOrRestore",function(a){new LibroTerceros(a)});var Medios=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this.getElement("saveButton").observe("click",this._generar.bind(this))},_generar:function(){var a=this.getElement("saveButton"),b=this.getElement("mediosForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a,b){a.disable();b.disable();this.getElement("headerSpinner").show()}.bind(this,a,b),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):
this.getMessages().success(a.message);"undefined"!=typeof a.url&&window.open(a.url)}.bind(this),onComplete:function(a,b){a.enable();b.enable();this.getElement("headerSpinner").hide()}.bind(this,a,b)})}});HfosBindings.late("win-medios","afterCreateOrRestore",function(a){new Medios(a)});var CamposMedios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("select#magfor");a.observe("change",this._showCampos.bind(this,a));this.getElement("saveButton").observe("click",this._guardar.bind(this))},_guardar:function(){var a=this.getElement("camposCuentasForm");new HfosAjax.JsonFormRequest(a,{onCreate:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==
a.status?this.getMessages().success(a.message):"FAILED"==a.status&&this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})},_showCampos:function(a){"@"!=a.getValue()?new HfosAjax.Request("campos_medios/getCampos",{parameters:"codigoFormato="+a.getValue(),onSuccess:function(a){this.getElement("campos").update(a.responseText);this._camposCallbacks();this._notifyContentChange()}.bind(this)}):(this.getElement("campos").update(""),this._notifyContentChange())},
_camposCallbacks:function(){for(var a=this.getElement("camposDisponibles").select('input[type="checkbox"]'),b=0;b<a.length;b++)a[b].observe("change",this._selectCampo.bind(this,a[b]));this._sortCampos();a=this.getElement("camposCuentasTable").tBodies[0].select("tr");for(b=0;b<a.length;b++)this._addRowHandler(a[b]);new HfosTabs(this,"tabbed")},_addRowHandler:function(a){var b=a.selectOne("div.hyAccept");b.title="Duplicar";b.observe("click",this._addCuentasRow.bind(this,a));b=a.selectOne("div.hyDelete");
null!==b&&b.observe("click",this._removeCuentasRow.bind(this,a))},_addCuentasRow:function(a){var b=a.cloneNode(!0);b.appendChild((new Element("TD")).update('<div class="hyDelete"></div>'));a.parentNode.appendChild(b);this._addRowHandler(b)},_removeCuentasRow:function(a){a.erase()},_sortCampos:function(){var a=this.getElement("camposSeleccionados");Sortable.destroy(a);Sortable.create(a)},_selectCampo:function(a){var b=this.getElement("camposSeleccionados"),c=a.id.replace("campo_");a.up().toggleClassName("selected");
if(!0==a.checked){var a=a.adjacent("span")[0],d=document.createElement("LI");d.setAttribute("id","campo_"+c);d.update(a.innerHTML);b.appendChild(d)}else c=b.selectOne("li#campo_"+c),b.removeChild(c);this._sortCampos()}});HfosBindings.late("win-campos-medios","afterCreate",function(a){new CamposMedios(a)});var HfosCuentasSelectores={_selectores:{},add:function(a,b){HfosCuentasSelectores._selectores[a]=b},removeAll:function(){for(var a in HfosCuentasSelectores._selectores)HfosCuentasSelectores._selectores[a].destroy(),delete HfosCuentasSelectores._selectores[a]}},HfosCuentasSelector=Class.create({_element:null,_elementDetalle:null,_elements:{},_cuentaElement:null,_elementDiv:null,_cuenta:"",_oldCuenta:"",_blockQuery:!1,_selectionFirst:!1,_selectionLast:!1,_resultsPointer:0,_liResults:[],_windowManager:null,
initialize:function(a,b){HfosCuentasSelectores.removeAll();this._element=$(a);this._elementDetalle=$(b);var c;c='<table cellspacing="0" cellpadding="0" class="cuentaSelector"><tr><td><input type="text" class="tipo cuentaSelectorPart" size="1" maxlength="1"/></td><td><input type="text" class="mayor cuentaSelectorPart" size="1" maxlength="1"/></td><td><input type="text" class="clase cuentaSelectorPart" size="2" maxlength="2"/></td><td><input type="text" class="subclase cuentaSelectorPart" size="2" maxlength="2"/></td><td><input type="text" class="auxiliar cuentaSelectorPart" size="3" maxlength="3"/></td><td><input type="text" class="subaux cuentaSelectorPart" size="3" maxlength="3"/></td></tr></table>';
var d=this._element.selectionStart;this._element.hide();this._element.insert({after:c});this._cuentaElement=this._element.parentNode.getElement("cuentaSelector");c={tipo:{length:1,next:"mayor",prev:""},mayor:{length:1,next:"clase",prev:"tipo"},clase:{length:2,next:"subclase",prev:"mayor"},subclase:{length:2,next:"auxiliar",prev:"clase"},auxiliar:{length:3,next:"subaux",prev:"subclase"},subaux:{length:3,next:"",prev:"auxiliar"}};for(var e in c){var f=c[e];this._elements[e]=this._cuentaElement.getElement(e);
this._autoNextOn(e,f)}this._oldCuenta=this._element.value;this._setCuenta(this._element.value,!1);this.focus(d);for(e in c)this._elements[e].observe("blur",this._blurCuentaElement.bind(this)),this._elements[e].observe("focus",this._focusCuentaElement.bind(this));this._windowManager=Hfos.getApplication().getWorkspace().getWindowManager();HfosCuentasSelectores.add(this._element.id,this)},_getSelectedCuenta:function(){var a="",b;for(b in this._elements)"undefined"!=typeof this._elements[b].value&&(a+=
this._elements[b].value);return a},_setCuenta:function(a,b){this._blockQuery=!0;this._cuenta=a;this._customFocus();this._blockQuery=!1;this._queryByCuenta();!0==b&&9<a.length&&this._elementDetalle&&(this._elementDetalle.focus(),this.fire("leave",this._element))},_customFocus:function(){var a="tipo";0<this._cuenta.length?(this._elements.tipo.setValue(this._cuenta.substr(0,1)),a="mayor"):this._elements.tipo.setValue("");1<this._cuenta.length?(this._elements.mayor.setValue(this._cuenta.substr(1,1)),
a="clase"):this._elements.mayor.setValue("");2<this._cuenta.length?(this._elements.clase.setValue(this._cuenta.substr(2,2)),a="subclase"):this._elements.clase.setValue("");4<this._cuenta.length?(this._elements.subclase.setValue(this._cuenta.substr(4,2)),a="auxiliar"):this._elements.subclase.setValue("");6<this._cuenta.length?(this._elements.auxiliar.setValue(this._cuenta.substr(6,3)),a="subaux"):this._elements.auxiliar.setValue("");9<this._cuenta.length?(this._elements.subaux.setValue(this._cuenta.substr(9,
3)),a="detalle"):this._elements.subaux.setValue("");"undefined"!=typeof this._elements[a]&&this._elements[a].focus()},_setCuentaTag:function(a,b,c){var a=this._elements[a],d=$(a.id+"_tag"),e=a.up().positionedOffset();if(d)d.update(b);else{var f=this._windowManager.getSpaceElement(),d=document.createElement("DIV");d.addClassName("auxiliarTag");d.id=a.id+"_tag";d.hide();d.update(b);f.appendChild(d)}var f=this._windowManager.getActiveWindow(),g=f.getContentElement();g.positionedOffset();b=e[1]-g.scrollTop+
f.getTop()+a.getHeight();e=e[0]-g.scrollLeft+f.getLeft()+a.getHeight();d.setStyle({top:b+"px",left:e+"px",height:a.getWidth()+"px",backgroundColor:c});!1==d.visible()&&new Effect.Appear(d,{duration:0.2})},_removeCuentaTag:function(){},_removeCuentaTags:function(){var a=0.4;$$(".auxiliarTag").each(function(b){new Effect.Fade(b,{duration:a});a-=0.1;0>a&&(a=0.1)})},_autoNextOn:function(a,b){a=this._elements[a];a.observe("keyup",function(a,b,e){var f=parseInt(e.keyCode,10),g=!1;if((47<f&&58>f||95<f&&
110>f)&&a.selectionStart==a.value.length)a.value.length>=b.length&&("undefined"!=typeof this._elements[b.next]?(this._elements[b.next].activate(),g=!0):(this._setCuenta(this._getSelectedCuenta(),!0),this._elementDetalle&&this._elementDetalle.focus(),this.fire("leave",this._element)));else if(f==Event.KEY_RETURN){var h=a.value;if(""!=h){g="";if(a.value.length<b.length){for(var i=0;i<b.length-a.value.length;i++)g+="0";h=g+h}a.value=h;if("undefined"!=typeof this._elements[b.next])this._elements[b.next].activate(),
g=!0;else{this._elementDetalle&&this._elementDetalle.focus();this.fire("leave",this._element);return}}if(0<this._liResults.length){this._setCuenta(this._liResults[this._resultsPointer].id,!0);this._resetResults();return}}else if(8==f&&""==a.value||f==Event.KEY_LEFT&&0==a.selectionStart){if(0<a.value.length&&!1==this._selectionFirst){this._selectionFirst=!0;return}"undefined"!=typeof this._elements[b.prev]&&(this._elements[b.prev].focus(),g=!0)}else if(f==Event.KEY_RIGHT&&a.selectionStart==a.value.length)if(""!==
b.next)if(0<a.value.length){if(!1==this._selectionLast){this._selectionLast=!0;return}if("undefined"!=typeof this._elements[b.next])this._elements[b.next].focus();else{this._elementDetalle.focus();this.fire("leave",this._element);return}}else if("undefined"!=typeof this._elements[b.next])this._elements[b.next].focus();else{this._elementDetalle&&this._elementDetalle.focus();this.fire("leave",this._element);return}else{this._elementDetalle.focus();this.fire("leave",this._element);return}else if(46==
f&&a.selectionStart==a.value.length){if(!1==this._selectionLast){this._selectionLast=!0;return}if("undefined"!=typeof this._elements[b.next])this._elements[b.next].focus(),this._elements[b.next].selectionStart=0,this._elements[b.next].selectionEnd=0}f==Event.KEY_DOWN?0<this._liResults.length?this._moveCursorNext():this.fire("keyup",this._element,e):f==Event.KEY_UP?0<this._liResults.length?this._moveCursorPrev():this.fire("keyup",this._element,e):(this._selectionLast=this._selectionFirst=!1,!1==g&&
this.fire("keyup",this._element,e))}.bind(this,a,b));a.observe("keydown",function(a,b,e){var f=parseInt(e.keyCode,10);if(!1==e.shiftKey&&9==f){if(f=a.value,""!=f){var g="";if(a.value.length<b.length){for(var h=0;h<b.length-a.value.length;h++)g+="0";f=g+f}a.value=f;"undefined"!=typeof this._elements[b.next]?this._elements[b.next].activate():(this._elementDetalle&&this._elementDetalle.focus(),this.fire("leave",this._element));new Event.stop(e)}}else 65<=f&&90>=f&&new Event.stop(e)}.bind(this,a,b))},
_resetResults:function(){if(null!==this._elementDiv)this._elementDiv.hide(),this._elementDiv.innerHTML="";this._liResults=[]},_selectFirstAuxiliar:function(){0<this._liResults.length&&this._liResults[0].addClassName("selected");this._resultsPointer=0},_moveCursorNext:function(){this._resultsPointer++;if(this._resultsPointer>=this._liResults.length)this._resultsPointer=0;this._moveCursor()},_moveCursorPrev:function(){this._resultsPointer--;if(0>this._resultsPointer)this._resultsPointer=this._liResults.length-
1;this._moveCursor()},_moveCursor:function(){0<this._liResults.length&&(this._liResults.each(function(a){a.removeClassName("selected")}),this._liResults[this._resultsPointer].addClassName("selected"))},_blurCuentaElement:function(){this._queryByCuenta()},_focusCuentaElement:function(){var a=document.activeElement;if(""==a.getValue()){var a=a.className.split(" ")[0],b;for(b in this._elements)if(b==a)break;else if(""==this._elements[b].getValue()){this._elements[b].focus();break}}this._queryByCuenta()},
_queryByCuenta:function(){if(!1==this._blockQuery){var a=this._getSelectedCuenta();if(""!=a){if(a!=this._oldCuenta)new HfosAjax.Request("cuentas/queryCuenta",{method:"GET",parameters:{cuenta:a},onSuccess:this._successQueryCuenta.bind(this)}),this._oldCuenta=a,this.fire("change",this._element,null)}else this._removeCuentaTags(),this._resetResults(),this._oldCuenta=a}window.setTimeout(this._checkForBlurSelector.bind(this),100)},_checkForBlurSelector:function(){var a=document.activeElement;if("INPUT"==
a.tagName){var b=!1,c;for(c in this._elements)if(this._elements[c]==a){b=!0;break}!1==b&&this.fire("leave",this._element)}},_successQueryCuenta:function(a){a=Json.decode(a.responseText);if("S"==a.existe){if("undefined"!=typeof this._elementDetalle)if(this._elementDetalle.setValue(a.nombre),"N"==a.esAuxiliar)if(0<a.cuentasAuxiliares.length){for(var b="<table cellspacing='0' cellpadding='0'><tr>",c=0,d=["#aeaeae","#b0b0b0","#cfcfcf","#d0d0d0","#ececec"],e=["tipo","mayor","clase","subclase","auxiliar"],
f=0;f<e.length;f++){var g=e[f];if("undefined"!=typeof a[g+"Detalle"]){if(""!=a[g+"Detalle"])var h=this._elements[g],g=a[g+"Detalle"],i=parseInt(9.4*g.length,10),b=b+("<td class='auxiliarTag' style='background-color:"+d[c]+";height:"+i+"px' valign='top'><div style='width:"+h.getWidth()+"px'>"+g.replace(/ /g,"&nbsp;")+"</div></td>");c++}}b+="<td valign='top'>";f=this._elements.tipo;c=f.positionedOffset();if(d=this._windowManager.getActiveWindow()){e=d.getContentElement();e.positionedOffset();f=c[1]-
e.scrollTop+d.getTop()+f.getHeight();c=c[0]-e.scrollLeft+d.getLeft();this._elementDiv=$("cuentasDiv");null===this._elementDiv?(this._elementDiv=document.createElement("DIV"),this._elementDiv.id="cuentasDiv",this._elementDiv.hide(),this._windowManager.getSpaceElement().appendChild(this._elementDiv)):this._elementDiv.innerHTML="";this._elementDiv.setStyle({top:f+"px",left:c+"px"});b+="<ul>";for(f=0;f<a.cuentasAuxiliares.length;f++)b+="<li id='"+a.cuentasAuxiliares[f].cuenta,b+="'><span class='resAuxiliar'>"+
a.cuentasAuxiliares[f].auxiliar+"</span>",b+=a.cuentasAuxiliares[f].nombre+"</li>";this._elementDiv.innerHTML=b+"</ul></td></tr></table>";this._elementDiv.show();this._liResults=this._elementDiv.select("li");this._selectFirstAuxiliar()}}else this._resetResults();else this._removeCuentaTags(),this._resetResults(),f=document.activeElement,""==f.value&&(this._elementDetalle&&this._elementDetalle.focus(),this.fire("leave",this._element))}else this._removeCuentaTags(),this._resetResults(),this._elementDetalle.setValue("NO EXISTE LA CUENTA")},
focus:function(a){if("undefined"==typeof a)a=this._cuenta.length;var b={12:"subaux",9:"auxiliar",6:"subclase",4:"clase",2:"mayor",1:"tipo","0":"tipo"};if("undefined"!=typeof b[a])a=this._elements[b[a]],a.selectionStart=a.value.length,a.focus()},getCuenta:function(){return this._cuenta},destroy:function(){this._removeCuentaTags();this._resetResults();if(null!==this._cuentaElement)this._cuentaElement.erase(),this._element.value=this._getSelectedCuenta(),this._element.show(),this._cuentaElement=null},
observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a,b,c){if(!Object.isUndefined(this["_"+a]))for(var d=0;d<this["_"+a].length;d++)if(!1===this["_"+a][d](this,b,c))return!1;return!0}});var CierreMensual=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cierreForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cierre contable, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el cierre correctamente"),this.selectOne("#proximoCierre").update(a.proximoCierre),this.selectOne("#cierreActual").update(a.cierreActual))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-cierre-contable","afterCreateOrRestore",function(a){new CierreMensual(a)});var CarteraEdades=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"carteraEdadesForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-cartera-edades","afterCreateOrRestore",function(a){new CarteraEdades(a)});var TrasladoActivos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this.getElement("saveButton").observe("click",this._trasladar.bind(this));new HfosTabs(this,"tabbed")},_trasladar:function(){new HfosModal.confirm({title:"Traslado Activos",message:"Seguro desea realizar el traslado?",onAccept:function(){this.getElement("headerSpinner").show();var a=this.getElement("trasladoActivosForm");new HfosAjax.JsonFormRequest(a,{onSuccess:function(a){"OK"==a.status?this.getMessages().success("Se realiz\u00f3 el traslado correctamente"):
this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}.bind(this)})}});HfosBindings.late("win-traslado-activos","afterCreateOrRestore",function(a){new TrasladoActivos(a)});var AnularDepreciacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);null!==this.getElement("anularDepreciacionForm")&&new HfosForm(this,"anularDepreciacionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?this.getMessages().success(a.message):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-anular-depreciacion","afterCreate",function(a){new AnularDepreciacion(a)});var ConsultaDepreciacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("input#activosId"),b=this.selectOne("input#activosId_det");a.observe("blur",this._showActivosCalcs.bind(this,a,b));b.observe("blur",this._showActivosCalcs.bind(this,a,b))},_showActivosCalcs:function(a,b){a.getValue()&&b.getValue()?(this.getElement("chooseActivo").hide(),this.getElement("DepreciacionContent").show(),this._calcularDepreciacion()):
(this.getElement("chooseActivo").show(),this.getElement("DepreciacionContent").hide())},_calcularDepreciacion:function(){new HfosAjax.Request("consulta_depreciacion/calcularDepreciacion",{parameters:"activosId="+activosId.getValue(),onCreate:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){this.selectOne("#depContent").update(a.responseText);this._notifyContentChange();this.getElement("headerSpinner").hide()}.bind(this)})}});
HfosBindings.late("win-consulta-depreciacion","afterCreate",function(a){new ConsultaDepreciacion(a)});var ConsultaCausacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("input#diferidosId"),b=this.selectOne("input#diferidosId_det");a.observe("blur",this._showDiferidosCalcs.bind(this,a,b));b.observe("blur",this._showDiferidosCalcs.bind(this,a,b))},_showDiferidosCalcs:function(a,b){a.getValue()&&0>b.getValue().indexOf("NO EXISTE")?(this.getElement("chooseDiferidos").hide(),this.getElement("CausacionContent").show(),
this._calcularCausacion()):(this.getElement("chooseDiferidos").show(),this.getElement("CausacionContent").hide())},_calcularCausacion:function(){new HfosAjax.Request("consulta_causacion/calcularCausacion",{parameters:"diferidosId="+diferidosId.getValue(),onCreate:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){this.selectOne("#cauContent").update(a.responseText);this._notifyContentChange();this.getElement("headerSpinner").hide()}.bind(this)})}});
HfosBindings.late("win-consulta-causacion","afterCreate",function(a){new ConsultaCausacion(a)});var Depreciacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"depreciacionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success(a.message),"undefined"!=typeof a.file&&window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-depreciacion","afterCreateOrRestore",function(a){new Depreciacion(a)});var CambioNit=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){HfosCommon.addTerceroCompleter("nitErrado");HfosCommon.addTerceroCompleter("nitCorrecto");this.getElement("importButton").observe("click",this._changeTercero.bind(this))},_changeTercero:function(){this.setIgnoreTermSignal(!0);var a=this.getElement("cambiarForm");new HfosAjax.JsonFormRequest(a,{onCreate:function(){this.getElement("importButton").disable();
this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?this.go("cambio_nit/index",{onSuccess:function(){this._setIndexCallbacks();this.getMessages().success(a.message)}.bind(this)}):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("importButton").enable();this.getElement("headerSpinner").hide();this.setIgnoreTermSignal(!1)}.bind(this)})}});HfosBindings.late("win-cambio-nit","afterCreateOrRestore",function(a){new CambioNit(a)});var Consultas=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this._setBuscarFormCallbacks()},_setBuscarFormCallbacks:function(){var a=this.getElement("buscarButton");if(null!==a){a.observe("click",function(a){this.go("consultas/consultar",{parameters:a.form.serialize(),onSuccess:this._setQueryCallbacks.bind(this)})}.bind(this,a));var a=this.selectOne("select#tipo"),b=this._onChangeTipo.bind(this,
a);a.observe("change",b);b()}},_setQueryCallbacks:function(){var a=this.getElement("backButton");null!==a&&a.observe("click",this._backConsultar.bind(this));this._setBuscarFormCallbacks()},_onChangeTipo:function(a){this.select("tr.consulta-tr").each(function(a){a.hide()});switch(a.getValue()){case "F":this.selectOne("tr#trFechaInicial").show();this.selectOne("tr#trFechaFinal").show();break;case "N":this.selectOne("tr#trNitInicial").show();this.selectOne("tr#trNitFinal").show();break;case "D":this.selectOne("tr#trNumeroInicial").show(),
this.selectOne("tr#trNumeroFinal").show()}},_backConsultar:function(){this.go("consultas/index",{onSuccess:this._setIndexCallbacks.bind(this)})}});HfosBindings.late("win-consultas","afterCreateOrRestore",function(a){new Consultas(a)});var ComprobanteDiario=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"comprobanteDiarioForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-comprobante-diario","afterCreateOrRestore",function(a){new ComprobanteDiario(a)});var FormatoCheque=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._addIndexCallbacks()},_addIndexCallbacks:function(){var a=this.selectOne("select#chequeraId");a.observe("change",this._onChangeChequera.bind(this,a));this.getElement("saveButton").observe("click",this._saveFormato.bind(this));this.getElement("copyButton").observe("click",this._selectFormato.bind(this))},_onChangeChequera:function(a){"@"==a.getValue()?(this.getMessages().notice("Seleccione una chequera para configurar su formato de impresi\u00f3n"),
this.getElement("saveButton").hide(),this.getElement("chooseChequera").show(),this.getElement("chequeraFormato").update("")):(this.getMessages().notice("Indique las posiciones horizontales y verticales de los items del cheque"),this.getElement("chooseChequera").hide(),new HfosAjax.Request("formato_cheque/getFormato",{parameters:{chequeraId:this.selectOne("select#chequeraId").getValue()},onCreate:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){this.getElement("chequeraFormato").update(a.responseText);
this._notifyContentChange()}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("saveButton").show()}.bind(this)}))},_saveFormato:function(){var a=this.selectOne("select#chequeraId").getValue();if("@"!=a){for(var a={chequeraId:a,medida:this.selectOne("select#medida").getValue()},b="ano,mes,dia,valor,tercero,suma,numero,nota,cuenta,detalle,debito,credito,valor_movi,empresa,num_cheque,cuenta_bancaria".split(","),c=0;c<b.length;c++)this.selectOne("input#"+b[c]+"X")&&
(a[b[c]+"X"]=this.selectOne("input#"+b[c]+"X").getValue(),a[b[c]+"Y"]=this.selectOne("input#"+b[c]+"Y").getValue());new HfosAjax.JsonRequest("formato_cheque/guardar",{onCreate:function(){this.getElement("headerSpinner").show()}.bind(this),parameters:a,onSuccess:function(a){"OK"==a.status?this.getMessages().success("Se actualiz\u00f3 correctamente el formato"):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("saveButton").show()}.bind(this)})}},
_selectFormato:function(){new HfosModalForm(this,"formato_cheque/selectFormato",{parameters:this._key,beforeClose:function(a,b,c){!1==b&&("OK"==c.status?this.getMessages().success(c.message,!0):this.getMessages().error(c.message,!0))}.bind(this)})}});HfosBindings.late("win-formato-cheque","afterCreate",function(a){new FormatoCheque(a)});var Cheque=Class.create(HfosProcessContainer,{_key:null,_movimientos:[],_activeMov:0,_oldTercero:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.getElement("newButton");null!==a&&(a.observe("click",this._newCheque.bind(this)),new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron cheques");break;case "1":this._key=a.key;this.go("cheque/ver",
{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this)});break;case "n":var c=new HfosBrowseData(this,7);c.setEnableDeleteButton(!1);c.build(this.getElement("resultados"),a);a=c.getDetailsButtons();for(c=0;c<a.length;c++)a[c].store("primary",a[c].title),a[c].title="Ver/Editar",a[c].observe("click",this._detailsHandler.bind(this,a[c]));this.scrollToBottom();this._notifyContentChange()}}.bind(this)}))},_detailsHandler:function(a){this._key=a.retrieve("primary");this.go("cheque/ver",{parameters:this._key,
onSuccess:this._setDetailsCallbacks.bind(this)})},_newCheque:function(){this.go("cheque/nuevo",{onSuccess:this._setNewCallbacks.bind(this)})},_setDetailsCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));var a=this.getElement("printButton");if(null!==a){a.observe("click",this._printCheque.bind(this));a=this.getElement("deleteButton");a.observe("click",this._anulaCheque.bind(this));var b=this.getElement("verComprob");null!==b?b.observe("click",Movimientos.abrir.bind(this,
b.title)):a.hide()}},abrirComprobante:function(){},_updateCartera:function(){var a=this.selectOne("input#nit");if(this._oldTercero!=a.value.strip())""==a.value.strip()||"0"==a.getValue()?(this.getElement("infoTercero").update("Seleccione un tercero para visualizar su cartera"),this.getElement("infoTercero").show(),this.getElement("carteraContent").hide()):(this._documentos=[],new HfosAjax.JsonRequest("cheque/getCartera",{parameters:"nit="+a.getValue(),onSuccess:function(a){if("OK"==a.status)if(0==
a.documentos.length)this.getElement("infoTercero").update("El tercero no tiene documentos en cartera asociados"),this.getElement("infoTercero").show(),this.getElement("carteraContent").hide();else{this.getElement("infoTercero").hide();var c;c='<table align="center" width="50%" class="hyBrowseTab zebraSt sortable" cellspacing="0"><thead><th class="nosort sortasc"></th><th class="sortcol">Tipo</th><th class="sortcol">N\u00famero</th><th class="sortcol">Cuenta</th><th class="sortcol">F. Emisi\u00f3n</th><th class="sortcol">F. Vence</th><th class="sortcol">Saldo</th><th class="sortcol">Abono</th></thead><tbody>';
for(var d=0;d<a.documentos.length;d++){var e=a.documentos[d].tipoDoc+"_"+a.documentos[d].numeroDoc+"_"+a.documentos[d].cuenta;c+='<tr><td><input type="checkbox" name="numeroDoc[]" value="'+e+'"/></td>';c+="<td>"+a.documentos[d].tipoDoc+"</td>";c+='<td align="right">'+a.documentos[d].numeroDoc+"</td>";c+='<td align="right">'+a.documentos[d].cuenta+"</td>";c+="<td>"+a.documentos[d].fEmision+"</td>";c+="<td>"+a.documentos[d].fVence+"</td>";c+='<td align="right">'+a.documentos[d].saldo+"</td>";c+='<td align="right"><input type="text" name="abono'+
e+'" class="abono numeric" value="'+a.documentos[d].saldoValor+'" size="9" maxlength="12"></td>';c+="</tr>"}this.getElement("carteraContent").update(c+"</tbody></table>");this.getElement("carteraContent").show();this._addDocumentoCallbacks();this._documentos=a.documentos;this._notifyContentChange()}}.bind(this)})),this._oldTercero=a.value.strip()},_addDocumentoCallbacks:function(){for(var a=this.getElement("carteraContent").select('input[type="checkbox"]'),b=0;b<a.length;b++)a[b].observe("click",
this._selectNumeroDoc.bind(this,a[b]));a=this.getElement("carteraContent").select("input.abono");for(b=0;b<a.length;b++)a[b].observe("blur",this._updateDebitosDoc.bind(this))},_selectNumeroDoc:function(a){a.up(1).toggleClassName("selected");this._calculateSumas()},_updateDebitosDoc:function(){this._calculateSumas()},_onChangeTab:function(a){"Cartera"==a&&this._updateCartera()},_showStatusBar:function(){var a;this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option></select><td><td class="totalOrden" align="right"></td></tr></table>');
this._sumasIguales=this.getStatusBarElement("totalOrden");this._sumasIguales.update("")},_setNewCallbacks:function(){this.getElement("backButton").observe("click",this._backToSearch.bind(this));this.getElement("saveButton").observe("click",this._grabarCheque.bind(this));new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)});HfosCommon.addCuentaCompleter("cuenta");HfosCommon.addTerceroCompleter("nit",!0);HfosCommon.addTerceroCompleter("nit2");this.selectOne("input#nit_det").observe("blur",
this._updateBeneficiario.bind(this));var a=this.selectOne("select#chequeraId");a.observe("change",this._onChangeChequera.bind(this,a));this.selectOne("input#valor").observe("blur",this._calculateSumas.bind(this));a=this.selectOne("input#addMovi");a.observe("click",this._addMovimiento.bind(this,a));this._showStatusBar();this._updateSumas(0,0);this._movimientos=[];this._activeMov=0},_updateBeneficiario:function(){var a=this.selectOne("input#nit_det"),b=this.selectOne("input#beneficiario");""==b.getValue()&&
!1==a.getValue().include("NO EXISTE")&&b.setValue(a.getValue())},_grabarCheque:function(){for(var a=0,b=this.selectOne("input#valor"),b=""===b.getValue()?0:parseFloat(b.getValue(),10),c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&("D"==this._movimientos[c].naturaleza?a+=this._movimientos[c].valor2:b+=this._movimientos[c].valor2);for(var d=this.getElement("carteraContent").select('input[type="checkbox"]'),e=this.getElement("carteraContent").select("input.abono"),c=0;c<d.length;c++)if(d[c].checked)for(var f=
0;f<this._documentos.length;f++){var g=d[c].getValue().split("_");this._documentos[f].numeroDoc==g[1]&&this._documentos[f].cuenta==g[2]&&(g=e[f].getValue(),""!==g&&(a+=parseFloat(g,10)))}if(a!=b)new HfosModal.alert({title:"Generar Cheques",message:"Movimientos contables descuadrados, por favor revise"});else if(a=this.selectOne("input#nit"),""==a.value.strip()||"0"==a.value)new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar el tercero del comprobante"}),a.activate();else if(""==this.selectOne("input#beneficiario").getValue()&&
this._updateBeneficiario(),"@"==this.selectOne("select#chequeraId").getValue())new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar la chequera"});else if(b=this.selectOne("input#valor"),0>=b.getValue()||""==b.getValue())new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar el valor del cheque"});else if(b=this.selectOne("textarea#observacion"),""==b.value.strip()||"0"==b.value)new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar la observaci\u00f3n \u00f3 nota del cheque"}),
a.activate();else{var h=this.getElement("formGrabar");h.select("input.movementHidden").each(function(a){a.erase()});a="nit2,nombre2,cuenta,naturaleza,descripcion,centroCosto,valor2".split(",");for(c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&a.each(function(a){var b=document.createElement("INPUT");b.type="hidden";b.className="movementHidden";b.name="f_"+a+"[]";b.value=this._movimientos[c][a];h.appendChild(b)}.bind(this));new HfosAjax.JsonFormRequest(h,{onSuccess:function(a){if("FAILED"==
a.status)this.getMessages().error(a.message);else if("OK"==a.status)this._key=a.id,this.go("cheque/ver",{parameters:this._key+"&new=1",onSuccess:this._setDetailsCallbacks.bind(this)})}.bind(this)})}},_sumCartera:function(){for(var a=0,b=this.getElement("carteraContent").select('input[type="checkbox"]'),c=this.getElement("carteraContent").select("input.abono"),d=0;d<b.length;d++)if(b[d].checked)for(var e=0;e<this._documentos.length;e++){var f=b[d].getValue().split("_");this._documentos[e].numeroDoc==
f[1]&&this._documentos[e].cuenta==f[2]&&(f=c[e].getValue(),""!==f&&(a+=parseFloat(f,10)))}return a},_addMovimiento:function(a){try{var b=this.selectOne("input#cuenta");if(""==b.getValue())new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar la cuenta"}),b.activate();else{var c=this.selectOne("input#valor2");if(""==c.getValue()||"0"==c.getValue())new HfosModal.alert({title:"Generar Cheques",message:"Debe indicar el valor"}),c.activate();else{var d=this.selectOne("select#centroCosto"),
e=this.selectOne("input#nit2"),f=this.selectOne("input#nit2_det"),g=this.selectOne("select#naturaleza"),h=this.selectOne("input#descripcion"),i=this.selectOne("input#cuenta_det");this._movimientos[-1==this._activeMov?this._movimientos.length:this._activeMov]={cuenta:b.getValue(),detalleCuenta:i.getValue(),naturaleza:g.getValue(),descripcion:h.getValue(),centroCosto:d.getValue(),textoCentro:d.options[d.selectedIndex].text,nit2:e.getValue(),nombre2:f.getValue(),valor2:parseFloat(c.getValue(),10),estado:"A"};
this._generarTabla();e.setValue("");f.setValue("");b.setValue("");g.setValue("");h.setValue("");d.setValue("");i.setValue("");c.setValue("");this._activeMov=-1;this.selectOne("input#nuevoMovi").hide();a.value="Agregar"}}}catch(j){HfosException.show(j)}},_generarTabla:function(){var a=this.selectOne("tbody#cmovi");a.innerHTML="";for(var b=0,c=0,d=this.selectOne("input#valor"),d=""===d.getValue()?0:parseFloat(d.getValue(),10),e=0;e<this._movimientos.length;e++)"A"==this._movimientos[e].estado&&(a.innerHTML+=
"<tr><td align='center'>"+(e+1)+"</td><td>"+this._movimientos[e].cuenta+"</td><td>"+this._movimientos[e].detalleCuenta+"</td><td>"+this._movimientos[e].textoCentro+"</td><td align='right'>"+this._movimientos[e].valor2+"</td><td align='center'><div class='hyDetails'></div></td><td align='center'><div class='hyDelete'></div></td></tr>",b+=this._movimientos[e].valor2,"D"==this._movimientos[e].naturaleza?c+=this._movimientos[e].valor2:d+=this._movimientos[e].valor2);a=a.select("div.hyDetails");for(e=
0;e<a.length;e++)a[e].observe("click",this._editar.bind(this,e));this._updateSumas(c,d);return b},_updateSumas:function(a,b){isNaN(b)&&(b=0);isNaN(a)&&(a=0);var c;c='<table class="sumasTable"><tr><td>D\u00e9bitos <b>'+a+"</b></td>"+("<td>Cr\u00e9ditos <b>"+b+"</b></td>");this._sumasIguales.update((0!=a-b?c+('<td>Diferencia <b class="descuadre">'+(a-b)+"</b></td>"):c+("<td>Diferencia <b>"+(a-b)+"</b></td>"))+"</tr></table>")},_editar:function(a){this.selectOne("input#nit2").setValue(this._movimientos[a].nit2);
this.selectOne("input#nit2_det").setValue(this._movimientos[a].nombre2);this.selectOne("input#cuenta").setValue(this._movimientos[a].cuenta);this.selectOne("input#cuenta_det").setValue(this._movimientos[a].detalleCuenta);this.selectOne("select#naturaleza").setValue(this._movimientos[a].naturaleza);this.selectOne("input#descripcion").setValue(this._movimientos[a].descripcion);this.selectOne("select#centroCosto").setValue(this._movimientos[a].centroCosto);this.selectOne("input#valor2").setValue(this._movimientos[a].valor2);
this._activeMov=a;this.selectOne("input#addMovi").value="Guardar";this.selectOne("input#nuevoMovi").show()},_eliminar:function(){movimiento[index].estado="B";generaTabla()},_calculateSumas:function(){for(var a=0,b=this.selectOne("input#valor"),b=""===b.getValue()?0:parseFloat(b.getValue(),10),c=0;c<this._movimientos.length;c++)"A"==this._movimientos[c].estado&&("D"==this._movimientos[c].naturaleza?a+=this._movimientos[c].valor2:b+=this._movimientos[c].valor2);for(var d=this.getElement("carteraContent").select('input[type="checkbox"]'),
e=this.getElement("carteraContent").select("input.abono"),c=0;c<d.length;c++)if(d[c].checked)for(var f=0;f<this._documentos.length;f++){var g=d[c].getValue().split("_");this._documentos[f].numeroDoc==g[1]&&this._documentos[f].cuenta==g[2]&&(g=e[f].getValue(),""!==g&&(a+=parseFloat(g,10)))}this._updateSumas(a,b)},_onChangeChequera:function(a){if("@"!=a.getValue()){var b=this.selectOne("select#numeroCheque");b.selectedIndex=0;new HfosAjax.JsonRequest("cheque/nextCheque",{parameters:{chequeraId:a.getValue()},
onSuccess:function(a,b){a.innerHTML="";if("OK"==b.status){var e="";b.lista.each(function(a){e+="<option value='"+a+"'>"+a});a.innerHTML=e}else new HfosModal.alert({title:"Generar Cheques",message:"La chequera tiene todos sus cheques emitidos"})}.bind(this,b)})}a.blur()},_backToSearch:function(){this._oldTercero=null;this.go("cheque/index",{onSuccess:this._setIndexCallbacks.bind(this)});this.hideStatusBar()},_printCheque:function(){window.open(Utils.getKumbiaURL("cheque/imprimir?"+this._key))},_anulaCheque:function(){new HfosModal.confirm({title:"Cheques",
message:"Seguro desea anular el cheque?",onAccept:function(){new HfosAjax.JsonRequest("cheque/anular",{checkAcl:!0,parameters:this._key,onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message);window.setTimeout(function(){this._backToSearch()}.bind(this),2E3)}.bind(this)})}.bind(this)})}});HfosBindings.late("win-cheque","afterCreate",function(a){new Cheque(a)});var Retencion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"retencionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-retencion","afterCreateOrRestore",function(a){new Retencion(a)});var ListadoRetencion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"listadoRetencionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-listado-retencion","afterCreateOrRestore",function(a){new ListadoRetencion(a)});var ListadoMovimiento=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"listadoMovimientoForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-listado-movimiento","afterCreateOrRestore",function(a){new ListadoMovimiento(a)});var BalanceCentros=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"balanceCentrosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-balance-centros","afterCreateOrRestore",function(a){new BalanceCentros(a)});var MovimientoCentros=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"movimientoCentrosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-movimiento-centros","afterCreateOrRestore",function(a){new MovimientoCentros(a)});var MovimientoDocumentos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"movimientoDocumentosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-movimiento-documentos","afterCreateOrRestore",function(a){new MovimientoDocumentos(a)});var MovimientoTerceros=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"movimientoTercerosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-movimiento-terceros","afterCreateOrRestore",function(a){new MovimientoTerceros(a)});var LibroAuxiliar=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"libroAuxiliarForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-libro-auxiliar","afterCreateOrRestore",function(a){new LibroAuxiliar(a)});var Consecutivo=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"consecutivosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-consecutivos","afterCreateOrRestore",function(a){new Consecutivo(a)});var Amortizacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"amortizacionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success(a.message),"undefined"!=typeof a.file&&window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-amortizacion","afterCreate",function(a){new Amortizacion(a)});var Balance=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"balanceForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-balance","afterCreateOrRestore",function(a){new Balance(a)});var Terceros={onCreate:function(){new Tercero(this)}},Tercero=Class.create({initialize:function(a){this._hyperForm=a}});HyperFormManager.lateBinding("terceros","afterInitialize",Terceros.onCreate);var Excluir=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);new HfosTabs(this,"tabbed");new HfosForm(this,"excluirForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el movimiento correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}});new HfosForm(this,"excluirForm2",{update:"resultados",onSuccess:function(a){"OK"==a.status?this.getMessages().success("Se gener\u00f3 el movimiento correctamente"):
"FAILED"==a.status&&(this.getMessages().error(a.message),"undefined"!=typeof a.file&&window.open(Utils.getURL(a.file)))}})}});HfosBindings.late("win-excluir","afterCreateOrRestore",function(a){new Excluir(a)});var Incluir=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this.getElement("saveButton").observe("click",this._uploadFile.bind(this))},_uploadFile:function(){this.setIgnoreTermSignal(!0);this.getElement("subirArchivo").hide();this.getElement("saveButton").disable();this.getElement("subirBar").show();this.getElement("subirFrame").observe("load",this._loadComplete.bind(this));this.getElement("subirForm").submit()},
_loadComplete:function(){this.getElement("subirFrame").show();this.getElement("saveButton").enable();this.getElement("subirArchivo").show();this.getElement("subirBar").hide();this.setIgnoreTermSignal(!1)}});HfosBindings.late("win-incluir","afterCreateOrRestore",function(a){new Incluir(a)});var Cuentas=Class.create(HfosProcessContainer,{_key:"",_hyperForm:null,initialize:function(a){this._hyperForm=a;this._hyperForm.observe("onNew",this._setNewCallbacks.bind(this));this._hyperForm.observe("onEdit",this._setEditCallbacks.bind(this));this.setContainer(a)},_queryByCodigo:function(a,b){new HfosAjax.JsonRequest("cuentas/queryAllByCodigo",{checkAcl:!0,parameters:"codigo="+a.getValue()+"&nombre="+b.getValue(),onSuccess:function(a){this._renderCuentas(a)}.bind(this)})},_queryByNombre:function(a,
b){2<b.getValue().length&&new HfosAjax.JsonRequest("cuentas/queryAllByNombre",{checkAcl:!0,parameters:"codigo="+a.getValue()+"&nombre="+b.getValue(),onSuccess:function(a){this._renderCuentas(a)}.bind(this)})},_renderCuentas:function(a){var b=this.getElement("resultadoCuentas");b.innerHTML="";for(var c=0;c<a.length;c++)b.innerHTML+="<tr><td>"+a[c].codigo+"</td><td>"+a[c].nombre+'</td><td><div class="hyDetails" title="'+a[c].codigo+'"></div></td></tr>';a=b.select("div.hyDetails");for(c=0;c<a.length;c++)a[c].observe("click",
this._editCuenta.bind(this,a[c].title)),a[c].title="";this._notifyContentChange()},_setIndexCallbacks:function(){var a=this.selectOne("input#cuenta"),b=this.selectOne("input#nombreCuenta");a.observe("keyup",this._queryByCodigo.bind(this,a,b));b.observe("keyup",this._queryByNombre.bind(this,a,b));a=this.getElement("newButton");a.observe("click",this._newCuenta.bind(this,a))},_setNewCallbacks:function(){this._hyperForm.getMessages().notice('Defina los par\u00e1metros de la cuenta y haga click en "Guardar" para terminar');
this._hyperForm.showControlButton("saveButton");this._hyperForm.setCurrentState("new");this._setSaveCallbacks()},_setEditCallbacks:function(){this._hyperForm.getMessages().notice('Defina los par\u00e1metros de la cuenta y haga click en "Guardar" para terminar');this._hyperForm.showControlButton("saveButton");this._hyperForm.setCurrentState("edit");this._setSaveCallbacks()},_setSaveCallbacks:function(){HfosCommon.addNiifCompleter("cuenta_niif");HfosCommon.addCuentaCompleter("contrapartida");HfosCommon.addCuentaCompleter("cta_retencion");
HfosCommon.addCuentaCompleter("cta_iva")}});HyperFormManager.lateBinding("cuentas","afterInitialize",function(){new Cuentas(this)});var Movimientos={abrir:function(a){Hfos.getApplication().run({id:"win-movimiento",icon:"document-library.png",title:"Movimiento Contable",action:"movimiento",height:"570px",onStartup:Movimientos._openDocument.bind(this,a)})},_openDocument:function(a,b){b.fire("onCustomMessage","open",a)}},Movimiento=Class.create(HfosProcessContainer,{next:{cuenta:"nombreCuenta",nombreCuenta:"descripcion",descripcion:"valor",valor:"naturaleza"},prev:{cuenta:"naturaleza",nombreCuenta:"cuenta",descripcion:"nombreCuenta",
valor:"descripcion"},_key:null,_columnHeaders:[],_sortTableBody:null,_totalRows:0,_rowsForUpdate:[],_sumasComprobante:null,initialize:function(a){this.setContainer(a);a.observe("beforeClose",this._beforeCloseCallback.bind(this));a.observe("onInactive",this._onInactiveCallback.bind(this));a.observe("onKeyPress",this._onKeyPress.bind(this));a.observe("onCustomMessage",this._onCustomMessage.bind(this));if(!1==a.wasRestored())this._setIndexCallbacks();else switch(a.getState()){case "index":this._setIndexCallbacks();
break;case "new":this._restoreNew()}this.getContentElement().observe("scroll",function(){HfosCuentasSelectores.removeAll();this._removeDetails()}.bind(this));a.fire("onReady")},setKey:function(a){this._key=a;this.getContentElement().lang=a},isReady:function(){return this._isReady},__destruct:function(){this._removeDetails();if("edit"==this.getState()||"new"==this.getState()){var a=this._getKeyToClean();new HfosAjax.Request("movimiento/clean",{parameters:a,checkAcl:!0})}delete this._key},_beforeCloseCallback:function(){if("edit"==
this.getState()||"new"==this.getState()){var a=!1;if(a="edit"==this.getState()?this.select("tr.lineaChanged").length:this.select("table.movimiento-grid tr").length)return new HfosModal.confirm({title:"Movimiento Contable",message:"Hay movimiento sin guardar. \u00bfDesea continuar?",onAccept:function(){this.__destruct();this.getContainer().close(!0)}.bind(this)}),!1;this.__destruct();return!0}this.__destruct();return!0},_onInactiveCallback:function(){this._removeDetails();HfosCuentasSelectores.removeAll()},
_onKeyPress:function(a,b){var c=this.getState();if("index"==c)return b.ctrlKey&&b.keyCode==Event.KEY_N?(this._newComprobante(),new Event.stop(b),new Event.cancelBubble(b),!1):!0;if("edit"==c||"new"==c){if(b.keyCode==Event.KEY_F7)return c=this.getElement("saveButton"),null!==c&&this._saveComprobante.bind(this,c)(),new Event.stop(b),new Event.cancelBubble(b),!1;if(b.keyCode==Event.KEY_F10)return this._backComprobante(),new Event.stop(b),new Event.cancelBubble(b),!1}if("edit"==c){if(b.keyCode==Event.KEY_F2)return this._cambiarFechaComprobante(),
new Event.stop(b),new Event.cancelBubble(b),!1;if(b.keyCode==Event.KEY_F4)return this._duplicaMovimiento(),new Event.stop(b),new Event.cancelBubble(b),!1;if(b.keyCode==Event.KEY_F8)return this._printComprobante(),new Event.stop(b),new Event.cancelBubble(b),!1}return!0},_abrirMovimiento:function(a){Hfos.getUI().blockInput();this.setKey(a);this.go("movimiento/editar",{checkAcl:!0,parameters:a,onSuccess:this._setEditCallbacks.bind(this)})},_onCustomMessage:function(a,b,c){switch(b){case "open":if("edit"==
this.getState()||"new"==this.getState())if(a=!1,a="edit"==this.getState()?this.select("tr.lineaChanged").length:this.select("table.movimiento-grid tr").length)return new HfosModal.confirm({title:"Movimiento Contable",message:"Hay movimiento sin guardar, \u00bfDesea cargar el comprobante y descargar los cambios sin guardar?",onAccept:function(a){this._abrirMovimiento(a)}.bind(this,c)}),!1;this._abrirMovimiento(c);break;default:new HfosModal.alert({title:"Movimiento Contable",message:'No se ha implementado el tipo de mensaje "'+
b+'"'})}},_setIndexCallbacks:function(){var a=this.getElement("newButton");null!==a&&a.observe("click",this._newComprobante.bind(this));new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron movimientos");break;case "1":Hfos.getUI().blockInput();this.setKey(a.key);this.go("movimiento/editar",{checkAcl:!0,parameters:a.key,onSuccess:this._setEditCallbacks.bind(this)});break;case "n":var c=new HfosBrowseData(this,
7);c.setEnableDeleteButton(!1);resultados=this.getElement("resultados");if(null!==resultados){c.build(resultados,a);for(var d=c.getDetailsButtons(),a=0;a<d.length;a++)d[a].store("primary",d[a].title),d[a].title="Ver/Editar",d[a].observe("click",this._detailsHandler.bind(this,d[a]));c=c.getRows();for(a=0;a<c.length;a++)c[a].store("primary",c[a].title),c[a].title="",c[a].observe("dblclick",this._detailsHandler.bind(this,c[a]))}this._notifyContentChange();this.scrollToBottom()}}.bind(this)});this.setState("index");
this._dropDetails();HfosCuentasSelectores.removeAll();this.hideStatusBar()},_detailsHandler:function(a){Hfos.getUI().blockInput();a=a.retrieve("primary");this.setKey(a);this.go("movimiento/editar",{parameters:a,checkAcl:!0,onSuccess:this._setEditCallbacks.bind(this)})},_getSumas:function(){new HfosAjax.JsonRequest("movimiento/getSumas",{parameters:this._key,checkAcl:!0,onSuccess:function(a){this._updateSumas(a)}.bind(this)})},_setEditCallbacks:function(){var a=this.getElement("backButton");null!==
a&&(a.observe("click",this._backComprobante.bind(this)),a=this.getElement("saveButton"),null!==a&&(a.observe("click",this._saveComprobante.bind(this,a)),a=this.getElement("deleteButton"),null!==a&&a.observe("click",this._deleteComprobante.bind(this,a)),a=this.getElement("revisionButton"),null!==a&&a.observe("click",this._revisionesComprobante.bind(this)),a=this.getElement("copyButton"),null!==a&&a.observe("click",this._copyComprobante.bind(this)),a=this.getElement("printButton"),null!==a&&a.observe("click",
this._printComprobante.bind(this)),a=this.getElement("dateButton"),null!==a&&a.observe("click",this._cambiarFechaComprobante.bind(this)),this._addGridCallbacks(),this.scrollToTop(),this._getSumas(),this.setState("edit")));Hfos.getUI().unblockInput()},_setNewCallbacks:function(){var a=this.getElement("backButton");null!==a&&a.observe("click",this._backComprobante.bind(this));a=this.selectOne("select#codigoComprobante");if(null!==a){a.observe("change",this._getComprobanteConsecutivo.bind(this,a));var b=
this.getElement("saveButton");null!==b&&("@"==a.getValue()?b.hide():b.observe("click",this._saveComprobante.bind(this,b)));DateField.observe(this.selectOne("input#fecha"),"change",this._onChangeFecha.bind(this));null!==this.getElement("movimiento-grid")?(b=this.selectOne("input#numero"),this.setKey("codigoComprobante="+a.getValue()+"&numero="+b.getValue()),this._addGridCallbacks(),window.setTimeout(function(){this.select("input.cuenta")[0].focus()}.bind(this),100)):a.focus();this.setState("new")}},
_newComprobante:function(){this.go("movimiento/nuevo",{checkAcl:!0,onSuccess:this._setNewCallbacks.bind(this)})},_getKeyToClean:function(){var a=this.selectOne("select#codigoComprobante");if(null!==a){var b=this.selectOne("input#numero");return"codigoComprobante="+a.getValue()+"&numero="+b.getValue()}return this._key},_backComprobante:function(){this.go("movimiento/index",{checkAcl:!0,parameters:"clean=1&"+this._getKeyToClean(),onSuccess:this._setIndexCallbacks.bind(this)})},_saveComprobante:function(a){a.disable();
this._removeDetails();HfosCuentasSelectores.removeAll();this.setIgnoreTermSignal(!0);this.getElement("headerSpinner").show();new HfosAjax.JsonRequest("movimiento/guardar",{parameters:this._key,checkAcl:!0,onSuccess:function(a,c){"OK"==c.status?window.setTimeout(function(a){var b=this.getElement("headerSpinner");b&&b.hide();this.go("movimiento/index",{checkAcl:!0,parameters:this._key,onSuccess:function(){"new"==this.getState()?a?this.getMessages().success(a):this.getMessages().success("Se cre\u00f3 el comprobante correctamente"):
this.getMessages().success("Se actualiz\u00f3 el comprobante correctamente");this._setIndexCallbacks()}.bind(this)})}.bind(this,c.message),100):(this.getMessages().error(c.message),a.enable())}.bind(this,a),onComplete:function(){var a=this.getElement("headerSpinner");a&&a.hide();this.setIgnoreTermSignal(!1)}.bind(this)})},_duplicaMovimiento:function(){for(var a=0,b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a++;0<a&&(b.length==a?new HfosModal.alert({title:"Movimiento Contable",
message:"El comprobante debe tener al menos un movimiento"}):new HfosModal.confirm({title:"Movimiento Contable",message:"Seguro desea copiar los movimientos seleccionados?",onAccept:function(){for(var a=[],b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a.push(b[c].up(1).retrieve("position"));new HfosAjax.JsonRequest("movimiento/copiarLineas",{checkAcl:!0,parameters:"lineas="+a.join(",")+"&"+this._key,onSuccess:function(a,b){"OK"==b.status?"new"==this.getState()&&this.go("movimiento/nuevo",
{checkAcl:!0,parameters:this._key,onSuccess:this._setNewCallbacks.bind(this)}):this.getMessages().error(b.message)}.bind(this,a)})}.bind(this)}))},_deleteComprobante:function(){new HfosModal.confirm({title:"Movimiento Contable",message:"Seguro desea eliminar el comprobante?",onAccept:function(){new HfosAjax.JsonRequest("movimiento/eliminar",{parameters:this._key,checkAcl:!0,onCreate:function(){this.setIgnoreTermSignal(!0);this.getElement("headerSpinner").show();Hfos.getUI().blockInput()}.bind(this),
onSuccess:function(a){"OK"==a.status?this.go("movimiento/index",{checkAcl:!0,parameters:this._key,onSuccess:function(){this._setIndexCallbacks();this.getMessages().success("Se elimin\u00f3 el comprobante correctamente")}.bind(this)}):this.getMessages().error(a.message)}.bind(this),onComplete:function(){var a=this.getElement("headerSpinner");this.setIgnoreTermSignal(!1);a&&a.hide();Hfos.getUI().unblockInput()}.bind(this)})}.bind(this)})},_copyComprobante:function(){new HfosModalForm(this,"movimiento/copiar",
{checkAcl:!0,parameters:this._key,beforeClose:function(a,b,c){!1==b&&this.go("movimiento/nuevo",{checkAcl:!0,parameters:c.key,onSuccess:this._setNewCallbacks.bind(this)})}.bind(this)})},_printComprobante:function(){this._removeDetails();HfosCuentasSelectores.removeAll();if(this.select("tr.lineaChanged").length)return new HfosModal.confirm({title:"Movimiento Contable",message:"Hay movimiento sin guardar, este no se incluir\u00e1 en el reporte. Desea continuar?",onAccept:function(){this._printInternal()}.bind(this)}),
!1;this._printInternal()},_printInternal:function(){new HfosModalForm(this,"movimiento/imprimir",{checkAcl:!0,parameters:this._key,beforeClose:function(a,b,c){!1==b&&"undefined"!=typeof c.file&&window.open($Kumbia.path+c.file)}.bind(this)})},_cambiarFechaComprobante:function(){new HfosModalForm(this,"movimiento/cambiarFecha",{checkAcl:!0,parameters:this._key,beforeClose:function(a,b){!1==b&&this.getMessages().success('Se realiz\u00f3 el cambio de fecha, para terminar haga click en "Guardar"',!0)}.bind(this)})},
_getComprobanteConsecutivo:function(a){this.go("movimiento/nuevo",{checkAcl:!0,parameters:"codigoComprobante="+a.getValue(),onCreate:function(){Hfos.getUI().blockInput()},onSuccess:this._setNewCallbacks.bind(this),onComplete:function(){Hfos.getUI().unblockInput()}})},_pushRowForUpdate:function(a,b){"number"!=typeof b&&(b=a.up(1).retrieve("consecutive"));if("undefined"!=typeof b){var c=this.select("input.cuenta")[b];if("undefined"!=typeof c){var d=c.getValue();if(""!=d){try{var c={},e=this.selectOne("input#fecha");
null!==e&&(c.fecha=e.getValue());c.consecutivo=b;c.cuenta=d;c.descripcion=this.select("input.descripcion")[b].getValue();c.valor=this.select("input.valor")[b].getValue();c.naturaleza=this.select("select.naturaleza")[b].getValue();var f=this._getDetailElement(b);if(null!=f){var g=f.selectOne("input#nit");null!==g&&(c.nit=g.getValue());var h=f.selectOne("select#centroCosto");null!==h&&(c.centroCosto=h.getValue());var i=f.selectOne("select#tipoDocumento");null!==i&&(c.tipoDocumento=i.getValue());var j=
f.selectOne("input#numeroDocumento");null!==j&&(c.numeroDocumento=j.getValue());var k=f.selectOne("input#fechaVence");null!==k&&(c.fechaVence=k.getValue());var l=f.selectOne("input#baseGravable");null!==l&&(c.baseGravable=l.getValue())}b+1==this._totalRows&&this._addRow()}catch(m){HfosException.show(m)}e=this.getElement("saveButton");null!==e&&e.disable();new HfosAjax.JsonRequest("movimiento/guardarLinea?"+this._key,{parameters:c,checkAcl:!0,onCreate:function(){Hfos.getUI().blockInput()},onSuccess:function(a,
b,c){var d=this.select("input.cuenta")[b];"undefined"!=typeof d&&(d=d.up(1),"FAILED"==c.status?(b==d.retrieve("position")&&d.addClassName("lineaError"),this.getMessages().error(c.message)):(b==d.retrieve("position")&&d.hasClassName("lineaError")&&d.removeClassName("lineaError"),"edit"==this.getState()&&("1"==c.changed?d.addClassName("lineaChanged"):d.removeClassName("lineaChanged")),this._updateSumas(c),this.getMessages().setDefault()),a.enable())}.bind(this,e,b),onComplete:function(){Hfos.getUI().unblockInput()}})}}}},
_updateSumas:function(a){var b='<table class="sumasTable"><tr><td>D\u00e9bitos <b>'+a.debitos+"</b></td>",b=b+("<td>Cr\u00e9ditos <b>"+a.creditos+"</b></td>"),b=a.descuadre?b+('<td>Diferencia <b class="descuadre">'+a.diferencia+"</b></td>"):b+("<td>Diferencia <b>"+a.diferencia+"</b></td>");this._sumasComprobante.update(b+"</tr></table>")},_onChangeFecha:function(a){new HfosAjax.JsonRequest("movimiento/validarFecha",{parameters:this._key+"&fecha="+a,checkAcl:!0,onSuccess:function(a){"OK"!=a.status?
this.getMessages().error(a.message):this.getMessages().setDefault()}.bind(this)})},_addRow:function(){var a=this._totalRows,b=document.createElement("TR");b.addClassName("movimiento"+a);b.addClassName("naturalezaD");b.store("position",a);b.store("consecutive",a);var c=document.createElement("TD");c.addClassName("numero");c.store("position",a);c.update(a+1);c.observe("click",this._onClickRowNumber.bind(this,c));b.appendChild(c);c=document.createElement("TD");c.update('<input id="cuentaCheck" type="checkbox" name="cuentaCheck">');
b.appendChild(c);var c=document.createElement("TD"),d=document.createElement("INPUT");d.setAttribute("type","text");d.setAttribute("id","cuenta"+a);d.setAttribute("name","cuenta"+a);d.setAttribute("size",10);d.addClassName("cuenta");d.observe("keydown",NumericField.maskNum);d.observe("focus",this._onFocusCuenta.bind(this,d));c.appendChild(d);b.appendChild(c);c=document.createElement("TD");d=document.createElement("INPUT");d.setAttribute("type","text");d.setAttribute("id","nombreCuenta"+a);d.setAttribute("name",
"nombreCuenta"+a);d.setAttribute("size",25);d.addClassName("nombreCuenta");d.observe("keydown",this._onKeyDownNombreCuenta.bind(this,d));d.observe("blur",this._onBlurNombreCuenta.bind(this,d));c.appendChild(d);b.appendChild(c);c=document.createElement("TD");d=document.createElement("INPUT");d.setAttribute("type","text");d.setAttribute("id","descripcion"+a);d.setAttribute("name","descripcion"+a);d.setAttribute("size",25);d.setAttribute("autocomplete","off");d.addClassName("descripcion");d.observe("focus",
this._onFocusDescripcion.bind(this,d));c.appendChild(d);b.appendChild(c);c=document.createElement("TD");d=document.createElement("INPUT");d.setAttribute("type","text");d.setAttribute("id","valor"+a);d.setAttribute("name","valor"+a);d.setAttribute("size",13);d.setAttribute("maxlength",17);d.setAttribute("autocomplete","off");d.addClassName("valor");c.appendChild(d);b.appendChild(c);c=document.createElement("TD");d=document.createElement("SELECT");d.setAttribute("id","naturaleza"+a);d.setAttribute("name",
"naturaleza"+a);d.addClassName("naturaleza");d.update('<option value="D">DEBITO</option><option value="C">CREDITO</option>');d.observe("change",this._onChangeNaturaleza.bind(this,d));d.observe("blur",this._onBlurNaturaleza.bind(this,d));c.appendChild(d);b.appendChild(c);this._sortTableBody.appendChild(b);a=b.select('input[type="text"], select');for(b=0;b<a.length;b++)a[b].store("navEnabled",!0),a[b].observe("blur",this._pushRowForUpdate.bind(this,a[b])),a[b].observe("focus",this._checkForActiveDetails.bind(this,
a[b])),a[b].observe("keyup",this._onKeyUpTextBox.bind(this,null,a[b]));this._totalRows++;this._notifyContentChange()},_selectRow:function(a){var b=a.up(1);b.hasClassName("lineaError")||(a.checked?b.addClassName("selectedRow"):b.removeClassName("selectedRow"));for(var a=0,b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a++;b=this.getStatusBarElement("movimientoSeleccion");0<a?b.show():b.hide();this._removeDetails();HfosCuentasSelectores.removeAll()},_deleteRows:function(){for(var a=
0,b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a++;0<a&&(b.length==a?new HfosModal.alert({title:"Movimiento Contable",message:"El comprobante debe tener al menos un movimiento"}):new HfosModal.confirm({title:"Movimiento Contable",message:"Seguro desea eliminar los movimientos seleccionados?",onAccept:function(){for(var a=[],b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a.push(b[c].up(1).retrieve("position"));new HfosAjax.JsonRequest("movimiento/borrarLineas",
{checkAcl:!0,parameters:"lineas="+a.join(",")+"&"+this._key,onSuccess:function(a,b){if("OK"==b.status){HfosCuentasSelectores.removeAll();this._removeDetails();for(var c=0;c<a.length;c++){var d=this.getElement("movimiento"+a[c]);null!==d&&d.hide()}d=this.select('td[class="numero"]');for(c=0;c<d.length;c++)d[c].update(c+1);this._updateSumas(b);this.getStatusBarElement("movimientoSeleccion").hide();this.getMessages().setDefault()}else this.getMessages().error(b.message)}.bind(this,a)})}.bind(this)}))},
_addGridCallbacks:function(){var a=this.getElement("movimiento-grid");if(a){var b=a.tBodies[0].select("tr");this._totalRows=b.length;for(var c=0;c<this._totalRows;c++)b[c].store("position",c),b[c].store("consecutive",c)}b=this.select("td.numero");for(c=0;c<b.length;c++)b[c].store("position",c),b[c].observe("click",this._onClickRowNumber.bind(this,b[c]));b=this.select('input[type="text"], select');for(c=0;c<b.length;c++)b[c].store("navEnabled",!0),b[c].setAttribute("autocomplete","off"),b[c].observe("blur",
this._pushRowForUpdate.bind(this,b[c])),b[c].observe("focus",this._checkForActiveDetails.bind(this,b[c])),b[c].observe("keyup",this._onKeyUpTextBox.bind(this,null,b[c]));b=this.select('input[type="checkbox"]');for(c=0;c<b.length;c++)b[c].observe("change",this._selectRow.bind(this,b[c]));b=this.select("input.cuenta");for(c=0;c<b.length;c++)b[c].observe("focus",this._onFocusCuenta.bind(this,b[c]));b=this.select("input.descripcion");for(c=0;c<b.length;c++)b[c].observe("focus",this._onFocusDescripcion.bind(this,
b[c]));b=this.select("select.naturaleza");for(c=0;c<b.length;c++)b[c].observe("change",this._onChangeNaturaleza.bind(this,b[c])),b[c].observe("blur",this._onBlurNaturaleza.bind(this,b[c]));b=this.select("input.nombreCuenta");for(c=0;c<b.length;c++)b[c].observe("keydown",this._onKeyDownNombreCuenta.bind(this,b[c])),b[c].observe("blur",this._onBlurNombreCuenta.bind(this,b[c]));b=this.select("th");this._columnHeaders=[];for(c=0;c<b.length;c++)b[c].hasClassName("sortcol")&&(b[c].observe("click",this._columnSortHandler.bind(this,
b[c],c)),this._columnHeaders.push(b[c]));this._sortTableBody=a.tBodies[0];this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option><option value="C">Copiar</option></select><td><td class="sumasComprobante" align="right"></td></tr></table>');a=this.getStatusBarElement("opcionesSeleccion");
a.observe("change",function(a){try{switch($F(a)){case "D":this._deleteRows();break;case "C":this._duplicaMovimiento()}a.setValue("@")}catch(b){HfosException.show(b)}}.bind(this,a));this._sumasComprobante=this.getStatusBarElement("sumasComprobante");this._sumasComprobante.update("")},_onClickRowNumber:function(a){a=parseInt(a.retrieve("position"),10);a=this.select("input.cuenta")[a];"undefined"!=typeof a&&a.focus()},_onChangeNaturaleza:function(a){var b=a.up(1);"D"==a.getValue()?(b.removeClassName("naturalezaC"),
b.addClassName("naturalezaD")):(b.removeClassName("naturalezaD"),b.addClassName("naturalezaC"));a.focus()},_onBlurNaturaleza:function(a){a=parseInt(a.up(1).retrieve("position"),10);a++;a=this.select("input.cuenta")[a];"undefined"!=typeof a&&a.focus()},_columnSortHandler:function(a,b){HfosCuentasSelectores.removeAll();this._removeDetails();for(var c=a.hasClassName("sortasc"),d=0;d<this._columnHeaders.length;d++)this._columnHeaders[d].removeClassName("sortasc"),this._columnHeaders[d].removeClassName("sortdesc");
c?(this._sortColumn(b,!1),a.addClassName("sortdesc")):(this._sortColumn(b,!0),a.addClassName("sortasc"))},_onKeyUpTextBox:function(a,b,c){if(!(c.keyCode!=Event.KEY_UP&&c.keyCode!=Event.KEY_DOWN&&c.keyCode!=Event.KEY_LEFT&&c.keyCode!=Event.KEY_RIGHT&&c.keyCode!=Event.KEY_PAGEUP&&c.keyCode!=Event.KEY_PAGEDOWN&&c.keyCode!=Event.KEY_RETURN)&&!1!==b.retrieve("navEnabled"))if(c.keyCode==Event.KEY_UP){a=parseInt(b.up(1).retrieve("position"),10);a--;var d=this.select("."+b.className)[a];d&&this._activate(d);
0>=a&&this.scrollToTop();new Event.stop(c)}else if(c.keyCode==Event.KEY_DOWN){a=parseInt(b.up(1).retrieve("position"),10);if(b.hasClassName("cuenta")||b.hasClassName("nombreCuenta"))for(var d=this.getSpaceElement().select("div.movimiento-detail"),e=0;e<d.length;e++)if(d[e].retrieve("position")==a&&!0==d[e].visible()){var f=d[e].selectOne("input#nit");if(null!==f){f.focus();new Event.stop(c);return}d=d[e].selectOne("select#centroCosto");if(null!==d){d.focus();new Event.stop(c);return}break}a++;(d=
this.select("."+b.className)[a])&&this._activate(d);new Event.stop(c)}else c.keyCode==Event.KEY_RIGHT&&!0==b.visible()&&b.selectionStart==b.value.length?1==b.retrieve("moveNext")?(a=parseInt(b.up(1).retrieve("position"),10),(d=this.select("."+this.next[b.className])[a])&&this._activate(d),new Event.stop(c)):b.store("moveNext",1):c.keyCode==Event.KEY_LEFT&&!0==b.visible()&&0==b.selectionStart?1==b.retrieve("movePrev")?(a=parseInt(b.up(1).retrieve("position"),10),(d=this.select("."+this.prev[b.className])[a])&&
this._activate(d),new Event.stop(c)):b.store("movePrev",1):(c.keyCode==Event.KEY_RETURN&&(a=parseInt(b.up(1).retrieve("position"),10),"undefined"==typeof this.next[b.className]?(d="cuenta",a++):d=this.next[b.className],(d=this.select("."+d)[a])&&this._activate(d),new Event.stop(c)),c.keyCode==Event.KEY_PAGEUP?(a=parseInt(b.up(1).retrieve("position"),10),a-=13,0>a&&(a=0),(d=this.select("."+b.className)[a])&&this._activate(d),5>=a&&this.scrollToTop(),new Event.stop(c)):c.keyCode==Event.KEY_PAGEDOWN?
(a=parseInt(b.up(1).retrieve("position"),10),a+=13,a>this._totalRows&&(a=this._totalRows-1),(d=this.select("."+b.className)[a])&&this._activate(d),new Event.stop(c)):(b.store("moveNext",void 0),b.store("movePrev",void 0)))},_activate:function(a){var b=a.positionedOffset(),c=this.getContentElement(),b=b[1]-0.77*c.getHeight();if(0<b)c.scrollTop=b;a.activate();this._removeDetails()},_sortColumn:function(a,b){for(var c=[],d=this._sortTableBody.select("td:nth-of-type("+(a+2)+")"),e=0;e<d.length;e++)c.push(d[e]);
!0==b?c.sort(this._ascendingSort):c.sort(this._descendingSort);for(e=0;e<c.length;e++)d=c[e].parentNode,d.store("position",e),this._sortTableBody.appendChild(d)},_ascendingSort:function(a,b){if(a.firstDescendant()&&b.firstDescendant()){var c=a.firstDescendant().getValue(),d=b.firstDescendant().getValue();return""==c?1:""==d?-1:c<d?-1:c>d?1:0}return 0},_descendingSort:function(a,b){if(a.firstDescendant()&&b.firstDescendant()){var c=a.firstDescendant().getValue(),d=b.firstDescendant().getValue();return c>
d?-1:c<d?1:0}return 0},_getDetailElement:function(a){return this.getSpaceElement().selectOne("div#detail"+a)},_removeDetails:function(){for(var a=this.getSpaceElement().select("div.movimiento-detail"),b=0;b<a.length;b++)a[b].hide()},_dropDetails:function(){for(var a=this.getSpaceElement().select("div.movimiento-detail"),b=0;b<a.length;b++)a[b].erase()},_changeCuentaSelector:function(a,b){this._removeDetails();this._pushRowForUpdate(b)},_checkForActiveDetails:function(a){for(var a=parseInt(a.up(1).retrieve("position"),
10),b=this.getSpaceElement().select("div.movimiento-detail"),c=0;c<b.length;c++)a!=b[c].retrieve("position")&&b[c].hide()},_onFocusDescripcion:function(a){""==a.value.strip()&&window.setTimeout(function(){var b=parseInt(a.up(1).retrieve("position"),10),b=this.select("input.nombreCuenta")[b];"undefined"!=typeof b&&(b=b.getValue(),!1==b.include("EXISTE")&&a.setValue(b))}.bind(this),100)},_onFocusCuenta:function(a){this._removeDetails();""!=a.getValue()&&((b=this._getDetailElement(b))?b.show():this._showDetalles(a));
var b=parseInt(a.up(1).retrieve("position"),10),b=this.select("input.nombreCuenta")[b],b=new HfosCuentasSelector(a,b);b.observe("change",this._changeCuentaSelector.bind(this));b.observe("leave",this._leaveCuentaSelector.bind(this));b.observe("keyup",this._onKeyUpTextBox.bind(this));a.store("selector",b)},_showDetalles:function(a){var b=parseInt(a.up(1).retrieve("position"),10);new HfosAjax.Request("movimiento/getDetalles",{method:"GET",checkAcl:!0,parameters:"cuenta="+a.getValue()+"&consecutivo="+
b+"&"+this._key,onSuccess:function(a,b){if(""!=b.responseText){var e=this.getContentElement(),f=parseInt(a.up(1).retrieve("position"),10),g=this._getDetailElement(f);g?g.show():(g=document.createElement("DIV"),g.setAttribute("id","detail"+f),g.store("position",f),g.addClassName("movimiento-detail"),this.getSpaceElement().appendChild(g),new HfosDraggable(g));g.update(b.responseText);var h=g.selectOne("input#nit");if(null!==h){var i=g.selectOne("input#nitNombre");h.store("position",f);h.observe("blur",
this._queryByNit.bind(this,h,i));h.observe("keydown",this._nitNavigation.bind(this,h,i,a));i.store("position",f);i.observe("blur",this._nitNombreNext.bind(this,i));i.observe("keydown",this._nitNombreNavigation.bind(this,h,i,a));i=g.selectOne("input#crearNit");i.store("position",f);i.observe("click",this._showCrearNit.bind(this,i));document.activeElement!=h&&""==h.getValue()&&window.setTimeout(function(a){a.focus()}.bind(this,h),50)}i=g.selectOne("select#centroCosto");null!==i&&(i.store("position",
f),i.observe("blur",this._centroCostoNavigation.bind(this,i)),null===h&&"@"==i.getValue()&&i.focus());var j=g.selectOne("select#tipoDocumento");if(null!==j){j.store("position",f);j.observe("blur",this._tipoDocumentoNavigation.bind(this,j));var k=g.selectOne("input#numeroDocumento");k.store("position",f);k.observe("blur",this._numeroDocumentoNavigation.bind(this,k));k=g.selectOne("input#verCartera");null!==h?(""!==h.getValue()?k.show():k.hide(),k.store("position",f),k.observe("click",this._verCartera.bind(this,
k))):k.hide();null===i&&"@"==j.getValue()&&j.focus()}h=g.selectOne("input#baseGravable");null!==h&&(h.store("position",f),h.observe("blur",this._baseGravableNavigation.bind(this,h)),null===i&&"@"==h.getValue()&&h.focus());f=this.getContainer();h=a.up().positionedOffset();e.positionedOffset();e=h[1]-e.scrollTop+f.getTop()+4;f=h[0]+f.getLeft();g.setStyle({top:e+a.getHeight()+"px",left:f+"px"})}}.bind(this,a)})},_showCarteraButton:function(){},_updateNumeroNit:function(a,b,c){b&&(b.setValue(c.value),
a.store("completer",void 0))},_verCartera:function(a){var a=parseInt(a.retrieve("position"),10),b=this._getDetailElement(a),c=b.selectOne("input#nit"),d=this.select("input.cuenta")[a];if("undefined"==typeof c||"undefined"==typeof d)return null;""!==c.getValue()?new HfosModalForm(this,"movimiento/verCartera",{parameters:{nit:c.getValue(),cuenta:d.getValue()},style:{width:"600px"},afterShow:function(a){var b=a.selectOne("table#carteraTable");null!=b&&(new HfosBrowseData(this)).fromHtmlTable(a,b,12)}.bind(this),
beforeClose:function(a,b,c,d,i){!1==d&&"OK"==i.status&&"undefined"!=typeof i.cartera&&(a.selectOne("select#tipoDocumento").setValue(i.cartera.tipoDoc),a=a.selectOne("input#numeroDocumento"),a.setValue(i.cartera.numeroDoc),this.select("input.valor")[b].setValue(Math.abs(i.cartera.valor)),c=this.select("select.naturaleza")[b],0>i.cartera.valor?c.setValue("D"):c.setValue("C"),this._pushRowForUpdate(a,b))}.bind(this,b,a)}):this.getMessages().error("Indique un tercero en el movimiento para consultar la cartera")},
_showCrearNit:function(a){var b=this._getDetailElement(parseInt(a.retrieve("position"),10)),c=b.selectOne("input#nit"),b=b.selectOne("input#nitNombre"),d=b.getValue();d.include("NO EXISTE")&&(d="");new HfosModalForm(this,"terceros/crear",{defaults:{nit:c.getValue(),nombre:d},afterShow:HfosCommon.afterShowNitCrear,beforeClose:function(a,b,c,d,i){var j=d.selectOne("input#nit"),d=d.selectOne("input#nombre");a.setValue(j.getValue());b.setValue(d.getValue());a.focus();!0==i?c.show():c.hide()}.bind(this,
c,b,a)})},_nitNombreNext:function(a){var b=parseInt(a.retrieve("position"),10),c=this._getDetailElement(b);if(""!=a.getValue())if(a=c.selectOne("select#centroCosto"),null!==a)a.focus();else if(a=c.selectOne("select#tipoDocumento"),null!==a)a.focus();else if(c=c.selectOne("input#baseGravable"),null!==c)c.focus();else{var d=this.select("input.descripcion")[b];d&&window.setTimeout(function(){d.focus()}.bind(this,d),100)}},_nitNavigation:function(a,b,c,d){if(d.keyCode==Event.KEY_UP)a=c.retrieve("selector"),
"undefined"!=typeof a?a.focus():c.focus(),new Event.stop(d);else if(d.keyCode==Event.KEY_DOWN){c=parseInt(c.up(1).retrieve("position"),10);a=this._getDetailElement(c);if(null!==a&&(a=a.selectOne("select#centroCosto"),null!==a)){new Event.stop(d);a.focus();return}c++;var e=this.select("input.cuenta")[c];e&&window.setTimeout(function(){e.focus()}.bind(this,e),200);new Event.stop(d)}else d.keyCode==Event.KEY_RIGHT&&a.selectionStart==a.value.length||d.keyCode==Event.KEY_RETURN?(b.focus(),new Event.stop(d)):
""==a.getValue()&&(c=parseInt(c.up(1).retrieve("position"),10),a=this._getDetailElement(c),a.selectOne("input#crearNit").show())},_nitNombreNavigation:function(a,b,c,d){var e=b.retrieve("completer");d.keyCode!=Event.KEY_RETURN&&d.keyCode!=Event.KEY_TAB&&d.keyCode!=Event.KEY_DOWN&&d.keyCode!=Event.KEY_UP&&d.keyCode!=Event.KEY_LEFT&&d.keyCode!=Event.KEY_RIGHT&&d.keyCode!=Event.KEY_PAGEUP&&d.keyCode!=Event.KEY_PAGEDOWN&&224!=d.keyCode&&("undefined"==typeof e&&b.store("completer",new HfosAutocompleter(b,
"terceros/queryByName",{paramName:"nombre",afterUpdateElement:this._updateNumeroNit.bind(this,b,a)})),b.observe("external:changed",function(a){var a=a.up(6),b=a.selectOne("input#verCartera");a.selectOne("input#crearNit").hide();null!==b&&b.show()}.bind(this,a,b)));if("undefined"==typeof e)if(d.keyCode==Event.KEY_LEFT&&0==b.selectionStart)a.focus(),new Event.stop(d);else if(d.keyCode==Event.KEY_UP){var c=parseInt(c.up(1).retrieve("position"),10),f=this.select("input.nombreCuenta")[c];f&&window.setTimeout(function(){f.focus()}.bind(this,
f),100)}else d.keyCode==Event.KEY_DOWN&&(a=a.up(6),b=a.selectOne("select#centroCosto"),null!==b?window.setTimeout(function(a){a.activate()}.bind(this,b),100):(b=a.selectOne("select#tipoDocumento"),null!==b?window.setTimeout(function(a){a.activate()}.bind(this,b),100):(a=a.selectOne("input#baseGravable"),null!==a?window.setTimeout(function(a){a.activate()}.bind(this,a),100):(c=parseInt(c.up(1).retrieve("position"),10),c++,(f=this.select("input.cuenta")[c])&&window.setTimeout(function(a){a.focus()}.bind(this,
f),100),new Event.stop(d)))))},_centroCostoNavigation:function(a){var b=parseInt(a.retrieve("position"),10);this._pushRowForUpdate(a,b);a=this._getDetailElement(b);if(null!==a){var c=a.selectOne("select#tipoDocumento");if(null!==c){window.setTimeout(function(a){a.activate()}.bind(this,c),200);return}a=a.selectOne("input#baseGravable");if(null!==a){window.setTimeout(function(a){a.activate()}.bind(this,a),200);return}}var d=this.select("input.descripcion")[b];d&&window.setTimeout(function(){d.focus()}.bind(this,
d),200)},_tipoDocumentoNavigation:function(a){var b=parseInt(a.retrieve("position"),10);this._pushRowForUpdate(a,b);a=this._getDetailElement(b);if(null!==a&&(a=a.selectOne("input#numeroDocumento"),null!==a)){window.setTimeout(function(a){a.activate()}.bind(this,a),200);return}var c=this.select("input.descripcion")[b];c&&window.setTimeout(function(){c.focus()}.bind(this,c),100)},_numeroDocumentoNavigation:function(a){var b=parseInt(a.retrieve("position"),10);this._pushRowForUpdate(a,b);a=this._getDetailElement(b).selectOne("input#baseGravable");
if(null!==a)window.setTimeout(function(a){a.activate()}.bind(this,a),200);else{var c=this.select("input.descripcion")[b];c&&window.setTimeout(function(){c.focus()}.bind(this,c),100)}},_baseGravableNavigation:function(a){this.getContentElement();var b=parseInt(a.retrieve("position"),10),c=this._getDetailElement(b),d=this.selectOne("input#valor"+b),e=c.selectOne("input#cuentaPorcIva");if(d&&e){var f=parseFloat(a.getValue());f&&new HfosModal.confirm({title:"Base Gravable",message:"Desea que el sistema calcule la base gravable seg\u00fan el porcentaje de la cuenta?",
onAccept:function(){var a=parseFloat(e.getValue());a?d.setValue(f*a/100):alert("No se ha definido el porcentaje de iva de esta cuenta que pide base, por favor ingresarla")}})}this._pushRowForUpdate(a,b);var g=this.select("input.descripcion")[b];g&&window.setTimeout(function(){g.focus()}.bind(this,g),100)},_queryByNit:function(a,b){""!=a.getValue()?(this._pushRowForUpdate(a,a.retrieve("position")),new HfosAjax.JsonRequest("terceros/queryByNit",{method:"GET",checkAcl:!0,parameters:"nit="+a.getValue(),
onSuccess:function(a,b,e){var f=a.retrieve("position"),g=this._getDetailElement(f);if(null!==g){var h=g.selectOne("input#verCartera"),g=g.selectOne("input#crearNit");"OK"==e.status?(b.setValue(e.nombre),g.hide(),null!==h&&h.show()):(b.setValue(e.message),document.activeElement==a&&b.activate(),this.select("input.cuenta")[f].up(1).addClassName("lineaError"),g.show(),null!==h&&h.hide())}}.bind(this,a,b)})):this._getDetailElement(a.retrieve("position")).selectOne("input#crearNit").show()},_onBlurNombreCuenta:function(a){var b=
a.retrieve("completer");"undefined"!=typeof b&&(b.destroy(),a.store("completer",void 0),a.store("navEnabled",!0))},_onKeyDownNombreCuenta:function(a,b){b.keyCode!=Event.KEY_RETURN&&b.keyCode!=Event.KEY_TAB&&b.keyCode!=Event.KEY_DOWN&&b.keyCode!=Event.KEY_UP&&b.keyCode!=Event.KEY_LEFT&&b.keyCode!=Event.KEY_RIGHT&&b.keyCode!=Event.KEY_PAGEUP&&b.keyCode!=Event.KEY_PAGEDOWN&&224!=b.keyCode&&(HfosCuentasSelectores.removeAll(),this._removeDetails(),"undefined"==typeof a.retrieve("completer")&&(a.store("completer",
new HfosAutocompleter(a,"cuentas/queryByName",{paramName:"nombre",afterUpdateElement:this._updateCodigoCuenta.bind(this,a)})),a.store("navEnabled",!1)))},_updateCodigoCuenta:function(a,b){var c=parseInt(a.up(1).retrieve("position"),10);(c=this.select("input.cuenta")[c])&&c.setValue(b.value)},_leaveCuentaSelector:function(a,b){a.getCuenta();a.destroy();if(""!=b.getValue()){var c=b.up(1).retrieve("position"),d=this._getDetailElement(c);d?d.show():this._showDetalles(b);this._pushRowForUpdate(b,c)}b.store("selector",
void 0)},_restoreNew:function(){var a=this.getContentElement().lang;""!=a?this.go("movimiento/nuevo",{checkAcl:!0,parameters:a,onCreate:function(){Hfos.getUI().blockInput()},onSuccess:this._setNewCallbacks.bind(this),onComplete:function(){Hfos.getUI().unblockInput()}}):this._setNewCallbacks()},_revisionesComprobante:function(){var a=this.getContentElement().lang;""!=a&&new HfosModalForm(this,"movimiento/revisiones",{parameters:a,beforeClose:function(){}.bind(this,a)})}});
HfosBindings.late("win-movimiento","afterCreateOrRestore",function(a){new Movimiento(a)});
