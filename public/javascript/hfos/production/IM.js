var PermisosCentros=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("select#usuariosId"),b=this.selectOne("input#submitButton");a.observe("change",this._showRolesPerms.bind(this,a,b));b.observe("click",this._savePermisosCentros.bind(this));a=this.selectOne("input#selectAll");a.observe("click",this._activeOrDesactiveChecks.bind(this,a))},_showRolesPerms:function(a,b){this._desSelectAll();"@"!=
a.getValue()?(this.getElement("chooseRole").hide(),this.getElement("tabAppChoose").show(),this.getElement("PerfilesContent").show(),b.show(),this._loadStoredPermisosCentros()):(this.getElement("chooseRole").show(),this.getElement("tabAppChoose").hide(),this.getElement("PerfilesContent").hide(),b.hide())},_loadStoredPermisosCentros:function(){new HfosAjax.JsonRequest("permisos_centros/loadPermisosCentros",{parameters:"usuariosId="+usuariosId.getValue(),onSuccess:function(a){0<a.pOpcion.length&&this._activeChecksByArray(a.pOpcion);
this.getMessages().notice(a.message)}.bind(this)})},_activeChecksByArray:function(a){if(!a)return!1;$(a).each(function(a){if(a=this.selectOne('.resource-access > input[type="checkbox"][value="'+a+'"]'))a.checked=!0}.bind(this))},_desSelectAll:function(){var a=this.select('.resource-access > input[type="checkbox"]');a&&a.each(function(a){a.checked=!1}.bind(this))},_savePermisosCentros:function(){var a=this.select('.resource-access > input[type="checkbox"]');if(a){var b="",c=0;a.each(function(a){a.checked&&
a.value&&(b+="&permisos["+c+"]="+a.value,c++)});new HfosAjax.JsonRequest("permisos_centros/savePermisosCentros",{parameters:"usuariosId="+usuariosId.getValue()+b,onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?this.getMessages().success(a.message):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}},_activeOrDesactiveChecks:function(a){var b=a.checked;this.select('.resource-access > input[type="checkbox"]').each(function(a){!0==
b?(a.checked=!0,a.enable()):a.checked=!1})}});HfosBindings.late("win-permisos-centros","afterCreate",function(a){new PermisosCentros(a)});var PermisosComprob=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("select#usuariosId"),b=this.selectOne("select#comprob"),c=this.selectOne("input#submitButton");a.observe("change",this._showRolesPerms.bind(this,a,b,c));b.observe("change",this._showRolesPerms.bind(this,a,b,c));c.observe("click",this._savePerfilesUsuarios.bind(this,a,b))},_showRolesPerms:function(a,b,c){this._desSelectAll();
"@"!=a.getValue()?(this.getElement("chooseRole").hide(),this.getElement("comprobBlock").show(),"@"!=b.getValue()?(this.getElement("chooseComprob").hide(),this.getElement("tabAppChoose").show(),this.getElement("PerfilesContent").show(),c.show(),this._loadStoredPerfilesUsuarios(a,b)):(this.getElement("chooseComprob").show(),this.getElement("tabAppChoose").hide(),this.getElement("PerfilesContent").hide(),c.hide())):(this.getElement("chooseRole").show(),this.getElement("comprobBlock").hide(),b.getValue()?
this.getElement("chooseComprob").hide():this.getElement("chooseComprob").show(),this.getElement("tabAppChoose").hide(),this.getElement("PerfilesContent").hide(),c.hide());trustComprob=!1},_loadStoredPerfilesUsuarios:function(a,b){new HfosAjax.JsonRequest("permisos_comprob/loadPermisosComprob",{parameters:"usuariosId="+a.getValue()+"&comprob="+b.getValue(),onSuccess:function(a){0<a.pOpcion.length&&this._activeChecksByArray(a.pOpcion);this.getMessages().notice(a.message)}.bind(this)})},_activeChecksByArray:function(a){if(!a)return!1;
$(a).each(function(a){if(a=this.selectOne('.resource-access > input[type="checkbox"][value="'+a+'"]'))a.checked=!0}.bind(this))},_desSelectAll:function(){var a=this.select('.resource-access > input[type="checkbox"]');a&&a.each(function(a){a.checked=!1}.bind(this))},_checkIfComprob:function(a,b,c){new HfosAjax.JsonRequest("permisos_comprob/checkComprob",{parameters:"comprob="+b.getValue(),onSuccess:function(d){alert(d.status);"FAILED"==d.status?(b.setValue(""),c.hide(),this.getElement("PerfilesContent").hide(),
this.getMessages().notice(d.message)):this._showRolesPerms(a,b,c)}.bind(this)})},_savePerfilesUsuarios:function(a,b){var c=this.select('.resource-access > input[type="checkbox"]');if(c){var d=0,e="";c.each(function(a){a.checked&&a.value&&(e+="&permisos["+d+"]="+a.value,d++)});new HfosAjax.JsonRequest("permisos_comprob/savePermisosComprob",{parameters:"usuariosId="+a.getValue()+"&comprob="+b.getValue()+e,onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==
a.status?this.getMessages().success(a.message):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}}});HfosBindings.late("win-permisos-comprob","afterCreate",function(a){new PermisosComprob(a)});var PerfilesUsuarios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("select#usuariosId"),b=this.selectOne("input#submitButton");a.observe("change",this._showRolesPerms.bind(this,a,b));b.observe("click",this._savePerfilesUsuarios.bind(this,a))},_showRolesPerms:function(a,b){this._desSelectAll();"@"!=a.getValue()?(this.getElement("chooseRole").hide(),this.getElement("tabAppChoose").show(),this.getElement("PerfilesContent").show(),
b.show(),this._loadStoredPerfilesUsuarios(a)):(this.getElement("chooseRole").show(),this.getElement("tabAppChoose").hide(),this.getElement("PerfilesContent").hide(),b.hide())},_loadStoredPerfilesUsuarios:function(a){new HfosAjax.JsonRequest("perfiles_usuarios/loadPerfilesUsuarios",{parameters:"usuariosId="+a.getValue(),onSuccess:function(a){"OK"==a.status?(this.getMessages().success(a.message),this._activeChecksByArray(a.perfiles)):this.getMessages().notice(a.message)}.bind(this)})},_activeChecksByArray:function(a){if(!a)return!1;
$(a).each(function(a){if(a=this.selectOne('input[type="checkbox"][value="'+a+'"]'))a.checked=!0}.bind(this))},_desSelectAll:function(){var a=this.select('input[type="checkbox"]');a&&a.each(function(a){a.checked=!1}.bind(this))},_savePerfilesUsuarios:function(a){var b=this.select('input[type="checkbox"]');if(b){var c="",d=0;b.each(function(a){a.checked&&a.value&&(c+="&perfiles["+d+"]="+a.value,d++)});new HfosAjax.JsonRequest("perfiles_usuarios/savePerfilesUsuarios",{parameters:"usuariosId="+a.getValue()+
c,onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?this.getMessages().success(a.message):this.getMessages().notice(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}}});HfosBindings.late("win-perfiles-usuarios","afterCreate",function(a){new PerfilesUsuarios(a)});var PermisosPerfiles=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("select#aplicacionId"),b=this.selectOne("select#perfilesId"),c=this.selectOne("input#submitButton");a.observe("change",this._showRolesPerms.bind(this,b,a,!0));b.observe("change",this._showRolesPerms.bind(this,b,a,!1));c.observe("click",this._savePerfilesPermisos.bind(this,b,a))},_getRolesOnApp:function(a){new HfosAjax.JsonRequest("permisos_perfiles/getPerfilesPorApp",
{parameters:{aplicacionId:a},onSuccess:function(a){if("OK"==a.status){var c=this.selectOne("select#perfilesId");c.innerHTML="";c.appendChild((new Element("OPTION",{value:"@"})).update("Seleccione..."));a.perfiles.each(function(a){c.appendChild((new Element("OPTION",{value:a.id})).update(a.nombre))});this.getElement("chooseRole").show();this.getElement("chooseApp").hide();this.getElement("tabRolesChoose").show()}else this.getMessages().error(a.message),this.getElement("chooseRole").hide(),this.getElement("chooseApp").show(),
this.getElement("tabRolesChoose").hide()}.bind(this)})},_showRolesPerms:function(a,b,c){if("@"!=b.getValue())if(!1==c)"@"==a.getValue()&&this._getRolesOnApp(b.getValue());else{this.getElement("permsContent").update("");this.selectOne("input#submitButton").hide();this._getRolesOnApp(b.getValue());return}else this.getElement("chooseRole").hide(),this.getElement("chooseApp").show(),this.getElement("tabRolesChoose").hide();"@"!=a.getValue()?"@"!=b.getValue()&&(this.getElement("chooseRole").hide(),this.selectOne("input#submitButton").show(),
new HfosAjax.Request("permisos_perfiles/getPermisos",{parameters:"perfilesId="+a.getValue()+"&aplicacionId="+b.getValue(),onSuccess:function(a){this.getMessages().notice('Seleccione los permisos asignados al perfil y d\u00e9 click en "Guardar"');this.getElement("permsContent").update(a.responseText).show();this.GardienInitialize()}.bind(this)})):(this.getMessages().hide(),this.getElement("chooseRole").show(),this.getElement("permsContent").update(""),this.selectOne("input#submitButton").hide())},
_savePerfilesPermisos:function(a,b){var c=this.select('.resource-access > input[type="checkbox"]');if(c){var d=0,e="";c.each(function(a){a.checked&&a.value&&(e+="&access["+d+"]="+a.value,d++)});new HfosAjax.JsonRequest("permisos_perfiles/savePerfilesPermisos",{parameters:"perfilesId="+a.getValue()+"&aplicacionId="+b.getValue()+""+e,onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?this.getMessages().success(a.message):this.getMessages().error(a.message)}.bind(this),
onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}},_prepareForInput:function(){this._hyperGrid.clearData();return!0},rollTree:function(a){var b=a.checked,c=a.adjacent("UL")[0];a.parentNode.select('input[type="checkbox"]').each(function(a){a.up(1)==c&&(!0==b?a.enable():a.disable())})},GardienInitialize:function(){var a=!0;this.select('div#acl input[type="checkbox"]').each(function(b){!0==a?a=!1:!1==b.checked&&b.disable();b.observe("click",function(a){this.rollTree(a)}.bind(this,
b))}.bind(this));this.select('div#acl input[type="checkbox"]').each(function(a){!0==a.checked&&this.rollTree(a)}.bind(this));var b=this.selectOne("input#selectAll");b.observe("click",this._activeOrDesactiveChecks.bind(this,b));this._notifyContentChange()},_activeOrDesactiveChecks:function(a){var b=a.checked;this.select('.resource-access > input[type="checkbox"]').each(function(a){!0==b?(a.checked=!0,a.enable()):a.checked=!1})}});HfosBindings.late("win-permisos-perfiles","afterCreate",function(a){new PermisosPerfiles(a)});
