var CuentaCobro=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("printButton");a.observe("click",this._imprimir.bind(this,a));a=this.getElement("importButton");a.observe("click",this._cuentaCobro.bind(this,a))},_cuentaCobro:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cuentaCobroForm");b.setAttribute("action",$Kumbia.path+"tpc/cuenta_cobro/generar");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 generando las cuentas de cobro por favor esperar...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success("Se realizaron la(s) cuenta(s) de cobro correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})},_imprimir:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cuentaCobroForm");b.setAttribute("action",
$Kumbia.path+"tpc/cuenta_cobro/imprimir");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 generando la impresi\u00f3n de las cuentas de cobro por favor esperar...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):"OK"==a.status&&(this.getMessages().success("Se realizar\u00f3 la impresi\u00f3n de la(s) cuenta(s) de cobro correctamente"),"undefined"!=typeof a.file&&
window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cuenta-cobro-tpc","afterCreateOrRestore",function(a){new CuentaCobro(a)});var CambioContratos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);var a=this.getElement("importButton"),b=this.selectOne("#sociosId"),c=this.selectOne("#sociosId_det");b.observe("change",this._getNumeroContrato.bind(this));c.observe("change",this._getNumeroContrato.bind(this));a.observe("click",this._cambioContratos.bind(this,a))},_getNumeroContrato:function(){var a=this.selectOne("#sociosId"),b=this.selectOne("#numeroContrato");a&&a.getValue()&&b&&new HfosAjax.JsonRequest("contratos/getNumeroContrato",
{parameters:{socio:a.getValue()},onSuccess:function(a){"OK"==a.status&&b.setValue(a.numeroContrato)}.bind(this)})},_cambioContratos:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cambioContratosForm");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 cambiando el n\u00famero de contrato...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),
"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success(a.message),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cambio-contratos-tpc","afterCreateOrRestore",function(a){new CambioContratos(a)});var Propietarios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._propietarios.bind(this,a))},_propietarios:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("propietariosForm");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 generando el informe...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==
a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe de propietarios correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-propietarios-tpc","afterCreateOrRestore",function(a){new Propietarios(a)});var SociosAldia=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._generar.bind(this,a))},_generar:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("sociosAldiaForm");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 generando el informe...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?
(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-socios-aldia-tpc","afterCreateOrRestore",function(a){new SociosAldia(a)});var AReserva={_active:null,setActive:function(a){this._active=a},getActive:function(){return this._active},addCallbacksRecibosPagos:function(a){a||(a={});if(!a.rc)a.rc=null;var a=AReserva.getActive(),b=a.selectOne("#reservasId"),c=a.selectOne("#recibosPagoButtonList");if(c&&b)c.onClick=function(){this._imprimeRecibosPagosLista(c.alt)}}},AbonoReserva=Class.create(HfosProcessContainer,{_key:null,_movimientos:[],_activeMov:0,_oldTercero:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},
_setIndexCallbacks:function(){new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron reservas");break;case "1":this._key=a.key;this.go("abono_reserva/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this,this._key)});break;case "n":var b=new HfosBrowseData(this,8);b.setEnableDeleteButton(!1);b.build(this.getElement("resultados"),a);a=b.getDetailsButtons();for(b=0;b<a.length;b++)a[b].store("primary",
a[b].title),a[b].title="Abonar",a[b].observe("click",this._detailsHandler.bind(this,a[b]));this.scrollToBottom();this._notifyContentChange()}}.bind(this)})},_detailsHandler:function(a){this._key=a.retrieve("primary");this.go("abono_reserva/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this,this._key)})},_makeParamsReport:function(a){var b={tipo:"R"};if(a.reservasId)b.reservasId=a.reservasId;if(a.urlAction)b.urlAction=a.urlAction;if(a.id)b.id=a.id;if(a.rcId)b.rcId=a.rcId;return b},
_getReporteFormato:function(a){a&&(a=this._makeParamsReport(a),new HfosModalForm(this,"abono_reserva/getFormato",{parameters:a,beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.file&&window.open($Kumbia.path+e.file):"FAILED"==e.status&&this._active.getMessages().error(e.message))}.bind(this,a)}))},_imprimeRecibosPagosLista:function(a){var b={urlAction:"abono_reserva/getListaRecibosPagos"};b.reservasId=b.id=a;this._getReporteFormato(b)},_imprimeRecibosPagos:function(a){var b=
{urlAction:"abono_reserva/getReciboPago"};b.rcId=a;this._getReporteFormato(b)},_setDetailsCallbacks:function(a){this.getElement("backButton").observe("click",this._backToSearch.bind(this));var b=this.getElement("printButton");if(null!==b){b.hide();b=this.getElement("newButton");this.getElement("deleteButton").hide();var c=this.selectOne("#estadoReserva");c&&"A"==c.getValue()?b.observe("click",this._nuevoAbono.bind(this,a)):b.hide();(a=this.selectOne("#recibosPagoButtonList"))&&a.observe("click",this._imprimeRecibosPagosLista.bind(this,
a.alt));$$(".recibosPagoButton").each(function(a){a.observe("click",this._imprimeRecibosPagos.bind(this,a.alt))}.bind(this));$$(".anularRecibosPagoButton").each(function(a){a.observe("click",this._anularRecibosPagos.bind(this,a.alt))}.bind(this))}new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)})},_nuevoAbono:function(a){this.go("abono_reserva/nuevo",{parameters:a,onSuccess:this._setNewCallbacks.bind(this)})},_onChangeTab:function(){},_setNewCallbacks:function(){var a=this.getElement("backButton");
a&&a.observe("click",this._backToSearch.bind(this));if(a=this.getElement("saveButton"))a.observe("click",this._grabarAbono.bind(this)),this._addGridCallbacks(1),new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)}),this._showTotalBar(),this._totalizeAbono()},_updateBeneficiario:function(){var a=this.selectOne("input#nit_det"),b=this.selectOne("input#beneficiario");""==b.getValue()&&!1==a.getValue().include("NO EXISTE")&&b.setValue(a.getValue())},_grabarAbono:function(){var a=this.getElement("formGrabar");
new HfosAjax.JsonFormRequest(a,{onSuccess:function(a){if("FAILED"==a.status)this.getMessages().error(a.message);else if("OK"==a.status){this.getMessages().success(a.message);this._key=a.reservasId;this.hideStatusBar();var c="id="+a.reservasId+"&rcId="+a.id+"&tipo=R";this.go("abono_reserva/ver",{parameters:c,onSuccess:this._setDetailsCallbacks.bind(this,c)});this._imprimeRecibosPagos(a.id)}}.bind(this)})},_backToSearch:function(){this.go("abono_reserva/index",{onSuccess:this._setIndexCallbacks.bind(this)});
this.hideStatusBar()},_anularRecibosPagos:function(a){new HfosModal.confirm({title:"Recibos de caja",message:"Se recalcular\u00e1 para reversar el pago. Seguro desea anular el recibo de caja?.",onAccept:function(){new HfosAjax.JsonRequest("abono_reserva/anular",{checkAcl:!0,parameters:{rcId:a},onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):(this.getMessages().success(a.message),a="id="+a.reservasId+"&n=0&rcId="+a.id+"&tipo=R",this.go("abono_reserva/ver",{parameters:a,
onSuccess:this._setDetailsCallbacks.bind(this,a)}))}.bind(this)})}.bind(this)})},_addGridCallbacks:function(a){var b=this.getElement("linea"+a);b.store("position",a);a=b.getElement("itemCheck");a.observe("change",this._selectRow.bind(this,a));a=b.getElement("formaPago");a.observe("blur",this._onBlurFormaPago.bind(this,a));a=b.getElement("numeroForma");a.observe("blur",this._onBlurNumeroForma.bind(this,a));b=b.getElement("valor");b.observe("blur",this._onBlurValor.bind(this,b))},_onBlurFormaPago:function(a){this._pushRowForUpdate(a)},
_onBlurNumeroForma:function(a){this._pushRowForUpdate(a)},_onBlurValor:function(a){this._pushRowForUpdate(a)},_pushRowForUpdate:function(a){a=a.up(1).retrieve("position")+1;if(null===this.getElement("linea"+a)){var b=document.createElement("TR");b.addClassName("linea"+a);var c=document.createElement("TD");c.addClassName("numero");c.update(a);b.appendChild(c);c=document.createElement("TD");c.update('<input type="checkbox" class="itemCheck" id="itemCheck'+a+'"/>');b.appendChild(c);c=document.createElement("TD");
c.addClassName("formaPago");var d=this.select("select.formaPago")[0];c.appendChild(d.cloneNode(!0));b.appendChild(c);c=document.createElement("TD");c.addClassName("numeroForma");c.update('<input type="text" class="numeroForma" name="numeroForma[]" id="numeroForma'+a+'" size="5" maxlength="4"/>');b.appendChild(c);c=document.createElement("TD");c.update('<input type="text" class="valor numeric" name="valor[]" id="valor'+a+'" size="12"/>');b.appendChild(c);this.getElement("abonos-reserva-body").appendChild(b);
this._addGridCallbacks(a);this._notifyContentChange();this._totalizeAbono();this.scrollToBottom()}},_selectRow:function(a){var b=a.up(1);b.hasClassName("lineaError")||(a.checked?b.addClassName("selectedRow"):b.removeClassName("selectedRow"));for(var a=0,b=this.select('input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a++},_totalizeAbono:function(){for(var a=this.select("input.valor"),b=0,c=0;c<a.length;c++)""!=a[c].getValue()&&(b+=parseFloat(a[c].getValue(),10));b=Utils.numberFormat(b);this._totalOrden.update('<table class="sumasTable"><tr><td>Total Abono <b>'+
b+"</b></td></tr></table>")},_showTotalBar:function(){var a;this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option></select><td><td class="totalOrden" align="right"></td></tr></table>');a=this.getStatusBarElement("opcionesSeleccion");a.observe("change",function(a){try{switch($F(a)){case "D":this._deleteRows()}a.setValue("@")}catch(c){HfosException.show(c)}}.bind(this,
a));this._totalOrden=this.getStatusBarElement("totalOrden");this._totalOrden.update("")}});HfosBindings.late("win-abono-reserva-tpc","afterCreate",function(a){new AbonoReserva(a);AReserva.setActive(a)});var AContrato={_active:null,setActive:function(a){this._active=a},getActive:function(){return this._active},addCallbacksRecibosPagos:function(a){a||(a={});if(!a.rc)a.rc=null;var a=AContrato.getActive(),b=a.selectOne("#sociosId");if((a=a.selectOne("#recibosPagoButtonList"))&&b)a.onClick=function(){this._imprimeRecibosPagosLista(b)}}},AbonoContrato=Class.create(HfosProcessContainer,{_key:null,_movimientos:[],_activeMov:0,_oldTercero:null,initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},
_setIndexCallbacks:function(){new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){switch(a.number){case "0":this.getMessages().notice("No se encontraron contratos");break;case "1":this._key=a.key;this.go("abono_contrato/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this,this._key)});break;case "n":var b=new HfosBrowseData(this,8);b.setEnableDeleteButton(!1);b.build(this.getElement("resultados"),a);a=b.getDetailsButtons();for(b=0;b<a.length;b++)a[b].store("primary",
a[b].title),a[b].title="Abonar",a[b].observe("click",this._detailsHandler.bind(this,a[b]));this.scrollToBottom();this._notifyContentChange()}}.bind(this)})},_detailsHandler:function(a){this._key=a.retrieve("primary");this.go("abono_contrato/ver",{parameters:this._key,onSuccess:this._setDetailsCallbacks.bind(this,this._key)});this.hideStatusBar()},_makeParamsReport:function(a){var b={tipo:"C"};if(a.sociosId)b.reservasId=a.sociosId;if(a.urlAction)b.urlAction=a.urlAction;if(a.id)b.id=a.id;if(a.rcId)b.rcId=
a.rcId;return b},_getReporteFormato:function(a){a&&(a=this._makeParamsReport(a),new HfosModalForm(this,"abono_contrato/getFormato",{parameters:a,beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.file&&window.open($Kumbia.path+e.file):"FAILED"==e.status&&this._active.getMessages().error(e.message))}.bind(this,a)}))},_getFormErrado:function(a){a&&new HfosModalForm(this,"abono_contrato/getFormErrado",{parameters:a,beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=
typeof e.file&&window.open($Kumbia.path+e.file):"FAILED"==e.status&&this._active.getMessages().error(e.message))}.bind(this,a)})},_getDetalleAbono:function(a){a&&new HfosModalForm(this,"abono_contrato/getDetalleAbono",{parameters:{id:a},beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.file&&window.open($Kumbia.path+e.file):"FAILED"==e.status&&this._active.getMessages().error(e.message))}.bind(this,a)})},_imprimeRecibosPagosLista:function(a){var b={urlAction:"abono_contrato/getListaRecibosPagos"};
b.sociosId=b.id=a;this._getReporteFormato(b)},_imprimeRecibosPagos:function(a){var b={urlAction:"abono_contrato/getReciboPago"};b.rcId=a;this._getReporteFormato(b)},_anularRecibosPagos:function(a){new HfosModal.confirm({title:"Recibos de caja",message:"Se recalcular\u00e1 para reversar el pago. Seguro desea anular el recibo de caja?.",onAccept:function(){new HfosAjax.JsonRequest("abono_contrato/anular",{checkAcl:!0,parameters:{rcId:a},onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):
(this.getMessages().success(a.message),a="id="+a.sociosId+"&n=0&rcId="+a.id+"&tipo=C",this.go("abono_contrato/ver",{parameters:a,onSuccess:this._setDetailsCallbacks.bind(this,a)}))}.bind(this)})}.bind(this)})},_nuevoAbonoErrado:function(){var a="",b=this.selectOne("#sociosId");b&&(a="id="+b.getValue());this._getFormErrado(a)},_setDetailsCallbacks:function(a){this.hideStatusBar();var b=this.getElement("backButton");b&&b.observe("click",this._backToSearch.bind(this));b=this.getElement("printButton");
if(null!==b){b.hide();var c=this.selectOne("#estadoContrato"),d=this.selectOne("#estadoMovimiento"),e=this.getElement("newButton"),f=this.getElement("abonoPosteriorButton"),b=this.getElement("abonoOtrosButton"),g=this.getElement("abonoErradoButton"),h=this.getElement("abonoCapitalButton");g&&g.observe("click",this._nuevoAbonoErrado.bind(this));c&&"A"==c.getValue()&&"P"!=d.getValue()?(e&&e.observe("click",this._nuevoAbono.bind(this,a)),f&&f.observe("click",this._nuevoAbonoPosterior.bind(this,a)),h&&
h.observe("click",this._nuevoAbonoCapital.bind(this,a))):(e&&e.hide(),f&&f.hide(),h&&h.hide());(c=this.getElement("deleteButton"))&&c.hide();if(c=this.selectOne("#recibosPagoButtonList"))c.observe("click",this._imprimeRecibosPagosLista.bind(this,c.alt)),this.hideStatusBar();$$(".recibosPagoButton").each(function(a){a.observe("click",this._imprimeRecibosPagos.bind(this,a.alt))}.bind(this));$$(".anularRecibosPagoButton").each(function(a){a.observe("click",this._anularRecibosPagos.bind(this,a.alt))}.bind(this));
$$(".detalleRecibosPagoButton").each(function(a){a.observe("click",this._getDetalleAbono.bind(this,a.alt))}.bind(this));b&&b.observe("click",this._nuevoAbonoOtros.bind(this,a))}if(b=this.selectOne("#fechaPagoSelectorYear")){c=this.selectOne("#fechaPagoSelectorMonth");d=this.selectOne("#fechaPagoSelectorDay");if(b&&"@"==b.getValue()||c&&"@"==c.getValue()||d&&"@"==d.getValue())return!1;b.observe("change",this._changeEstadoCuenta.bind(this,a));c.observe("change",this._changeEstadoCuenta.bind(this,a));
d.observe("change",this._changeEstadoCuenta.bind(this,a))}new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)})},_changeEstadoCuenta:function(a){var b=this.selectOne("#estadoCuentaDiv");if(b){var c=this.selectOne("#fechaPagoSelectorYear"),d=this.selectOne("#fechaPagoSelectorMonth"),e=this.selectOne("#fechaPagoSelectorDay"),f=c.options[c.selectedIndex].value,f=f+"-",f=f+d.options[d.selectedIndex].value,f=f+"-",f=f+e.options[e.selectedIndex].value;new HfosAjax.Request("abono_contrato/getEstadoCuenta",
{parameters:a+"&fechaPago="+f,onSuccess:function(a){alert(f);b.update(a.responseText)}.bind(this)})}},_nuevoAbono:function(a){a&&-1==a.toString().indexOf("id=")&&(a="id="+a);this.go("abono_contrato/nuevo",{parameters:a,onSuccess:this._setNewCallbacks.bind(this)})},_nuevoAbonoPosterior:function(a){a&&-1==a.toString().indexOf("id=")&&(a="id="+a);this.go("abono_contrato/nuevo",{parameters:a+"&tipo=P",onSuccess:this._setNewCallbacks.bind(this)})},_nuevoAbonoCapital:function(a){a&&-1==a.toString().indexOf("id=")&&
(a="id="+a);this.go("abono_contrato/nuevo",{parameters:a+"&tipo=K",onSuccess:this._setNewCallbacks.bind(this)})},_nuevoAbonoOtros:function(a){a&&-1==a.toString().indexOf("id=")&&(a="id="+a);this.go("abono_contrato/nuevo",{parameters:a+"&tipo=O",onSuccess:this._setNewCallbacks.bind(this)})},_onChangeTab:function(){},_setNewCallbacks:function(){var a=this.getElement("backButton");a&&a.observe("click",this._backToSearch.bind(this));var a=this.selectOne("#fechaReciboDay"),b=this.selectOne("#fechaReciboMonth"),
c=this.selectOne("#fechaReciboYear");a&&a.disable();b&&b.disable();c&&c.disable();if(a=this.getElement("saveButton"))a.observe("click",this._grabarAbono.bind(this)),this._addGridCallbacks(1),new HfosTabs(this,"tabbed",{onChange:this._onChangeTab.bind(this)});this._showTotalBar();this._totalizeAbono()},_grabarAbono:function(){var a=this.getElement("formGrabar");new HfosAjax.JsonFormRequest(a,{onSuccess:function(a){if("FAILED"==a.status)this.getMessages().error(a.message);else if("OK"==a.status)this.getMessages().success(a.message),
this._key=a.sociosId,this.hideStatusBar(),this.go("abono_contrato/ver",{parameters:this._key+"&"+("id="+a.sociosId+"&rcId="+a.id+"&tipo=C"),onSuccess:this._setDetailsCallbacks.bind(this,this._key)}),this._imprimeRecibosPagos(a.id),this.hideStatusBar()}.bind(this)})},_backToSearch:function(){this.go("abono_contrato/index",{onSuccess:this._setIndexCallbacks.bind(this)});this.hideStatusBar()},_totalizeAbono:function(){for(var a=this.select("input.valor"),b=0,c=0;c<a.length;c++)""!=a[c].getValue()&&(b+=
parseFloat(a[c].getValue(),10));b=Utils.numberFormat(b);this._totalOrden.update('<table class="sumasTable"><tr><td>Total Abono <b>'+b+"</b></td></tr></table>")},_showTotalBar:function(){var a;this.showStatusBar('<table width="100%" class="movimientoStatusBar"><tr><td align="left" style="display:none" class="movimientoSeleccion">Opciones de la Selecci\u00f3n <select class="opcionesSeleccion"><option value="@">Seleccione...</option><option value="D">Eliminar</option></select><td><td class="totalOrden" align="right"></td></tr></table>');
a=this.getStatusBarElement("opcionesSeleccion");a.observe("change",function(a){try{switch($F(a)){case "D":this._deleteRows()}a.setValue("@")}catch(c){HfosException.show(c)}}.bind(this,a));this._totalOrden=this.getStatusBarElement("totalOrden");this._totalOrden.update("")},_addGridCallbacks:function(a){var b=this.getElement("linea"+a);b.store("position",a);a=b.getElement("itemCheck");a.observe("change",this._selectRow.bind(this,a));a=b.getElement("formaPago");a.observe("blur",this._onBlurFormaPago.bind(this,
a));a=b.getElement("numeroForma");a.observe("blur",this._onBlurNumeroForma.bind(this,a));b=b.getElement("valor");b.observe("blur",this._onBlurValor.bind(this,b))},_onBlurFormaPago:function(a){this._pushRowForUpdate(a)},_onBlurNumeroForma:function(a){this._pushRowForUpdate(a)},_onBlurValor:function(a){this._pushRowForUpdate(a)},_pushRowForUpdate:function(a){a=a.up(1).retrieve("position")+1;if(null===this.getElement("linea"+a)){var b=document.createElement("TR");b.addClassName("linea"+a);var c=document.createElement("TD");
c.addClassName("numero");c.update(a);b.appendChild(c);c=document.createElement("TD");c.update('<input type="checkbox" class="itemCheck" id="itemCheck'+a+'"/>');b.appendChild(c);c=document.createElement("TD");c.addClassName("formaPago");var d=this.select("select.formaPago")[0];c.appendChild(d.cloneNode(!0));b.appendChild(c);c=document.createElement("TD");c.addClassName("numeroForma");c.update('<input type="text" class="numeroForma" name="numeroForma[]" id="numeroForma'+a+'" size="5" maxlength="4"/>');
b.appendChild(c);c=document.createElement("TD");c.update('<input type="text" class="valor numeric" name="valor[]" id="valor'+a+'" size="12"/>');b.appendChild(c);this.getElement("abonos-contrato-body").appendChild(b);this._addGridCallbacks(a);this._notifyContentChange();this.scrollToBottom();this._totalizeAbono()}},_selectRow:function(a){var b=a.up(1);b.hasClassName("lineaError")||(a.checked?b.addClassName("selectedRow"):b.removeClassName("selectedRow"));for(var a=0,b=this.select('input[type="checkbox"]'),
c=0;c<b.length;c++)b[c].checked&&a++}});HfosBindings.late("win-abono-contrato-tpc","afterCreate",function(a){new AbonoContrato(a);AContrato.setActive(a)});var Proyeccion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._proyeccion.bind(this,a));if(a=this.getElement("valorTotal")){a.observe("change",this._cuotaInicial.bind(this,a));var b=this.getElement("cuotaInicial");b&&b.observe("change",this._cuotaInicial.bind(this,a))}a.activate()},_cuotaInicial:function(a){var a=this.getElement("valorTotal"),b=this.getElement("cuotaInicial"),c=this.getElement("saldoPagar");a.getValue()&&
new HfosAjax.JsonRequest("contratos/getCuotaInicial",{parameters:{valorTotal:a.getValue(),cuotaInicial:b.getValue()},onSuccess:function(d){"FAILED"==d.status?(this.getMessages().error(d.message),b.setValue(0),c.setValue(a.getValue())):(b&&b.setValue(d.cuotaInicial),c&&c.setValue(d.saldoPagar))}.bind(this)})},_proyeccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("proyeccionForm");new HfosAjax.JsonFormRequest(b,{onLoading:function(a){this.getMessages().notice("Se est\u00e1 proyectando la amortizaci\u00f3n...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el proyecci\u00f3n correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-proyeccion-tpc","afterCreateOrRestore",function(a){new Proyeccion(a)});var Reservas={_active:null,setActive:function(a){Reservas._active=new Reserva(a)},hasActive:function(){return null!==Reservas._active},getActive:function(){return Reservas._active},unsetActive:function(){Reservas._active=null}},Reserva=Class.create({_hyperForm:null,_data:null,initialize:function(a){this._hyperForm=a;a.observe("beforeRecordPreview",this._addActivarButton.bind(this));a.observe("beforeRecordPreview",this._addDesistirButton.bind(this))},_addActivarButton:function(a,b){this._hyperForm.removeControlButton("copyButton");
var c="";if(null!=b)var d=new HyperRecordData(b.data),c=d.getValueFromName("estado_contrato");"Activo"==c&&this._hyperForm.addControlButton({className:"copyButton",value:"Activar Contrato",onClick:this._abrirActivarContrato.bind(this,d)})},_abrirActivarContrato:function(a){a=a.getValueFromName("id");new HfosAjax.JsonRequest("reservas/getDatos",{parameters:{codigo:a},onSuccess:function(a){"OK"==a.status?(this._data=a.data,Hfos.getApplication().run({id:"win-contratos-tpc",icon:"hire-me.png",title:"Contratos",
width:"900px",height:"600px",action:"contratos"})):this._hyperForm.getMessages().error(a.message)}.bind(this)})},_addDesistirButton:function(a,b){this._hyperForm.removeControlButton("deleteButton");this._hyperForm.removeControlButton("desistirButton");var c=new HyperRecordData(b.data);"Activo"==c.getValueFromName("estado_contrato")&&this._hyperForm.addControlButton({className:"desistirButton",value:"Desistir",onClick:this._abrirDesistir.bind(this,c)})},_abrirDesistir:function(a){this._hyperForm.getActiveSection();
(a=a.getValueFromName("id"))?new HfosModalForm(this,"reservas/getDesistir",{parameters:{reservaId:a},beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.message&&(this._hyperForm.getMessages().success(e.message),c.close()):"FAILED"==e.status&&this._hyperForm.getMessages().error(e.message))}.bind(this,a)}):alert("No encontro codigo")},loadData:function(a){null!==this._data&&(a.setFieldValues(this._data),a.getMessages().notice("Activando la reserva "+this._data.numero_contrato),
a.addFieldLabelInput("reservas_contrato","Reserva",this._data.id,"before",this._data.numero_contrato))}});HyperFormManager.lateBinding("reservas","afterInitialize",function(){Reservas.setActive(this)});var Contratos={_showAmortizacion:null,_cambioContrato:null,refinanciar:null,_active:null,setActive:function(a){Contratos._active=new Contrato(a)},hasActive:function(){return null!==Contratos._active},getActive:function(){return Contratos._active},unsetActive:function(){Contratos._active=null},setRefinanciar:function(a){Contratos._refinanciar=a},hasRefinanciar:function(){return null!==Contratos._refinanciar},getRefinanciar:function(){return Contratos._refinanciar},unsetRefinanciar:function(){Contratos._refinanciar=
null},setCambioContrato:function(a){Contratos._cambioContrato=a},hasCambioContrato:function(){return null!==Contratos._cambioContrato},getCambioContrato:function(){return Contratos._cambioContrato},unsetCambioContrato:function(){Contratos._cambioContrato=null},setShowAmortizacion:function(a){Contratos._showAmortizacion=a},hasShowAmortizacion:function(){return null!==Contratos._showAmortizacion},getShowAmortizacion:function(){return Contratos._showAmortizacion},unsetShowAmortizacion:function(){Contratos._showAmortizacion=
null}},Contrato=Class.create({_hyperForm:null,_refinanciar:null,initialize:function(a){this._hyperForm=a;a.observe("beforeInput",this._addValidations.bind(this));a.observe("beforeRecordPreview",this._addCambiarContratoButton.bind(this));a.observe("beforeRecordPreview",this._addDesistirButton.bind(this));a.observe("beforeRecordPreview",this._addRetomaButton.bind(this));a.observe("beforeRecordPreview",this._addRefinanciarButton.bind(this));a.observe("afterSendForm",this._mostrarAmortizacion.bind(this));
!0==Reservas.hasActive()&&(a.observe("beforeInput",function(){!0==Reservas.hasActive()&&(Reservas.getActive().loadData(this),Reservas.unsetActive())}.bind(a)),a.externalProcedureCall("new"))},_mostrarAmortizacion:function(a,b){var c=this._hyperForm.getCurrentState();if("OK"==b.status&&("edit"==c||"new"==c))Contratos.setShowAmortizacion(!0),this._hyperForm.observe("beforeRecordPreview",this._getReporteAmortizacion.bind(this))},_getCuotaInicial:function(){var a=this._hyperForm,b=this._hyperForm.getActiveSection(),
c=b.selectOne("#valor_total"),d=b.selectOne("#cuota_inicial");c.getValue()&&new HfosAjax.JsonRequest("contratos/getCuotaInicial",{parameters:{valorTotal:c.getValue(),cuotaInicial:d.getValue()},onSuccess:function(c){if("FAILED"==c.status){a.getMessages().error(c.message);var c=b.selectOne("#valor_total"),d=b.selectOne("#cuota_inicial"),g=b.selectOne("#saldo_pagar");d.setValue(0);g.setValue(c.getValue())}else(d=b.selectOne("#cuota_inicial"))&&d.setValue(c.cuotaInicial),(g=b.selectOne("#saldo_pagar"))&&
g.setValue(c.saldoPagar);(g=b.selectOne("#hoy"))&&g.setValue(d.getValue())}})},_getPuntos:function(){var a=this._hyperForm,b=this._hyperForm.getActiveSection(),c=b.selectOne("#puntos_ano"),d=b.selectOne("#numero_anos");c.getValue()&&d.getValue()&&new HfosAjax.JsonRequest("contratos/getPuntos",{parameters:{puntosAno:c.getValue(),numeroAno:d.getValue()},onSuccess:function(c){if("FAILED"==c.status)a.getMessages().error(c.message);else{var d=b.selectOne("#total_puntos");d&&d.setValue(c.totalPuntos)}}})},
_getReporteAmortizacion:function(a,b){var c=this._hyperForm.getActiveSection().selectOne("#id"),d=0;!c&&b&&b.data?(c=b.data.last().value)?(contratoAsociadoArray=c.split("/"),d=contratoAsociadoId=parseInt(contratoAsociadoArray[0])):d=b.data[0].value:d=c.getValue();0<d&&!0==Contratos.getShowAmortizacion()&&(new HfosModalForm(this,"contratos/getFormato",{parameters:{sociosId:d},beforeClose:function(a,b,c,d){!1==c&&("OK"==d.status?"undefined"!=typeof d.file&&(Contratos.setShowAmortizacion(!1),window.open($Kumbia.path+
d.file)):"FAILED"==d.status&&this._hyperForm.getMessages().error(d.message))}.bind(this,d)}),Contratos.unsetShowAmortizacion())},_addValidations:function(){alert("validando");var a=this._hyperForm.getActiveSection(),b=a.selectOne("#puntos_ano"),c=a.selectOne("#numero_anos");b.observe("change",this._getPuntos.bind(this));c.observe("change",this._getPuntos.bind(this));b=a.selectOne("#valor_total");a=a.selectOne("#cuota_inicial");b.observe("change",this._getCuotaInicial.bind(this));a.observe("change",
this._getCuotaInicial.bind(this));a=this._hyperForm.getActiveSection();(a=a.selectOne("#amortizacionButton"))&&a.observe("click",this._amortizacionShow.bind(this))},_amortizacionShow:function(){Contratos.setShowAmortizacion(!0);this._getReporteAmortizacion(!1)},_abrirCambioContrato:function(a){this._hyperForm.getActiveSection();(a=a.getValueFromName("id"))?new HfosModalForm(this,"contratos/getCambioContrato",{parameters:{sociosId:a},beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=
typeof e.message&&(Contratos.setCambioContrato(!0),this._hyperForm.getMessages().success(e.message),this._editCambioContrato(e)):"FAILED"==e.status&&this._hyperForm.getMessages().error(e.message))}.bind(this,a)}):alert("No encontro codigo")},_getCuotaInicialCambioContrato:function(){var a=this._hyperForm,b=this._hyperForm.getActiveSection(),c=b.selectOne("#id");c&&c.getValue()&&new HfosAjax.JsonRequest("contratos/getCuotaInicialCambioContrato",{parameters:"id="+c.getValue(),onSuccess:function(c){if("FAILED"==
c.status)a.getMessages().error(c.message);else{var e=b.selectOne("#cuota_inicial");e&&e.setValue(c.valor);(e=b.selectOne("#saldo_pagar"))&&e.setValue(c.saldoPagar);(e=b.selectOne("#hoy"))&&e.setValue(c.valor);(c=b.selectOne("#cuota2"))&&c.setValue(0);(c=b.selectOne("#cuota3"))&&c.setValue(0)}}})},_editCambioContrato:function(a){var b=this._hyperForm;this._hyperForm.getActiveSection();var c=this._hyperForm.getElement("editButton");null!==c?(this._hyperForm.observe("beforeInput",function(a){if(!0==
Contratos.getCambioContrato()){b.getMessages().notice("Cambiando Contrato");b.addFieldLabelInput("nuevo_contrato","Nuevo Contrato",a.tipoContratoId,"before",a.tipoContratoNombre);if(a=b.getActiveSection().selectOne("#tipo_contrato_id"))a.setAttribute("disabled","true"),a.disable();var a=b.getActiveSection().selectOne("#fecha_compraMonth"),c=b.getActiveSection().selectOne("#fecha_compraYear"),f=b.getActiveSection().selectOne("#fecha_compraDay");a&&(a.setAttribute("disabled","true"),a.disable(),c.setAttribute("disabled",
"true"),c.disable(),f.setAttribute("disabled","true"),f.disable());this._getCuotaInicialCambioContrato();b.observe("beforeRecordPreview",function(){Contratos.unsetCambioContrato()}.bind(this))}}.bind(this,a)),this._hyperForm.fire("onEdit"),c.click()):alert("No encontro editButton")},_addCambiarContratoButton:function(a,b){this._hyperForm.removeControlButton("reopenButton");this._hyperForm.getActiveSection();var c=new HyperRecordData(b.data);"Activo"==c.getValueFromName("estado_contrato")&&this._hyperForm.addControlButton({className:"copyButton",
value:"Cambio de Contrato",onClick:this._abrirCambioContrato.bind(this,c)})},_addDesistirButton:function(a,b){this._hyperForm.removeControlButton("deleteButton");this._hyperForm.removeControlButton("desistirButton");var c=new HyperRecordData(b.data);"Activo"==c.getValueFromName("estado_contrato")&&this._hyperForm.addControlButton({className:"desistirButton",value:"Desistir",onClick:this._abrirDesistir.bind(this,c)})},_abrirDesistir:function(a){this._hyperForm.getActiveSection();(a=a.getValueFromName("id"))?
new HfosModalForm(this,"contratos/getDesistir",{parameters:{sociosId:a},beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.message&&this._hyperForm.getMessages().success(e.message):"FAILED"==e.status&&this._hyperForm.getMessages().error(e.message))}.bind(this,a)}):alert("No encontro codigo")},_addRetomaButton:function(a,b){this._hyperForm.removeControlButton("retomaButton");var c=new HyperRecordData(b.data);"Anulado"==c.getValueFromName("estado_contrato")&&this._hyperForm.addControlButton({className:"retomaButton",
value:"Retoma de Contrato",onClick:this._abrirRetoma.bind(this,c)})},_abrirRetoma:function(a){var b=this._hyperForm;this._hyperForm.getActiveSection();var c=a.getValueFromName("id");c?new HfosModal.confirm({title:"Retoma",message:"Esta seguro de retomar este contrato?",onAccept:function(){new HfosAjax.JsonRequest("contratos/retoma",{parameters:{sociosId:c},onSuccess:function(a){"FAILED"==a.status?b.getMessages().error(a.message):(b.getMessages().success(a.message),Contratos.setShowAmortizacion(!0))}})}.bind(this)}):
alert("No encontro codigo")},_addRefinanciarButton:function(a,b){this._hyperForm.removeControlButton("refinanciarButton");var c=new HyperRecordData(b.data);"Activo"==c.getValueFromName("estado_contrato")&&this._hyperForm.addControlButton({className:"refinanciarButton",value:"Refinanciar Contrato",onClick:this._addRefinanciacion.bind(this,c)})},_addRefinanciacion:function(a){var b=this._hyperForm;this._hyperForm.getActiveSection();var c=a.getValueFromName("id");c?new HfosAjax.JsonRequest("contratos/validarRefinanciar",
{parameters:{sociosId:c},onSuccess:function(a){"FAILED"==a.status?b.getMessages().error(a.message):new HfosModalForm(this,"contratos/getRefinanciar",{parameters:{sociosId:c},beforeClose:function(a,b,c,d){!1==c&&("OK"==d.status?"undefined"!=typeof d.message&&this._hyperForm.getMessages().success(d.message):"FAILED"==d.status&&this._hyperForm.getMessages().error(d.message))}.bind(this,c)})}.bind(this)}):alert("No encontro codigo")}});
HyperFormManager.lateBinding("contratos","afterInitialize",function(){Contratos.setActive(this);Contratos.getActive()});
