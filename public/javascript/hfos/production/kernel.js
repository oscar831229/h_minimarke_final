/*
 	New BSD License
 @version 	$Id$
*/
var Base={PROTOTYPE:1,JQUERY:2,EXT:3,MOOTOOLS:4,framework:0,bind:function(){var _func=arguments[0]||null;var _obj=arguments[1]||this;var i=0;var _args=[];for(var i=0;i<arguments.length;i++){if(i>1)_args[_args.length]=arguments[i];i++}return function(){return _func.apply(_obj,_args)}},_checkFramework:function(){if(typeof Prototype!="undefined"){Base.activeFramework=Base.PROTOTYPE;return}if(typeof jQuery!="undefined"){Base.activeFramework=Base.JQUERY;return}if(typeof Ext!="undefined"){Base.activeFramework=
Base.EXT;return}if(typeof MooTools!="undefined"){Base.activeFramework=Base.MOOTOOLS;return}return 0},$:function(element){return document.getElementById(element)},show:function(element){document.getElementById(element).style.display=""},hide:function(element){document.getElementById(element).style.display="none"},setValue:function(element,value){document.getElementById(element).value=value},getValue:function(element){element=document.getElementById(element);if(element.tagName=="SELECT")return element.options[element.selectedIndex].value;
else return element.value},up:function(element,levels){var l=0;var finalElement=element;while(finalElement){finalElement=finalElement.parentNode;if(l>=levels)return finalElement;l++}return finalElement}};
var NumericField={maskNum:function(evt){evt=evt?evt:window.event?window.event:null;var kc=evt.keyCode;if(!evt.ctrlKey&&!evt.metaKey){var ev=evt.altKey==false&&evt.shiftKey==false&&(kc>=48&&kc<=57||kc>=96&&kc<=105||kc==8||kc==9||kc==13||kc==17||kc==36||kc==35||kc==37||kc==46||kc==39||kc==190||kc==110);if(!ev){ev=evt.shiftKey==true&&(kc==9||kc>=35&&kc<=39);if(!ev)ev=evt.altKey==true&&(kc==84||kc==82)}if(!ev){evt.preventDefault();evt.stopPropagation();evt.stopped=true;return false}}return true},format:function(element){if(element.value!==
""){var integerPart="";var decimalPart="";var decimalPosition=element.value.indexOf(".");if(decimalPosition!=-1){decimalPart=element.value.substr(decimalPosition);integerPart=element.value.substr(0,decimalPosition)}else integerPart=element.value;document.title=integerPart+" "+decimalPart}}};
var DateCalendar={build:function(element,name,value){var year=parseInt(value.substr(0,4),10);var month=parseInt(value.substr(5,2),10);var day=parseInt(value.substr(8,2),10);DateCalendar._buildMonth(element,year,month,value)},_buildMonth:function(element,year,month,activeDate){var numberDays=DateField.getNumberDays(year,month);var firstDate=new Date(year,month-1,1);var lastDate=new Date(year,month-1,numberDays);var html='<table class="calendarTable" cellspacing="0">';html+='<tr><td class="arrowPrev"><img src="'+
$Kumbia.path+'img/prevw.gif"/></td>';html+='<td colspan="5" class="monthName">'+DateCalendar.getMonthName(month)+"</td>";html+='<td class="arrowNext"><img src="'+$Kumbia.path+'img/nextw.gif"/></td></tr>';html+="<tr><th>Dom</th><th>Lun</th><th>Mar</th><th>Mie</th><th>Jue</th><th>Vie</th><th>S\u00e1b</th></tr>";html+="<tr>";if(month==1)var numberDaysPast=DateField.getNumberDays(year-1,12);else var numberDaysPast=DateField.getNumberDays(year-1,month-1);var dayOfWeek=firstDate.getDay();for(var i=numberDaysPast-
dayOfWeek+1;i<numberDaysPast;i++)html+='<td class="outMonthDay">'+(i+1)+"</td>";var numberDay=1;var date;while(numberDay<=numberDays){if(month<10)date=year+"-0"+month+"-"+numberDay;else date=year+"-"+month+"-"+numberDay;if(activeDate==date)html+='<td class="selectedDay" title="'+date+'">'+numberDay+"</td>";else html+='<td title="'+date+'">'+numberDay+"</td>";if(dayOfWeek==6){html+="</tr><tr>";dayOfWeek=0}else dayOfWeek++;numberDay++}numberDay=1;if(dayOfWeek<7)for(var i=dayOfWeek;i<7;i++){html+='<td class="outMonthDay">'+
numberDay+"</td>";numberDay++}html+="</tr></table>";var position=element.up(1).cumulativeOffset();var calendarDiv=document.getElementById("calendarDiv");if(calendarDiv)calendarDiv.parentNode.removeChild(calendarDiv);calendarDiv=document.createElement("DIV");calendarDiv.id="calendarDiv";calendarDiv.addClassName("calendar");calendarDiv.update(html);calendarDiv.style.top=position[1]+22+"px";calendarDiv.style.left=position[0]+"px";document.body.appendChild(calendarDiv);window.setTimeout(function(){new Event.observe(window,
"click",DateCalendar.removeCalendar)},150)},removeCalendar:function(event){if(event.target.tagName!="INPUT"&&event.target.tagName!="SELECT"){var calendarDiv=document.getElementById("calendarDiv");if(calendarDiv)calendarDiv.parentNode.removeChild(calendarDiv);new Event.stopObserving(window,"click",DateCalendar.removeCalendar)}},getMonthName:function(month){switch(month){case 1:return"Enero";case 2:return"Febrero";case 3:return"Marzo";case 4:return"Abril";case 5:return"Mayo";case 6:return"Junio";case 7:return"Julio";
case 8:return"Agosto";case 9:return"Septiembre"}}};
var DateField={_monthTable:[31,28,31,30,31,30,31,31,30,31,30,31],_listeners:{},observe:function(element,eventName,procedure){if(typeof DateField._listeners[eventName]=="undefined")DateField._listeners[eventName]={};DateField._listeners[eventName][element.id]={"element":element,"procedure":procedure}},fire:function(element,eventName,elementValue){if(typeof DateField._listeners[eventName]!="undefined")if(typeof DateField._listeners[eventName][element.id]!="undefined"){var handler=DateField._listeners[eventName][element.id];
if(element==handler["element"])handler["procedure"](elementValue)}return false},getNumberDays:function(year,month){var numberDays=DateField._monthTable[month-1];if(month==2)if(parseInt(year,10)%4==0)numberDays=29;return numberDays},getElement:function(name,context){if(typeof context=="undefined")return Base.$(name);else return context.up(4).querySelector("#"+name)},getValue:function(name,context){var element=DateField.getElement(name,context);if(element.tagName=="SELECT")return element.options[element.selectedIndex].value;
else return element.value},refresh:function(name,context){var html="",n,numberDays;var year=DateField.getValue(name+"Year",context);var month=DateField.getValue(name+"Month",context);var day=DateField.getValue(name+"Day",context);var daySelect=DateField.getElement(name+"Day",context);var value=year+"-"+month+"-"+day;var element=DateField.getElement(name,context);element.value=value;while(daySelect.lastChild)daySelect.removeChild(daySelect.lastChild);if(month.substr(0,1)=="0")month=month.substr(1,
1);var numberDays=DateField.getNumberDays(year,month);for(var i=1;i<=numberDays;++i){n=i<10?"0"+i:i;if(n==day)html+='<option value="'+n+'" selected="selected">'+n+"</option>";else html+='<option value="'+n+'">'+n+"</option>"}daySelect.innerHTML=html;DateField.fire(element,"change",value)},showCalendar:function(element,name){DateCalendar.build(element,name,Base.getValue(name))}};
var TimeField={refresh:function(name,context){var hour=DateField.getValue(name+"Hour",context);var minutes=DateField.getValue(name+"Minutes",context);var value=hour+":"+minutes;DateField.getElement(name,context).value=value}};
var Utils={getKumbiaURL:function(url){if(typeof url=="undefined")url="";if($Kumbia.app!="")return $Kumbia.path+$Kumbia.app+"/"+url;else return $Kumbia.path+url},getAppURL:function(url){if(typeof url=="undefined")url="";if($Kumbia.app!="")return $Kumbia.path+$Kumbia.app+"/"+url;else return $Kumbia.path+url},getURL:function(url){if(typeof url=="undefined")return $Kumbia.path;else return $Kumbia.path+url},redirectParentToAction:function(url){new Utils.redirectToAction(url,window.parent)},redirectOpenerToAction:function(url){new Utils.redirectToAction(url,
window.opener)},redirectToAction:function(url,win){win=win?win:window;win.location=Utils.getKumbiaURL()+url},upperCaseFirst:function(str){var first=str.substring(0,1).toUpperCase();return first+str.substr(1,str.length-1)},round:function(number,decimals){var decimalPlace=Math.pow(100,decimals);return Math.round(number*decimalPlace)/decimalPlace},numberFormat:function(number){var number=number.toString();var decimalPosition=number.indexOf(".");if(decimalPosition!=-1){var decimals=number.substr(decimalPosition+
1);var integer=number.substring(0,decimalPosition)}else{var decimals="00";var integer=number}var n=1;var formatedNumber=[];var integer=integer.toArray();for(var i=0;i<integer.length;i++){if((integer.length-i)%3==0)if(i!=0)formatedNumber.unshift(".");formatedNumber.unshift(integer[i])}return formatedNumber.reverse().join("")+","+decimals.substr(0,2)}};
function ajaxRemoteForm(form,up,callback){if(callback==undefined)callback={};new Ajax.Updater(up,form.action,{method:"post",asynchronous:true,evalScripts:true,onSuccess:function(transport){$(up).update(transport.responseText)},onLoaded:callback.before!=undefined?callback.before:function(){},onComplete:callback.success!=undefined?callback.success:function(){},parameters:Form.serialize(form)});return false}
var AJAX={doRequest:function(url,options){var framework=Base.activeFramework;if(typeof options=="undefined")options={};switch(framework){case Base.PROTOTYPE:var callbackMap={"before":"onLoading","success":"onSuccess","complete":"onComplete","error":"onFailure"};$H(callbackMap).each(function(callback){if(typeof options[callback[0]]!="undefined")options[callback[1]]=function(procedure,transport){procedure.bind(this,transport.responseText)()}.bind(this,options[callback[0]])});return new Ajax.Request(url,
options);case Base.JQUERY:var paramMap={"method":"type","parameters":"data","asynchronous":"async"};$.each(paramMap,function(index,value){if(typeof options[index]!="undefined")options[value]=options[index]});options.url=url;return $.ajax(options);case Base.EXT:var paramMap={"before":"beforerequest","error":"failure","parameters":"params"};var index;for(index in paramMap)if(typeof options[index]!="undefined")options[paramMap[index]]=options[index];options.url=url;return Ext.Ajax.request(options);case Base.MOOTOOLS:var paramMap=
{"parameters":"data","asynchronous":"async","before":"onRequest","success":"onSuccess","error":"onFailure","complete":"onComplete"};var index;for(index in paramMap)if(typeof options[index]!="undefined")options[paramMap[index]]=options[index];options.url=url;var request=new Request(options);request.send();return request;break}},update:function(url,element,options){if(typeof options=="undefined")options={};options.success=function(responseText){Base.$(element).innerHTML=responseText};Base.bind(options.success,
element,element);return AJAX.doRequest(url,options)}};AJAX.xmlRequest=function(params){var options={};if(typeof params.url=="undefined"&&typeof params.action!="undefined")options.url=Utils.getKumbiaURL(params.action);return AJAX.doRequest(options.url,options)};
AJAX.viewRequest=function(params){var options={};if(typeof params.url=="undefined"&&typeof params.action!="undefined")options.url=Utils.getKumbiaURL(params.action);container=params.container;options.evalScripts=true;if(!document.getElementById(container))throw"CoreError: DOM Container '"+container+"' no encontrado";return AJAX.update(container,options.url,options)};
AJAX.execute=function(params){var options={};if(typeof params.url=="undefined"&&typeof params.action!="undefined")options.url=Utils.getKumbiaURL(params.action);return AJAX.doRequest(options.url,options)};
AJAX.query=function(queryAction,onSuccess){var me;new Ajax.Request(Utils.getKumbiaURL(queryAction),{method:"GET",asynchronous:false,onSuccess:function(transport){var xml=transport.responseXML;var data=xml.getElementsByTagName("data");if(Prototype.Browser.IE)xmlValue=data[0].text;else xmlValue=data[0].textContent;me=xmlValue}});return me};if(document.addEventListener)document.addEventListener("DOMContentLoaded",Base._checkFramework,false);else document.attachEvent("readystatechange",Base._checkFramework);var Prototype={Version:"1.7",Browser:function(){var a=navigator.userAgent,b=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!(!a||!a.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return!0;var a=document.createElement("div"),b=document.createElement("form"),c=!1;a.__proto__&&a.__proto__!==b.__proto__&&(c=!0);return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=!1;
var Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a}},Class=function(){function a(){}var b=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}();return{create:function(){function b(){this.initialize.apply(this,arguments)}var d=null,e=$A(arguments);Object.isFunction(e[0])&&(d=e.shift());Object.extend(b,Class.Methods);b.superclass=d;b.subclasses=[];if(d)a.prototype=d.prototype,b.prototype=new a,d.subclasses.push(b);
for(var d=0,f=e.length;d<f;d++)b.addMethods(e[d]);if(!b.prototype.initialize)b.prototype.initialize=Prototype.emptyFunction;return b.prototype.constructor=b},Methods:{addMethods:function(a){var d=this.superclass&&this.superclass.prototype,e=Object.keys(a);b&&(a.toString!=Object.prototype.toString&&e.push("toString"),a.valueOf!=Object.prototype.valueOf&&e.push("valueOf"));for(var f=0,g=e.length;f<g;f++){var j=e[f],h=a[j];if(d&&Object.isFunction(h)&&h.argumentNames()[0]=="$super"){var m=h,h=function(a){return function(){return d[a].apply(this,
arguments)}}(j).wrap(m);h.valueOf=m.valueOf.bind(m);h.toString=m.toString.bind(m)}this.prototype[j]=h}return this}}}}();
(function(){function a(a){switch(a){case null:return m;case void 0:return o}switch(typeof a){case "boolean":return l;case "number":return x;case "string":return q}return r}function b(a,b){for(var c in b)a[c]=b[c];return a}function c(a){return d("",{"":a},[])}function d(b,c,g){var c=c[b],e=typeof c;a(c)===r&&typeof c.toJSON==="function"&&(c=c.toJSON(b));b=h.call(c);switch(b){case w:case s:case y:c=c.valueOf()}switch(c){case null:return"null";case !0:return"true";case !1:return"false"}switch(typeof c){case "string":return c.inspect(!0);
case "number":return isFinite(c)?String(c):"null";case "object":for(var e=0,j=g.length;e<j;e++)if(g[e]===c)throw new TypeError;g.push(c);var f=[];if(b===A){e=0;for(j=c.length;e<j;e++){var m=d(e,c,g);f.push(typeof m==="undefined"?"null":m)}f="["+f.join(",")+"]"}else{for(var o=Object.keys(c),e=0,j=o.length;e<j;e++)b=o[e],m=d(b,c,g),typeof m!=="undefined"&&f.push(b.inspect(!0)+":"+m);f="{"+f.join(",")+"}"}g.pop();return f}}function e(a){return JSON.stringify(a)}function f(b){if(a(b)!==r)throw new TypeError;
var c=[],d;for(d in b)b.hasOwnProperty(d)&&c.push(d);return c}function g(a){return h.call(a)===A}function j(a){return typeof a==="undefined"}var h=Object.prototype.toString,m="Null",o="Undefined",l="Boolean",x="Number",q="String",r="Object",s="[object Boolean]",w="[object Number]",y="[object String]",A="[object Array]",D=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray=="function"&&Array.isArray([])&&
!Array.isArray({}))g=Array.isArray;b(Object,{extend:b,inspect:function(a){try{return j(a)?"undefined":a===null?"null":a.inspect?a.inspect():String(a)}catch(b){if(b instanceof RangeError)return"...";throw b;}},toJSON:D?e:c,toQueryString:function(a){return $H(a).toQueryString()},toHTML:function(a){return a&&a.toHTML?a.toHTML():String.interpret(a)},keys:Object.keys||f,values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},clone:function(a){return b({},a)},isElement:function(a){return!!(a&&a.nodeType==
1)},isArray:g,isHash:function(a){return a instanceof Hash},isFunction:function(a){return h.call(a)==="[object Function]"},isString:function(a){return h.call(a)===y},isNumber:function(a){return h.call(a)===w},isDate:function(a){return h.call(a)==="[object Date]"},isUndefined:j})})();
Object.extend(Function.prototype,function(){function a(a,b){for(var c=a.length,g=b.length;g--;)a[c+g]=b[g];return a}function b(b,e){b=c.call(b,0);return a(b,e)}var c=Array.prototype.slice;return{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a},bind:function(a){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var e=this,f=c.call(arguments,
1);return function(){var c=b(f,arguments);return e.apply(a,c)}},bindAsEventListener:function(b){var e=this,f=c.call(arguments,1);return function(c){c=a([c||window.event],f);return e.apply(b,c)}},curry:function(){if(!arguments.length)return this;var a=this,e=c.call(arguments,0);return function(){var c=b(e,arguments);return a.apply(this,c)}},delay:function(a){var b=this,f=c.call(arguments,1);a*=1E3;return window.setTimeout(function(){return b.apply(b,f)},a)},defer:function(){return this.delay.apply(this,
a([0.01],arguments))},wrap:function(b){var c=this;return function(){var f=a([c.bind(this)],arguments);return b.apply(this,f)}},methodize:function(){if(this._methodized)return this._methodized;var b=this;return this._methodized=function(){var c=a([this],arguments);return b.apply(null,c)}}}}());
(function(a){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function c(){return this.toISOString()}if(!a.toISOString)a.toISOString=b;if(!a.toJSON)a.toJSON=c})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=!1;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer)clearInterval(this.timer),this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(a){throw this.currentlyExecuting=
!1,a;}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(a){if(Object.isFunction(a))return a;var b=new Template(a);return function(a){return b.evaluate(a)}}function b(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function c(a){var b=this.strip().match(/([^?#]*)(#.*)?$/);return!b?{}:b[1].split(a||"&").inject({},function(a,b){if((b=b.split("="))[0]){var c=decodeURIComponent(b.shift()),d=b.length>1?b.join("="):b[0];d!=void 0&&(d=decodeURIComponent(d));c in a?(Object.isArray(a[c])||(a[c]=[a[c]]),a[c].push(d)):
a[c]=d}return a})}function d(a){var b=this.unfilterJSON(),c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;c.test(b)&&(b=b.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));try{if(!a||b.isJSON())return eval("("+b+")")}catch(d){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function e(){var a=this.unfilterJSON();return JSON.parse(a)}var f=window.JSON&&typeof JSON.parse==="function"&&
JSON.parse('{"test": true}').test;return{gsub:function(b,c){var d="",e=this,f,c=a(c);Object.isString(b)&&(b=RegExp.escape(b));if(!b.length&&!b.source)return c=c(""),c+e.split("").join(c)+c;for(;e.length>0;)(f=e.match(b))?(d+=e.slice(0,f.index),d+=String.interpret(c(f)),e=e.slice(f.index+f[0].length)):(d+=e,e="");return d},sub:function(b,c,d){c=a(c);d=Object.isUndefined(d)?1:d;return this.gsub(b,function(a){return--d<0?a[0]:c(a)})},scan:function(a,b){this.gsub(a,b);return String(this)},truncate:function(a,
b){a=a||30;b=Object.isUndefined(b)?"...":b;return this.length>a?this.slice(0,a-b.length)+b:String(this)},strip:String.prototype.trim||b,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var a=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(b){return(b.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(a){return eval(a)})},
escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:c,parseQuery:c,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return a<1?"":Array(a+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(a,
b){return b?b.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(a){var b=this.replace(/[\x00-\x1f\\]/g,function(a){return a in String.specialChar?String.specialChar[a]:"\\u00"+a.charCodeAt().toPaddedString(2,
16)});return a?'"'+b.replace(/"/g,'\\"')+'"':"'"+b.replace(/'/g,"\\'")+"'"},unfilterJSON:function(a){return this.replace(a||Prototype.JSONFilter,"$1")},isJSON:function(){var a=this;if(a.blank())return!1;a=a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");a=a.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");a=a.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(a)},evalJSON:f?e:d,include:function(a){return this.indexOf(a)>-1},startsWith:function(a){return this.lastIndexOf(a,
0)===0},endsWith:function(a){var b=this.length-a.length;return b>=0&&this.indexOf(a,b)===b},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,b){return(new Template(this,b)).evaluate(a)}}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){a&&Object.isFunction(a.toTemplateReplacements)&&(a=a.toTemplateReplacements());return this.template.gsub(this.pattern,function(b){if(a==null)return b[1]+"";var c=b[1]||"";if(c=="\\")return b[2];var d=a,e=b[3],f=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/,b=f.exec(e);if(b==null)return c;for(;b!=null;){var g=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1],d=d[g];if(null==
d||""==b[3])break;e=e.substring("["==b[3]?b[1].length:b[0].length);b=f.exec(e)}return c+String.interpret(d)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(a,b){var a=a||Prototype.K,c=!0;this.each(function(d,g){c=c&&!!a.call(b,d,g);if(!c)throw $break;});return c}function b(a,b){var a=a||Prototype.K,c=!1;this.each(function(d,g){if(c=!!a.call(b,d,g))throw $break;});return c}function c(a,b){var a=a||Prototype.K,c=[];this.each(function(d,g){c.push(a.call(b,d,g))});return c}function d(a,b){var c;this.each(function(d,g){if(a.call(b,d,g))throw c=d,$break;});return c}function e(a,b){var c=[];this.each(function(d,
g){a.call(b,d,g)&&c.push(d)});return c}function f(a){if(Object.isFunction(this.indexOf)&&this.indexOf(a)!=-1)return!0;var b=!1;this.each(function(c){if(c==a)throw b=!0,$break;});return b}function g(){return this.map()}return{each:function(a,b){var c=0;try{this._each(function(d){window.d=d;window.b=b;window.a=a;a.call(b,d,c++)})}catch(d){if(d!=$break)throw d;}return this},eachSlice:function(a,b,c){var d=-a,g=[],e=this.toArray();if(a<1)return e;for(;(d+=a)<e.length;)g.push(e.slice(d,d+a));return g.collect(b,
c)},all:a,every:a,any:b,some:b,collect:c,map:c,detect:d,findAll:e,select:e,filter:e,grep:function(a,b,c){var b=b||Prototype.K,d=[];Object.isString(a)&&(a=RegExp(RegExp.escape(a)));this.each(function(g,e){a.match(g)&&d.push(b.call(c,g,e))});return d},include:f,member:f,inGroupsOf:function(a,b){b=Object.isUndefined(b)?null:b;return this.eachSlice(a,function(c){for(;c.length<a;)c.push(b);return c})},inject:function(a,b,c){this.each(function(d,g){a=b.call(c,a,d,g)});return a},invoke:function(a){var b=
$A(arguments).slice(1);return this.map(function(c){return c[a].apply(c,b)})},max:function(a,b){var a=a||Prototype.K,c;this.each(function(d,g){d=a.call(b,d,g);if(c==null||d>=c)c=d});return c},min:function(a,b){var a=a||Prototype.K,c;this.each(function(d,g){d=a.call(b,d,g);if(c==null||d<c)c=d});return c},partition:function(a,b){var a=a||Prototype.K,c=[],d=[];this.each(function(g,e){(a.call(b,g,e)?c:d).push(g)});return[c,d]},pluck:function(a){var b=[];this.each(function(c){b.push(c[a])});return b},reject:function(a,
b){var c=[];this.each(function(d,g){a.call(b,d,g)||c.push(d)});return c},sortBy:function(a,b){return this.map(function(c,d){return{value:c,criteria:a.call(b,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}).pluck("value")},toArray:g,entries:g,zip:function(){var a=Prototype.K,b=$A(arguments);Object.isFunction(b.last())&&(a=b.pop());var c=[this].concat(b).map($A);return this.map(function(b,d){return a(c.pluck(d))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:d}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=Array(b);b--;)c[b]=a[b];return c}function $w(a){return!Object.isString(a)?[]:(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(a,b){for(var c=0,d=this.length>>>0;c<d;c++)c in this&&a.call(b,this[c],c,this)}function b(){return g.call(this,0)}function c(a,b){b||(b=0);var c=this.length;for(b<0&&(b=c+b);b<c;b++)if(this[b]===a)return b;return-1}function d(a,b){var b=isNaN(b)?this.length:(b<0?this.length+b:b)+1,c=this.slice(0,b).reverse().indexOf(a);return c<0?c:b-c-1}function e(){for(var a=g.call(this,0),b,c=0,d=arguments.length;c<d;c++)if(b=arguments[c],Object.isArray(b)&&!("callee"in b))for(var e=0,f=
b.length;e<f;e++)a.push(b[e]);else a.push(b);return a}var f=Array.prototype,g=f.slice,j=f.forEach;j||(j=a);Object.extend(f,Enumerable);if(!f._reverse)f._reverse=f.reverse;Object.extend(f,{_each:j,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return a!=null})},flatten:function(){return this.inject([],function(a,b){if(Object.isArray(b))return a.concat(b.flatten());a.push(b);return a})},
without:function(){var a=g.call(arguments,0);return this.select(function(b){return!a.include(b)})},reverse:function(a){return(a===!1?this.toArray():this)._reverse()},uniq:function(a){return this.inject([],function(b,c,d){(0==d||(a?b.last()!=c:!b.include(c)))&&b.push(c);return b})},intersect:function(a){return this.uniq().findAll(function(b){return a.detect(function(a){return b===a})})},clone:b,toArray:b,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+
"]"}});if(function(){return[].concat(arguments)[0][0]!==1}(1,2))f.concat=e;if(!f.indexOf)f.indexOf=c;if(!f.lastIndexOf)f.lastIndexOf=d})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(){return Object.clone(this._object)}return{initialize:function(a){this._object=Object.isHash(a)?a.toObject():Object.clone(a)},_each:function(a){for(var c in this._object){var d=this._object[c],e=[c,d];e.key=c;e.value=d;a(e)}},set:function(a,c){return this._object[a]=c},get:function(a){if(this._object[a]!==Object.prototype[a])return this._object[a]},unset:function(a){var c=this._object[a];delete this._object[a];return c},toObject:a,toTemplateReplacements:a,
keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(a){var c=this.detect(function(c){return c.value===a});return c&&c.key},merge:function(a){return this.clone().update(a)},update:function(a){return(new Hash(a)).inject(this,function(a,b){a.set(b.key,b.value);return a})},toQueryString:function(){return this.inject([],function(a,c){var d=encodeURIComponent(c.key),e=c.value;if(e&&typeof e=="object"){if(Object.isArray(e)){for(var f=[],g=0,j=e.length,h;g<
j;g++)h=e[g],f.push(Object.isUndefined(h)?d:d+"="+encodeURIComponent(String.interpret(h)));return a.concat(f)}}else a.push(Object.isUndefined(e)?d:d+"="+encodeURIComponent(String.interpret(e)));return a}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:a,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(a,b){$R(0,this,!0).each(a,b);return this},toPaddedString:function(a,b){var c=this.toString(b||10);return"0".times(a-c.length)+c},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(a,b,c){this.start=a;this.end=b;this.exclusive=c},_each:function(a){for(var b=this.start;this.include(b);)a(b),b=b.succ()},include:function(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0,
Responders:{responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,d){this.each(function(e){if(Object.isFunction(e[a]))try{e[a].apply(e,[b,c,d])}catch(f){}})}}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method))a+=(a?"&":"")+"_method="+this.method,this.method="post";a&&this.method==="get"&&(this.url+=(this.url.include("?")?"&":"?")+a);this.parameters=
a.toQueryParams();try{var b=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);if(!this.options.asynchronous&&
this.transport.overrideMimeType)this.onStateChange()}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;a>1&&!(a==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(a["Content-type"]=this.options.contentType+(this.options.encoding?
"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005))a.Connection="close";if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,d=b.length;c<d;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(b){a[b.key]=b.value})}for(var e in a)this.transport.setRequestHeader(e,a[e])},success:function(){var a=this.getStatus();return!a||a>=200&&a<300||a==304},getStatus:function(){try{return this.transport.status===
1223?204:this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var a=Ajax.Request.Events[a],b=new Ajax.Response(this);if(a=="Complete"){try{this._complete=!0,(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var d=b.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&d&&d.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&
this.evalResponse()}try{(this.options["on"+a]||Prototype.emptyFunction)(b,b.headerJSON),Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(e){this.dispatchException(e)}if(a=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;var a=this.transport=a.transport,b=this.readyState=a.readyState;if(b>2&&!Prototype.Browser.IE||b==4)this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(a.responseText),this.headerJSON=this._getHeaderJSON();if(b==4)a=a.responseXML,this.responseXML=Object.isUndefined(a)?null:a,this.responseJSON=this._getResponseJSON()},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||
""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},
_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,d){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};var d=Object.clone(d),e=d.onComplete;d.onComplete=function(b,c){this.updateContent(b.responseText);Object.isFunction(e)&&e(b,c)}.bind(this);$super(c,d)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var d=
{};d[c.insertion]=a;b.insert(d)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,d){$super(d);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){if(this.options.decay)this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=a.responseText;this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(arguments.length>1){for(var b=0,c=[],d=arguments.length;b<d;b++)c.push($(arguments[b]));return c}Object.isString(a)&&(a=document.getElementById(a));return Element.extend(a)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(a,b){for(var c=[],d=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),e=0,f=d.snapshotLength;e<f;e++)c.push(Element.extend(d.snapshotItem(e)));return c};if(!Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b=function(){try{var a=document.createElement('<input name="x">');return a.tagName.toLowerCase()==="input"&&a.name==="x"}catch(b){return!1}}(),c=a.Element;a.Element=function(a,c){var c=c||{},a=a.toLowerCase(),f=Element.cache;if(b&&c.name)return a="<"+a+' name="'+c.name+'">',delete c.name,Element.writeAttribute(document.createElement(a),c);f[a]||(f[a]=Element.extend(document.createElement(a)));f=(a==="select"?0:!("type"in c))?f[a].cloneNode(!1):document.createElement(a);return Element.writeAttribute(f,
c)};Object.extend(a.Element,c||{});if(c)a.Element.prototype=c.prototype})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(a){var b=a._prototypeUID;if(b)Element.stopObserving(a),a._prototypeUID=void 0,delete Element.Storage[b]};
Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){var a=function(){var a=document.createElement("select"),b=!0;a.innerHTML='<option value="test">test</option>';a.options&&a.options[0]&&(b=a.options[0].nodeName.toUpperCase()!==
"OPTION");return b}(),b=function(){try{var a=document.createElement("table");if(a&&a.tBodies)return a.innerHTML="<tbody><tr><td>test</td></tr></tbody>",typeof a.tBodies[0]=="undefined"}catch(b){return!0}}(),c=function(){try{var a=document.createElement("div");a.innerHTML="<link>";return a.childNodes.length===0}catch(b){return!0}}(),d=a||b||c,e=function(){var a=document.createElement("script"),b=!1;try{a.appendChild(document.createTextNode("")),b=!a.firstChild||a.firstChild&&a.firstChild.nodeType!==
3}catch(c){b=!0}return b}();return function(a,b){for(var a=$(a),j=Element._purgeElement,h=a.getElementsByTagName("*"),m=h.length;m--;)j(h[m]);b&&b.toElement&&(b=b.toElement());if(Object.isElement(b))return a.update().insert(b);b=Object.toHTML(b);j=a.tagName.toUpperCase();if(j==="SCRIPT"&&e)return a.text=b,a;if(d)if(j in Element._insertionTranslations.tags){for(;a.firstChild;)a.removeChild(a.firstChild);Element._getContentFromAnonymousElement(j,b.stripScripts()).each(function(b){a.appendChild(b)})}else if(c&&
Object.isString(b)&&b.indexOf("<link")>-1){for(;a.firstChild;)a.removeChild(a.firstChild);Element._getContentFromAnonymousElement(j,b.stripScripts(),!0).each(function(b){a.appendChild(b)})}else a.innerHTML=b.stripScripts();else a.innerHTML=b.stripScripts();b.evalScripts.bind(b).defer();return a}}(),replace:function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();else if(!Object.isElement(b)){var b=Object.toHTML(b),c=a.ownerDocument.createRange();c.selectNode(a);b.evalScripts.bind(b).defer();b=c.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,
a);return a},insert:function(a,b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var c,d,e,f;for(f in b)c=b[f],f=f.toLowerCase(),d=Element._insertionTranslations[f],c&&c.toElement&&(c=c.toElement()),Object.isElement(c)?d(a,c):(c=Object.toHTML(c),e=(f=="before"||f=="after"?a.parentNode:a).tagName.toUpperCase(),e=Element._getContentFromAnonymousElement(e,c.stripScripts()),(f=="top"||f=="after")&&e.reverse(),e.each(d.curry(a)),c.evalScripts.bind(c).defer());
return a},wrap:function(a,b,c){a=$(a);Object.isElement(b)?$(b).writeAttribute(c||{}):b=Object.isString(b)?new Element(b,c):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){var a=$(a),b="<"+a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(c){var d=c.first(),c=c.last();(d=(a[d]||"").toString())&&(b+=" "+c+"="+d.inspect(!0))});return b+">"},recursivelyCollect:function(a,b,c){for(var a=$(a),c=c||-1,d=[];a=a[b];)if(a.nodeType==
1&&d.push(Element.extend(a)),d.length==c)break;return d},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&a.nodeType!=1;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){for(var b=[],a=$(a).firstChild;a;)a.nodeType===1&&b.push(Element.extend(a)),a=a.nextSibling;return b},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},
nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){a=$(a);return Object.isString(b)?Prototype.Selector.match(a,b):b.match(a)},up:function(a,b,c){a=$(a);if(arguments.length==1)return $(a.parentNode);var d=Element.ancestors(a);return Object.isNumber(b)?d[b]:Prototype.Selector.find(d,b,c)},down:function(a,b,c){a=$(a);return arguments.length==1?Element.firstDescendant(a):
Object.isNumber(b)?Element.descendants(a)[b]:Element.select(a,b)[c||0]},previous:function(a,b,c){a=$(a);Object.isNumber(b)&&(c=b,b=!1);Object.isNumber(c)||(c=0);return b?Prototype.Selector.find(a.previousSiblings(),b,c):a.recursivelyCollect("previousSibling",c+1)[c]},next:function(a,b,c){a=$(a);Object.isNumber(b)&&(c=b,b=!1);Object.isNumber(c)||(c=0);return b?Prototype.Selector.find(a.nextSiblings(),b,c):(Object.isNumber(c),a.recursivelyCollect("nextSibling",c+1)[c])},select:function(a){var a=$(a),
b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){var a=$(a),b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){var a=$(a),b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var c=Element._attributeTranslations.read;
if(c.values[b])return c.values[b](a,b);c.names[b]&&(b=c.names[b]);if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,c){var a=$(a),d={},e=Element._attributeTranslations.write;typeof b=="object"?d=b:d[b]=Object.isUndefined(c)?!0:c;for(var f in d)b=e.names[f]||f,c=d[f],e.values[f]&&(b=e.values[f](a,c)),c===!1||c===null?a.removeAttribute(b):c===!0?a.setAttribute(b,b):a.setAttribute(b,c);return a},getHeight:function(a){return Element.getDimensions(a).height},
getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){var c=a.className;return c.length>0&&(c==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(c))}},addClassName:function(a,b){if(a=$(a))return Element.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClassName:function(a,b){if(a=$(a))return a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip(),a},toggleClassName:function(a,
b){return!(a=$(a))?void 0:Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){for(var a=$(a),b=a.firstChild;b;){var c=b.nextSibling;b.nodeType==3&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=c}return a},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&8)===8;if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return!0;return!1},
scrollTo:function(a){var a=$(a),b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){var a=$(a),b=b=="float"?"cssFloat":b.camelize(),c=a.style[b];if(!c||c=="auto")c=(c=document.defaultView.getComputedStyle(a,null))?c[b]:null;return b=="opacity"?c?parseFloat(c):1:c=="auto"?null:c},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){var a=$(a),c=a.style;if(Object.isString(b))return a.style.cssText+=";"+b,b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):
a;for(var d in b)d=="opacity"?a.setOpacity(b[d]):c[d=="float"||d=="cssFloat"?Object.isUndefined(c.styleFloat)?"cssFloat":"styleFloat":d]=b[d];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;return a},makePositioned:function(a){var a=$(a),b=Element.getStyle(a,"position");if(b=="static"||!b)if(a._madePositioned=!0,a.style.position="relative",Prototype.Browser.Opera)a.style.top=0,a.style.left=0;return a},undoPositioned:function(a){a=$(a);if(a._madePositioned)a._madePositioned=
void 0,a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right="";return a},makeClipping:function(a){a=$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden")a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},clonePosition:function(a,b,c){var c=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,
offsetLeft:0},c||{}),b=$(b),d=Element.viewportOffset(b),e=[0,0],f=null,a=$(a);Element.getStyle(a,"position")=="absolute"&&(f=Element.getOffsetParent(a),e=Element.viewportOffset(f));f==document.body&&(e[0]-=document.body.offsetLeft,e[1]-=document.body.offsetTop);if(c.setLeft)a.style.left=d[0]-e[0]+c.offsetLeft+"px";if(c.setTop)a.style.top=d[1]-e[1]+c.offsetTop+"px";if(c.setWidth)a.style.width=b.offsetWidth+"px";if(c.setHeight)a.style.height=b.offsetHeight+"px";return a}};
Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera)Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,c){switch(c){case "height":case "width":if(!Element.visible(b))return null;var d=parseInt(a(b,c),10);return d!==b["offset"+c.capitalize()]?d+"px":(c==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(d,function(c,d){var g=a(b,d);return g===null?c:c-parseInt(g,10)})+"px";default:return a(b,
c)}}),Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,c){return c==="title"?b.title:a(b,c)});else if(Prototype.Browser.IE)Element.Methods.getStyle=function(a,b){var a=$(a),b=b=="float"||b=="cssFloat"?"styleFloat":b.camelize(),c=a.style[b];!c&&a.currentStyle&&(c=a.currentStyle[b]);return b=="opacity"?(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&c[1]?parseFloat(c[1])/100:1:c=="auto"?(b=="width"||b=="height")&&a.getStyle("display")!="none"?a["offset"+b.capitalize()]+
"px":null:c},Element.Methods.setOpacity=function(a,b){var a=$(a),c=a.currentStyle;if(c&&!c.hasLayout||!c&&a.style.zoom=="normal")a.style.zoom=1;var c=a.getStyle("filter"),d=a.style;if(b==1||b==="")return(c=c.replace(/alpha\([^\)]*\)/gi,""))?d.filter=c:d.removeAttribute("filter"),a;else b<1.0E-5&&(b=0);d.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+b*100+")";return a},Element._attributeTranslations=function(){var a="className",b="for",c=document.createElement("div");c.setAttribute(a,"x");
c.className!=="x"&&(c.setAttribute("class","x"),c.className==="x"&&(a="class"));c=null;c=document.createElement("label");c.setAttribute(b,"x");c.htmlFor!=="x"&&(c.setAttribute("htmlFor","x"),c.htmlFor==="x"&&(b="htmlFor"));c=null;return{read:{names:{"class":a,className:a,"for":b,htmlFor:b},values:{_getAttr:function(a,b){return a.getAttribute(b)},_getAttr2:function(a,b){return a.getAttribute(b,2)},_getAttrNode:function(a,b){var c=a.getAttributeNode(b);return c?c.value:""},_getEv:function(){var a=document.createElement("div"),
b;a.onclick=Prototype.emptyFunction;a=a.getAttribute("onclick");String(a).indexOf("{")>-1?b=function(a,b){b=a.getAttribute(b);if(!b)return null;b=b.toString();b=b.split("{")[1];b=b.split("}")[0];return b.strip()}:a===""&&(b=function(a,b){b=a.getAttribute(b);return!b?null:b.strip()});a=null;return b}(),_flag:function(a,b){return $(a).hasAttribute(b)?b:null},style:function(a){return a.style.cssText.toLowerCase()},title:function(a){return a.title}}}}}(),Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",
cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a}),function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,
type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})}(Element._attributeTranslations.read.values),Prototype.BrowserFeatures.ElementExtensions&&
function(){Element.Methods.down=function(a,b,c){var a=$(a),d;if(arguments.length==1)d=a.firstDescendant();else if(Object.isNumber(b)){d=a.getElementsByTagName("*");for(var e=[],f=0,g;g=d[f];f++)g.tagName!=="!"&&e.push(g);d=e[b]}else d=Element.select(a,b)[c||0];return d}}();else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1?0.999999:b===""?"":b<1.0E-5?0:b;return a};else if(Prototype.Browser.WebKit)Element.Methods.setOpacity=
function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;if(b==1)if(a.tagName.toUpperCase()=="IMG"&&a.width)a.width++,a.width--;else try{var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(d){}return a};
if("outerHTML"in document.documentElement)Element.Methods.replace=function(a,b){a=$(a);b&&b.toElement&&(b=b.toElement());if(Object.isElement(b))return a.parentNode.replaceChild(b,a),a;var b=Object.toHTML(b),c=a.parentNode,d=c.tagName.toUpperCase();if(Element._insertionTranslations.tags[d]){var e=a.next(),d=Element._getContentFromAnonymousElement(d,b.stripScripts());c.removeChild(a);e?d.each(function(a){c.insertBefore(a,e)}):d.each(function(a){c.appendChild(a)})}else a.outerHTML=b.stripScripts();b.evalScripts.bind(b).defer();
return a};Element._returnOffset=function(a,b){var c=[a,b];c.left=a;c.top=b;return c};Element._getContentFromAnonymousElement=function(a,b,c){var d=new Element("div"),a=Element._insertionTranslations.tags[a],e=!1;a?e=!0:c&&(e=!0,a=["","",0]);if(e){d.innerHTML="&nbsp;"+a[0]+b+a[1];d.removeChild(d.firstChild);for(b=a[2];b--;)d=d.firstChild}else d.innerHTML=b;return $A(d.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){var b=Element._attributeTranslations.has[b]||b,c=$(a).getAttributeNode(b);return!(!c||!c.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__)window.HTMLElement={},window.HTMLElement.prototype=a.__proto__,Prototype.BrowserFeatures.ElementExtensions=!0})(document.createElement("div"));
Element.extend=function(){function a(a,b){for(var c in b){var d=b[c];Object.isFunction(d)&&!(c in a)&&(a[c]=d.methodize())}}var b=function(a){if(typeof window.Element!="undefined"){var b=window.Element.prototype;if(b){var c="_"+(Math.random()+"").slice(2),a=document.createElement(a);b[c]="x";a=a[c]!=="x";delete b[c];return a}}return!1}("object");if(Prototype.BrowserFeatures.SpecificElementExtensions)return b?function(b){if(b&&typeof b._extendedByPrototype=="undefined"){var c=b.tagName;c&&/^(?:object|applet|embed)$/i.test(c)&&
(a(b,Element.Methods),a(b,Element.Methods.Simulated),a(b,Element.Methods.ByTag[c.toUpperCase()]))}return b}:Prototype.K;var c={},d=Element.Methods.ByTag,b=Object.extend(function(b){if(!b||typeof b._extendedByPrototype!="undefined"||b.nodeType!=1||b==window)return b;var f=Object.clone(c),g=b.tagName.toUpperCase();d[g]&&Object.extend(f,d[g]);a(b,f);b._extendedByPrototype=Prototype.emptyFunction;return b},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(c,Element.Methods),
Object.extend(c,Element.Methods.Simulated))}});b.refresh();return b}();Element.hasAttribute=document.documentElement.hasAttribute?function(a,b){return a.hasAttribute(b)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(a){function b(b){b=b.toUpperCase();Element.Methods.ByTag[b]||(Element.Methods.ByTag[b]={});Object.extend(Element.Methods.ByTag[b],a)}function c(a,b,c){var c=c||!1,d;for(d in a){var g=a[d];if(Object.isFunction(g)&&(!c||!(d in b)))b[d]=g.methodize()}}function d(a){var b,c={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};c[a]&&(b="HTML"+c[a]+"Element");if(window[b])return window[b];b="HTML"+a+"Element";if(window[b])return window[b];b="HTML"+a.capitalize()+"Element";if(window[b])return window[b];a=document.createElement(a);return a.__proto__||a.constructor.prototype}
var e=Prototype.BrowserFeatures,f=Element.Methods.ByTag;a||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)}));if(arguments.length==2)var g=a,a=arguments[1];g?Object.isArray(g)?g.each(b):b(g):Object.extend(Element.Methods,a||{});
g=window.HTMLElement?HTMLElement.prototype:Element.prototype;e.ElementExtensions&&(c(Element.Methods,g),c(Element.Methods.Simulated,g,!0));if(e.SpecificElementExtensions)for(var j in Element.Methods.ByTag)e=d(j),Object.isUndefined(e)||c(f[j],e.prototype);Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(b){e||(e=c.WebKit&&!d.evaluate?document:c.Opera&&window.parseFloat(window.opera.version())<9.5?document.body:document.documentElement);f[b]="client"+b;a["get"+b]=function(){return e[f[b]]};return a["get"+b]()}var c=Prototype.Browser,d=document,e,f={};a.getWidth=b.curry("Width");a.getHeight=b.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a)){if(a===window)a=0;else{if(typeof a._prototypeUID==="undefined")a._prototypeUID=Element.Storage.UID++;a=a._prototypeUID}Element.Storage[a]||(Element.Storage[a]=$H());return Element.Storage[a]}},store:function(a,b,c){if(a=$(a))return arguments.length===2?Element.getStorage(a).update(b):Element.getStorage(a).set(b,c),a},retrieve:function(a,b,c){if(a=$(a)){var a=Element.getStorage(a),d=a.get(b);Object.isUndefined(d)&&(a.set(b,c),d=c);return d}},clone:function(a,
b){if(a=$(a)){var c=a.cloneNode(b);c._prototypeUID=void 0;if(b)for(var d=Element.select(c,"*"),e=d.length;e--;)d[e]._prototypeUID=void 0;return Element.extend(c)}},purge:function(a){if(a=$(a)){var b=Element._purgeElement;b(a);for(var a=a.getElementsByTagName("*"),c=a.length;c--;)b(a[c]);return null}}});
(function(){function a(a,b,c){var d=null;Object.isElement(a)&&(d=a,a=d.getStyle(b));if(a===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(a))return window.parseFloat(a);var e=a.include("%"),f=c===document.viewport;if(/\d/.test(a)&&d&&d.runtimeStyle&&(!e||!f))return c=d.style.left,b=d.runtimeStyle.left,d.runtimeStyle.left=d.currentStyle.left,d.style.left=a||0,a=d.style.pixelLeft,d.style.left=c,d.runtimeStyle.left=b,a;return d&&e?(c=c||d.parentNode,a=a.match(/^(\d+)%?$/i),a=!a?null:Number(a[1])/
100,e=null,d.getStyle("position"),d=b.include("left")||b.include("right")||b.include("width"),b=b.include("top")||b.include("bottom")||b.include("height"),c===document.viewport?d?e=document.viewport.getWidth():b&&(e=document.viewport.getHeight()):d?e=$(c).measure("width"):b&&(e=$(c).measure("height")),e===null?0:e*a):0}function b(a){a=$(a);if(a.nodeType===Node.DOCUMENT_NODE||e(a)||a.nodeName.toUpperCase()==="BODY"||a.nodeName.toUpperCase()==="HTML")return $(document.body);if(Element.getStyle(a,"display")!==
"inline"&&a.offsetParent)return $(a.offsetParent);for(;(a=a.parentNode)&&a!==document.body;)if(Element.getStyle(a,"position")!=="static")return a.nodeName.toUpperCase()==="HTML"?$(document.body):$(a);return $(document.body)}function c(a){var a=$(a),b=0,c=0;if(a.parentNode){do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a)}return new Element.Offset(c,b)}function d(a){var a=$(a),b=a.getLayout(),c=0,d=0;do if(c+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent){if(a.nodeName.toUpperCase()===
"BODY")break;if(Element.getStyle(a,"position")!=="static")break}while(a);d-=b.get("margin-top");c-=b.get("margin-left");return new Element.Offset(d,c)}function e(a){return a!==document.body&&!Element.descendantOf(a,document.body)}var f=Prototype.K;"currentStyle"in document.documentElement&&(f=function(a){if(!a.currentStyle.hasLayout)a.style.zoom=1;return a});Element.Layout=Class.create(Hash,{initialize:function($super,a,b){$super();this.element=$(a);Element.Layout.PROPERTIES.each(function(a){this._set(a,
null)},this);if(b)this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1},_set:function(a,b){return Hash.prototype.set.call(this,a,b)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,a){var b=$super(a);return b===null?this._compute(a):b},_begin:function(){if(!this._prepared){var b=this.element,c;a:{for(c=b;c&&c.parentNode;){if(c.getStyle("display")==="none"){c=!1;break a}c=$(c.parentNode)}c=!0}if(!c){b.store("prototype_original_styles",
{position:b.style.position||"",width:b.style.width||"",visibility:b.style.visibility||"",display:b.style.display||""});c=b.getStyle("position");var d=b.getStyle("width");if(d==="0px"||d===null)b.style.display="block",d=b.getStyle("width");var e=c==="fixed"?document.viewport:b.parentNode;b.setStyle({position:"absolute",visibility:"hidden",display:"block"});var f=b.getStyle("width");c=d&&f===d?a(b,"width",e):c==="absolute"||c==="fixed"?a(b,"width",e):$(b.parentNode).getLayout().get("width")-this.get("margin-left")-
this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");b.setStyle({width:c+"px"})}this._prepared=!0}},_end:function(){var a=this.element,b=a.retrieve("prototype_original_styles");a.store("prototype_original_styles",null);a.setStyle(b);this._prepared=!1},_compute:function(a){var b=Element.Layout.COMPUTATIONS;if(!(a in b))throw"Property not found.";return this._set(a,b[a].call(this,this.element))},toObject:function(){var a=$A(arguments),
b={};(a.length===0?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)){var c=this.get(a);c!=null&&(b[a]=c)}},this);return b},toHash:function(){var a=this.toObject.apply(this,arguments);return new Hash(a)},toCSS:function(){var a=$A(arguments),b={};(a.length===0?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)&&!Element.Layout.COMPOSITE_PROPERTIES.include(a)){var c=this.get(a);if(c!=null){var d=
b;a.include("border")&&(a+="-width");a=a.camelize();d[a]=c+"px"}}},this);return b},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),
COMPUTATIONS:{height:function(){this._preComputing||this._begin();var a=this.get("border-box-height");if(a<=0)return this._preComputing||this._end(),0;var b=this.get("border-top"),c=this.get("border-bottom"),d=this.get("padding-top"),e=this.get("padding-bottom");this._preComputing||this._end();return a-b-c-d-e},width:function(){this._preComputing||this._begin();var a=this.get("border-box-width");if(a<=0)return this._preComputing||this._end(),0;var b=this.get("border-left"),c=this.get("border-right"),
d=this.get("padding-left"),e=this.get("padding-right");this._preComputing||this._end();return a-b-c-d-e},"padding-box-height":function(){var a=this.get("height"),b=this.get("padding-top"),c=this.get("padding-bottom");return a+b+c},"padding-box-width":function(){var a=this.get("width"),b=this.get("padding-left"),c=this.get("padding-right");return a+b+c},"border-box-height":function(a){this._preComputing||this._begin();a=a.offsetHeight;this._preComputing||this._end();return a},"border-box-width":function(a){this._preComputing||
this._begin();a=a.offsetWidth;this._preComputing||this._end();return a},"margin-box-height":function(){var a=this.get("border-box-height"),b=this.get("margin-top"),c=this.get("margin-bottom");return a<=0?0:a+b+c},"margin-box-width":function(){var a=this.get("border-box-width"),b=this.get("margin-left"),c=this.get("margin-right");return a<=0?0:a+b+c},top:function(a){return a.positionedOffset().top},bottom:function(a){var b=a.positionedOffset(),a=a.getOffsetParent().measure("height"),c=this.get("border-box-height");
return a-c-b.top},left:function(a){return a.positionedOffset().left},right:function(a){var b=a.positionedOffset(),a=a.getOffsetParent().measure("width"),c=this.get("border-box-width");return a-c-b.left},"padding-top":function(b){return a(b,"paddingTop")},"padding-bottom":function(b){return a(b,"paddingBottom")},"padding-left":function(b){return a(b,"paddingLeft")},"padding-right":function(b){return a(b,"paddingRight")},"border-top":function(b){return a(b,"borderTopWidth")},"border-bottom":function(b){return a(b,
"borderBottomWidth")},"border-left":function(b){return a(b,"borderLeftWidth")},"border-right":function(b){return a(b,"borderRightWidth")},"margin-top":function(b){return a(b,"marginTop")},"margin-bottom":function(b){return a(b,"marginBottom")},"margin-left":function(b){return a(b,"marginLeft")},"margin-right":function(b){return a(b,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(a){var b=f(a.getOffsetParent()),a=a.getBoundingClientRect();
return(b.getBoundingClientRect().right-a.right).round()},bottom:function(a){var b=f(a.getOffsetParent()),a=a.getBoundingClientRect();return(b.getBoundingClientRect().bottom-a.bottom).round()}});Element.Offset=Class.create({initialize:function(a,b){this.left=a.round();this.top=b.round();this[0]=this.left;this[1]=this.top},relativeTo:function(a){return new Element.Offset(this.left-a.left,this.top-a.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},
toArray:function(){return[this.left,this.top]}});Prototype.Browser.IE?(b=b.wrap(function(a,b){b=$(b);if(b.nodeType===Node.DOCUMENT_NODE||e(b)||b.nodeName.toUpperCase()==="BODY"||b.nodeName.toUpperCase()==="HTML")return $(document.body);var c=b.getStyle("position");if(c!=="static")return a(b);b.setStyle({position:"relative"});var d=a(b);b.setStyle({position:c});return d}),d=d.wrap(function(a,b){b=$(b);if(!b.parentNode)return new Element.Offset(0,0);var c=b.getStyle("position");if(c!=="static")return a(b);
var d=b.getOffsetParent();d&&d.getStyle("position")==="fixed"&&f(d);b.setStyle({position:"relative"});d=a(b);b.setStyle({position:c});return d})):Prototype.Browser.Webkit&&(c=function(a){var a=$(a),b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;if(a.offsetParent==document.body&&Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return new Element.Offset(c,b)});Element.addMethods({getLayout:function(a,b){return new Element.Layout(a,b)},measure:function(a,b){return $(a).getLayout().get(b)},
getDimensions:function(a){var a=$(a),b=Element.getStyle(a,"display");if(b&&b!=="none")return{width:a.offsetWidth,height:a.offsetHeight};var b=a.style,b={visibility:b.visibility,position:b.position,display:b.display},c={visibility:"hidden",display:"block"};if(b.position!=="fixed")c.position="absolute";Element.setStyle(a,c);c={width:a.offsetWidth,height:a.offsetHeight};Element.setStyle(a,b);return c},getOffsetParent:b,cumulativeOffset:c,positionedOffset:d,cumulativeScrollOffset:function(a){var b=0,
c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode;while(a);return new Element.Offset(c,b)},viewportOffset:function(a){$(e);var b=0,c=0,d=document.body,e=a;do if(b+=e.offsetTop||0,c+=e.offsetLeft||0,e.offsetParent==d&&Element.getStyle(e,"position")=="absolute")break;while(e=e.offsetParent);e=a;do e!=d&&(b-=e.scrollTop||0,c-=e.scrollLeft||0);while(e=e.parentNode);return new Element.Offset(c,b)},absolutize:function(a){a=$(a);if(Element.getStyle(a,"position")==="absolute")return a;var c=b(a),
d=a.viewportOffset(),c=c.viewportOffset(),d=d.relativeTo(c),c=a.getLayout();a.store("prototype_absolutize_original_styles",{left:a.getStyle("left"),top:a.getStyle("top"),width:a.getStyle("width"),height:a.getStyle("height")});a.setStyle({position:"absolute",top:d.top+"px",left:d.left+"px",width:c.get("width")+"px",height:c.get("height")+"px"});return a},relativize:function(a){a=$(a);if(Element.getStyle(a,"position")==="relative")return a;var b=a.retrieve("prototype_absolutize_original_styles");b&&
a.setStyle(b);return a}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(a){a=$(a);if(e(a))return new Element.Offset(0,0);var a=a.getBoundingClientRect(),b=document.documentElement;return new Element.Offset(a.left-b.clientLeft,a.top-b.clientTop)}})})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};
Prototype.Selector=function(){function a(a){for(var b=0,e=a.length;b<e;b++)Element.extend(a[b]);return a}var b=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(a,b,e){var e=e||0,f=Prototype.Selector.match,g=a.length,j=0,h;for(h=0;h<g;h++)if(f(a[h],b)&&e==j++)return Element.extend(a[h])},extendElements:Element.extend===b?b:a,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function a(a,b,c,d,e,f){for(var e=a=="previousSibling"&&!f,k=0,g=d.length;k<g;k++){var h=d[k];if(h){if(e&&h.nodeType===1)h.sizcache=c,h.sizset=k;for(var h=h[a],j=!1;h;){if(h.sizcache===c){j=d[h.sizset];break}if(h.nodeType===1&&!f)h.sizcache=c,h.sizset=k;if(h.nodeName===b){j=h;break}h=h[a]}d[k]=j}}}function b(a,b,c,d,e,f){for(var e=a=="previousSibling"&&!f,k=0,g=d.length;k<g;k++){var h=d[k];if(h){if(e&&h.nodeType===1)h.sizcache=c,h.sizset=k;for(var h=h[a],m=!1;h;){if(h.sizcache===c){m=
d[h.sizset];break}if(h.nodeType===1){if(!f)h.sizcache=c,h.sizset=k;if(typeof b!=="string"){if(h===b){m=!0;break}}else if(j.filter(b,[h]).length>0){m=h;break}}h=h[a]}d[k]=m}}}var c=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,f=!1,g=!0;[0,0].sort(function(){g=!1;return 0});var j=function(a,b,d,f){var d=d||[],g=b=b||document;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!a||typeof a!==
"string")return d;for(var n=[],k,u,p,o,E=!0,B=s(b),v=a;(c.exec(""),k=c.exec(v))!==null;)if(v=k[3],n.push(k[1]),k[2]){o=k[3];break}if(n.length>1&&m.exec(a))if(n.length===2&&h.relative[n[0]])u=w(n[0]+n[1],b);else for(u=h.relative[n[0]]?[b]:j(n.shift(),b);n.length;)a=n.shift(),h.relative[a]&&(a+=n.shift()),u=w(a,u);else if(!f&&n.length>1&&b.nodeType===9&&!B&&h.match.ID.test(n[0])&&!h.match.ID.test(n[n.length-1])&&(k=j.find(n.shift(),b,B),b=k.expr?j.filter(k.expr,k.set)[0]:k.set[0]),b){k=f?{expr:n.pop(),
set:l(f)}:j.find(n.pop(),n.length===1&&(n[0]==="~"||n[0]==="+")&&b.parentNode?b.parentNode:b,B);u=k.expr?j.filter(k.expr,k.set):k.set;for(n.length>0?p=l(u):E=!1;n.length;){var t=n.pop();k=t;h.relative[t]?k=n.pop():t="";k==null&&(k=b);h.relative[t](p,k,B)}}else p=[];p||(p=u);if(!p)throw"Syntax error, unrecognized expression: "+(t||a);if(e.call(p)==="[object Array]")if(E)if(b&&b.nodeType===1)for(a=0;p[a]!=null;a++)p[a]&&(p[a]===!0||p[a].nodeType===1&&r(b,p[a]))&&d.push(u[a]);else for(a=0;p[a]!=null;a++)p[a]&&
p[a].nodeType===1&&d.push(u[a]);else d.push.apply(d,p);else l(p,d);o&&(j(o,g,d,f),j.uniqueSort(d));return d};j.uniqueSort=function(a){if(q&&(f=g,a.sort(q),f))for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1);return a};j.matches=function(a,b){return j(a,null,null,b)};j.find=function(a,b,c){var d,e;if(!a)return[];for(var f=0,k=h.order.length;f<k;f++){var g=h.order[f];if(e=h.leftMatch[g].exec(a)){var j=e[1];e.splice(1,1);if(j.substr(j.length-1)!=="\\"&&(e[1]=(e[1]||"").replace(/\\/g,""),d=h.find[g](e,
b,c),d!=null)){a=a.replace(h.match[g],"");break}}}d||(d=b.getElementsByTagName("*"));return{set:d,expr:a}};j.filter=function(a,b,c,d){for(var e=a,f=[],k=b,g,j,m=b&&b[0]&&s(b[0]);a&&b.length;){for(var l in h.filter)if((g=h.match[l].exec(a))!=null){var o=h.filter[l],v,t;j=!1;k==f&&(f=[]);if(h.preFilter[l])if(g=h.preFilter[l](g,k,c,f,d,m)){if(g===!0)continue}else j=v=!0;if(g)for(var q=0;(t=k[q])!=null;q++)if(t){v=o(t,g,q,k);var r=d^!!v;c&&v!=null?r?j=!0:k[q]=!1:r&&(f.push(t),j=!0)}if(v!==void 0){c||
(k=f);a=a.replace(h.match[l],"");if(!j)return[];break}}if(a==e)if(j==null)throw"Syntax error, unrecognized expression: "+a;else break;e=a}return k};var h=j.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")}},relative:{"+":function(a,b,c){var d=typeof b==="string",e=d&&!/\W/.test(b),d=d&&!e;e&&!c&&(b=b.toUpperCase());for(var c=0,e=a.length,f;c<e;c++)if(f=a[c]){for(;(f=f.previousSibling)&&f.nodeType!==1;);a[c]=d||f&&f.nodeName===b?f||
!1:f===b}d&&j.filter(b,a,!0)},">":function(a,b,c){var d=typeof b==="string";if(d&&!/\W/.test(b))for(var b=c?b:b.toUpperCase(),c=0,e=a.length;c<e;c++){var f=a[c];if(f)d=f.parentNode,a[c]=d.nodeName===b?d:!1}else{c=0;for(e=a.length;c<e;c++)(f=a[c])&&(a[c]=d?f.parentNode:f.parentNode===b);d&&j.filter(b,a,!0)}},"":function(c,e,f){var g=d++,h=b;if(!/\W/.test(e))var j=e=f?e:e.toUpperCase(),h=a;h("parentNode",e,g,c,j,f)},"~":function(c,e,f){var g=d++,h=b;if(typeof e==="string"&&!/\W/.test(e))var j=e=f?e:
e.toUpperCase(),h=a;h("previousSibling",e,g,c,j,f)}},find:{ID:function(a,b,c){if(typeof b.getElementById!=="undefined"&&!c)return(a=b.getElementById(a[1]))?[a]:[]},NAME:function(a,b){if(typeof b.getElementsByName!=="undefined"){for(var c=[],d=b.getElementsByName(a[1]),e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(/\\/g,"")+" ";if(f)return a;
for(var f=0,g;(g=b[f])!=null;f++)g&&(e^(g.className&&(" "+g.className+" ").indexOf(a)>=0)?c||d.push(g):c&&(b[f]=!1));return!1},ID:function(a){return a[1].replace(/\\/g,"")},TAG:function(a,b){for(var c=0;b[c]===!1;c++);return b[c]&&s(b[c])?a[1]:a[1].toUpperCase()},CHILD:function(a){if(a[1]=="nth"){var b=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(a[2]=="even"&&"2n"||a[2]=="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0;a[3]=b[3]-0}a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){b=a[1].replace(/\\/g,
"");!f&&h.attrMap[b]&&(a[1]=h.attrMap[b]);a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(a,b,d,e,f){if(a[1]==="not")if((c.exec(a[3])||"").length>1||/^\w/.test(a[3]))a[3]=j(a[3],null,null,b);else return a=j.filter(a[3],b,d,1^f),d||e.push.apply(e,a),!1;else if(h.match.POS.test(a[0])||h.match.CHILD.test(a[0]))return!0;return a},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===
!0},selected:function(a){return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!j(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){return"text"===a.type},radio:function(a){return"radio"===a.type},checkbox:function(a){return"checkbox"===a.type},file:function(a){return"file"===a.type},password:function(a){return"password"===a.type},submit:function(a){return"submit"===a.type},image:function(a){return"image"===
a.type},reset:function(a){return"reset"===a.type},button:function(a){return"button"===a.type||a.nodeName.toUpperCase()==="BUTTON"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0==b},eq:function(a,b,c){return c[3]-
0==b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=h.filters[e];if(f)return f(a,c,b,d);else if(e==="contains")return(a.textContent||a.innerText||"").indexOf(b[3])>=0;else if(e==="not"){b=b[3];c=0;for(d=b.length;c<d;c++)if(b[c]===a)return!1;return!0}},CHILD:function(a,b){var c=b[1],d=a;switch(c){case "only":case "first":for(;d=d.previousSibling;)if(d.nodeType===1)return!1;if(c=="first")return!0;d=a;case "last":for(;d=d.nextSibling;)if(d.nodeType===1)return!1;return!0;case "nth":var c=b[2],e=b[3];
if(c==1&&e==0)return!0;var f=b[0],g=a.parentNode;if(g&&(g.sizcache!==f||!a.nodeIndex)){for(var h=0,d=g.firstChild;d;d=d.nextSibling)if(d.nodeType===1)d.nodeIndex=++h;g.sizcache=f}d=a.nodeIndex-e;return c==0?d==0:d%c==0&&d/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],c=h.attrHandle[c]?h.attrHandle[c](a):
a[c]!=null?a[c]:a.getAttribute(c),d=c+"",e=b[2],f=b[4];return c==null?e==="!=":e==="="?d===f:e==="*="?d.indexOf(f)>=0:e==="~="?(" "+d+" ").indexOf(f)>=0:!f?d&&c!==!1:e==="!="?d!=f:e==="^="?d.indexOf(f)===0:e==="$="?d.substr(d.length-f.length)===f:e==="|="?d===f||d.substr(0,f.length+1)===f+"-":!1},POS:function(a,b,c,d){var e=h.setFilters[b[2]];if(e)return e(a,c,b,d)}}},m=h.match.POS,o;for(o in h.match)h.match[o]=RegExp(h.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),h.leftMatch[o]=RegExp(/(^(?:.|\r|\n)*?)/.source+
h.match[o].source);var l=function(a,b){a=Array.prototype.slice.call(a,0);return b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(x){l=function(a,b){var c=b||[];if(e.call(a)==="[object Array]")Array.prototype.push.apply(c,a);else if(typeof a.length==="number")for(var d=0,f=a.length;d<f;d++)c.push(a[d]);else for(d=0;a[d];d++)c.push(a[d]);return c}}var q;document.documentElement.compareDocumentPosition?q=function(a,b){if(!a.compareDocumentPosition||
!b.compareDocumentPosition)return a==b&&(f=!0),0;var c=a.compareDocumentPosition(b)&4?-1:a===b?0:1;c===0&&(f=!0);return c}:"sourceIndex"in document.documentElement?q=function(a,b){if(!a.sourceIndex||!b.sourceIndex)return a==b&&(f=!0),0;var c=a.sourceIndex-b.sourceIndex;c===0&&(f=!0);return c}:document.createRange&&(q=function(a,b){if(!a.ownerDocument||!b.ownerDocument)return a==b&&(f=!0),0;var c=a.ownerDocument.createRange(),d=b.ownerDocument.createRange();c.setStart(a,0);c.setEnd(a,0);d.setStart(b,
0);d.setEnd(b,0);c=c.compareBoundaryPoints(Range.START_TO_END,d);c===0&&(f=!0);return c});(function(){var a=document.createElement("div"),b="script"+(new Date).getTime();a.innerHTML="<a name='"+b+"'/>";var c=document.documentElement;c.insertBefore(a,c.firstChild);if(document.getElementById(b))h.find.ID=function(a,b,c){if(typeof b.getElementById!=="undefined"&&!c)return(b=b.getElementById(a[1]))?b.id===a[1]||typeof b.getAttributeNode!=="undefined"&&b.getAttributeNode("id").nodeValue===a[1]?[b]:void 0:
[]},h.filter.ID=function(a,b){var c=typeof a.getAttributeNode!=="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b};c.removeChild(a);c=a=null})();(function(){var a=document.createElement("div");a.appendChild(document.createComment(""));if(a.getElementsByTagName("*").length>0)h.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){for(var d=[],e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c};a.innerHTML="<a href='#'></a>";if(a.firstChild&&typeof a.firstChild.getAttribute!==
"undefined"&&a.firstChild.getAttribute("href")!=="#")h.attrHandle.href=function(a){return a.getAttribute("href",2)};a=null})();document.querySelectorAll&&function(){var a=j,b=document.createElement("div");b.innerHTML="<p class='TEST'></p>";if(!(b.querySelectorAll&&b.querySelectorAll(".TEST").length===0)){j=function(b,c,d,e){c=c||document;if(!e&&c.nodeType===9&&!s(c))try{return l(c.querySelectorAll(b),d)}catch(f){}return a(b,c,d,e)};for(var c in a)j[c]=a[c];b=null}}();document.getElementsByClassName&&
document.documentElement.getElementsByClassName&&function(){var a=document.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(a.getElementsByClassName("e").length!==0&&(a.lastChild.className="e",a.getElementsByClassName("e").length!==1))h.order.splice(1,0,"CLASS"),h.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!=="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}();var r=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&
16}:function(a,b){return a!==b&&(a.contains?a.contains(b):!0)},s=function(a){return a.nodeType===9&&a.documentElement.nodeName!=="HTML"||!!a.ownerDocument&&a.ownerDocument.documentElement.nodeName!=="HTML"},w=function(a,b){for(var c=[],d="",e,f=b.nodeType?[b]:b;e=h.match.PSEUDO.exec(a);)d+=e[0],a=a.replace(h.match.PSEUDO,"");a=h.relative[a]?a+"*":a;e=0;for(var g=f.length;e<g;e++)j(a,f[e],c);return j.filter(d,c)};window.Sizzle=j})();
(function(a){var b=Prototype.Selector.extendElements;Prototype.Selector.engine=a;Prototype.Selector.select=function(c,d){return b(a(c,d||document))};Prototype.Selector.match=function(b,d){return a.matches(d,[b]).length==1}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=!0;var c,d,e=!1,f=b.submit,g,j;b.hash?(j={},g=function(a,b,c){b in a?(Object.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c)):a[b]=c;return a}):(j="",g=function(a,b,c){return a+(a?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(c)});return a.inject(j,function(a,b){if(!b.disabled&&b.name&&(c=b.name,d=$(b).getValue(),d!=null&&b.type!="file"&&
(b.type!="submit"||!e&&f!==!1&&(!f||c==f)&&(e=!0))))a=g(a,c,d);return a})}};
Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){for(var a=$(a).getElementsByTagName("*"),b,c=[],d=Form.Element.Serializers,e=0;b=a[e];e++)c.push(b);return c.inject([],function(a,b){d[b.tagName.toLowerCase()]&&a.push(Element.extend(b));return a})},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var d=0,e=[],f=a.length;d<f;d++){var g=a[d];b&&g.type!=b||c&&g.name!=c||
e.push(Element.extend(g))}return e},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){var a=$(a).getElements().findAll(function(a){return"hidden"!=a.type&&!a.disabled}),b=a.findAll(function(a){return a.hasAttribute("tabIndex")&&a.tabIndex>=0}).sortBy(function(a){return a.tabIndex}).first();return b?b:a.find(function(a){return/^(?:input|select|textarea)$/i.test(a.tagName)})},
focusFirstElement:function(a){var a=$(a),b=a.findFirstElement();b&&b.activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var c=b.parameters,d=a.readAttribute("action")||"";if(d.blank())d=window.location.href;b.parameters=a.serialize(!0);c&&(Object.isString(c)&&(c=c.toQueryParams()),Object.extend(b.parameters,c));if(a.hasAttribute("method")&&!b.method)b.method=a.method;return new Ajax.Request(d,b)}};
Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=void 0){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){var a=$(a),b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){var a=$(a),c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus(),a.select&&
(a.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(a.type))&&a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=!0;return a},enable:function(a){a=$(a);a.disabled=!1;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers=function(){function a(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;else a.checked=!!b}function b(a,b){if(Object.isUndefined(b))return a.value;else a.value=b}function c(a){var b=a.selectedIndex;return b>=0?e(a.options[b]):null}function d(a){var b,c=a.length;if(!c)return null;var d=0;for(b=[];d<c;d++){var m=a.options[d];m.selected&&b.push(e(m))}return b}function e(a){return Element.hasAttribute(a,"value")?a.value:a.text}return{input:function(c,d){switch(c.type.toLowerCase()){case "checkbox":case "radio":return a(c,
d);default:return b(c,d)}},inputSelector:a,textarea:b,select:function(a,b){if(Object.isUndefined(b))return(a.type==="select-one"?c:d)(a);for(var e,h,m=!Object.isArray(b),o=0,l=a.length;o<l;o++)if(e=a.options[o],h=this.optionValue(e),m){if(h==b){e.selected=!0;break}}else e.selected=b.include(h)},selectOne:c,selectMany:d,optionValue:e,button:b}}();
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,d){$super(d,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a))this.callback(this.element,a),this.lastValue=a}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a)this.callback(this.element,a),this.lastValue=a},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(a,b){return a.which?a.which===b+1:a.button===b}function b(a,b){return a.button===w[b]}function c(a,b){switch(b){case 0:return a.which==1&&!a.metaKey;case 1:return a.which==2||a.which==1&&a.metaKey;case 2:return a.which==3;default:return!1}}function d(a){var b=document.documentElement,c=document.body||{scrollLeft:0};return a.pageX||a.clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0)}function e(a){var b=document.documentElement,c=document.body||{scrollTop:0};return a.pageY||
a.clientY+(b.scrollTop||c.scrollTop)-(b.clientTop||0)}function f(a,b,c){var d=Element.retrieve(a,"prototype_event_registry");Object.isUndefined(d)&&(z.push(a),d=Element.retrieve(a,"prototype_event_registry",$H()));var e=d.get(b);Object.isUndefined(e)&&(e=[],d.set(b,e));if(e.pluck("handler").include(c))return!1;var f;if(b.include(":"))f=function(d){if(Object.isUndefined(d.eventName))return!1;if(d.eventName!==b)return!1;l.extend(d,a);c.call(a,d)};else if(!q&&(b==="mouseenter"||b==="mouseleave")){if(b===
"mouseenter"||b==="mouseleave")f=function(b){l.extend(b,a);for(var d=b.relatedTarget;d&&d!==a;)try{d=d.parentNode}catch(e){d=a}d!==a&&c.call(a,b)}}else f=function(b){l.extend(b,a);c.call(a,b)};f.handler=c;e.push(f);return f}function g(){for(var a=0,b=z.length;a<b;a++)l.stopObserving(z[a]),z[a]=null}function j(a,b,c){a=$(a);c=f(a,b,c);if(!c)return a;b.include(":")?a.addEventListener?a.addEventListener("dataavailable",c,!1):(a.attachEvent("ondataavailable",c),a.attachEvent("onlosecapture",c)):(b=C(b),
a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c));return a}function h(a,b,c){var a=$(a),d=Element.retrieve(a,"prototype_event_registry");if(!d)return a;if(!b)return d.each(function(b){h(a,b.key)}),a;var e=d.get(b);if(!e)return a;if(!c)return e.each(function(c){h(a,b,c.handler)}),a;for(var f=e.length,g;f--;)if(e[f].handler===c){g=e[f];break}if(!g)return a;b.include(":")?a.removeEventListener?a.removeEventListener("dataavailable",g,!1):(a.detachEvent("ondataavailable",g),a.detachEvent("onlosecapture",
g)):(c=C(b),a.removeEventListener?a.removeEventListener(c,g,!1):a.detachEvent("on"+c,g));d.set(b,e.without(g));return a}function m(a,b,c,d){a=$(a);Object.isUndefined(d)&&(d=!0);if(a==document&&document.createEvent&&!a.dispatchEvent)a=document.documentElement;var e;document.createEvent?(e=document.createEvent("HTMLEvents"),e.initEvent("dataavailable",d,!0)):(e=document.createEventObject(),e.eventType=d?"ondataavailable":"onlosecapture");e.eventName=b;e.memo=c||{};document.createEvent?a.dispatchEvent(e):
a.fireEvent(e.eventType,e);return l.extend(e)}function o(a,b,c,d){a=$(a);Object.isFunction(c)&&Object.isUndefined(d)&&(d=c,c=null);return(new l.Handler(a,b,c,d)).start()}var l={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},x=document.documentElement,q="onmouseenter"in x&&"onmouseleave"in x,r=function(){return!1};window.attachEvent&&(r=window.addEventListener?
function(a){return!(a instanceof window.Event)}:function(){return!0});var s,w={"0":1,1:4,2:2};s=window.attachEvent?window.addEventListener?function(c,d){return r(c)?b(c,d):a(c,d)}:b:Prototype.Browser.WebKit?c:a;l.Methods={isLeftClick:function(a){return s(a,0)},isMiddleClick:function(a){return s(a,1)},isRightClick:function(a){return s(a,2)},element:function(a){var a=l.extend(a),b=a.target,c=a.type;if((a=a.currentTarget)&&a.tagName&&(c==="load"||c==="error"||c==="click"&&a.tagName.toLowerCase()==="input"&&
a.type==="radio"))b=a;if(b.nodeType==Node.TEXT_NODE)b=b.parentNode;return Element.extend(b)},findElement:function(a,b){var c=l.element(a);if(!b)return c;for(;c;){if(Object.isElement(c)&&Prototype.Selector.match(c,b))return Element.extend(c);c=c.parentNode}},pointer:function(a){return{x:d(a),y:e(a)}},pointerX:d,pointerY:e,stop:function(a){l.extend(a);a.preventDefault();a.stopPropagation();a.stopped=!0}};var y=Object.keys(l.Methods).inject({},function(a,b){a[b]=l.Methods[b].methodize();return a});if(window.attachEvent){var A=
function(a){switch(a.type){case "mouseover":case "mouseenter":a=a.fromElement;break;case "mouseout":case "mouseleave":a=a.toElement;break;default:return null}return Element.extend(a)},D={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};l.extend=function(a,b){if(!a)return!1;if(!r(a))return a;if(a._extendedByPrototype)return a;a._extendedByPrototype=Prototype.emptyFunction;var c=l.pointer(a);Object.extend(a,{target:a.srcElement||
b,relatedTarget:A(a),pageX:c.x,pageY:c.y});Object.extend(a,y);Object.extend(a,D);return a}}else l.extend=Prototype.K;if(window.addEventListener)l.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(l.prototype,y);var z=[];Prototype.Browser.IE&&window.attachEvent("onunload",g);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,!1);var C=Prototype.K,n={mouseenter:"mouseover",mouseleave:"mouseout"};q||(C=function(a){return n[a]||
a});l.Handler=Class.create({initialize:function(a,b,c,d){this.element=$(a);this.eventName=b;this.selector=c;this.callback=d;this.handler=this.handleEvent.bind(this)},start:function(){l.observe(this.element,this.eventName,this.handler);return this},stop:function(){l.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(a){var b=l.findElement(a,this.selector);b&&this.callback.call(this.element,a,b)}});Object.extend(l,l.Methods);Object.extend(l,{fire:m,observe:j,stopObserving:h,
on:o});Element.addMethods({fire:m,observe:j,stopObserving:h,on:o});Object.extend(document,{fire:m.methodize(),observe:j.methodize(),stopObserving:h.methodize(),on:o.methodize(),loaded:!1});window.Event?Object.extend(window.Event,l):window.Event=l})();
(function(){function a(){if(!document.loaded)d&&window.clearTimeout(d),document.loaded=!0,document.fire("dom:loaded")}function b(){document.readyState==="complete"&&(document.stopObserving("readystatechange",b),a())}function c(){try{document.documentElement.doScroll("left")}catch(b){d=c.defer();return}a()}var d;document.addEventListener?document.addEventListener("DOMContentLoaded",a,!1):(document.observe("readystatechange",b),window==top&&(d=c.defer()));Event.observe(window,"load",a)})();Element.addMethods();
Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var d=Element.cumulativeScrollOffset(a);this.xcomp=b+d[0]-this.deltaX;this.ycomp=c+d[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();
return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(a){function b(a){return a.blank()?null:"[contains(concat(' ', @class, ' '), ' "+a+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(a,d){var d=d.toString().strip(),e=/\s/.test(d)?$w(d).map(b).join(""):b(d);return e?document._getElementsByXPath(".//*"+e,a):[]}:function(a,b){var b=b.toString().strip(),e=[],f=/\s/.test(b)?$w(b):null;if(!f&&!b)return e;for(var g=$(a).getElementsByTagName("*"),b=" "+b+" ",
j=0,h,m;h=g[j];j++)h.className&&(m=" "+h.className+" ")&&(m.include(b)||f&&f.all(function(a){return!a.toString().blank()&&m.include(" "+a+" ")}))&&e.push(Element.extend(h));return e};return function(a,b){return $(b||document.body).getElementsByClassName(a)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(a){return a.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(a,b){for(var c=Prototype.Selector.match,d=[],e=0,f=a.length;e<f;e++){var g=a[e];c(g,b)&&d.push(Element.extend(g))}return d},
findElement:function(a,b,c){for(var c=c||0,d=0,e,f=0,g=a.length;f<g;f++)if(e=a[f],Prototype.Selector.match(e,b)&&c===d++)return Element.extend(e)},findChildElements:function(a,b){var c=b.toArray().join(", ");return Prototype.Selector.select(c,a||document)}})})();
var Scriptaculous={Version:"1.9.0",require:function(a){try{document.write('<script type="text/javascript" src="'+a+'"><\/script>')}catch(b){var c=document.createElement("script");c.type="text/javascript";c.src=a;document.getElementsByTagName("head")[0].appendChild(c)}},REQUIRED_PROTOTYPE:"1.6.0.3",load:function(){function a(a){var b=a.replace(/_.*|\./g,""),b=parseInt(b+"0".times(4-b.length));return a.indexOf("_")>-1?b-1:b}if(typeof Prototype=="undefined"||typeof Element=="undefined"||typeof Element.Methods==
"undefined"||a(Prototype.Version)<a(Scriptaculous.REQUIRED_PROTOTYPE))throw"script.aculo.us requires the Prototype JavaScript framework >= "+Scriptaculous.REQUIRED_PROTOTYPE;var b=/scriptaculous\.js(\?.*)?$/;$$("script[src]").findAll(function(a){return a.src.match(b)}).each(function(a){var d=a.src.replace(b,""),a=a.src.match(/\?.*load=([a-z,]*)/);(a?a[1]:"builder,effects,dragdrop,controls,slider,sound").split(",").each(function(a){Scriptaculous.require(d+a+".js")})})}};Scriptaculous.load();
var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(a,b,c){var a=a.toUpperCase(),d=document.createElement(this.NODEMAP[a]||"div");try{d.innerHTML="<"+a+"></"+a+">"}catch(e){}var f=d.firstChild||null;f&&f.tagName.toUpperCase()!=a&&(f=f.getElementsByTagName(a)[0]);f||(f=document.createElement(a));if(f){if(b)if(this._isStringOrNumber(b)||
b instanceof Array||b.tagName)this._children(f,b);else{var g=this._attributes(b);if(g.length){try{d.innerHTML="<"+a+" "+g+"></"+a+">"}catch(j){}f=d.firstChild||null;if(!f)for(attr in f=document.createElement(a),b)f[attr=="class"?"className":attr]=b[attr];f.tagName.toUpperCase()!=a&&(f=d.getElementsByTagName(a)[0])}}c&&this._children(f,c);return $(f)}},_text:function(a){return document.createTextNode(a)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(a){var b=[];for(attribute in a)b.push((attribute in
this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+a[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"');return b.join(" ")},_children:function(a,b){b.tagName?a.appendChild(b):typeof b=="object"?b.flatten().each(function(b){typeof b=="object"?a.appendChild(b):Builder._isStringOrNumber(b)&&a.appendChild(Builder._text(b))}):Builder._isStringOrNumber(b)&&a.appendChild(Builder._text(b))},_isStringOrNumber:function(a){return typeof a=="string"||typeof a=="number"},build:function(a){var b=this.node("div");
$(b).update(a.strip());return b.down()},dump:function(a){typeof a!="object"&&typeof a!="function"&&(a=window);"A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR".split(/\s+/).each(function(b){a[b]=
function(){return Builder.node.apply(Builder,[b].concat($A(arguments)))}})}};String.prototype.parseColor=function(a){var b="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(","),d=0;do b+=parseInt(c[d]).toColorPart();while(++d<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(d=1;d<4;d++)b+=(this.charAt(d)+this.charAt(d)).toLowerCase();this.length==7&&(b=this.toLowerCase())}return b.length==7?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(a){return a.nodeType==3?a.nodeValue:a.hasChildNodes()?Element.collectTextNodes(a):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(a){return a.nodeType==3?a.nodeValue:a.hasChildNodes()&&!Element.hasClassName(a,b)?Element.collectTextNodesIgnoreClass(a,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{var a=$(a),b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";Prototype.Browser.IE&&(b+=";zoom:1");a=$(a);$A(a.childNodes).each(function(c){c.nodeType==3&&(c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(d==" "?String.fromCharCode(160):d),c)}),Element.remove(c))})},multiple:function(a,b,c){var a=
(typeof a=="object"||Object.isFunction(a))&&a.length?a:$(a).childNodes,d=Object.extend({speed:0.1,delay:0},c||{}),e=d.delay;$A(a).each(function(a,c){new b(a,Object.extend(d,{delay:c*d.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();return Effect[Effect.PAIRS[b][a.visible()?1:0]](a,Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{}))}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(a){return a.state=="idle"}).each(function(b){b.startOn+=a.finishOn;b.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b}a.startOn+=b;a.finishOn+=b;(!a.options.queue.limit||this.effects.length<a.options.queue.limit)&&this.effects.push(a);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0)clearInterval(this.interval),this.interval=null},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){return!Object.isString(a)?a:this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===!1)a.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=function(){function a(b,
d){if(b.options[d+"Internal"])b.options[d+"Internal"](b);if(b.options[d])b.options[d](b)}return function(c){if(this.state==="idle")this.state="running",a(this,"beforeSetup"),this.setup&&this.setup(),a(this,"afterSetup");if(this.state==="running")this.position=c=this.options.transition(c)*this.fromToDelta+this.options.from,a(this,"beforeUpdate"),this.update&&this.update(c),a(this,"afterUpdate")}}();this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":
this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn)if(a>=this.finishOn)this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish");else{var a=(a-this.startOn)/this.totalTime,b=(a*this.totalFrames).round();if(b>this.currentFrame)this.render(a),this.currentFrame=b}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},event:function(a){if(this.options[a+
"Internal"])this.options[a+"Internal"](this);if(this.options[a])this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){var a=Object.isString(a)?$(a):a,d=$A(arguments),e=d.last(),d=d.length==5?d[3]:null;this.method=Object.isFunction(e)?e.bind(a):Object.isFunction(a[e])?a[e].bind(a):function(b){a[e]=b};this.start(Object.extend({from:b,to:c},d||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});this.start(Object.extend({from:this.element.getOpacity()||0,to:1},b||{}))},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({x:0,y:0,mode:"relative"},b||{}))},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");this.options.mode=="absolute"&&(this.options.x-=this.originalLeft,this.options.y-=this.originalTop)},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,d){return new Effect.Move(a,Object.extend({x:c,y:b},d||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{}))},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(a){this.originalStyle[a]=
this.element.style[a]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0)this.fontSize=parseFloat(a),this.fontSizeType=b}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=
[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
if(this.options.scaleX)c.width=b.round()+"px";if(this.options.scaleY)c.height=a.round()+"px";if(this.options.scaleFromCenter){var d=(a-this.dims[0])/2,e=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)c.top=this.originalTop-d+"px";if(this.options.scaleX)c.left=this.originalLeft-e+"px"}else{if(this.options.scaleY)c.top=-d+"px";if(this.options.scaleX)c.left=-e+"px"}}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({startcolor:"#ffff99"},b||{}))},setup:function(){if(this.element.getStyle("display")=="none")this.cancel();else{this.oldStyle={};if(!this.options.keepBackgroundImage)this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"});if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))}},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+
(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){var c=b||{},d=document.viewport.getScrollOffsets(),e=$(a).cumulativeOffset();c.offset&&(e[1]+=c.offset);return new Effect.Tween(null,d.top,e[1],c,function(a){scrollTo(d.left,a.round())})};
Effect.Fade=function(a,b){var a=$(a),c=a.getInlineOpacity(),d=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(a){a.options.to==0&&a.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,d)};
Effect.Appear=function(a,b){var a=$(a),c=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(a){a.element.forceRerendering()},beforeSetup:function(a){a.element.setOpacity(a.options.from).show()}},b||{});return new Effect.Opacity(a,c)};
Effect.Puff=function(a,b){var a=$(a),c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(a){Position.absolutize(a.effects[0].element)},afterFinishInternal:function(a){a.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(a){a.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){var a=$(a),c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){var a=$(a),c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(a){new Effect.Scale(a.element,1,{duration:0.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(a){a.element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){var a=$(a),c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:0.5,beforeSetup:function(a){a.effects[0].element.makePositioned()},afterFinishInternal:function(a){a.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){var a=$(a),c=Object.extend({distance:20,duration:0.5},b||{}),d=parseFloat(c.distance),e=parseFloat(c.duration)/10,f={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:d,y:0,duration:e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-d*2,y:0,duration:e*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:d*2,y:0,duration:e*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-d*2,y:0,duration:e*2,afterFinishInternal:function(a){new Effect.Move(a.element,
{x:d*2,y:0,duration:e*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-d,y:0,duration:e,afterFinishInternal:function(a){a.element.undoPositioned().setStyle(f)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(a){a.element.makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g,j,h;switch(c.direction){case "top-left":f=g=j=h=0;break;case "top-right":f=e.width;g=h=0;j=-e.width;break;case "bottom-left":f=j=0;g=e.height;h=-e.height;break;
case "bottom-right":f=e.width;g=e.height;j=-e.width;h=-e.height;break;case "center":f=e.width/2,g=e.height/2,j=-e.width/2,h=-e.height/2}return new Effect.Move(a,{x:f,y:g,duration:0.01,beforeSetup:function(a){a.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(a){new Effect.Parallel([new Effect.Opacity(a.element,{sync:!0,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(a.element,{x:j,y:h,sync:!0,transition:c.moveTransition}),new Effect.Scale(a.element,100,{scaleMode:{originalHeight:e.height,
originalWidth:e.width},sync:!0,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(a){a.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.effects[0].element.undoClipping().undoPositioned().setStyle(d)}},c))}})};
Effect.Shrink=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g;switch(c.direction){case "top-left":f=g=0;break;case "top-right":f=e.width;g=0;break;case "bottom-left":f=0;g=e.height;break;case "bottom-right":f=e.width;g=
e.height;break;case "center":f=e.width/2,g=e.height/2}return new Effect.Parallel([new Effect.Opacity(a,{sync:!0,to:0,from:1,transition:c.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:!0,transition:c.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(a,{x:f,y:g,sync:!0,transition:c.moveTransition})],Object.extend({beforeStartInternal:function(a){a.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.effects[0].element.hide().undoClipping().undoPositioned().setStyle(d)}},
c))};Effect.Pulsate=function(a,b){var a=$(a),c=b||{},d=a.getInlineOpacity(),e=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(a){a.element.setStyle({opacity:d})}},c),{transition:function(a){return 1-e(-Math.cos(a*(c.pulses||5)*2*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){var a=$(a),c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(a){a.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({style:{}},b||{});if(Object.isString(c.style))if(c.style.include(":"))this.style=c.style.parseStyle();else{this.element.addClassName(c.style);this.style=$H(this.element.getStyles());this.element.removeClassName(c.style);var d=this.element.getStyles();this.style=this.style.reject(function(a){return a.value==d[a.key]});c.afterFinishInternal=function(a){a.element.addClassName(a.options.style);
a.transforms.each(function(b){a.element.style[b.style]=""})}}else this.style=$H(c.style);this.start(c)},setup:function(){function a(a){if(!a||["rgba(0, 0, 0, 0)","transparent"].include(a))a="#ffffff";a=a.parseColor();return $R(0,2).map(function(c){return parseInt(a.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(b){var c=b[0],b=b[1],d=null;b.parseColor("#zzzzzz")!="#zzzzzz"?(b=b.parseColor(),d="color"):c=="opacity"?(b=parseFloat(b),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})):Element.CSS_LENGTH.test(b)&&(d=b.match(/^([\+\-]?[0-9\.]+)(.*)$/),b=parseFloat(d[1]),d=d.length==3?d[2]:null);var e=this.element.getStyle(c);return{style:c.camelize(),originalValue:d=="color"?a(e):parseFloat(e||0),targetValue:d=="color"?a(b):b,unit:d}}.bind(this)).reject(function(a){return a.originalValue==a.targetValue||a.unit!="color"&&(isNaN(a.originalValue)||isNaN(a.targetValue))})},update:function(a){for(var b={},c,d=this.transforms.length;d--;)b[(c=this.transforms[d]).style]=
c.unit=="color"?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(c.unit===null?"":c.unit);this.element.setStyle(b,!0)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(a){var a=$H(a),c=a.values().first();this.tracks.push($H({ids:a.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options");return[$(b)||$$(b)].flatten().map(function(a){return new c(a,Object.extend({sync:!0},
d))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();Prototype.Browser.WebKit?a=(new Element("div",{style:this})).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',a=String.__parseStyleElement.childNodes[0].style);Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(a,d){a[d]=b[d];return a})}:function(a){var a=$(a),b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(a,c){a[c]=b[c];return a});if(!c.opacity)c.opacity=a.getOpacity();return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";
var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(a,b){var a=$(a),c=Object.extend({greedy:!0,hoverclass:null,tree:!1},b||{});if(c.containment){c._containers=[];var d=c.containment;Object.isArray(d)?d.each(function(a){c._containers.push($(a))}):c._containers.push($(d))}if(c.accept)c.accept=[c.accept].flatten();Element.makePositioned(a);c.element=a;this.drops.push(c)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i)Element.isParent(a[i].element,
deepest.element)&&(deepest=a[i]);return deepest},isContained:function(a,b){var c;c=b.tree?a.treeNode:a.parentNode;return b._containers.detect(function(a){return c==a})},isAffected:function(a,b,c){return c.element!=b&&(!c._containers||this.isContained(b,c))&&(!c.accept||Element.classNames(b).detect(function(a){return c.accept.include(a)}))&&Position.within(c.element,a[0],a[1])},deactivate:function(a){a.hoverclass&&Element.removeClassName(a.element,a.hoverclass);this.last_active=null},activate:function(a){a.hoverclass&&
Element.addClassName(a.element,a.hoverclass);this.last_active=a},show:function(a,b){if(this.drops.length){var c,d=[];this.drops.each(function(c){Droppables.isAffected(a,b,c)&&d.push(c)});d.length>0&&(c=Droppables.findDeepestChild(d));this.last_active&&this.last_active!=c&&this.deactivate(this.last_active);if(c){Position.within(c.element,a[0],a[1]);if(c.onHover)c.onHover(b,c.element,Position.overlap(c.overlap,c.element));c!=this.last_active&&Droppables.activate(c)}}},fire:function(a,b){if(this.last_active&&
(Position.prepare(),this.isAffected([Event.pointerX(a),Event.pointerY(a)],b,this.last_active)&&this.last_active.onDrop))return this.last_active.onDrop(b,this.last_active.element,a),!0},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0)this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),
Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress);this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});this.drags.length==0&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(a){a.options.delay?
this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay):(window.focus(),this.activeDraggable=a)},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var b=[Event.pointerX(a),Event.pointerY(a)];if(!(this._lastPointer&&this._lastPointer.inspect()==b.inspect()))this._lastPointer=b,this.activeDraggable.updateDrag(a,b)}},endDrag:function(a){if(this._timeout)clearTimeout(this._timeout),
this._timeout=null;if(this.activeDraggable)this._lastPointer=null,this.activeDraggable.endDrag(a),this.activeDraggable=null},keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(a,b,c){this[a+"Count"]>0&&this.observers.each(function(d){if(d[a])d[a](a,b,
c)});if(b.options[a])b.options[a](b,c)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}},Draggable=Class.create({initialize:function(a,b){var c={handle:!1,reverteffect:function(a,b,c){var g=Math.sqrt(Math.abs(b^2)+Math.abs(c^2))*0.02;new Effect.Move(a,{x:-c,y:-b,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(a){var b=Object.isNumber(a._opacity)?a._opacity:
1;new Effect.Opacity(a,{duration:0.2,from:0.7,to:b,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[a]=!1}})},zindex:1E3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!b||Object.isUndefined(b.endeffect))&&Object.extend(c,{starteffect:function(a){a._opacity=Element.getOpacity(a);Draggable._dragging[a]=!0;new Effect.Opacity(a,{duration:0.2,from:a._opacity,to:0.7})}});c=Object.extend(c,b||{});this.element=$(a);if(c.handle&&Object.isString(c.handle))this.handle=
this.element.down("."+c.handle,0);if(!this.handle)this.handle=$(c.handle);if(!this.handle)this.handle=this.element;if(c.scroll&&!c.scroll.scrollTo&&!c.scroll.outerHTML)c.scroll=$(c.scroll),this._isScrollChild=Element.childOf(this.element,c.scroll);Element.makePositioned(this.element);this.options=c;this.dragging=!1;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,
"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(a){if(Object.isUndefined(Draggable._dragging[this.element])||!Draggable._dragging[this.element])if(Event.isLeftClick(a)&&(!(tag_name=Event.element(a).tagName.toUpperCase())||!(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA"))){var b=
[Event.pointerX(a),Event.pointerY(a)],c=this.element.cumulativeOffset();this.offset=[0,1].map(function(a){return b[a]-c[a]});Draggables.activate(this);Event.stop(a)}},startDrag:function(a){this.dragging=!0;if(!this.delta)this.delta=this.currentDelta();if(this.options.zindex)this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex;if(this.options.ghosting)this._clone=this.element.cloneNode(!0),(this._originallyAbsolute=this.element.getStyle("position")==
"absolute")||Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element);if(this.options.scroll)if(this.options.scroll==window){var b=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=b.left;this.originalScrollTop=b.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,
b){this.dragging||this.startDrag(a);this.options.quiet||(Position.prepare(),Droppables.show(b,this.element));Draggables.notify("onDrag",this,a);this.draw(b);this.options.change&&this.options.change(this);if(this.options.scroll){this.stopScrolling();var c;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))c=[left,top,left+width,top+height];else c=Position.page(this.options.scroll).toArray(),c[0]+=this.options.scroll.scrollLeft+Position.deltaX,c[1]+=this.options.scroll.scrollTop+
Position.deltaY,c.push(c[0]+this.options.scroll.offsetWidth),c.push(c[1]+this.options.scroll.offsetHeight);var d=[0,0];b[0]<c[0]+this.options.scrollSensitivity&&(d[0]=b[0]-(c[0]+this.options.scrollSensitivity));b[1]<c[1]+this.options.scrollSensitivity&&(d[1]=b[1]-(c[1]+this.options.scrollSensitivity));b[0]>c[2]-this.options.scrollSensitivity&&(d[0]=b[0]-(c[2]-this.options.scrollSensitivity));b[1]>c[3]-this.options.scrollSensitivity&&(d[1]=b[1]-(c[3]-this.options.scrollSensitivity));this.startScrolling(d)}Prototype.Browser.WebKit&&
window.scrollBy(0,0);Event.stop(a)},finishDrag:function(a,b){this.dragging=!1;if(this.options.quiet){Position.prepare();var c=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(c,this.element)}if(this.options.ghosting)this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null;c=!1;b&&((c=Droppables.fire(a,this.element))||(c=!1));if(c&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify("onEnd",
this,a);var d=this.options.revert;d&&Object.isFunction(d)&&(d=d(this.element));var e=this.currentDelta();d&&this.options.reverteffect?(c==0||d!="failure")&&this.options.reverteffect(this.element,e[1]-this.delta[1],e[0]-this.delta[0]):this.delta=e;if(this.options.zindex)this.element.style.zIndex=this.originalZ;this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){a.keyCode==Event.KEY_ESC&&(this.finishDrag(a,!1),Event.stop(a))},
endDrag:function(a){this.dragging&&(this.stopScrolling(),this.finishDrag(a,!0),Event.stop(a))},draw:function(a){var b=this.element.cumulativeOffset();if(this.options.ghosting){var c=Position.realOffset(this.element);b[0]+=c[0]-Position.deltaX;b[1]+=c[1]-Position.deltaY}c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];this.options.scroll&&this.options.scroll!=window&&this._isScrollChild&&(b[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft,b[1]-=this.options.scroll.scrollTop-this.originalScrollTop);
c=[0,1].map(function(c){return a[c]-b[c]-this.offset[c]}.bind(this));this.options.snap&&(c=Object.isFunction(this.options.snap)?this.options.snap(c[0],c[1],this):Object.isArray(this.options.snap)?c.map(function(a,b){return(a/this.options.snap[b]).round()*this.options.snap[b]}.bind(this)):c.map(function(a){return(a/this.options.snap).round()*this.options.snap}.bind(this)));var d=this.element.style;if(!this.options.constraint||this.options.constraint=="horizontal")d.left=c[0]+"px";if(!this.options.constraint||
this.options.constraint=="vertical")d.top=c[1]+"px";if(d.visibility=="hidden")d.visibility=""},stopScrolling:function(){if(this.scrollInterval)clearInterval(this.scrollInterval),this.scrollInterval=null,Draggables._lastScrollPointer=null},startScrolling:function(a){if(a[0]||a[1])this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var a=new Date,b=a-this.lastScrolled;
this.lastScrolled=a;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1])a=b/1E3,this.options.scroll.scrollTo(left+a*this.scrollSpeed[0],top+a*this.scrollSpeed[1])}else this.options.scroll.scrollLeft+=this.scrollSpeed[0]*b/1E3,this.options.scroll.scrollTop+=this.scrollSpeed[1]*b/1E3;Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild)Draggables._lastScrollPointer=
Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*b/1E3,Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*b/1E3,Draggables._lastScrollPointer[0]<0&&(Draggables._lastScrollPointer[0]=0),Draggables._lastScrollPointer[1]<0&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer);this.options.change&&this.options.change(this)},_getWindowScroll:function(a){var b,c,d;with(a.document){if(a.document.documentElement&&
documentElement.scrollTop)b=documentElement.scrollTop,c=documentElement.scrollLeft;else if(a.document.body)b=body.scrollTop,c=body.scrollLeft;a.innerWidth?(d=a.innerWidth,a=a.innerHeight):a.document.documentElement&&documentElement.clientWidth?(d=documentElement.clientWidth,a=documentElement.clientHeight):(d=body.offsetWidth,a=body.offsetHeight)}return{top:b,left:c,width:d,height:a}}});Draggable._dragging={};
var SortableObserver=Class.create({initialize:function(a,b){this.element=$(a);this.observer=b;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){for(;a.tagName.toUpperCase()!="BODY";){if(a.id&&Sortable.sortables[a.id])return a;
a=a.parentNode}},options:function(a){a=Sortable._findRootElement($(a));return!a?void 0:Sortable.sortables[a.id]},destroy:function(a){a=$(a);if(a=Sortable.sortables[a.id])Draggables.removeObserver(a.element),a.droppables.each(function(a){Droppables.remove(a)}),a.draggables.invoke("destroy"),delete Sortable.sortables[a.element.id]},create:function(a,b){var a=$(a),c=Object.extend({element:a,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:a,handle:!1,
only:!1,delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},b||{});this.destroy(a);var d={revert:!0,quiet:c.quiet,scroll:c.scroll,scrollSpeed:c.scrollSpeed,scrollSensitivity:c.scrollSensitivity,delay:c.delay,ghosting:c.ghosting,constraint:c.constraint,handle:c.handle};if(c.starteffect)d.starteffect=c.starteffect;if(c.reverteffect)d.reverteffect=
c.reverteffect;else if(c.ghosting)d.reverteffect=function(a){a.style.top=0;a.style.left=0};if(c.endeffect)d.endeffect=c.endeffect;if(c.zindex)d.zindex=c.zindex;var e={overlap:c.overlap,containment:c.containment,tree:c.tree,hoverclass:c.hoverclass,onHover:Sortable.onHover},f={onHover:Sortable.onEmptyHover,overlap:c.overlap,containment:c.containment,hoverclass:c.hoverclass};Element.cleanWhitespace(a);c.draggables=[];c.droppables=[];if(c.dropOnEmpty||c.tree)Droppables.add(a,f),c.droppables.push(a);(c.elements||
this.findElements(a,c)||[]).each(function(b,f){var h=c.handles?$(c.handles[f]):c.handle?$(b).select("."+c.handle)[0]:b;c.draggables.push(new Draggable(b,Object.extend(d,{handle:h})));Droppables.add(b,e);if(c.tree)b.treeNode=a;c.droppables.push(b)});c.tree&&(Sortable.findTreeElements(a,c)||[]).each(function(b){Droppables.add(b,f);b.treeNode=a;c.droppables.push(b)});this.sortables[a.identify()]=c;Draggables.addObserver(new SortableObserver(a,c.onUpdate))},findElements:function(a,b){return Element.findChildren(a,
b.only,b.tree?!0:!1,b.tag)},findTreeElements:function(a,b){return Element.findChildren(a,b.only,b.tree?!0:!1,b.treeTag)},onHover:function(a,b,c){if(!Element.isParent(b,a)&&!(c>0.33&&c<0.66&&Sortable.options(b).tree))if(c>0.5){if(Sortable.mark(b,"before"),b.previousSibling!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,b);if(b.parentNode!=c)Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}else{Sortable.mark(b,"after");var d=b.nextSibling||null;
if(d!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,d);if(b.parentNode!=c)Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}},onEmptyHover:function(a,b,c){var d=a.parentNode,e=Sortable.options(b);if(!Element.isParent(b,a)){var f=Sortable.findElements(b,{tag:e.tag,only:e.only}),g=null;if(f)for(var j=Element.offsetSize(b,e.overlap)*(1-c),c=0;c<f.length;c+=1)if(j-Element.offsetSize(f[c],e.overlap)>=0)j-=Element.offsetSize(f[c],e.overlap);else{g=j-
Element.offsetSize(f[c],e.overlap)/2>=0?c+1<f.length?f[c+1]:null:f[c];break}b.insertBefore(a,g);Sortable.options(d).onChange(a);e.onChange(a)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(a,b){var c=Sortable.options(a.parentNode);if(!c||c.ghosting){if(!Sortable._marker)Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);
var d=a.cumulativeOffset();Sortable._marker.setStyle({left:d[0]+"px",top:d[1]+"px"});b=="after"&&(c.overlap=="horizontal"?Sortable._marker.setStyle({left:d[0]+a.clientWidth+"px"}):Sortable._marker.setStyle({top:d[1]+a.clientHeight+"px"}));Sortable._marker.show()}},_tree:function(a,b,c){for(var d=Sortable.findElements(a,b)||[],e=0;e<d.length;++e){var f=d[e].id.match(b.format);f&&(f={id:encodeURIComponent(f?f[1]:null),element:a,parent:c,children:[],position:c.children.length,container:$(d[e]).down(b.treeTag)},
f.container&&this._tree(f.container,b,f),c.children.push(f))}return c},tree:function(a,b){var a=$(a),c=this.options(a),c=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:a.id,format:c.format},b||{});return Sortable._tree(a,c,{id:null,parent:null,children:[],container:a,position:0})},_constructIndex:function(a){var b="";do a.id&&(b="["+a.position+"]"+b);while((a=a.parent)!=null);return b},sequence:function(a,b){var a=$(a),c=Object.extend(this.options(a),b||{});return $(this.findElements(a,
c)||[]).map(function(a){return a.id.match(c.format)?a.id.match(c.format)[1]:""})},setSequence:function(a,b,c){var a=$(a),d=Object.extend(this.options(a),c||{}),e={};this.findElements(a,d).each(function(a){a.id.match(d.format)&&(e[a.id.match(d.format)[1]]=[a,a.parentNode]);a.parentNode.removeChild(a)});b.each(function(a){var b=e[a];b&&(b[1].appendChild(b[0]),delete e[a])})},serialize:function(a,b){var a=$(a),c=Object.extend(Sortable.options(a),b||{}),d=encodeURIComponent(b&&b.name?b.name:a.id);return c.tree?
Sortable.tree(a,b).children.map(function(a){return[d+Sortable._constructIndex(a)+"[id]="+encodeURIComponent(a.id)].concat(a.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(a,b).map(function(a){return d+"[]="+encodeURIComponent(a)}).join("&")}};Element.isParent=function(a,b){return!a.parentNode||a==b?!1:a.parentNode==b?!0:Element.isParent(a.parentNode,b)};
Element.findChildren=function(a,b,c,d){if(!a.hasChildNodes())return null;d=d.toUpperCase();b&&(b=[b].flatten());var e=[];$A(a.childNodes).each(function(a){a.tagName&&a.tagName.toUpperCase()==d&&(!b||Element.classNames(a).detect(function(a){return b.include(a)}))&&e.push(a);c&&(a=Element.findChildren(a,b,c,d))&&e.push(a)});return e.length>0?e.flatten():[]};Element.offsetSize=function(a,b){return a["offset"+(b=="vertical"||b=="height"?"Height":"Width")]};
if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){this.element=a=$(a);this.update=$(b);this.active=this.changed=this.hasFocus=!1;this.entryCount=this.index=0;this.oldElementValue=this.element.value;this.setOptions?this.setOptions(c):this.options=c||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||
function(a,b){if(!b.style.position||b.style.position=="absolute")b.style.position="absolute",Position.clone(a,b,{setHeight:!1,offsetTop:a.offsetHeight});Effect.Appear(b,{duration:0.15})};this.options.onHide=this.options.onHide||function(a,b){new Effect.Fade(b,{duration:0.15})};if(typeof this.options.tokens=="string")this.options.tokens=Array(this.options.tokens);this.options.tokens.include("\n")||this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);
Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none")this.options.onShow(this.element,this.update);if(!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")=="absolute")new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),
this.iefix=$(this.update.id+"_iefix");this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none")this.options.onHide(this.element,this.update);this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&
Element.show(this.options.indicator)},stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(a);case Event.KEY_ESC:this.hide();this.active=!1;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);
return}else if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0)return;this.hasFocus=this.changed=!0;this.observer&&clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1E3)},activate:function(){this.changed=!1;this.hasFocus=!0;this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");if(this.index!=b.autocompleteIndex)this.index=b.autocompleteIndex,this.render();Event.stop(a)},
onClick:function(a){this.index=Event.findElement(a,"LI").autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(){setTimeout(this.hide.bind(this),250);this.active=this.hasFocus=!1},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");if(this.hasFocus)this.show(),this.active=!0}else this.active=!1,this.hide()},markPrevious:function(){this.index>0?this.index--:
this.index=this.entryCount-1;this.getEntry(this.index).scrollIntoView(!0)},markNext:function(){this.index<this.entryCount-1?this.index++:this.index=0;this.getEntry(this.index).scrollIntoView(!1)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=!1;this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement)this.options.updateElement(a);else{var b=
"";if(this.options.select){var c=$(a).select("."+this.options.select)||[];c.length>0&&(b=Element.collectTextNodes(c[0],this.options.select))}else b=Element.collectTextNodesIgnoreClass(a,"informal");c=this.getTokenBounds();if(c[0]!=-1){var d=this.element.value.substr(0,c[0]),e=this.element.value.substr(c[0]).match(/^\s+/);e&&(d+=e[0]);this.element.value=d+b+this.element.value.substr(c[1])}else this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();this.options.afterUpdateElement&&
this.options.afterUpdateElement(this.element,a)}},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.index=0;this.entryCount==1&&this.options.autoSelect?
(this.selectEntry(),this.hide()):this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=!1;this.tokenBounds=null;this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide());this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],
a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];for(var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,d=-1,e=a.length,f,g=0,j=this.options.tokens.length;g<j;++g)f=a.lastIndexOf(this.options.tokens[g],b+c-1),f>d&&(d=f),f=a.indexOf(this.options.tokens[g],b+c),-1!=f&&f<e&&(e=f);return this.tokenBounds=[d+1,e]}});
Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;++d)if(a[d]!=b[d])return d;return c};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.asynchronous=!0;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;this.options.defaultParams&&
(this.options.parameters+="&"+this.options.defaultParams);new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:!0,partialChars:2,ignoreCase:!0,fullSearch:!1,selector:function(a){for(var c=[],d=[],e=a.getToken(),f=0;f<a.options.array.length&&c.length<a.options.choices;f++)for(var g=a.options.array[f],j=a.options.ignoreCase?g.toLowerCase().indexOf(e.toLowerCase()):
g.indexOf(e);j!=-1;){if(j==0&&g.length!=e.length){c.push("<li><strong>"+g.substr(0,e.length)+"</strong>"+g.substr(e.length)+"</li>");break}else if(e.length>=a.options.partialChars&&a.options.partialSearch&&j!=-1&&(a.options.fullSearch||/\s/.test(g.substr(j-1,1)))){d.push("<li>"+g.substr(0,j)+"<strong>"+g.substr(j,e.length)+"</strong>"+g.substr(j+e.length)+"</li>");break}j=a.options.ignoreCase?g.toLowerCase().indexOf(e.toLowerCase(),j+1):g.indexOf(e,j+1)}d.length&&(c=c.concat(d.slice(0,a.options.choices-
c.length)));return"<ul>"+c.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b;this.element=a=$(a);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(c);Object.extend(this.options,c||{});if(!this.options.formId&&this.element.id&&(this.options.formId=this.element.id+"-inplaceeditor",$(this.options.formId)))this.options.formId="";if(this.options.externalControl)this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)this.options.externalControlOnly=
!1;this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){this._editing&&
!a.ctrlKey&&!a.altKey&&!a.shiftKey&&(Event.KEY_ESC==a.keyCode?this.handleFormCancellation(a):Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a))},createControl:function(a,b,c){var d=this.options[a+"Control"],b=this.options[a+"Text"];if("button"==d){c=document.createElement("input");c.type="submit";c.value=b;c.className="editor_"+a+"_button";if("cancel"==a)c.onclick=this._boundCancelHandler;this._form.appendChild(c);this._controls[a]=c}else if("link"==d)d=document.createElement("a"),d.href=
"#",d.appendChild(document.createTextNode(b)),d.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler,d.className="editor_"+a+"_link",c&&(d.className+=" "+c),this._form.appendChild(d),this._controls[a]=d},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var c=this.options.size||this.options.cols||0;if(0<c)b.size=c}else b=document.createElement("textarea"),
b.rows=1>=this.options.rows?this.options.autoRows:this.options.rows,b.cols=this.options.cols||40;b.name=this.options.paramName;b.value=a;b.className="editor_field";if(this.options.submitOnBlur)b.onblur=this._boundSubmitHandler;this._controls.editor=b;this.options.loadTextURL&&this.loadExternalText();this._form.appendChild(this._controls.editor)},createForm:function(){function a(a,d){var e=b.options["text"+a+"Controls"];e&&d!==!1&&b._form.appendChild(document.createTextNode(e))}var b=this;this._form=
$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br"));if(this.options.onFormCustomization)this.options.onFormCustomization(this,this._form);a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",
this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(!this._saving&&!this._editing)this._editing=!0,this.triggerCallback("onEnterEditMode"),this.options.externalControl&&this.options.externalControl.hide(),this.element.hide(),
this.createForm(),this.element.parentNode.insertBefore(this._form,this.element),this.options.loadTextURL||this.postProcessEditField(),a&&Event.stop(a)},enterHover:function(){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML,
this._oldInnerHTML=null},handleFormCancellation:function(a){this.wrapUp();a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();b=this.options.callback(b,c)||"";Object.isString(b)&&(b=b.toQueryParams());b.editorId=this.element.id;this.options.htmlResponse?(c=Object.extend({evalScripts:!0},this.options.ajaxOptions),Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Updater({success:this.element},
this.url,c)):(c=Object.extend({method:"get"},this.options.ajaxOptions),Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Request(this.url,c));a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();this.options.externalControl&&this.options.externalControl.show();this._editing=
this._saving=!1;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=!0;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,
onSuccess:function(a){this._form.removeClassName(this.options.loadingClassName);a=a.responseText;this.options.stripLoadedTextTags&&(a=a.stripTags());this._controls.editor.value=a;this._controls.editor.disabled=!1;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a)$(this._controls.editor)["focus"==a?"focus":"activate"]()},prepareOptions:function(){this.options=
Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=!0;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;this.options.externalControlOnly||
this.element.observe(b.key,a);this.options.externalControl&&this.options.externalControl.observe(b.key,a)}.bind(this))},removeForm:function(){if(this._form)this._form.remove(),this._form=null,this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(a,b){if("function"==
typeof this.options[a])this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||this.element.stopObserving(a.key,a.value);this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,b,c,d){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(b,c,d)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText();this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);
this.showLoadingText(this.options.loadingCollectionText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){a=a.responseText.strip();if(!/^\[.*\]$/.test(a))throw"Server returned an invalid collection representation.";this._collection=eval(a);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,a)},
showLoadingText:function(a){this._controls.editor.disabled=!0;var b=this._controls.editor.firstChild;if(!b)b=document.createElement("option"),b.value="",this._controls.editor.appendChild(b),b.selected=!0;b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);
Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){this._text=a.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(a){return 2===a.length?a:[a,a].flatten()});var a="value"in this.options?this.options.value:this._text,
b=this._collection.any(function(b){return b[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(d,e){c=document.createElement("option");c.value=d[0];c.selected=b?d[0]==a:0==e;c.appendChild(document.createTextNode(d[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=!1;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(b,d){b in a||d===void 0||(a[b]=d)}a&&(b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":a.cancelLink==a.cancelButton==!1?!1:void 0),b("okControl",a.okLink?"link":a.okButton?"button":a.okLink==a.okButton==!1?!1:void 0),b("highlightColor",a.highlightcolor),b("highlightEndColor",a.highlightendcolor))};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:!1,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:!0,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:!1,submitOnBlur:!1,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:!0})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;a._effect&&a._effect.cancel()},onFailure:function(a){alert("Error communication with the server: "+
a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:!0})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||0.5;this.element=$(a);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(){if(this.lastValue!=$F(this.element))this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1E3),this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,
$F(this.element))}});if(!Control)var Control={};
Control.Slider=Class.create({initialize:function(a,b,c){var d=this;this.handles=Object.isArray(a)?a.collect(function(a){return $(a)}):[$(a)];this.track=$(b);this.options=c||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(a){return $(a)}):!1;this.options.startSpan=
$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||!1;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,
""):this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,"");this.disabled=this.dragging=this.active=!1;this.options.disabled&&this.setDisabled();if(this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):!1)this.minimum=this.allowedValues.min(),this.maximum=this.allowedValues.max();this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);
this.handles.each(function(a,b){b=d.handles.length-1-b;d.setValue(parseFloat((Object.isArray(d.options.sliderValue)?d.options.sliderValue[b]:d.options.sliderValue)||d.range.start),b);a.makePositioned().observe("mousedown",d.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=!0},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);
Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=!0},setEnabled:function(){this.disabled=!1},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max())return this.allowedValues.max();if(a<=this.allowedValues.min())return this.allowedValues.min();var b=Math.abs(this.allowedValues[0]-a),
c=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);e<=b&&(c=d,b=e)});return c}return a>this.range.end?this.range.end:a<this.range.start?this.range.start:a},setValue:function(a,b){if(!this.active)this.activeHandleIdx=b||0,this.activeHandle=this.handles[this.activeHandleIdx],this.updateStyles();b=b||this.activeHandleIdx||0;this.initialized&&this.restricted&&(b>0&&a<this.values[b-1]&&(a=this.values[b-1]),b<this.handles.length-1&&a>this.values[b+1]&&(a=this.values[b+1]));
a=this.getNearestValue(a);this.values[b]=a;this.value=this.values[0];this.handles[b].style[this.isVertical()?"top":"left"]=this.translateToPx(a);this.drawSpans();(!this.dragging||!this.event)&&this.updateFinished()},setValueBy:function(a,b){this.setValue(this.values[b||this.activeHandleIdx||0]+a,b||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(a-this.range.start))+"px"},translateToValue:function(a){return a/
(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(a){var b=this.values.sortBy(Prototype.K),a=a||0;return $R(b[a],b[a+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-
this.alignX},isVertical:function(){return this.axis=="vertical"},drawSpans:function(){var a=this;this.spans&&$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))});this.options.startSpan&&this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));this.options.endSpan&&this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(a,b){this.isVertical()?(a.style.top=
this.translateToPx(b.start),a.style.height=this.translateToPx(b.end-b.start+this.range.start)):(a.style.left=this.translateToPx(b.start),a.style.width=this.translateToPx(b.end-b.start+this.range.start))},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(a){if(Event.isLeftClick(a)){if(!this.disabled){this.active=!0;var b=Event.element(a),c=[Event.pointerX(a),Event.pointerY(a)];if(b==this.track)b=
this.track.cumulativeOffset(),this.event=a,this.setValue(this.translateToValue((this.isVertical()?c[1]-b[1]:c[0]-b[0])-this.handleLength/2)),b=this.activeHandle.cumulativeOffset(),this.offsetX=c[0]-b[0],this.offsetY=c[1]-b[1];else{for(;this.handles.indexOf(b)==-1&&b.parentNode;)b=b.parentNode;if(this.handles.indexOf(b)!=-1)this.activeHandle=b,this.activeHandleIdx=this.handles.indexOf(this.activeHandle),this.updateStyles(),b=this.activeHandle.cumulativeOffset(),this.offsetX=c[0]-b[0],this.offsetY=
c[1]-b[1]}}Event.stop(a)}},update:function(a){if(this.active){if(!this.dragging)this.dragging=!0;this.draw(a);Prototype.Browser.WebKit&&window.scrollBy(0,0);Event.stop(a)}},draw:function(a){var b=[Event.pointerX(a),Event.pointerY(a)],c=this.track.cumulativeOffset();b[0]-=this.offsetX+c[0];b[1]-=this.offsetY+c[1];this.event=a;this.setValue(this.translateToValue(this.isVertical()?b[1]:b[0]));if(this.initialized&&this.options.onSlide)this.options.onSlide(this.values.length>1?this.values:this.value,this)},
endDrag:function(a){this.active&&this.dragging&&(this.finishDrag(a,!0),Event.stop(a));this.dragging=this.active=!1},finishDrag:function(){this.dragging=this.active=!1;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange)this.options.onChange(this.values.length>1?this.values:this.value,this);this.event=null}});function $(a){Object.isString(a)&&(a=document.getElementById(a));return Element.extend(a)}if("undefined"!=typeof document.querySelectorAll)Element.prototype.select=function(a){a=this.querySelectorAll(a);return null===a?[]:a};Element.prototype.setStyle=function(a){if("string"==typeof a)this.style.cssText+=";"+a;else for(var b in a)this.style[b]=a[b]};Element.prototype.erase=function(){return null!==this.parentNode?(this.parentNode.removeChild(this),!0):!1};
Element.prototype.getElement=function(a){return this.querySelector("."+a)};Element.prototype.selectOne="undefined"!=typeof document.querySelector?function(a){return this.querySelector(a)}:function(a){return this.select(a)[0]};Element.prototype.getId=function(){return this.id};Element.prototype.getHeight=function(){return this.offsetHeight};Element.prototype.getWidth=function(){return this.offsetWidth};Element.prototype.load=function(a,b){new HfosAjax.Updater(this,a,b)};
Element.prototype.realOffset=function(){var a=0,b=0,c=this;if(c.offsetParent){do b=0==c.scrollTop?b+c.offsetTop:b+(c.offsetTop-c.scrollTop),a+=c.offsetLeft;while(c=c.offsetParent)}return[a,b]};Element.prototype.invisible=function(){this.style.visibility="hidden"};Element.prototype.put=function(){};Element.prototype.obtain=function(){};Function.prototype.shift=function(){var a=this,b=arguments;return function(){return a.apply(a,b)}};
Event.cancelBubble=function(a){a.cancelBubble=!0;a.returnValue=!1;a.stopPropagation&&(a.stopPropagation(),a.preventDefault())};var enable_upload_file=function(a){if(a){var b=$(a+"_span"),a=$(a+"_up");b&&a&&(b.show(),a.hide())}},cancel_upload_file=function(a){if(a){var b=$(a+"_span"),a=$(a+"_up");b&&a&&(b.hide(),a.show())}},upload_file=function(a){if(a){var b=$(a+"_span");if((a=$(a))&&b)a.value=b.value}};
var Json={encode:function(a){return"undefined"==typeof JSON?a.toJSON():JSON.stringify(a)},decode:function(a){return"undefined"==typeof JSON?a.evalJSON():JSON.parse(a)}};
var swfobject=function(){function a(){if(!v){try{var a=m.getElementsByTagName("body")[0].appendChild(m.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}v=!0;for(var a=B.length,c=0;c<a;c++)B[c]()}}function b(a){v?a():B[B.length]=a}function c(a){if(typeof p.addEventListener!=n)p.addEventListener("load",a,!1);else if(typeof m.addEventListener!=n)m.addEventListener("load",a,!1);else if(typeof p.attachEvent!=n)x(p,"onload",a);else if("function"==typeof p.onload){var b=p.onload;p.onload=
function(){b();a()}}else p.onload=a}function d(){var a=m.getElementsByTagName("body")[0],b=m.createElement(t);b.setAttribute("type",C);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=n){var f=c.GetVariable("$version");if(f)f=f.split(" ")[1].split(","),j.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)]}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}function e(){var a=s.length;if(0<a)for(var b=0;b<a;b++){var c=s[b].id,
d=s[b].callbackFn,e={success:!1,id:c};if(0<j.pv[0]){var k=q(c);if(k)if(D(s[b].swfVersion)&&!(j.wk&&312>j.wk)){if(w(c,!0),d)e.success=!0,e.ref=f(c),d(e)}else if(s[b].expressInstall&&g()){e={};e.data=s[b].expressInstall;e.width=k.getAttribute("width")||"0";e.height=k.getAttribute("height")||"0";if(k.getAttribute("class"))e.styleclass=k.getAttribute("class");if(k.getAttribute("align"))e.align=k.getAttribute("align");for(var m={},k=k.getElementsByTagName("param"),o=k.length,z=0;z<o;z++)"movie"!=k[z].getAttribute("name").toLowerCase()&&
(m[k[z].getAttribute("name")]=k[z].getAttribute("value"));h(e,m,c,d)}else l(k),d&&d(e)}else if(w(c,!0),d){if((c=f(c))&&typeof c.SetVariable!=n)e.success=!0,e.ref=c;d(e)}}}function f(a){var b=null;if((a=q(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=n?b=a:(a=a.getElementsByTagName(t)[0])&&(b=a);return b}function g(){return!E&&D("6.0.65")&&(j.win||j.mac)&&!(j.wk&&312>j.wk)}function h(a,b,c,d){E=!0;H=d||null;J={success:!1,id:c};var e=q(c);if(e){"OBJECT"==e.nodeName?(A=k(e),F=null):(A=e,F=c);a.id=
K;if(typeof a.width==n||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==n||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";m.title=m.title.slice(0,47)+" - Flash Player Installation";d=j.ie&&j.win?"ActiveX":"PlugIn";d="MMredirectURL="+p.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+m.title;b.flashvars=typeof b.flashvars!=n?b.flashvars+("&"+d):d;if(j.ie&&j.win&&4!=e.readyState)d=m.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",
c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}();o(a,b,c)}}function l(a){if(j.ie&&j.win&&4!=a.readyState){var b=m.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(k(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=m.createElement("div");if(j.win&&
j.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(t)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function o(a,b,c){var d,e=q(c);if(j.wk&&312>j.wk)return d;if(e){if(typeof a.id==n)a.id=c;if(j.ie&&j.win){var f="",g;for(g in a)if(a[g]!=Object.prototype[g])"data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=
" "+g+'="'+a[g]+'"');g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";G[G.length]=a.id;d=q(a.id)}else{h=m.createElement(t);h.setAttribute("type",C);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&
(a=h,g=f,k=b[f],c=m.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}}return d}function L(a){var b=q(a);if(b&&"OBJECT"==b.nodeName)j.ie&&j.win?(b.style.display="none",function(){if(4==b.readyState){var c=q(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b)}function q(a){var b=null;try{b=m.getElementById(a)}catch(c){}return b}
function x(a,b,c){a.attachEvent(b,c);y[y.length]=[a,b,c]}function D(a){var b=j.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function M(a,b,c,d){if(!j.ie||!j.mac){var e=m.getElementsByTagName("head")[0];if(e){c=c&&"string"==typeof c?c:"screen";d&&(I=r=null);if(!r||I!=c)d=m.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),r=e.appendChild(d),
j.ie&&j.win&&typeof m.styleSheets!=n&&0<m.styleSheets.length&&(r=m.styleSheets[m.styleSheets.length-1]),I=c;j.ie&&j.win?r&&typeof r.addRule==t&&r.addRule(a,b):r&&typeof m.createTextNode!=n&&r.appendChild(m.createTextNode(a+" {"+b+"}"))}}}function w(a,b){if(N){var c=b?"visible":"hidden";v&&q(a)?q(a).style.visibility=c:M("#"+a,"visibility:"+c)}}function O(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=n?encodeURIComponent(a):a}var n="undefined",t="object",C="application/x-shockwave-flash",
K="SWFObjectExprInst",p=window,m=document,u=navigator,P=!1,B=[function(){P?d():e()}],s=[],G=[],y=[],A,F,H,J,v=!1,E=!1,r,I,N=!0,j=function(){var a=typeof m.getElementById!=n&&typeof m.getElementsByTagName!=n&&typeof m.createElement!=n,b=u.userAgent.toLowerCase(),c=u.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\u000b1",f=[0,0,0],g=null;if(typeof u.plugins!=n&&typeof u.plugins["Shockwave Flash"]==
t){if((g=u.plugins["Shockwave Flash"].description)&&!(typeof u.mimeTypes!=n&&u.mimeTypes[C]&&!u.mimeTypes[C].enabledPlugin))P=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof p.ActiveXObject!=n)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(h&&(g=h.GetVariable("$version")))e=!0,g=g.split(" ")[1].split(","),
f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){j.w3&&((typeof m.readyState!=n&&"complete"==m.readyState||typeof m.readyState==n&&(m.getElementsByTagName("body")[0]||m.body))&&a(),v||(typeof m.addEventListener!=n&&m.addEventListener("DOMContentLoaded",a,!1),j.ie&&j.win&&(m.attachEvent("onreadystatechange",function(){"complete"==m.readyState&&(m.detachEvent("onreadystatechange",arguments.callee),a())}),p==top&&function(){if(!v){try{m.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),j.wk&&function(){v||(/loaded|complete/.test(m.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))})();(function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var a=y.length,b=0;b<a;b++)y[b][0].detachEvent(y[b][1],y[b][2]);a=G.length;for(b=0;b<a;b++)L(G[b]);for(var c in j)j[c]=null;j=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(j.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=
d;s[s.length]=e;w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(j.w3)return f(a)},embedSWF:function(a,c,d,e,f,k,l,m,q,p){var r={success:!1,id:c};j.w3&&!(j.wk&&312>j.wk)&&a&&c&&d&&e&&f?(w(c,!1),b(function(){d+="";e+="";var b={};if(q&&typeof q===t)for(var j in q)b[j]=q[j];b.data=a;b.width=d;b.height=e;j={};if(m&&typeof m===t)for(var x in m)j[x]=m[x];if(l&&typeof l===t)for(var s in l)j.flashvars=typeof j.flashvars!=n?j.flashvars+("&"+s+"="+l[s]):s+"="+l[s];if(D(f))x=o(b,j,c),b.id==
c&&w(c,!0),r.success=!0,r.ref=x;else{if(k&&g()){b.data=k;h(b,j,c,p);return}w(c,!0)}p&&p(r)})):p&&p(r)},switchOffAutoHideShow:function(){N=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:D,createSWF:function(a,b,c){if(j.w3)return o(a,b,c)},showExpressInstall:function(a,b,c,d){j.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){j.w3&&L(a)},createCSS:function(a,b,c,d){j.w3&&M(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=
m.location.search||m.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return O(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return O(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(E){var a=q(K);if(a&&A){a.parentNode.replaceChild(A,a);if(F&&(w(F,!0),j.ie&&j.win))A.style.display="block";H&&H(J)}E=!1}}}}();
var CoreAnimation=Class.create({complexLoop:function(a,b,c,d){var e=(new Date).getTime(),f=e+b,g=setInterval(function(){var h=(new Date).getTime();c(a,h>f?1:(h-e)/b,d);if(h>f&&(clearInterval(g),"function"==typeof d.afterFinish))d.afterFinish.element=a,d.afterFinish()},10)},loop:function(a,b,c,d,e){var f=(new Date).getTime(),g=f+c,h=setInterval(function(){var l=(new Date).getTime();d(a,1-(1-b)*(l>g?1:(l-f)/c));if(l>g&&(clearInterval(h),"function"==typeof e.afterFinish))e.afterFinish.element=a,e.afterFinish()},
10)},morph:function(a,b){var c=1E3*b.duration,a=$(a);if("undefined"!=b.style){var d=[],e=[],f=[],g;for(g in b.style)f.push(g),d.push(parseInt(b.style[g],10)),e.push(parseInt(a.style[g],10));delete b.style;b.styles=f;b.to=d;b.from=e;this.complexLoop(a,c,function(a,b,c){a.style.display="none";for(var d=c.styles.length,e=c.to,f=c.from,c=c.styles,g=0;g<d;g++)a.style[c[g]]=f[g]-(f[g]-e[g])*b+"px";a.style.display=""},b)}return this},opaque:function(a,b){var a=$(a),c=1E3*b.duration;parseInt(a.style.opacity,
10);this.loop(a,b.to,c,function(a,b){a.style.opacity=b},b);return this},scale:function(a,b){var a=$(a),c=1E3*b.duration;a.style.MozTransformOrigin="center center";this.loop(a,b.to,c,function(a,b){a.style.MozTransform="scale("+b+", "+b+")"},b);return this},rotate:function(a,b){a=$(a);this.loop(a,b.to,1E3*b.duration,function(a,b){a.setStyle("-moz-transform: rotate("+b+"deg)")},b);return this},skewX:function(a,b){a=$(a);this.loop(a,b.to,1E3*b.duration,function(a,b){a.setStyle("-moz-transform: skewX("+
b+"deg)")});return this},traslate3d:function(a){a.style.webkitTransform="translate3d(0, 0, 100px)"},scale2:function(a){a.style.MozTransitionDuration="4s"},morph2:function(a){a.style.MozTransitionProperty="width";a.style.MozTransitionDuration="5s";a.style.MozTransitionDelay="0s";a.style.width="900px"},flipX:function(a,b){a.addClassName("flipped-x");window.setTimeout(function(a,b){"undefined"!=typeof b.afterFinish&&b.afterFinish(this);a.removeClassName("flipped-x")}.bind(this,a,b),700)},flipY:function(a){a.addClassName("flipped-y")}});
var Hfos={_ui:null,_loaded:!1,_mode:"test",_consumer:"",_version:null,_shouldUpgrade:!1,_shortCutsActived:!1,_applications:{},_activeApplication:null,_numberApps:0,_screenSaver:null,_communications:null,_time:null,_animation:null,_welcomeBox:null,_upgradeBox:null,_activeContainerId:0,initialize:function(){!1==Hfos._loaded&&(new Event.observe(document,"dom:loaded",function(){Hfos._loadComponents();Hfos._addAppContainers();Hfos._loaded=!0;Hfos._communications.observe("endSession",Hfos.closeApp);window.onerror=
HfosException.showToDebug;"localhost"!=window.location.hostname&&document.body.observe("offline",Hfos._onOfflineMode)}),!1==window.location.toString().include("#")&&(window.location+="#"))},_loadBaseComponents:function(){Hfos._ui=new HfosUI;Hfos._animation=new CoreAnimation},_loadComponents:function(){Hfos._loadBaseComponents();Hfos._communications=new HfosCommunications;Hfos._productivity=new HfosProductivity;Hfos._time=new HfosTime},_addAppContainers:function(){for(var a=new Element("div",{id:"userSpace",
"class":"userSpace"}),b=0;7>b;b++)a.appendChild(new Element("div",{"class":"appContainer",id:"app-cont-"+b}));document.body.selectOne("div#mainContent").appendChild(a)},getNextContainerId:function(){var a=Hfos._activeContainerId;Hfos._activeContainerId++;return a},bootApp:function(a,b,c,d,e){Hfos.initialize();null!=Hfos._activeApplication&&Hfos._activeApplication.getCode()!=b&&Hfos._activeApplication.sleep();"undefined"==typeof Hfos._applications[b]?!1==Hfos._loaded?new Event.observe(document,"dom:loaded",
Hfos._delayedLoad.bind(this,a,b,c,d,e)):Hfos._delayedLoad(a,b,c,d,e):(Hfos._applications[b].wakeup(),Hfos._activeApplication=Hfos._applications[b])},closeOpenedApp:function(a){a=a.getCode();"undefined"!=typeof Hfos._applications[a]&&(Hfos._applications[a].sleep(),Hfos._numberApps--,0>=Hfos._numberApps?Hfos.closeApp():$H(Hfos._applications).each(function(a){a[1].wakeup();throw $break;}))},setConsumer:function(a){Hfos._consumer=a},getConsumer:function(){return Hfos._consumer},setVersion:function(a,
b){Hfos._version=a;Hfos._shouldUpgrade=b},shouldToUpgrade:function(){return Hfos._shouldUpgrade},setMode:function(a){Hfos._mode=a},getMode:function(){return Hfos._mode},getLoaded:function(){return Hfos._loaded},getApplication:function(){return Hfos._activeApplication},getApplications:function(){return Hfos._applications},_delayedLoad:function(a,b,c,d,e){a=new HfosApplication(a,b,c,d,e);Hfos._applications[b]=a;Hfos._activeApplication=a;Hfos._numberApps++;1==Hfos._numberApps&&Hfos._onFirstAppCreated(a)},
_onFirstAppCreated:function(){Hfos._communications.listen()},isSupportedNavigator:function(){var a=/Firefox\/([0-9]+)\.([0-5]+)/.exec(navigator.userAgent);return null==a?(a=/Chrome\/([0-9]+)\.([0-5]+)/.exec(navigator.userAgent),null==a?!1:!0):3<a[1]?!0:!1},checkForAuthToken:function(a,b){Hfos.initialize();if(Hfos.isSupportedNavigator())if(""==$("mainContent").innerHTML)new HfosAjax.JsonRequest("session/exists",{onSuccess:function(a,b,c){!1==c?new HfosLogin(a,b):b()}.bind(this,a,b)});else{var c=Utils.upperCaseFirst($Kumbia.controller);
eval("typeof "+c+' == "function"')&&eval("new "+c+'($("mainContent"))')}else Hfos._loadBaseComponents(),new HfosModal.customDialog({icon:"firefox48",title:"Navegador Incompatible",message:"Su navegador no es compatible con el sistema, por favor instale \u00f3 actualice a Mozilla Firefox 17.0",buttons:{Descargar:{action:function(){window.location="https://affiliates.mozilla.org/link/banner/1728/3/19"}}}})},activeShortcuts:function(){if(!1==Hfos._shortCutsActived)Hfos._shortCutsActived=!0,new Event.observe(window,
"keydown",HfosShortcuts.globalKeyUpHandler)},loadSource:function(a,b){var c=document.createElement("SCRIPT");c.type="text/javascript";c.src=$Kumbia.path+"javascript/hfos/"+a+".js";"undefined"!=typeof b&&c.observe("load",b);document.body.appendChild(c)},showWelcomeBox:function(){if(null==Hfos._welcomeBox)Hfos._welcomeBox=new HfosWelcomeBox},showUpgradeBox:function(){if(null==Hfos._upgradeBox)Hfos._upgradeBox=new HfosUpgradeBox},isWelcoming:function(){return null==Hfos._welcomeBox?!1:Hfos._welcomeBox.isOnCourse()},
isUpgrading:function(){return null==Hfos._upgradeBox?!1:Hfos._upgradeBox.isOnCourse()},showAccountData:function(){Hfos.getApplication().run({id:"win-useraccount",title:"Datos de la Cuenta",icon:"key.png",height:270,width:500,externAction:"identity/usuarios/config"})},_onOfflineMode:function(){new HfosModal.alert({title:"Alerta",message:"Su equipo est\u00e1 desconectado de la red y no puede acceder al servidor"})},getUI:function(){return Hfos._ui},getAnimation:function(){return Hfos._animation},getCommunications:function(){return Hfos._communications},
getProductivity:function(){return Hfos._productivity},closeApp:function(){Hfos.getUI().showScreenShadow();Hfos.getCommunications().stop();for(var a in Hfos._applications)Hfos._applications[a].hibernate();Hfos._waitForHibernate=window.setInterval(function(){var a=!0,c;for(c in Hfos._applications)"hibernate"!=Hfos._applications[c].getState()&&(a=!1);a&&(window.clearInterval(Hfos._waitForHibernate),new HfosAjax.JsonRequest("session/end",{onSuccess:function(){window.location=Utils.getAppURL("index")}}))},
200)}};var HfosTime=Class.create({initialize:function(){Hfos.getCommunications().observe("time",this.onMessage.bind(this))},onMessage:function(a){HfosNotifierServer.add(a.message);return!0}});
var HfosApplication=Class.create({_workspace:null,_menu:null,_status:"wakeup",_state:null,_sourcesLoaded:!1,_percentLoaded:0,_name:null,_code:null,_icon:null,_uri:null,_runtimeLoaded:null,_containerId:0,options:null,_hasAccess:!1,_virtualUser:null,_storage:null,initialize:function(a,b,c,d,e,f){this._name=a;this._code=b;"undefined"==typeof c?this._uri=$Kumbia.app:(this._uri=c,$Kumbia.app=c);this._icon=d;this._options=f;!1==e&&this._createWorkspace();this._runtimeLoaded=e;document.body.className=this._code;
this._loadSources();this._checkStability()},getContainerId:function(){return this._containerId},getAppContainer:function(){return document.body.selectOne("div#app-cont-"+this._containerId)},_createWorkspace:function(){if(null===this._menu)this._containerId=Hfos.getNextContainerId(),this._menu=new HfosMenu(this),this._workspace=new HfosWorkspace(this),this._loadState(),null!==this.options&&"undefined"!=typeof this.options.afterFinish&&this.options.afterFinish();this._setFavicon();this._setWindowTitle()},
_setWindowTitle:function(){document.title=this._name+" - "+Hfos.getConsumer()},_setFavicon:function(){if("undefined"!=typeof document.head){var a=$("favicon");a&&a.erase();a=document.createElement("LINK");a.id="favicon";a.type="text/png";a.rel="icon";a.href=$Kumbia.path+"img/backoffice/hover/"+this._icon;document.head.appendChild(a)}},_checkStability:function(){"production"!=Hfos.getMode()&&"localhost"!=window.location.host&&"127.0.0.1"!=window.location.host&&new HfosModal.alert({title:"Modo desarrollo y pruebas",
message:"La aplicaci\u00f3n no est\u00e1 en modo producci\u00f3n. En este momento puede tener un rendimiento menor y los problemas que se generen no ser\u00e1n reportados autom\u00e1ticamente. Consulte con soporte t\u00e9cnico para ajustar la configuraci\u00f3n."})},_loadSources:function(){!0==this._runtimeLoaded?(this._percentLoaded=0,new HfosAjax.JsonRequest("workspace/getSources",{parameters:"appCode="+this._code,onSuccess:function(a){if("OK"==a.status){var b=$A(a.sources);0<b.length&&this._loadSourceBatch(b,
0,a.mode,a.total)}else HfosNotifierServer.add(a.message)}.bind(this)})):this._sourcesLoaded=!0},_loadSourceBatch:function(a,b,c,d){if("js"==a[b].type){var e=document.createElement("SCRIPT");e.type="text/javascript";e.src="production"==c?$Kumbia.path+"javascript/hfos/production/"+a[b].name+".js?r="+parseInt(1E3*Math.random()):$Kumbia.path+"javascript/hfos/app/"+this._code+"/"+a[b].name+".js?r="+parseInt(1E3*Math.random());e.observe("load",function(a,b,c,d){a.length!=b+1&&this._loadSourceBatch(a,b+
1,c,d);this._notifySourceLoaded(a[b],d)}.bind(this,a,b,c,d));document.body.appendChild(e)}else if("css"==a[b].type)e=document.createElement("LINK"),e.type="text/css",e.rel="stylesheet",e.href="production"==c?$Kumbia.path+"css/hfos/app/"+a[b].name+".css?r="+parseInt(1E3*Math.random()):$Kumbia.path+"css/hfos/production/"+a[b].name+".css?r="+parseInt(1E3*Math.random()),document.body.appendChild(e),this._notifySourceLoaded(a[b],d)},_notifySourceLoaded:function(a,b){this._percentLoaded+=a.size/b;0.95<
this._percentLoaded&&this._createWorkspace()},_loadState:function(){this._hasAccess=!1;new HfosAjax.JsonRequest("workspace/getApplicationState",{parameters:"appCode="+this._code,onSuccess:function(a){if("undefined"==typeof a.options)this._noRoleAccess();else if("undefined"==typeof a.options.userRoles)this._noRoleAccess();else if("undefined"==typeof a.options.userRoles[this._code])this._noRoleAccess();else if("undefined"!=typeof a.options.passwordExpired?a.options.passwordExpired&&this._passwordExpired():
(this._hasAccess=!0,"PV"!=this._code&&"FO"!=this._code&&(!0==Hfos.shouldToUpgrade()?Hfos.showUpgradeBox():"undefined"==typeof a.options.welcome&&Hfos.showWelcomeBox())),this._state=a.state,this._virtualUser=new HfosVirtualUser(a.tokenId,a.options),!0==this._hasAccess)this._storage="test"==Hfos.getMode()?null:new HfosStorageDb(this,this._restore.bind(this)),this.fire("onHasAccess")}.bind(this)})},_noRoleAccess:function(){new HfosModal.alert({title:this._name,message:"No tiene perfiles asignados para trabajar en esta aplicaci\u00f3n. Consulte con un administrador del sistema",
onAccept:function(){this.forceClose()}.bind(this)})},_passwordExpired:function(){new HfosModal.alert({title:this._name,message:"Su contrase\u00f1a ha expirado, debe cambiar su contrase\u00f1a en este momento",onAccept:function(){Hfos.showAccountData()}.bind(this)})},forceClose:function(){Hfos.closeOpenedApp(this)},setState:function(a){new HfosAjax.JsonRequest("workspace/setApplicationState",{parameters:"appCode="+this._code+"&state="+a,onSuccess:function(a,c){"FAILED"==c.status?alert(c.message):this._state=
a}.bind(this,a)})},hasAccess:function(){return this._hasAccess},getState:function(){return this._state},getWorkspace:function(){return this._workspace},getMenu:function(){return this._menu},getStorage:function(){return"undefined"!==typeof this._storage?this._storage:null},setStorage:function(a){this._storage=a},getUri:function(){return this._uri},getCode:function(){return this._code},getName:function(){return this._name},getIcon:function(){return this._icon},getVirtualUser:function(){return this._virtualUser},
getUserOptions:function(){return this._userOptions},activeShortcuts:function(){Hfos.activeShortcuts()},loadSource:function(a,b){var c=document.createElement("SCRIPT");c.type="text/javascript";c.src=$Kumbia.path+"javascript/hfos/app/"+this._code+"/"+a+".js";c.observe("load",b);document.body.appendChild(c)},run:function(a){if(navigator.onLine||"hostname"!=window.location.hostname){"undefined"==typeof a.action&&"undefined"==typeof a.externAction&&new HfosModal.alert({title:this._name,message:"No se puede iniciar el proceso porque no se indic\u00f3 la acci\u00f3n a realizar"});
var b=this._workspace.getWindowManager();"undefined"!=typeof a.action?HfosAcl.checkPermission(a.action,b.createAndRun.bind(b,a)):HfosAcl.checkPermission(a.externAction,b.createAndRun.bind(b,a),!0)}else Hfos._onOfflineMode()},open:function(a){this._workspace.getWindowManager().create(a)},observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a,b,c){try{if(!Object.isUndefined(this["_"+a]))for(var d=0;d<this["_"+a].length;d++)if(!1===this["_"+a][d](this,
b,c))return!1;return!0}catch(e){HfosException.show(e)}},notify:function(a){switch(a){case "hibernateCompleted":this.setState("hibernate")}},sleep:function(){if("wakeup"==this._status)this._workspace.sleep(),this._status="sleep",this.setState("sleep")},wakeup:function(){if("sleep"==this._status)this._workspace.wakeup(),this._status="wakeup",$Kumbia.app=this._uri,this._setFavicon(),this._setWindowTitle(),this.setState("active")},hibernate:function(){this._workspace.hibernate()},_restore:function(){if("test"!=
Hfos.getMode())return null!==this._storage&&(this._storage.findAll("Objects",function(a){if(0<a.length){Hfos.getUI().blockInput();for(var b=[],c=0;c<a.length;c++)b[a[c].position]=a[c];for(c=0;c<b.length;c++)a=b[c],"undefined"!=typeof a&&this.open({id:a.id,state:a.state,title:a.title,y:a.y,x:a.x,width:a.width,height:a.height,icon:a.icon,content:a.content});Hfos.getUI().unblockInput()}}.bind(this)),this._storage.free()),!0;this.setState("active")}});
var HfosBindings={_objectBindings:{},late:function(a,b,c){"undefined"==typeof HfosBindings._objectBindings[a]&&(HfosBindings._objectBindings[a]={});"undefined"==typeof HfosBindings._objectBindings[a][b]&&(HfosBindings._objectBindings[a][b]=[]);HfosBindings._objectBindings[a][b].push(c)},get:function(a){return"undefined"!=typeof HfosBindings._objectBindings[a]?HfosBindings._objectBindings[a]:null},fire:function(){}};
var HfosProcess={_onCompleteIFrame:function(){},liveJsonForm:function(a,b){var c=document.createElement("IFRAME"),d="iframe"+parseInt((new Date).getTime());c.name=d;c.hide();document.body.appendChild(c);var e=document.createElement("FORM");e.target=d;e.method=a.getAttribute("method");e.action=a.getAttribute("action");e.hide();document.body.appendChild(c);for(var d=a.getInputs(),f=0;f<d.length;f++){var g=document.createElement("INPUT");g.type="hidden";g.name=d[f].name;g.value=d[f].getValue();e.appendChild(g[f])}c.observe("load",
HfosProcess._onCompleteIFrame(c,e,b));e.submit();if("undefined"!=typeof b.onLoading)b.onLoading()}};
var HfosProcessContainer=Class.create({_container:null,_ignoreTermSignal:!1,_messages:null,_window:null,setContainer:function(a){this._container=a;"undefined"!=typeof this._container.tagName?this._setWindow(a):this._window=a;this._container!=this&&this._container.observe("beforeClose",this._onCloseProcess.bind(this))},getContainer:function(){return this._container},setState:function(a){if("undefined"!=typeof this._container.setState)return this._container.setState(a)},getState:function(){return"undefined"!=
typeof this._container.getState?this._container.getState():null},go:function(a,b){return"undefined"!=typeof this._container.go?this._container.go(a,b):this._container.load(a,b)},hideStatusBar:function(){if("undefined"!=typeof this._container.hideStatusBar)this._container.hideStatusBar();else{var a=$("processStatusBar");a&&a.hide()}},showStatusBar:function(a){if("undefined"!=typeof this._container.showStatusBar)this._container.showStatusBar(a);else{var b=$("processStatusBar");b||(b=document.createElement("DIV"),
b.setAttribute("id","processStatusBar"),document.body.appendChild(b));b.update(a)}},getStatusBarElement:function(a){if("undefined"!=typeof this._container.showStatusBar)return this._container.getStatusBar().getElement(a);var b=$("processStatusBar");return b?b.getElement(a):null},scrollToTop:function(){"undefined"!=typeof this._container.scrollToTop?this._container.scrollToTop():document.body.scrollTop=0},scrollToBottom:function(){"undefined"!=typeof this._container.scrollToTop?this._container.scrollToBottom():
document.body.scrollTop=document.body.offsetHeight},select:function(a){return this._container.select(a)},selectOne:function(a){return this._container.selectOne(a)},getId:function(){return this._container.id},getElement:function(a){return this._container.getElement(a)},getContentElement:function(){return null!==this._container?"undefined"!=typeof this._container.getContentElement?this._container.getContentElement():document.body:document.body},getSpaceElement:function(){return"undefined"!=typeof this._container.getSpaceElement?
this._container.getSpaceElement():document.body},getMessages:function(){if(null==this._messages)this._messages=new HfosMessages(this);return this._messages},observe:function(a,b){null!==this._window&&this._window.observe(a,b)},_setWindow:function(a){for(var a=a.ancestors(),b=0;b<a.length;b++)if(a[b].hasClassName("window-main")){this._window=Hfos.getApplication().getWorkspace().getWindowManager().getWindow(a[b].id);break}},_notifyContentChange:function(){null!==this._window&&this._window.notify("contentChanged")},
setIgnoreTermSignal:function(a){this._ignoreTermSignal=a},_onCloseProcess:function(){return!0==this._ignoreTermSignal?(new HfosModal.alert({title:this._container.getTitle(),message:"No se puede cerrar la ventana porque est\u00e1 ocupada realizando un proceso"}),!1):!0}});
var HfosException={showRemote:function(a){var b=a.responseText;if(b){if("{"==b.substring(0,1)){var c=Json.decode(b),b="<b>JsonRemoteException > "+c.type+":</b> ",b=b+(c.message+"<br>");if("undefined"!=typeof c.trace)for(var d=0,e=c.trace.length;d<e;d++)"undefined"!=typeof c.trace[d].file&&(b+=c.trace[d].file+"("+c.trace[d].line+")<br>")}else""==b&&(b="function"==typeof a.getAllHeaders?"<pre>"+a.getAllHeaders()+"</pre>"+b:"No hay informaci\u00f3n del error");try{if("production"==Hfos.getMode()){if("undefined"!=
typeof b&&b){var f=a.getResponseHeader("X-Socorro-Reported"),g=a.getResponseHeader("X-Socorro-Reason");HfosPanic.launchCrashReport(b,f,g)}}else{var h=$("debugFailure");""==h.innerHTML?h.update("<b>Kernel Panic</b><br/>"+b):h.innerHTML+=b;h.show()}}catch(l){alert(l)}}},show:function(a,b){var c=[];if(a.stack)for(var d=a.stack.split("\n"),e=0,f=d.length;e<f;e++)c.push(d[e]);"production"==Hfos.getMode()?"undefined"!=typeof b&&b.responseText.include("Allowed memory")?new HfosModal.alert({title:"Memoria Insuficiente",
message:"El servidor no tiene memoria suficiente para completar el proceso requerido. Si es un reporte intente generarlo a otro formato. Si es un proceso intente ejecutarlo cuando no hayan otros usuarios trabajando"}):(d="","function"==typeof Hfos.toSource&&(d=Hfos.toSource()),"undefined"!=typeof b?(e=b.getResponseHeader("X-Socorro-Reported"),f=b.getResponseHeader("X-Socorro-Reason"),HfosPanic.launchCrashReport(a+" "+c.join("\n")+" "+b.responseText+"\n"+d,e,f)):HfosPanic.launchCrashReport(a+" "+c.join("\n")+
"\n"+d,null,null)):(c="<pre>Exception: "+a+" "+c.join("\n")+"</pre>",$("debugException").show(),$("debugException").innerHTML+=c,"undefined"!=typeof b&&($("debugException").innerHTML+=b.responseText),$("debugException").innerHTML+='<div align="right"><a href="#" onclick="$(\'debugException\').update(\'\')">[Clear]</a></div>')},showSilent:function(a){if("production"==Hfos.getMode())HfosPanic.silentCrashReport(a);else{var b=[];if(a.stack)for(var c=a.stack.split("\n"),d=0,e=c.length;d<e;d++)b.push(c[d]);
a="<pre>SilentException: "+a+" "+b.join("\n")+"</pre>";$("debugException").show();$("debugException").innerHTML+=a;"undefined"!=typeof transport&&($("debugException").innerHTML+=transport.responseText);$("debugException").innerHTML+='<div align="right"><a href="#" onclick="$(\'debugException\').update(\'\')">[Clear]</a></div>'}},showToDebug:function(a,b,c){if("undefined"!=typeof b)if("production"==Hfos.getMode()){if(b.include("cloudfront")||a.include("too much recursion")||a.include("Script error."))return!1;
var d="";"function"==typeof Hfos.toSource&&(d=Hfos.toSource());HfosPanic.launchCrashReport("UncaughtException: "+a+" "+b+"@"+c+"\n"+d,null,null)}else a="<pre>UncaughtException: "+a+" "+b+"@"+c+"</pre>",$("debugException").show(),$("debugException").innerHTML+=a,$("debugException").innerHTML+="<a href=\"#\" onclick=\"$('debugException').update('')\">[Clear]</a>"},showWorkerError:function(a){var b="",c=[];if(a.stack){for(var b=a.stack.split("\n"),d=0,e=b.length;d<e;d++)c.push(b[d]);b=c.join("\n")}"production"==
Hfos.getMode()?HfosPanic.launchCrashReport("UncaughtException: "+a.message+" "+a.filename+"@"+a.line+" "+b,null,null):($("debugException").show(),$("debugException").innerHTML+=a.message,$("debugException").innerHTML+="<a href=\"#\" onclick=\"$('debugException').update('')\">[Clear]</a>")}};
var HfosCoreDump={_dumpSymbol:function(a,b){if(32>b){if(Object.isElement(a))return"#<Element:"+a.tagName+" "+a.id+">";if("object"==typeof a){if(Object.isArray(a))return"Array";if("undefined"!=typeof a._debuggable){var c=0,d={};$H(a).each(function(a){if("function"!=typeof a[1]&&(Object.isElement(a[1])?d[a[0]]="#<Element:"+a[1].tagName+" "+a[1].id+">":"object"==typeof a[1]?Object.isArray(a[1])?d[a[0]]="Array":"undefined"!=typeof a[1]._debuggable?d[a[0]]=Object.inspect($H(a[1])):(b++,d[a[0]]=HfosCoreDump._dumpSymbol(a[1],
b),b--):d[a[0]]=Object.inspect(a[1]),c++,31<c))return d._incomplete=!0,d});return d}}return Object.inspect(a)}return"RangeError "+b},dump:function(){var a={},b=Hfos.getApplications();a.apps=HfosCoreDump._dumpSymbol(b,0,0);return JSON.stringify(a)}};
var HfosPanic={_errorReport:null,_reported:{},_buildCrashBox:function(a){var b=WindowUtilities.getWindowScroll(document.body),b=(WindowUtilities.getPageSize(document.body).windowWidth-600-b.left)/2;if(5<document.body.select("div.crash-report").length)return new HfosModal.alert({title:"CrashReport",message:"Se ha producido un problema en la aplicaci\u00f3n. El asistente de env\u00edo de errores ha dejado de funcionar."}),null;var c=document.createElement("DIV");c.addClassName("crash-report");c.update(a);
c.setStyle({left:b+"px"});document.body.appendChild(c);return c},launchCrashReport:function(a,b){HfosPanic._errorReport=a;Hfos.getUI().showScreenShadow(0.2);null===b?new HfosAjax.Request("socorro/crash",{onSuccess:function(a){if(""!=a.responseText&&(a=HfosPanic._buildCrashBox(a.responseText),null!==a)){var b=a.selectOne("input#sendButton");null!==b&&b.observe("click",HfosPanic._sendReport);a=a.selectOne("input#missButton");null!==a&&a.observe("click",HfosPanic._closeCrashReport)}}}):new HfosAjax.Request("socorro/wasCrash",
{onSuccess:function(a){""!=a.responseText&&(a=HfosPanic._buildCrashBox(a.responseText),null!==a&&a.selectOne("input#missButton").observe("click",HfosPanic._closeCrashReport))}})},silentCrashReport:function(){},_sendReport:function(){var a=document.body.getElement("crash-report");a.selectOne("div#sendMessage").show();a.selectOne("div#buttonPanel").hide();if(null!==HfosPanic._errorReport){var b=hex_md5(HfosPanic._errorReport).toLowerCase();"undefined"==typeof HfosPanic._reported[b]?(new HfosAjax.JsonRequest("socorro/sendReport",
{parameters:"report="+Base64.encode(HfosPanic._errorReport),onSuccess:function(b,d){if("yes"==d.getResponseHeader("X-Socorro-Reported"))a.selectOne("div#sendMessage").update("Gracias!"),window.setTimeout(function(){HfosPanic._closeCrashReport()},2E3);else{a.selectOne("div#problemDescription").hide();a.selectOne("div#sendMessage").hide();if("email-problem"==d.getResponseHeader("X-Socorro-Reason")){var e=d.getResponseHeader("X-Socorro-File");a.selectOne("a#logFile").href=e;a.selectOne("div#emailDescription").show()}else a.selectOne("div#unknownDescription").show();
a.selectOne("div#buttonPanel").show();e=a.selectOne("input#sendButton");null!==e&&e.hide();e=a.selectOne("input#missButton");null!==e&&e.setValue("Cerrar")}}}),HfosPanic._reported[b]=!0):(a.selectOne("div#sendMessage").update("Ya se hab\u00eda informado"),window.setTimeout(function(){HfosPanic._closeCrashReport()},2E3))}},_closeCrashReport:function(){HfosPanic._errorReport=null;document.body.getElement("crash-report").erase();Hfos.getUI().hideScreenShadow()}};
var HfosUpgradeBox=Class.create({_position:1,_upgradeBox:null,_onCourse:!0,initialize:function(){!0==this._onCourse&&new HfosAjax.ApplicationRequest("identity/upgrade",{parameters:"appCode="+Hfos.getApplication().getCode(),onSuccess:function(a){Hfos.getUI().showScreenShadow(0.15);var b=Hfos.getApplication().getWorkspace();window.setTimeout(function(a){a.getToolbar().hide()}.bind(this,b),1500);var c=document.createElement("DIV");c.setAttribute("id","upgradeBox");c.update(a.responseText);c.hide();b.getSpaceElement().appendChild(c);
Hfos.getUI().centerAtScreen(c);c.select("a.finishButton").each(function(a){a.observe("click",this.startUpgrade.bind(this))}.bind(this));this._upgradeBox=c;new Effect.Appear(c,{duration:2})}.bind(this)})},moveLeft:function(){new Effect.Move("upgradePages",{duration:0.5,x:870})},moveRight:function(){new Effect.Move("upgradePages",{duration:0.5,x:-870})},startUpgrade:function(){this.moveRight();this.doUpgrade();window.setInterval(function(){var a=this._upgradeBox.selectOne("div.part"+this._position);
new Effect.Appear(a,{duration:1.2});this._position++;if(5==this._position){this._position=1;var b=0.5;this._upgradeBox.select("div.part").reverse().each(function(a){new Effect.Fade(a,{duration:b});b+=0.1})}}.bind(this),1500)},doUpgrade:function(){new HfosAjax.JsonApplicationRequest("identity/upgrade/doUpgrade",{onSuccess:function(){this._upgradeBox.hide();this._upgradeBox.erase();Hfos.getApplication().getWorkspace().getToolbar().show();Hfos.getUI().hideScreenShadow();this._onCourse=!1}.bind(this)})},
isOnCourse:function(){return this._onCourse}});
var HfosWelcomeBox=Class.create(HfosProcessContainer,{_onCourse:!0,initialize:function(){!0==this._onCourse&&new HfosAjax.ApplicationRequest("identity/welcome",{onSuccess:function(a){var b=Hfos.getApplication().getWorkspace().getWindowManager();!0!=b.hasModalWindow()&&b.setModalWindow(this,function(a){var b=document.createElement("DIV");b.setAttribute("id","welcomeBox");b.update(a.responseText);Hfos.getApplication().getWorkspace().getSpaceElement().appendChild(b);Hfos.getUI().centerAtScreen(b);b.hide();
b.select("a.prevButton").each(function(a){a.observe("click",this.moveLeft.bind(this))}.bind(this));b.select("a.nextButton").each(function(a){a.observe("click",this.moveRight.bind(this))}.bind(this));b.select("a.finishButton").each(function(a){a.observe("click",this.finishTour.bind(this))}.bind(this));Hfos.getUI().showScreenShadow();new Effect.Appear(b,{duration:0.3})}.bind(this,a))}.bind(this)})},moveLeft:function(){new Effect.Move("welcomePages",{duration:0.5,x:870})},moveRight:function(){new Effect.Move("welcomePages",
{duration:0.5,x:-870})},finishTour:function(){if(!0==this._onCloseProcess()){var a=$("welcomeBox");a&&new Effect.Fade(a,{duration:0.3,afterFinish:function(a){Hfos.getUI().hideScreenShadow();Hfos.getApplication().getWorkspace().getWindowManager().removeModalWindow();a.erase();new HfosAjax.ApplicationRequest("identity/workspace/setPageCheck",{parameters:"pageName=welcome"});this._onCourse=!1}.bind(this,a)})}},close:function(){this.finishTour()},sendKeyEvent:function(a){a.keyCode==Event.KEY_LEFT?this.moveLeft():
a.keyCode==Event.KEY_RIGHT&&this.moveRight()},isOnCourse:function(){return this._onCourse}});var HfosDOMSerializer={serialize:function(a){return Base64.encode(a)}};var hexcase=0,b64pad="";function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function b64_md5(a){return rstr2b64(rstr_md5(str2rstr_utf8(a)))}function any_md5(a,b){return rstr2any(rstr_md5(str2rstr_utf8(a)),b)}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}
function b64_hmac_md5(a,b){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function any_hmac_md5(a,b,c){return rstr2any(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}
function rstr_hmac_md5(a,b){var c=rstr2binl(a);16<c.length&&(c=binl_md5(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=binl_md5(d.concat(rstr2binl(b)),512+8*b.length);return binl2rstr(binl_md5(e.concat(c),640))}function rstr2hex(a){"undefined"==typeof hexcase&&(hexcase=0);for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d,e=0;e<a.length;e++)d=a.charCodeAt(e),c+=b.charAt(d>>>4&15)+b.charAt(d&15);return c}
function rstr2b64(a){"undefined"==typeof b64pad&&(b64pad="");for(var b="",c=a.length,d=0;d<c;d+=3)for(var e=a.charCodeAt(d)<<16|(d+1<c?a.charCodeAt(d+1)<<8:0)|(d+2<c?a.charCodeAt(d+2):0),f=0;4>f;f++)b=8*d+6*f>8*a.length?b+b64pad:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return b}
function rstr2any(a,b){var c=b.length,d,e,f,g,h,l=Array(Math.ceil(a.length/2));for(d=0;d<l.length;d++)l[d]=a.charCodeAt(2*d)<<8|a.charCodeAt(2*d+1);var k=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2))),o=Array(k);for(e=0;e<k;e++){h=[];for(d=g=0;d<l.length;d++)if(g=(g<<16)+l[d],f=Math.floor(g/c),g-=f*c,0<h.length||0<f)h[h.length]=f;o[e]=g;l=h}c="";for(d=o.length-1;0<=d;d--)c+=b.charAt(o[d]);return c}
function str2rstr_utf8(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&56319>=d&&56320<=e&&57343>=e&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binl(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<c%32;return b}
function binl2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}
function binl_md5(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16)var h=c,l=d,k=e,o=f,c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,
1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+
10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+
11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,
c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,
d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,l),e=safe_add(e,k),f=safe_add(f,o);return[c,d,e,f]}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}
function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}var Base64={encode:function(a){return window.btoa(a)},decode:function(a){return window.atob(a)}};
for(var HfosSettings=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this.getElement("saveButton").observe("click",this._saveSettings.bind(this));this.getElement("formPannel")&&new HfosTabs(this,"tabbed")},_saveSettings:function(){var a=this.getElement("settingsForm");new HfosAjax.JsonFormRequest(a,{onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?this.getMessages().success("Se actualiz\u00f3 correctamente la configuraci\u00f3n"):
this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}}),settingsWindows=["win-settings-contab","win-settings-inve","win-settings-nomina","win-settings-tpc","win-settings-socios"],i=0;i<settingsWindows.length;i++)HfosBindings.late(settingsWindows[i],"afterCreate",function(a){new HfosSettings(a)});
var HfosStorageDb=Class.create({_application:null,_db:null,initialize:function(a,b){this._application=a;this._openDatabase(b)},_openDatabase:function(a){if(null==this._db)if("undefined"==typeof window.mozIndexedDB)null===window.sessionStorage.getItem("shouldUpdateNotify")&&window.sessionStorage.setItem("shouldUpdateNotify",!0),this._application.setStorage(null);else{var b=this._application.getVirtualUser().getToken(),b="hfos-ux10-"+this._application.getCode()+"-"+b,b=window.mozIndexedDB.open(b,1,
"HFOS recovery workspace data");b.onupgradeneeded=this._onUpgradeNeeded.bind(this,b);b.onsuccess=this._onOpenDatabase.bind(this,b,a);b.onerror=this._onError.bind(this,b)}},_onUpgradeNeeded:function(a,b){if(1===b.newVersion&&b.target.transaction){var c=b.target.transaction.db;c.createObjectStore("Objects",{keyPath:"id"}).createIndex("id","id",{unique:!0});c.createObjectStore("HyperForms",{keyPath:"id"}).createIndex("id","id",{unique:!0});c.createObjectStore("HyperGrids",{keyPath:"id"}).createIndex("id",
"id",{unique:!0});c.createObjectStore("HyperSearch",{keyPath:"id"}).createIndex("id","id",{unique:!0});c=c.createObjectStore("InputFields",{keyPath:"id"});c.createIndex("id","id",{unique:!0});c.createIndex("containerKey","containerKey",{unique:!1})}},_onOpenDatabase:function(a,b,c){c=c.target.result;"function"==typeof c.setVersion?this._application.setStorage(null):(this._db=c,this._application.setStorage(this),a.onerror=this._onGenericError.bind(this),"function"==typeof b&&b())},_onGenericError:function(a){var b=
0,b="undefined"!=typeof a.errorCode?a.errorCode:100;1<b&&("undefined"!=typeof a.target?(HfosException.showSilent("Silent-Exception: "+$H(a.target).inspect().replace("<","")),a.preventDefault()):HfosException.showSilent(a))},_onError:function(){new HfosModal.confirm({title:this._application.getName(),message:"No autoriz\u00f3 el almacenamiento local para el sistema. Si su equipo se apaga inesperadamente no podr\u00e1 recuperar su trabajo. \u00bfDesea autorizarlo ahora?",onAccept:function(){this._application.setStorage(null);
this._openDatabase()}.bind(this)})},save:function(a,b,c){if(null!==this._db){var d="undefined"!=typeof IDBTransaction.READ_WRITE?this._db.transaction(a,IDBTransaction.READ_WRITE):this._db.transaction(a,"readwrite");d.onerror=this._onGenericError.bind(this);a=d.objectStore(a).put(b);a.onerror=this._onGenericError.bind(this);if("function"==typeof c)a.onsuccess=c}else"function"==typeof c&&c()},remove:function(a,b,c){if(null!==this._db){var d="undefined"!=typeof IDBTransaction.READ_WRITE?this._db.transaction(a,
IDBTransaction.READ_WRITE):this._db.transaction(a,"readwrite");d.onerror=this._onGenericError.bind(this);a=d.objectStore(a).delete(b);a.onerror=this._onGenericError.bind(this);if("function"==typeof c)a.onsuccess=c}else"function"==typeof c&&c()},findFirst:function(a,b,c){if(null!==this._db&&(a=this._db.transaction(a).objectStore(a).get(b),a.onerror=this._onGenericError.bind(this),"function"==typeof c))a.onsuccess=function(a,b){try{a(b.result)}catch(c){HfosException.show(c)}}.bind(this,c,a)},findAll:function(a,
b){if(null!==this._db){var c=this._db.transaction(a).objectStore(a).openCursor();c.onerror=this._onGenericError.bind(this);c.onsuccess=function(a,b,c){try{var g=c.target.result;g?(b.push(g.value),g.continue()):"function"==typeof a&&a(b)}catch(h){HfosException.show(h)}}.bind(this,b,[])}},findAllBy:function(a,b,c,d){if(null!==this._db){var e=IDBKeyRange.only(c);this._db.transaction(a).objectStore(a).index(b).openCursor(e).onsuccess=function(a,b,c,d){try{var e=d.target.result;e?(b.push(e.value),e.continue()):
"function"==typeof c&&c(b)}catch(o){HfosException.show(o)}}.bind(this,c,[],d)}},free:function(){}});
var HfosBgProcess=Class.create({_worker:null,_options:{},initialize:function(){this._worker=new Worker($Kumbia.path+"javascript/hfos/kernel/smp/worker.js");this._worker.onmessage=this._onMessage.bind(this);this._worker.onerror=HfosException.show;this._postMessage({action:"initialize",path:$Kumbia.path})},request:function(a,b){HfosBgProcess._options=b;this._postMessage({action:"request",url:a,options:b})},_postMessage:function(a){a=Json.encode(a);this._worker.postMessage(a)},_onMessage:function(a){a=
Json.decode(a.data);switch(a.action){case "readyState":HfosHttpReadyState.onReadyStateChange(a,HfosBgProcess._options);4==a.readyState&&(this._worker.terminate(),delete this._worker);break;case "debug":"undefined"!=typeof window.console&&window.console.log(a.value)}}});var HfosVirtualUser=Class.create({_token:{},_options:{},initialize:function(a,b){this._token=a;this._options=b},getToken:function(){return this._token},getOptions:function(){return this._options}});
var HfosUserAccount=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this.selectOne("input#submitButton").observe("click",this._cambiarClaveUsuario.bind(this));this.selectOne("input#password_actual").activate()},_cambiarClaveUsuario:function(){var a=this.selectOne("input#password_actual"),b=this.selectOne("input#password_nuevo"),c=this.selectOne("input#password_nuevo_confirm"),d="";a&&(d=a.getValue());a="";b&&(a=
b.getValue());b="";c&&(b=c.getValue());new HfosAjax.JsonApplicationRequest("identity/usuarios/cambioClave",{parameters:"password_actual="+d+"&password_nuevo="+a+"&password_nuevo_confirm="+b,onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==a.status?(this.getMessages().success(a.message),window.setTimeout(function(){var a=Hfos.getApplication();"undefined"!=typeof a.getVirtualUser().getOptions().passwordExpired&&new HfosModal.alert({title:a.getName(),
message:"Se va a reiniciar la sesi\u00f3n para refrescar sus credenciales",onAccept:function(){Hfos.closeApp()}})},1500)):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}});HfosBindings.late("win-useraccount","afterCreate",function(a){new HfosUserAccount(a)});
var HfosWallet={_secureWallet:{},has:function(a){return"undefined"==typeof HfosWallet._secureWallet[a]?!1:HfosWallet._secureWallet[a]},store:function(a,b){HfosWallet._secureWallet[a]=b}};
var HfosUac={_element:null,requestElevation:function(a,b){WindowUtilities.getWindowScroll(document.body);WindowUtilities.getPageSize(document.body);var c=document.createElement("DIV");c.addClassName("modalLayout");c.id="modalLayout";c.innerHTML="<table width='100%'><tr><td id='imgCon' valign='top'><img src='"+$Kumbia.path+"img/backoffice/blank.gif' class='lock32'/></td><td><h1>Cambio de Usuario</h1><h2>Puede cambiar temporalmente de usuario para ejecutar la acci\u00f3n que estaba realizando. Indique un usuario que tenga privilegios suficientes para realizar esta acci\u00f3n.</h2></td></tr><tr><td align='right' colspan='2'><table class='loginUAC'><tr><td align='right'><b>Usuario</b></td><td><input type='text' id='login' autocomplete='off'></tr><tr><td align='right'><b>Password</b></td><td><input type='password' id='password'/></tr></td></table></td><tr><td align='right' colspan='2'><div class='buttonContainer'><table><tr><td><input type='button' value='Cerrar' class='controlButton controlButtonShadow' id='acceptButton'></td><td><input type='button' value='Cambiar de Usuario' class='controlButton controlButtonShadow' id='authButton'></td><td><div class='loadUAC' style='display:none'></div></td></tr></table></div></td></tr></table>";
document.body.appendChild(c);Hfos.getUI().centerAtScreen(c);Hfos.getUI().showScreenShadow();c.selectOne("input#acceptButton").observe("click",HfosUac.removeDialog);c.selectOne("input#authButton").observe("click",HfosUac.approveElevation.bind(this,a,b));c.selectOne("input#login").activate();new Draggable(c);HfosUac._element=c},approveElevation:function(a,b){HfosUac._element.getElement("loadUAC").show();HfosUac._element.selectOne("input#acceptButton").disable();HfosUac._element.selectOne("input#authButton").disable();
var c=HfosUac._element.selectOne("input#login"),d=HfosUac._element.selectOne("input#password");new HfosAjax.JsonRequest("gardien/elevate",{parameters:"resource="+a+"&login="+c.getValue()+"&password="+d.getValue(),onSuccess:function(a,b,c){"OK"==c.status?(HfosUac.removeDialog(),b()):"FAILED"==c.status&&(new Effect.Shake(HfosUac._element,{duration:0.5}),HfosUac._element.getElement("loadUAC").hide(),HfosUac._element.selectOne("input#acceptButton").enable(),HfosUac._element.selectOne("input#authButton").enable(),
HfosUac._element.selectOne("input#login").activate())}.bind(this,a,b)})},removeDialog:function(){HfosUac._element.erase();HfosUac._element=null;Hfos.getUI().hideScreenShadow()}};
var HfosAcl={handleFailedCheck:function(a,b,c){var d=Hfos.getApplication();!1==a.elevation?new HfosModal.alert({title:d.getName(),message:"No tiene permisos suficientes para: "+a.description}):new HfosModal.customDialog({icon:"alert48",title:d.getName(),message:"No tiene permisos suficientes para: "+a.description,buttons:{Autenticar:{action:function(a,b,c){c.acceptDefault();HfosUac.requestElevation(a,b)}.bind(this,b,c)},Cerrar:{action:function(a){a.acceptDefault()}}}})},checkPermission:function(a,
b,c){new HfosAjax.JsonRequest("gardien/check",{parameters:"undefined"==typeof c?"resource="+a:"externResource="+a,onSuccess:function(a,b,c){"OK"==c.status?b():"FAILED"==c.status&&HfosAcl.handleFailedCheck(c.accessInfo,a,b)}.bind(this,a,b)})}};
var HfosConsole=Class.create(HfosProcessContainer,{_contentElement:null,_commandElement:null,_commandListElement:null,_commands:[],_pointer:0,initialize:function(a){this._contentElement=a.getContentElement();this._contentElement.addClassName("consoleBackground");this._contentElement.observe("click",this._onFocusConsole.bind(this));this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){this._commandElement=this.selectOne("input#command");this._commandListElement=this.selectOne("div#commands");
this._commandElement.observe("keyup",this._sendCommand.bind(this));this._commandElement.activate();var a=window.sessionStorage.getItem("consoleCommands");if(null!==a)this._commands=JSON.parse(a),this._pointer=this._commands.length},_onFocusConsole:function(){this._commandElement.activate()},_updateConsole:function(a){var b=document.createElement("DIV");b.className="history";b.update(a);this._commandListElement.appendChild(b);for(var a=this._commandListElement.select("pre"),b=this._container.getWidth()-
50,c=0;c<a.length;c++)a[c].getWidth()>b&&a[c].setStyle({width:b+"px"});this._contentElement.scrollTop=this._contentElement.scrollHeight;this._notifyContentChange()},_sendCommand:function(a){a.keyCode==Event.KEY_UP&&("undefined"!=typeof this._commands[this._pointer-1]?(this._pointer--,this._commandElement.setValue(this._commands[this._pointer])):this._commandElement.setValue(""));a.keyCode==Event.KEY_DOWN&&("undefined"!=typeof this._commands[this._pointer+1]?(this._pointer++,this._commandElement.setValue(this._commands[this._pointer])):
this._commandElement.setValue(""));if(a.keyCode==Event.KEY_RETURN)if(a=this._commandElement.getValue().strip(),""==a)this._updateConsole('<span class="prompt">HFOS> </span><br/>'),this._commandElement.setValue("");else if("exit"==a)Hfos.getApplication().getWorkspace().getWindowManager().getActiveWindow().close();else if("clear"==a)this._commandListElement.innerHTML="",this._commandElement.setValue("");else if("history"==a){for(a=0;a<this._commands.length;a++)this._updateConsole(a+" "+this._commands[a]);
this._commandElement.setValue("")}else this._updateConsole('<span class="prompt">HFOS> </span>'+a+"<br/>"),new HfosAjax.ApplicationRequest("identity/console/execute",{parameters:{command:a},onLoading:function(){this._commandElement.setValue("Ejecutando...");this._commandElement.disable()}.bind(this),onSuccess:function(a){this._updateConsole(a.responseText)}.bind(this),onComplete:function(a){this._commandElement.enable();this._commandElement.setValue("");this._commands.push(a);this._pointer=this._commands.length;
window.sessionStorage.setItem("consoleCommands",JSON.stringify(this._commands))}.bind(this,a)})}});HfosBindings.late("win-console","afterCreateOrRestore",function(a){new HfosConsole(a)});
var CKEDITOR_BASEPATH=$Kumbia.path+"javascript/ckeditor/",HfosMail=Class.create({_element:null,_badgeElement:null,_inboxElement:null,_productivity:null,_editorLoaded:!1,_lastMessageId:null,initialize:function(a){this._productivity=a;this._inboxElement=a.getLeftPanel().getElement("inbox-div");this._badgeElement=this._inboxElement.getElement("badge");this._inboxElement.observe("click",this._getInbox.bind(this));this._composeElement=a.getLeftPanel().getElement("compose-div");this._composeElement.observe("click",
this._getCompose.bind(this,null,null));this._sentElement=a.getLeftPanel().getElement("sent-div");this._sentElement.observe("click",this._getSent.bind(this));this._trashElement=a.getLeftPanel().getElement("trash-div");this._trashElement.observe("click",this._getTrash.bind(this));this._getMessageCount()},_getRightPanel:function(){return this._productivity.getRightPanel()},_getInbox:function(){new HfosAjax.ApplicationRequest("identity/mail/getInbox",{checkAcl:!0,onSuccess:function(a){this._getRightPanel().update(a.responseText);
this._addBoxCallbacks();this._adjustPanels();window.setTimeout(function(){this._getMessageCount()}.bind(this),2E3)}.bind(this)})},_getCompose:function(a,b){new HfosAjax.ApplicationRequest("identity/mail/getCompose",{checkAcl:!0,parameters:{action:a,messageId:b},onSuccess:function(a){this._getRightPanel().update(a.responseText);this._addComposeCallbacks();this._initializeEditor();this._adjustPanels()}.bind(this)})},_getSent:function(){new HfosAjax.ApplicationRequest("identity/mail/getSent",{checkAcl:!0,
onSuccess:function(a){this._getRightPanel().update(a.responseText);this._addBoxCallbacks();this._adjustPanels()}.bind(this)})},_getTrash:function(){new HfosAjax.ApplicationRequest("identity/mail/getTrash",{checkAcl:!0,onSuccess:function(a){this._getRightPanel().update(a.responseText);this._addBoxCallbacks();this._adjustPanels()}.bind(this)})},_initializeEditor:function(){if(!1==this._editorLoaded){var a=document.createElement("SCRIPT");a.src=$Kumbia.path+"javascript/ckeditor/ckeditor.js";a.observe("load",
function(){this._setEditorToContent();this._editorLoaded=!0}.bind(this));document.body.appendChild(a)}else this._setEditorToContent()},_setEditorToContent:function(){if($("content")){"undefined"!=typeof CKEDITOR.instances.content&&delete CKEDITOR.instances.content;var a=WindowUtilities.getPageSize(document.body);CKEDITOR.replace("content",{language:"es",uiColor:"#EAEAEA",height:a.windowHeight-353,toolbar:[["Styles","Format"],["Bold","Italic","Strike"],["Cut","Copy","Paste","PasteText","PasteFromWord"],
"NumberedList,BulletedList,-,Outdent,Indent,Blockquote".split(","),["Link","Unlink","Anchor"],"/","Undo,Redo,-,Find,Replace,-,SelectAll,RemoveFormat".split(","),"Image,Table,HorizontalRule,Smiley,SpecialChar,PageBreak".split(",")]})}},_addBoxCallbacks:function(){var a=this._getRightPanel(),b=a.getElement("window-close");if(null!==b){b.observe("click",this._closePanel.bind(this));b=a.getElement("seleccionar");b.observe("click",this._selectMessages.bind(this,b));b=a.getElement("seleccionarCheck");b.observe("click",
this._selectMessagesCheck.bind(this,b));(b=a.getElement("responder"))&&b.observe("click",this._answerMessage.bind(this));(b=a.getElement("reenviar"))&&b.observe("click",this._forwardMessage.bind(this));(b=a.getElement("suprimir"))&&b.observe("click",this._deleteMessage.bind(this));(b=a.getElement("suprimirDefinitivo"))&&b.observe("click",this._deleteDefinitiveMessage.bind(this));(b=a.getElement("restaurar"))&&b.observe("click",this._restoreMessage.bind(this));a.getElement("marcarLeido").observe("click",
this._markReadMessage.bind(this));a.getElement("marcarNoLeido").observe("click",this._markUnreadMessage.bind(this));a=a.getElement("mailTable").select("tbody tr");for(b=0;b<a.length;b++){for(var c=a[b].select("td"),d=1;5>=d;d++)c[d].observe("click",this._openMessage.bind(this,a[b]));c=a[b].selectOne('input[type="checkbox"]');c.observe("click",this._selectRow.bind(this,c,a[b]));(c=a[b].selectOne("img.delete"))&&c.observe("click",this._deleteThisMessage.bind(this,a[b]))}}},_addComposeCallbacks:function(){var a=
["to","cc"],b=this._getRightPanel(),c=b.getElement("window-close");if(c){c.observe("click",this._closePanel.bind(this));b.getElement("send").observe("click",this._sendMessage.bind(this));b.getElement("discard").observe("click",this._closePanel.bind(this));for(c=0;c<a.length;c++){var d=b.selectOne("#"+a[c]);new Ajax.Autocompleter(d,a[c]+"_choices",Utils.getURL("identity/mail/getDirectory"),{paramName:"id",minChars:2,tokens:[","],afterUpdateElement:function(a){$(a+"_choices").removeClassName("autocomplete");
$(a+"_choices").addClassName("autocomplete")}.bind(this,a[c])});d.observe("keyup",function(){var a=this.value.strip().length,a=23*(parseInt(a/95)+1);new Effect.Morph(this,{style:{height:a+"px"}})})}}},_sendMessage:function(){var a=this._getRightPanel();""==a.selectOne("textarea#to").getValue().strip()?new HfosModal.alert({title:"Redactar Mensaje",message:"Indique al menos un destinatario del correo"}):""==a.selectOne("input#subject").getValue().strip()?new HfosModal.confirm({title:"Redactar Mensaje",
message:"El mensaje no tiene asunto. \u00bfDesea confirmar de todas maneras?",onAccept:function(){this._deliveryMessage()}.bind(this)}):this._deliveryMessage()},_deliveryMessage:function(){var a=this._getRightPanel();new HfosAjax.JsonApplicationRequest("identity/mail/delivery",{checkAcl:!0,parameters:{to:a.selectOne("textarea#to").getValue(),cc:a.selectOne("textarea#cc").getValue(),subject:a.selectOne("input#subject").getValue(),content:CKEDITOR.instances.content.document.getBody().getHtml()},onSuccess:function(a){"OK"==
a.status?this._getInbox():"FAILED"==a.status&&new HfosModal.alert({title:"Redactar Mensaje",message:a.message})}.bind(this)})},_selectMessagesCheck:function(a){a.checked?this._selectAll():this._selectNone()},_selectMessages:function(a){switch(a.getValue()){case "A":this._selectAll();break;case "N":this._selectNone();break;case "R":this._selectRead();break;case "U":this._selectUnread();break;default:this._selectNone()}},_selectAll:function(){for(var a=this._getRightPanel().getElement("mailTable").select("tbody tr"),
b=0;b<a.length;b++){var c=a[b].selectOne('input[type="checkbox"]');c.checked=!0;this._selectRow.bind(this,c,a[b])()}},_selectNone:function(){for(var a=this._getRightPanel().getElement("mailTable").select("tbody tr"),b=0;b<a.length;b++){var c=a[b].selectOne('input[type="checkbox"]');c.checked=!1;this._selectRow.bind(this,c,a[b])()}},_selectRead:function(){for(var a=this._getRightPanel().getElement("mailTable").select("tbody tr"),b=0;b<a.length;b++){var c=a[b].selectOne('input[type="checkbox"]');c.checked=
a[b].hasClassName("unread")?!1:!0;this._selectRow.bind(this,c,a[b])()}},_selectUnread:function(){for(var a=this._getRightPanel().getElement("mailTable").select("tbody tr"),b=0;b<a.length;b++){var c=a[b].selectOne('input[type="checkbox"]');c.checked=a[b].hasClassName("unread")?!0:!1;this._selectRow.bind(this,c,a[b])()}},_answerMessage:function(){null!==this._lastMessageId&&this._getCompose("answer",this._lastMessageId)},_forwardMessage:function(){null!==this._lastMessageId&&this._getCompose("forward",
this._lastMessageId)},_deleteThisMessage:function(a){new HfosAjax.JsonApplicationRequest("identity/mail/delete",{checkAcl:!0,parameters:"messages[]="+a.id,onSuccess:this._onDeleteOrRestoreMessages.bind(this,[a.id])})},_deleteMessage:function(){var a=this._getRowsChecked(),b=0<a.length?this._getRowsCheckedQueryString():"messages[]="+this._getRightPanel().getElement("selected-this").id;new HfosAjax.JsonApplicationRequest("identity/mail/delete",{parameters:b,checkAcl:!0,onSuccess:this._onDeleteOrRestoreMessages.bind(this,
a)})},_restoreMessage:function(){var a=this._getRowsChecked(),b=0<a.length?this._getRowsCheckedQueryString():"messages[]="+this._getRightPanel().getElement("selected-this").id;new HfosAjax.JsonApplicationRequest("identity/mail/restore",{parameters:b,checkAcl:!0,onSuccess:this._onDeleteOrRestoreMessages.bind(this,a)})},_deleteDefinitiveMessage:function(){var a=this._getRowsChecked(),b=0<a.length?this._getRowsCheckedQueryString():"messages[]="+this._getRightPanel().getElement("selected-this").id;new HfosAjax.JsonApplicationRequest("identity/mail/deleteDefinitive",
{checkAcl:!0,parameters:b,onSuccess:this._onDeleteOrRestoreMessages.bind(this,a)})},_markReadMessage:function(){var a=this._getRowsChecked(),b=0<a.length?this._getRowsCheckedQueryString():"messages[]="+this._getRightPanel().getElement("selected-this").id;new HfosAjax.JsonApplicationRequest("identity/mail/markRead",{checkAcl:!0,parameters:b,onSuccess:this._onMarkReadMessages.bind(this,a)})},_markUnreadMessage:function(){var a=this._getRowsChecked(),b=0<a.length?this._getRowsCheckedQueryString():"messages[]="+
this._getRightPanel().getElement("selected-this").id;new HfosAjax.JsonApplicationRequest("identity/mail/markUnread",{checkAcl:!0,parameters:b,onSuccess:this._onMarkUnreadMessages.bind(this,a)})},_onMarkReadMessages:function(a){if(0<a.length)for(var b=0;b<a.length;b++){var c=$(a[b]);c&&c.removeClassName("unread")}else a=this._getRightPanel().getElement("selected-this"),null!=a&&a.removeClassName("unread");window.setTimeout(function(){this._getMessageCount()}.bind(this),2E3)},_onMarkUnreadMessages:function(a){if(0<
a.length)for(var b=0;b<a.length;b++){var c=$(a[b]);c&&c.addClassName("unread")}else a=this._getRightPanel().getElement("selected-this"),null!=a&&a.addClassName("unread");window.setTimeout(function(){this._getMessageCount()}.bind(this),2E3)},_onDeleteOrRestoreMessages:function(a){if(0<a.length)for(var b=0;b<a.length;b++){var c=$(a[b]);c&&c.erase()}else a=this._getRightPanel().getElement("selected-this"),null!=a&&a.erase();this._getRightPanel().getElement("mailContent").update("");this._adjustPanels();
this._enableButtons();window.setTimeout(function(){this._getMessageCount()}.bind(this),2E3)},_selectThisRow:function(a){for(var b=this._getRightPanel().getElement("mailTable").select("tbody tr.selected-this"),c=0;c<b.length;c++)b[c].removeClassName("selected-this");a.addClassName("selected-this")},_openMessage:function(a){this._lastMessageId=a.id;a.removeClassName("unread");this._selectThisRow(a);new HfosAjax.ApplicationRequest("identity/mail/openMessage",{checkAcl:!0,parameters:{sid:a.id},onSuccess:function(a){this._getRightPanel().getElement("mailContent").update(a.responseText);
this._adjustPanels();this._enableButtons();window.setTimeout(function(){this._getMessageCount()}.bind(this),2E3)}.bind(this)})},_getRowsChecked:function(){for(var a=[],b=this._getRightPanel().getElement("mailTable").select('tbody input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a.push(b[c].up(1).id);return a},_getRowsCheckedQueryString:function(){for(var a=[],b=this._getRightPanel().getElement("mailTable").select('tbody input[type="checkbox"]'),c=0;c<b.length;c++)b[c].checked&&a.push("messages[]="+
b[c].up(1).id);return a.join("&")},_enableButtons:function(){var a=this._getRightPanel(),b=a.getElement("mailContent"),c=this._getRowsChecked().length,d="responder,reenviar,restaurar,suprimirDefinitivo,suprimir,marcarLeido,marcarNoLeido".split(",");if(""!=b.innerHTML||1<=c)for(b=0;b<d.length;b++)(c=a.getElement(d[b]))&&c.enable();else for(b=0;b<d.length;b++)(c=a.getElement(d[b]))&&c.disable()},_selectRow:function(a,b){a.checked?b.addClassName("selected"):b.removeClassName("selected");this._enableButtons()},
_closePanel:function(){this._getRightPanel().update("");this._productivity.selectNone()},_adjustPanels:function(){var a=WindowUtilities.getPageSize(document.body),b=this._getRightPanel().getElement("mailContent");if(b){var c=this._getRightPanel().getElement("mailPreviews");""==b.innerHTML?(b.hide(),c.setStyle({height:a.windowHeight-103+"px"})):(b.show(),c.setStyle({height:a.windowHeight/2-99+"px"}),b.setStyle({height:a.windowHeight/2-11+"px"}),window.setTimeout(function(){var a=this._getRightPanel().getElement("iframeContent");
a.setStyle({overflowY:"hidden",height:a.contentWindow.document.body.offsetHeight+70+"px"})}.bind(this),500))}else(b=this._getRightPanel().getElement("mailCompose"))&&b.setStyle({height:a.windowHeight-103+"px"})},_getMessageCount:function(){new HfosAjax.JsonApplicationRequest("identity/mail/getMessageCount",{onSuccess:function(a){"OK"==a.status&&(0==a.unread?new Effect.Fade(this._badgeElement):(this._badgeElement.update(a.unread),new Effect.Appear(this._badgeElement)),0==a.trash?this._trashElement.setStyle({backgroundImage:"url("+
$Kumbia.path+"img/backoffice/bin-metal.png)"}):this._trashElement.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/bin-metal-full.png)"}),0==a.inbox?this._inboxElement.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/inbox.png)"}):this._inboxElement.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/inbox-document.png)"}))}.bind(this)})}});
var HfosProductivity=Class.create({_leftPanel:null,_rightPanel:null,_element:null,_mail:null,initialize:function(){},_canGetMail:function(){null==this._mail&&new HfosAjax.JsonApplicationRequest("identity/productivity/canGetMail",{checkAcl:!0,onSuccess:function(a){if("OK"==a.status)"undefined"!=typeof a.notMailUser?!0==a.notMailUser?this._requestFrontCredentials():this._mail=new HfosMail(this):this._mail=new HfosMail(this)}.bind(this)})},_addCallbacks:function(){this._panelItems=document.body.select("div.left-panel-item");
for(var a=0;a<this._panelItems.length;a++)this._panelItems[a].observe("click",this._selectPanelItem.bind(this,this._panelItems[a]))},selectNone:function(){for(var a=0;a<this._panelItems.length;a++)this._panelItems[a].removeClassName("active")},_selectPanelItem:function(a){this.selectNone();a.addClassName("active")},show:function(){null==this._leftPanel&&new HfosAjax.ApplicationRequest("identity/productivity/getPanel",{checkAcl:!1,onSuccess:function(a){var b=document.createElement("DIV");b.setAttribute("id",
"left-panel");b.addClassName("left-panel");b.update(a.responseText);document.body.appendChild(b);this._leftPanel=b;b=document.createElement("DIV");b.setAttribute("id","right-panel");b.addClassName("right-panel");document.body.appendChild(b);this._rightPanel=b;this._addCallbacks();this.adjustPanels();this._canGetMail()}.bind(this)})},_requestFrontCredentials:function(){new HfosAjax.ApplicationRequest("identity/productivity/requestFrontCredentials",{onSuccess:function(a){var b=document.createElement("DIV");
b.addClassName("uacLayout");b.id="uacLayout";b.innerHTML=a.responseText;document.body.appendChild(b);Hfos.getUI().centerAtScreen(b);Hfos.getUI().showScreenShadow();b.selectOne("input#acceptButton").observe("click",this._closeRequest.bind(this));b.selectOne("input#authButton").observe("click",this._validateCredentials.bind(this));b.selectOne("input#noHaveFrontAccount").observe("click",this._changeUserType.bind(this));b.selectOne("input#haveFrontAccount").observe("click",this._changeUserType.bind(this));
b.selectOne("input#password").activate();new Draggable(b);this._element=b;(!0==Hfos.isUpgrading()||!0==Hfos.isWelcoming())&&this._closeRequest()}.bind(this)})},_changeUserType:function(){var a=this._element.selectOne("#haveUserForm");this._element.selectOne("input#noHaveFrontAccount").checked?a.hide():a.show()},_removeDialog:function(){this._element.erase();this._element=null;Hfos.getUI().hideScreenShadow()},_closeRequest:function(){this._removeDialog();new HfosAjax.ApplicationRequest("identity/productivity/noMailUser",
{checkAcl:!1,onSuccess:function(a){$("right-panel").update(a.responseText)}})},_validateCredentials:function(){var a=this._element.selectOne("input#haveFrontAccount").checked?"Y":"N";new HfosAjax.JsonApplicationRequest("identity/productivity/linkAccount",{parameters:{frontAccount:a,usuarioFrontId:this._element.selectOne("select#usuarioFrontId").getValue(),password:this._element.selectOne("input#password").getValue()},onSuccess:function(a,c){"FAILED"==c.status?"Y"==a?new Effect.Shake(this._element,
{afterFinish:function(a){this._element.selectOne("#"+a.field).activate()}.bind(this,c)}):new HfosModal.alert({title:"Enlace de cuentas",message:c.message}):(this._removeDialog(),this._canGetMail())}.bind(this,a)})},adjustPanels:function(){this._rightPanel.setStyle({width:WindowUtilities.getPageSize(document.body).windowWidth-220+"px"})},getLeftPanel:function(){return this._leftPanel},getRightPanel:function(){return this._rightPanel}});
var HfosUI=Class.create({_shadow:null,_blockInput:null,_numberShadows:0,showScreenShadow:function(a){if(null==this._shadow)this._shadow=document.createElement("DIV"),this._shadow.addClassName("screen-shadow"),this._shadow.observe("click",function(a){new Event.stop(a)}),document.body.appendChild(this._shadow);"undefined"!=typeof a&&this._shadow.setOpacity(a);this._shadow.show();this._numberShadows++},hideScreenShadow:function(){this._numberShadows--;if(null!==this._shadow&&0>=this._numberShadows)this._shadow.hide(),
this._numberShadows=0},blockInput:function(){if(null==this._blockInput)this._blockInput=document.createElement("DIV"),this._blockInput.addClassName("block-input"),document.body.appendChild(this._blockInput);this._blockInput.show()},unblockInput:function(){null!==this._blockInput&&this._blockInput.hide()},setBackground:function(a){document.body.style.background="url("+$Kumbia.path+"img/backoffice/wall/"+a+")"},centerAtScreen:function(a){var b=WindowUtilities.getWindowScroll(document.body),c=WindowUtilities.getPageSize(document.body),
d=(c.windowWidth-a.getWidth()-b.left)/2,b=(c.windowHeight-a.getHeight()-b.top)/3;a.style.left=d+"px";a.style.top=b+"px"}});
var HfosModal={zIndex:5002,_modals:[],remove:function(a){for(var b=HfosModal._modals.length-1;0<=b;b--)if("undefined"!=typeof HfosModal._modals[b]&&HfosModal._modals[b]==a){HfosModal._modals[b].getElement().erase();delete HfosModal._modals[b];break}HfosModal._onRemove()},_remove:function(){if(0<HfosModal.getLength()){for(var a=HfosModal._modals.length-1;0<=a;a--)if("undefined"!=typeof HfosModal._modals[a]){HfosModal._modals[a].getElement().erase();delete HfosModal._modals[a];break}HfosModal._onRemove()}},
_onRemove:function(){0==HfosModal.getLength()&&(Hfos.getUI().hideScreenShadow(),HfosShortcuts.enable(),HfosModal._onWindowKey&&new Event.stopObserving(window,"keydown",HfosModal._onWindowKey))},_onWindowKey:function(a){a.keyCode==Event.KEY_RETURN?HfosModal.getTopDialog().getFocusButton().click():a.keyCode==Event.KEY_ESC?HfosModal._remove():a.keyCode==Event.KEY_LEFT?HfosModal.getTopDialog().moveLeft():a.keyCode==Event.KEY_RIGHT&&HfosModal.getTopDialog().moveRight();new Event.stop(a);new Event.cancelBubble(a);
return!1},getTopDialog:function(){for(var a=HfosModal._modals.length-1;0<=a;a--)if("undefined"!=typeof HfosModal._modals[a])return HfosModal._modals[a]},getLength:function(){for(var a=0,b=HfosModal._modals.length-1;0<=b;b--)"undefined"!=typeof HfosModal._modals[b]&&a++;return a},add:function(a){HfosModal._modals.push(a);1==HfosModal.getLength()&&(HfosShortcuts.disable(),Hfos.getUI().showScreenShadow(),new Event.observe(window,"keydown",HfosModal._onWindowKey))},Types:{ALERT:1,CONFIRM:2,ERROR:3,EVENT:4,
CUSTOM:5}};
HfosModal.Dialog=Class.create({_options:{},_element:null,_acceptButton:null,_buttons:null,_focusIndex:0,initialize:function(a,b){var c=$(document.createElement("DIV"));c.addClassName("modalLayout");c.id="modal-"+HfosModal.zIndex;c.style.zIndex=HfosModal.zIndex;var d="<table width='100%'><tr><td id='imgCon'><img src='"+$Kumbia.path+"img/backoffice/blank.gif' class='";b==HfosModal.Types.ALERT?d+="alert48":b==HfosModal.Types.CONFIRM?d+="info48":b==HfosModal.Types.EVENT?d+="event48":b==HfosModal.Types.CUSTOM&&"undefined"!=
typeof a.icon&&(d+=a.icon);d+="'/></td><td><h1>"+a.title+"</h1><h2>"+a.message+"</h2></td></tr><tr><td align='right' colspan='2'>";b==HfosModal.Types.ALERT?d+="<div class='buttonContainer'><input type='button' value='Aceptar' class='controlButton controlButtonShadow' id='acceptButton'></div>":b==HfosModal.Types.CONFIRM?(d+="<div class='buttonContainer'><input type='button' value='Cancelar' class='controlButtonCancel' id='cancelButton'></div>",d+="<div class='buttonContainer'><input type='button' value='Aceptar' class='controlButton controlButtonShadow' id='acceptButton'></div>"):
b==HfosModal.Types.EVENT?d+="<div class='buttonContainer'><input type='button' value='Cerrar' class='controlButton controlButtonShadow' id='acceptButton'></div>":b==HfosModal.Types.CUSTOM&&("undefined"!=typeof a.showAccept&&a.showAccept&&(d+="<div class='buttonContainer'><input type='button' value='Aceptar' class='controlButton controlButtonShadow' id='acceptButton'></div>"),"undefined"!=typeof a.buttons&&$H(a.buttons).each(function(a){d+="<div class='buttonContainer'><input type='button' value='"+
a[0]+"' ";typeof a[1].className&&(d+="class='"+a[1].className+"'");d+=" id='btn"+a[0]+"'></div>"}));d+="</td></tr></table>";c.innerHTML=d;document.body.appendChild(c);new Draggable(c);this._element=c;HfosModal.zIndex++;Hfos.getUI().centerAtScreen(c);b==HfosModal.Types.CUSTOM&&"undefined"!=typeof a.buttons&&$H(a.buttons).each(function(a){c.selectOne("input#btn"+a[0]).observe("click",a[1].action.bind(this,this))}.bind(this));var e=c.selectOne("input#acceptButton");if(e)e.observe("click",HfosModal.remove.bind(this,
this)),"undefined"!=typeof a.onAccept&&e.observe("click",a.onAccept),this._acceptButton=e;b==HfosModal.Types.CONFIRM&&(e=c.selectOne("input#cancelButton"),e.observe("click",HfosModal.remove.bind(this,this)),e.addClassName("default"));this._options=a;this._focusIndex=0;this._buttons=this._element.select('input[type="button"]');HfosModal.add(this)},focusButton:function(a){for(var b=0;b<this._buttons.length;b++)b==a?this._buttons[b].addClassName("default"):this._buttons[b].removeClassName("default")},
moveLeft:function(){0<this._focusIndex&&(this._focusIndex--,this.focusButton(this._focusIndex))},moveRight:function(){this._focusIndex<this._buttons.length-1&&(this._focusIndex++,this.focusButton(this._focusIndex))},acceptDefault:function(){HfosModal.remove.bind(this,this)()},getFocusButton:function(){return this._buttons[this._focusIndex]},getElement:function(){return this._element}});HfosModal.confirm=function(a){new HfosModal.Dialog(a,HfosModal.Types.CONFIRM)};
HfosModal.alert=function(a){new HfosModal.Dialog(a,HfosModal.Types.ALERT)};HfosModal.customDialog=function(a){new HfosModal.Dialog(a,HfosModal.Types.CUSTOM)};HfosModal.showEvent=function(a){new HfosModal.Dialog(a,HfosModal.Types.EVENT)};
var WindowUtilities={getWindowScroll:function(a){var b,c,d,a=a||document.body;if(a!=document.body)b=a.scrollTop,c=a.scrollLeft,d=a.scrollWidth,a=a.scrollHeight;else{a=window;if(a.document.documentElement&&a.document.documentElement.scrollTop)b=a.document.documentElement.scrollTop,c=a.document.documentElement.scrollLeft;else if(a.document.body)b=a.document.body.scrollTop,c=a.document.body.scrollLeft;a.innerWidth?(d=a.innerWidth,a=a.innerHeight):a.document.documentElement&&a.document.documentElement.clientWidth?
(d=a.document.documentElement.clientWidth,a=a.document.documentElement.clientHeight):(d=a.document.body.offsetWidth,a=a.document.body.offsetHeight)}return{top:b,left:c,width:d,height:a}},getPageSize:function(a){var a=a||document.body,b,c,d;if(a!=document.body)b=a.getWidth(),c=a.getHeight(),d=a.scrollWidth,a=a.scrollHeight;else{window.innerHeight&&window.scrollMaxY?(d=document.body.scrollWidth,a=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(d=document.body.scrollWidth,
a=document.body.scrollHeight):(d=document.body.offsetWidth,a=document.body.offsetHeight);if(self.innerHeight)b=self.innerWidth,c=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)b=document.documentElement.clientWidth,c=document.documentElement.clientHeight;else if(document.body)b=document.body.clientWidth,c=document.body.clientHeight;a=a<c?c:a;d=d<b?b:d}return{pageWidth:d,pageHeight:a,windowWidth:b,windowHeight:c}}};
var HfosWindow=Class.create({_element:null,_headerElement:null,_closeElement:null,_minimizeElement:null,_resizeElement:null,_contentElement:null,_titleElement:null,_titleBarElement:null,_statusBarElement:null,_windowManager:null,_subprocess:null,_status:"normal",_state:null,_position:-1,_wasRestored:!1,_parameters:"",_title:"",_handlerDragCache:null,_resizeOffset:[],initialize:function(a,b){try{var c=a.getSpaceElement();if(c.selectOne("div#"+b.id))return a.setActiveWindow(this,!0),!1;b.width=parseInt(b.width,
10)||900;b.height=parseInt(b.height,10)||560;var d=WindowUtilities.getWindowScroll(c),e=WindowUtilities.getPageSize(c),f=(e.windowWidth-b.width-d.left)/2,g=(e.windowHeight-b.height-d.top-35)/2;b.y=b.y||g;b.x=b.x||f;b.parameters=b.parameters||"";b.y=13>b.y?13:b.y+a.getOffsetTop();b.x=10>b.x?10:b.x+a.getOffsetLeft();if(g+b.height>c.getHeight()-50)b.height=c.getHeight()-60;this._element=document.createElement("DIV");this._element.addClassName("window-main");this._element.setStyle({top:b.y+"px",left:b.x+
"px",width:b.width+"px",height:b.height+"px"});this._element.id=b.id;this._element.update(this.getSkeleton());this._element.observe("click",a.setActiveWindow.bind(a,this,!1));this._titleElement=this._element.getElement("window-title-bar");if("undefined"!=typeof b.icon)this._titleElement.addClassName("window-icon"),this._titleElement.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/hover/"+b.icon+")"}),this._icon=b.icon;this._titleElement.update(b.title);this._titleBarElement=this._element.getElement("window-header-se");
this._titleBarElement.observe("dblclick",this._maximizeWindow.bind(this));this._handlerDragCache=this._attemptToDrag.bind(this);this._titleBarElement.observe("mouseenter",this._handlerDragCache);this._title=b.title;this._headerElement=$(this._element.getElement("window-header-se"));this._closeElement=$(this._element.getElement("window-close"));this._minimizeElement=$(this._element.getElement("window-minimize"));this._resizerElement=$(this._element.getElement("window-resizer"));this._contentElement=
$(this._element.getElement("window-content"));this._status="normal";this._windowManager=a;var h=a.getLateBindings(this._element.id);if(null!==h)for(var l in h)for(d=0;d<h[l].length;d++)this.observe(l,h[l][d]);if("undefined"!=typeof b.bindings)for(l in b.bindings)this.observe(l,b.bindings[l]);if("undefined"!=typeof b.action||"undefined"!=typeof b.externAction){this._element.hide();if("undefined"==typeof b.action){var k=b.externAction;new HfosAjax.ApplicationRequest(k,{parameters:b.parameters,onSuccess:this._onReceiveContent.bind(this)})}else k=
b.action,new HfosAjax.Request(k,{parameters:b.parameters,onSuccess:this._onReceiveContent.bind(this)});c.appendChild(this._element)}else if("undefined"!=typeof b.content&&this._contentElement.update(b.content),c.appendChild(this._element),!0==this._element.visible())"undefined"!=typeof b.content?(this._state=b.state,this._wasRestored=!0,delete b.state,delete b.content,this.fire("afterRestore")):(this.fire("afterCreate"),this._storePosition()),this.fire("afterCreateOrRestore");this._relocateElements();
this._addHandlers()}catch(o){HfosException.show(o)}},_onReceiveContent:function(a){this._contentElement.update(a.responseText);this._element.show();this.fire("afterCreate");this.fire("afterCreateOrRestore");this._storePosition();this._onResize()},_storePosition:function(a){var b=this._windowManager.getWorkspace().getApplication().getStorage();b?"function"==typeof a&&b.save("Objects",{id:this._element.id,state:this._state,position:this._position,title:this._title,icon:this._icon,parameters:this._parameters,
y:parseInt(this._element.style.top,10),x:parseInt(this._element.style.left,10),width:this._element.getWidth(),height:this._element.getHeight(),content:this._contentElement.innerHTML},a):"function"==typeof a&&a()},_onResize:function(){this._contentElement.style.overflowY=this._contentElement.scrollHeight>this._contentElement.getHeight()?"scroll":"hidden";this._storePosition()},_dragBehavior:function(a){if(a){var b=a.element.style.left;if(0>parseInt(b,10))this._splitLeftWindow();else{var c=WindowUtilities.getWindowScroll(document.body),
d=WindowUtilities.getPageSize(document.body),e=a.element.getWidth();parseInt(b,10)+e>d.windowWidth-c.left?this._splitRightWindow():10>parseInt(a.element.style.top,10)?new Effect.Morph(a.element,{duration:0.2,style:{top:"10px"},afterFinish:this._storePosition.bind(this)}):this._storePosition()}}},_attemptToDrag:function(){new HfosDraggable(this._element,{handle:this._titleElement,starteffect:!1,endeffect:!1,onEnd:this._dragBehavior.bind(this)});this._handlerDragCache&&this._titleBarElement.stopObserving("mouseenter",
this._handlerDragCache)},_relocateElements:function(){this._contentElement.setStyle({height:this._element.getHeight()-32+"px"});null!==this._statusBarElement&&(this._contentElement.scrollHeight>this._contentElement.getHeight()?this._statusBarElement.setStyle({width:this._element.getWidth()-25+"px",top:this._element.getHeight()-32+"px"}):this._statusBarElement.setStyle({width:this._element.getWidth()-10+"px",top:this._element.getHeight()-32+"px"}))},_addHandlers:function(){this._closeElement.observe("click",
this._closeWindow.bind(this));this._minimizeElement.observe("click",this._minimizeWindow.bind(this))},_startResize:function(a){if(Event.isLeftClick(a))Event.pointerX(a),Event.pointerY(a),a=this._element.cumulativeOffset(),this._resizeOffset=[],this._resizeOffset[0]=a.left,this._resizeOffset[1]=a.top,this._resizeActive=!0},_leaveResize:function(a){try{if(!0==this._resizeActive){var b=[Event.pointerX(a),Event.pointerY(a)],c=this._resizerElement.cumulativeOffset();if(b[0]<c.left-20)delete this._resizeOffset,
this._resizeActive=!1}}catch(d){HfosException.show(d)}},_stopResize:function(){delete this._resizeOffset;this._resizeActive=!1},_updateResize:function(a){!0==this._resizeActive&&(a=[Event.pointerX(a),Event.pointerY(a)],a[0]>this._resizeOffset[0]?this._element.setStyle({width:a[0]-this._resizeOffset[0]+"px"}):this._element.setStyle({width:a[0]+this._resizeOffset[0]+"px"}))},close:function(a){if("undefined"==typeof a&&this.isObserved("beforeClose")&&!1===this.fire("beforeClose"))return!1;this._closeInternal()},
_closeInternal:function(){750>this._contentElement.select("*").length?3>this._windowManager.getNumberWindows()?(new Hfos.getAnimation).scale(this._element,{to:0.95,duration:0.2,afterFinish:this._removeWindow.bind(this)}):this._removeWindow():this._removeWindow();this.fire("afterClose")},_closeWindow:function(a){this.close();new Event.stop(a)},_removeWindow:function(){var a=this._element.id;this._element.hide();null!==this._element.parentNode&&this._element.erase();var b=this._windowManager.getWorkspace().getApplication().getStorage();
null!==b?b.remove("Objects",a,this._windowManager.notify.bind(this._windowManager,"closed",this)):this._windowManager.notify("closed",this)},showThumbnail:function(a){"minimized"==this._status&&(Prototype.Browser.Gecko&&(a=a.cumulativeOffset(),this._element.setOpacity(1),this._element.setStyle({MozTransformOrigin:"top left",MozTransform:"scale(0.25)",top:a[1]-150+"px",left:a[0]+7+"px",zIndex:155})),this._element.show())},hideThumbnail:function(){"minimized"==this._status&&new Effect.Fade(this._element,
{duration:0.5,afterFinish:function(){"minimized"!=this.getStatus()&&this.show()}.bind(this)})},show:function(){this._element.setOpacity(1);this._element.style.MozTransform="scale(1.0)";this._element.show()},_resizeTo:function(a,b){this._element.setStyle({width:a,height:b});this._relocateElements()},_minimizeWindow:function(a){3>this._windowManager.getNumberWindows()?new Effect.Parallel([new Effect.Move(this._element,{sync:!0,y:5,x:-5}),new Effect.Fade(this._element,{sync:!0,to:0.5})],{duration:0.3,
afterFinish:this._minimizeInternal.bind(this)}):this._minimizeInternal();new Event.stop(a)},_minimizeInternal:function(){var a=this._windowManager.getDimensionsFor("minimized",this);this._element.hide();this._element.setOpacity(1);this._resizeTo(a.width,a.height);this._windowManager.setFirstNormalToActive();this.fire("onInactive")},restoreWindow:function(){var a=this._windowManager.getDimensionsFor("normal",this);this._element.setStyle({top:a.top,left:a.left,width:a.width,height:a.height});this.show();
this._relocateElements();this._windowManager.setActiveWindow(this)},maximize:function(){this._maximizeWindow()},_maximizeWindow:function(){var a;a="normal"==this._status?this._windowManager.getDimensionsFor("maximized",this):this._windowManager.getDimensionsFor("normal",this);(new Hfos.getAnimation).morph(this._element,{duration:0.2,style:{top:a.top,left:a.left,width:a.width,height:a.height},afterFinish:function(){this._relocateElements();this._onResize();this._storePosition()}.bind(this)})},_splitLeftWindow:function(){var a=
this._windowManager.getSpaceElement(),b=WindowUtilities.getWindowScroll(a),a=WindowUtilities.getPageSize(a),c=parseInt((a.windowWidth-b.left)/2,10)-15+"px";new Effect.Morph(this._element,{duration:0.2,style:{left:"0px",top:"10px",width:c,height:a.windowHeight-b.top-50+"px"},afterFinish:function(){this._relocateElements();this._onResize()}.bind(this)})},_splitRightWindow:function(){var a=this._windowManager.getSpaceElement(),b=WindowUtilities.getWindowScroll(a),a=WindowUtilities.getPageSize(a),c=parseInt((a.windowWidth-
b.left)/2,10)-10+"px";new Effect.Morph(this._element,{duration:0.2,style:{left:c,top:"10px",width:c,height:a.windowHeight-b.top-50+"px"},afterFinish:function(){this._relocateElements();this._onResize()}.bind(this)})},skewLeft:function(){this.setStyle("-moz-transform: scale(0.7) rotate(5deg)")},go:function(a,b){"undefined"==typeof b&&(b={});b.onComplete="undefined"==b.onComplete?function(){this.notify("contentChanged")}.bind(this):function(a){"function"==typeof a&&a();this.notify("contentChanged")}.bind(this,
b.onComplete);if("undefined"!=typeof b.parameters)this._parameters=b.parameters;return this._contentElement.load(a,b)},setState:function(a){this._state=a;this._storePosition()},getState:function(){return this._state},wasRestored:function(){return this._wasRestored},scrollToTop:function(){this._contentElement.scrollTop=0},scrollToBottom:function(){this._contentElement.scrollTop=this._contentElement.scrollHeight},getWidth:function(){return this._element.getWidth()},getHeight:function(){return this._element.getHeight()},
notify:function(a){switch(a){case "contentChanged":this._onResize()}this.fire(a)},notifyContentChange:function(){this.notify("contentChanged")},isObserved:function(a){return!Object.isUndefined(this["_"+a])},observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a,b,c){try{if(!Object.isUndefined(this["_"+a]))for(var d=0;d<this["_"+a].length;d++)if(!1===this["_"+a][d](this,b,c))return!1;return!0}catch(e){HfosException.show(e)}},showStatusBar:function(a){if(null===
this._statusBarElement)this._statusBarElement=document.createElement("DIV"),this._statusBarElement.addClassName("window-status-bar"),this._element.appendChild(this._statusBarElement);this._statusBarElement.update(a);this._statusBarElement.show();this._relocateElements()},hideStatusBar:function(){null!==this._statusBarElement&&this._statusBarElement.hide()},getStatusBar:function(){return this._statusBarElement},getSkeleton:function(){var a;return'<div class="window-header-se"><table cellspacing="0" cellpadding="0" width="100%"><tr><td width="95%"><div class="window-title-bar"></div></td><td align="right"><div class="window-header-buttons"><table cellspacing="0" cellpadding="0"><tr><td><div class="window-minimize">-</div></td></td><td><div class="window-close"></div></td></tr></table></td></tr></table></div><div class="window-content"></div><div class="window-resizer"></div>'},
isActive:function(){return 150==this._element.style.zIndex},setActive:function(a){!1==this.isActive()&&(this._headerElement.removeClassName("window-header-se-un"),this._contentElement.removeClassName("window-content-un"),this._element.setOpacity(1),this._element.setStyle({zIndex:150}));this._position=a},setInactive:function(a){!0==this.isActive()&&(this._headerElement.addClassName("window-header-se-un"),this._contentElement.addClassName("window-content-un"),this._element.setOpacity(0.95),this._element.setStyle({zIndex:100}),
this.fire("onInactive"));this._position=a},sendKeyEvent:function(a){return this.fire("onKeyPress",a)},getDimensions:function(){return{top:this._element.style.top,left:this._element.style.left,width:this._element.style.width,height:this._element.style.height}},getTop:function(){return this._element.offsetTop},getLeft:function(){return this._element.offsetLeft},getElement:function(a){return this._contentElement.getElement(a)},getWindowElement:function(){return this._element},getSpaceElement:function(){return this._windowManager.getSpaceElement()},
getContentElement:function(){return this._contentElement},select:function(a){return this._contentElement.select(a)},selectOne:function(a){return this._contentElement.selectOne(a)},getId:function(){return this._element.id},getStatus:function(){return this._status},getTitle:function(){return this._title},getWindowManager:function(){return this._windowManager},setStatus:function(a){this._status=a},setSubprocess:function(a){this._subprocess=a},getSubprocess:function(){return this._subprocess},hibernate:function(){this._storePosition(this.setStatus.bind(this,
"hibernate"))}});
var HfosWindowManager=Class.create({_workspace:null,_originalState:{},_spaceElement:null,_windows:{},_modalWindow:null,_numberWindows:0,_lateBindings:{},_windowOrder:[],_offsetTop:0,_offsetLeft:0,initialize:function(a){this._offsetLeft=this._offsetTop=0;this._workspace=a},_setActiveInternal:function(a){if(!1==a.isActive()){var b=0;this._windowOrder=[];$H(this._windows).each(function(c){c[1]!=a&&(c[1].setInactive(b),this._windowOrder.push(c[1].getId()));b++}.bind(this));this._windowOrder.push(a.getId());a.setActive(b)}switch(a.getStatus()){case "minimized":a.restoreWindow()}},
setActiveWindow:function(a,b){"undefined"==typeof b&&(b=!1);if(!1==b)this._setActiveInternal(a);else{var c=1,d=this.getActiveWindow();null!==d&&(d.getWindowElement().offsetLeft>a.getWindowElement().offsetLeft&&(c=-1),new Effect.Move(a.getWindowElement(),{x:20*c,duration:0.2,afterFinish:function(a,b){this._setActiveInternal(a);new Effect.Move(a.getWindowElement(),{x:20*-b,duration:0.2})}.bind(this,a,c)}))}this._workspace.getTaskbar().setActive(a)},setModalWindow:function(a,b){null===this._modalWindow?
(this._modalWindow=a,b()):new HfosModal.alert({title:Hfos.getApplication().getName(),message:"Ya hay otra ventana modal abierta"})},hasModalWindow:function(){return null!==this._modalWindow},removeModalWindow:function(){delete this._modalWindow;this._modalWindow=null},getActiveWindow:function(){if(null===this._modalWindow){var a=null;$H(this._windows).each(function(b){b[1].isActive()&&(a=b[1])});return a}return this._modalWindow},create:function(a){if(!1==this.exists(a))return this._numberWindows++,
this._addWindow(a);this.setActiveWindow(this.getWindow(a.id),!0);return!1},createAndRun:function(a){if(!1==this.exists(a)){if("undefined"!=typeof a.onStartup){if("undefined"==typeof a.bindings)a.bindings={};a.bindings.onReady=a.onStartup}this._numberWindows++;return this._addWindow(a)}var b=this.getWindow(a.id);this.setActiveWindow(b,!1);if("undefined"!=typeof a.onStartup)a.onStartup(b);return!1},_addWindow:function(a){this._windows[a.id]=new HfosWindow(this,a);this._workspace.getTaskbar().add(a);
this.setActiveWindow(this._windows[a.id]);this._offsetTop+=10;this._offsetLeft+=10;return this._windows[a.id]},_closedWindow:function(a){this._workspace.getTaskbar().remove(a);delete this._windows[a.getId()];"undefined"!=typeof this._originalState[a.getId()]&&delete this._originalState[a.getId()];this._numberWindows--;this._offsetTop=10*this._numberWindows;this._offsetLeft=10*this._numberWindows;0<this._numberWindows&&this.setFirstNormalToActive()},exists:function(a){return"undefined"==typeof this._windows[a.id]?
!1:!0},getWindow:function(a){return"undefined"!=typeof this._windows[a]?this._windows[a]:null},getWindows:function(){return this._windows},getDimensionsFor:function(a,b){var c={};switch(a){case "normal":if("undefined"!=typeof this._originalState[b.getId()]){var d=this._originalState[b.getId()];delete this._originalState[b.getId()];c.left=d.left;c.top=d.top;c.width=d.width;c.height=d.height}break;case "maximized":var d=WindowUtilities.getWindowScroll(this._spaceElement),e=WindowUtilities.getPageSize(this._spaceElement);
this._originalState[b.getId()]=b.getDimensions();c.width=e.windowWidth-d.left-20+"px";c.height=e.windowHeight-d.top-50+"px";c.left="10px";c.top="10px";break;case "minimized":this._originalState[b.getId()]=b.getDimensions(),c.width="680px",c.height="400px"}b.setStatus(a);return c},setFirstNormalToActive:function(){this._workspace.getTaskbar().setNoneActive();for(var a=this._windowOrder.length-1;0<=a;a--){var b=this.getWindow(this._windowOrder[a]);if(null!==b&&"minimized"!=b.getStatus()){this.setActiveWindow(b);
break}}},closeActiveWindow:function(){null===this._modalWindow?$H(this._windows).each(function(a){a[1].isActive()&&a[1].close()}):this._modalWindow.close()},setSpaceElement:function(a){this._spaceElement=a},getSpaceElement:function(){return this._spaceElement},getNumberWindows:function(){return null===this._modalWindow?this._numberWindows:this._numberWindows+1},getOffsetTop:function(){return this._offsetTop},getOffsetLeft:function(){return this._offsetLeft},getWorkspace:function(){return this._workspace},
select:function(a){return this._spaceElement.select(a)},sleep:function(){this._spaceElement.hide()},wakeup:function(){this._spaceElement.show();this.setFirstNormalToActive()},hibernate:function(){var a=$H(this._windows);a.each(function(a){a[1].hibernate()});this._interval=window.setInterval(function(a){var c=!0;a.each(function(a){"hibernate"!=a[1].getStatus()&&(c=!1)});c&&(window.clearInterval(this._interval),this._workspace.notify("hibernateCompleted"))}.bind(this,a),200)},notify:function(a,b){switch(a){case "closed":this._closedWindow(b)}},
lateBinding:function(a,b,c){HfosBindings.late(a,b,c)},getLateBindings:function(a){return HfosBindings.get(a)}});
var HfosToolbar=Class.create({_workspace:null,_startMenu:null,_headerElement:null,_applicationSharp:null,_numberVisible:0,_menu:null,_subMenus:[],initialize:function(a){this._workspace=a},hideMenus:function(){for(var a=0;a<this._subMenus.length;a++)this._subMenus[a].hide()},deployFirst:function(){this.hideMenus();0<this._subMenus.length&&this._subMenus[0].show()},deployLast:function(){this.hideMenus();0<this._subMenus.length&&this._subMenus[this._subMenus.length-1].show()},deployNext:function(){var a=
this.getActiveMenu().getActiveOption();if(null!==a&&a.retrieve("hasSubOptions")&&(a=a.retrieve("action"),"undefined"!=typeof a)){a();return}for(var a=!1,b=0;b<this._subMenus.length;b++)if(!1==a)this._subMenus[b].visible()&&(a=!0);else{this.hideMenus();this._subMenus[b].show();break}},deployPrev:function(){for(var a=!1,b=this._subMenus.length-1;0<=b;b--)if(!1==a)this._subMenus[b].visible()&&(a=!0);else{this.hideMenus();this._subMenus[b].show();break}},isSomeVisible:function(){for(var a=0;a<this._subMenus.length;a++)if(this._subMenus[a].visible())return!0;
return!1},getActiveMenu:function(){for(var a=0;a<this._subMenus.length;a++)if(this._subMenus[a].visible())return this._subMenus[a];return!1},setMenu:function(a){new Event.observe(window,"click",this.hideMenus.bind(this));this._headerElement=document.createElement("DIV");var b=document.createElement("DIV");this._headerElement.addClassName("header");b.addClassName("menu");for(var c=a.getOptions(),d=document.createDocumentFragment(),e=0;e<c.length;e++){var f=document.createElement("DIV");f.addClassName("item-menu-parent");
var g=document.createElement("DIV");g.addClassName("item-menu");g.update(c[e].title);g.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/"+c[e].icon+")"});var h=new HfosSubmenu(this,c[e],g);g.observe("mouseover",h.show.bind(h));g.observe("click",h.showbyClick.bind(h));f.appendChild(g);d.appendChild(f);this.addSubmenu(h)}b.appendChild(d);this._headerElement.appendChild(b);b=this._workspace.getSystemTray();this._headerElement.appendChild(b.getElement());b.loadWidgets();document.body.appendChild(this._headerElement);
new Effect.Move(this._headerElement,{duration:1,y:50});b=this._workspace.getApplication();this._applicationSharp=document.createElement("DIV");this._applicationSharp.addClassName("header-button-main");this._applicationSharp.innerHTML='<div id="appName">'+b.getName()+"</div>";document.body.appendChild(this._applicationSharp);this._applicationSharp.selectOne("div#appName").setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/hover/"+b.getIcon()+")"});this._startMenu=new HfosStartMenu(this);
this._menu=a},addSubmenu:function(a){this._subMenus[this._subMenus.length]=a},getSubmenus:function(){return this._subMenus},getApplicationSharp:function(){return this._applicationSharp},notifyShow:function(){if(1<=this._numberVisible)for(var a=0;a<this._subMenus.length;a++)this._subMenus[a].visible()&&this._subMenus[a].hide();this._numberVisible++;null!==this._startMenu&&this._startMenu.hide()},notifyHide:function(){this._numberVisible--;0>=this._numberVisible&&window.setTimeout(function(){document.body.select("div.submenu-options").map(Element.hide)},
250)},hide:function(){this._startMenu.hide();new Effect.Move(this._headerElement,{duration:0.5,y:-50});new Effect.Fade(this._applicationSharp)},show:function(){new Effect.Move(this._headerElement,{duration:0.5,y:50});new Effect.Appear(this._applicationSharp)},sleep:function(){this.hide()},wakeup:function(){this.show()},getWorkspace:function(){return this._workspace}});
var HfosStartMenu=Class.create({_toolbar:null,_element:null,_startMenuElement:null,initialize:function(a){this._toolbar=a;this._element=a.getApplicationSharp();this._element.observe("click",this.show.bind(this))},show:function(){this._element.hasClassName("header-button-main-se")?(this._element.removeClassName("header-button-main-se"),this._startMenuElement.hide()):new HfosAjax.JsonRequest("workspace/getStartItems",{onLoading:function(){this._element.selectOne("#appName").update('<div align="center"><div class="load-bar"></div></div>')}.bind(this),
onSuccess:function(a){this._element.addClassName("header-button-main-se");if(null===this._startMenuElement)this._startMenuElement=document.createElement("DIV"),this._startMenuElement.addClassName("start-menu"),this._toolbar.getWorkspace().getApplication().getAppContainer().appendChild(this._startMenuElement),this._toolbar.getWorkspace().getSpaceElement().observe("click",this.hide.bind(this));"OK"==a.status&&(this._startMenuElement.update(""),a.items.each(function(a){this._startMenuElement.appendChild((new Element("LABEL")).update(a.name));
var c=document.createElement("UL"),d=document.createDocumentFragment();a.items.each(function(c){var f=document.createElement("LI");"undefined"!=typeof Movimientos&&f.observe("click",Movimientos.abrir.bind(window,c.key));if("undefined"!=typeof a.icon)f.style.backgroundImage="url("+$Kumbia.path+"img/backoffice/hover/"+a.icon+")";f.observe("click",this.hide.bind(this));f.update(c.text);d.appendChild(f)}.bind(this));c.appendChild(d);this._startMenuElement.appendChild(c)}.bind(this)));this._startMenuElement.show()}.bind(this),
onComplete:function(){var a=this._toolbar.getWorkspace().getApplication();this._element.selectOne("#appName").update(a.getName())}.bind(this)})},hide:function(){null!==this._startMenuElement&&(this._element.removeClassName("header-button-main-se"),this._startMenuElement.hide())}});
var HfosMenu=Class.create({_options:{},_application:null,initialize:function(a){var b=document.createElement("SCRIPT");b.type="text/javascript";b.src=$Kumbia.path+"javascript/hfos/menus/"+a.getCode()+".js?r="+parseInt(1E3*Math.random());document.body.appendChild(b);b.observe("load",this._refreshToolbar.bind(this));this._application=a},_refreshToolbar:function(){this._application.getWorkspace().getToolbar().setMenu(this)},setOptions:function(a){this._options[this._application.getCode()]=$A(a)},getOptions:function(){return this._options[this._application.getCode()]}});
var HfosSubmenu=Class.create({_element:null,_option:null,_toolbar:null,_subMenuOptions:[],_hideTimeout:null,_subMenuElement:null,initialize:function(a,b,c){this._toolbar=a;this._option=b;this._element=c},visible:function(){return null!==this._subMenuElement},show:function(){this.hide();this._toolbar.notifyShow();this._element.addClassName("item-menu-over");this._element.parentNode.addClassName("item-menu-parent-over");var a=document.createElement("DIV");a.addClassName("submenu");for(var b=document.createDocumentFragment(),
c=this._element.cumulativeOffset(),d=this._option.options,e=0;e<d.length;e++){var f=!1,g=document.createElement("DIV");g.setAttribute("id",d[e].title+e);g.update(d[e].title);g.addClassName("item-submenu");"undefined"==typeof d[e].options?g.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/hover/"+d[e].icon+")"}):g.setStyle({background:"url("+$Kumbia.path+"img/backoffice/hover/"+d[e].icon+") 7px 9px no-repeat, url("+$Kumbia.path+"img/nextw.gif) 97% center no-repeat"});"undefined"!=typeof d[e].click?
(g.store("action",d[e].click),g.observe("click",g.retrieve("action")),g.observe("mouseenter",this._hideSubOptions.bind(this))):"undefined"!=typeof d[e].options&&(f=this._showSubOptions.bind(this,a,g,d[e].options),g.addClassName("item-suboptions"),g.store("action",f),g.observe("click",function(a,b){a.retrieve("action")();this.focusOption.bind(this,a)();new Event.stop(b)}.bind(this,g)),g.observe("mouseenter",f),f=!0);g.store("icon",d[e].icon);g.store("hasSubOptions",f);g.observe("mouseenter",this.focusOption.bind(this,
g));b.appendChild(g);this._subMenuOptions[this._subMenuOptions.length]=$(g)}a.appendChild(b);b=this._toolbar.getWorkspace().getSpaceElement();document.body.appendChild(a);a.hide();0<c[0]?c[0]<b.getWidth()-a.getWidth()?a.setStyle({top:"35px",left:c[0]+1+"px"}):a.setStyle({top:"35px",left:c[0]+this._element.getWidth()-a.getWidth()+"px"}):a.setStyle({top:"35px",right:"15px"});new Effect.Appear(a,{duration:0.2});this._subMenuElement=a;a.observe("mouseenter",this._cancelRemove.bind(this));this._element.observe("mouseenter",
this._cancelRemove.bind(this))},showbyClick:function(a){this.show();new Event.stop(a)},_hideSubOptions:function(){var a=document.body.selectOne("div.submenu-options");null!==a&&"undefined"!=typeof a.parentNode&&null!=a.parentNode&&a.erase()},_showSubOptions:function(a,b,c){try{this._hideSubOptions();var d=document.createElement("DIV");d.addClassName("submenu");d.addClassName("submenu-options");d.hide();for(var e=document.createDocumentFragment(),f=0;f<c.length;f++){var g=document.createElement("DIV");
g.setAttribute("id",c[f].title+f);g.update(c[f].title);g.addClassName("item-submenu");g.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/hover/"+c[f].icon+")"});"undefined"!=typeof c[f].click&&(g.store("action",c[f].click),g.observe("click",g.retrieve("action")));g.store("icon",c[f].icon);g.store("hasSubOptions",!1);g.observe("mouseenter",this.focusSubOption.bind(this,g));e.appendChild(g)}d.appendChild(e);var h=b.cumulativeOffset(),l=this._toolbar.getWorkspace().getSpaceElement();h[0]+
190<l.getWidth()-b.getWidth()?d.setStyle({top:h[1]+"px",left:h[0]+190+"px"}):d.setStyle({top:h[1]+"px",left:h[0]-200+"px"});a.store("subOptions",d);document.body.appendChild(d);new Effect.Appear(d,{duration:0.2})}catch(k){HfosException.show(k)}},_cancelRemove:function(){this.removeTimeout()},_prepareForRemove:function(){this.removeTimeout();this._hideTimeout=window.setInterval(this.hide.bind(this),300)},removeTimeout:function(){if(null!=this._hideTimeout)window.clearTimeout(this._hideTimeout),this._hideTimeout=
null},hide:function(){if(null!==this._subMenuElement){this._toolbar.notifyHide();var a=this._subMenuElement.retrieve("subOptions");"undefined"!=typeof a&&new Effect.Fade(a,{duration:0.2,afterFinish:function(){null!==this.parentNode&&"undefined"!=typeof this.parentNode&&this.erase()}.bind(a)});new Effect.Fade(this._subMenuElement,{duration:0.2,afterFinish:function(){null!==this.parentNode&&"undefined"!=typeof this.parentNode&&this.erase()}.bind(this._subMenuElement)});this._subMenuElement=null;this._subMenuOptions=
[];this._element.removeClassName("item-menu-over");this._element.parentNode.removeClassName("item-menu-parent-over");this.removeTimeout()}},focusSubOption:function(a){for(var b=a.parentNode.select("div.item-submenu-over"),c=0;c<b.length;c++)this._applyIcon(b[c],"hover/",!1),b[c].removeClassName("item-submenu-over"),b[c].parentNode.removeClassName("item-menu-parent-over");a.addClassName("item-submenu-over");a.parentNode.addClassName("item-menu-parent-over");this._applyIcon(a,"hover/",!0)},focusOption:function(a){for(var b=
0;b<this._subMenuOptions.length;b++)this._applyIcon(this._subMenuOptions[b],"hover/",!1),this._subMenuOptions[b].removeClassName("item-submenu-over");"undefined"!=typeof a&&(a.addClassName("item-submenu-over"),this._applyIcon(a,"hover/",!0))},_applyIcon:function(a,b,c){var d=a.retrieve("icon");"undefined"!=typeof d&&(!1==a.retrieve("hasSubOptions")?a.setStyle({backgroundImage:"url("+$Kumbia.path+"img/backoffice/"+b+d+")"}):!1==c?a.setStyle({background:"url("+$Kumbia.path+"img/backoffice/"+b+d+") 7px 9px no-repeat, url("+
$Kumbia.path+"img/nextw.gif) 97% center no-repeat"}):a.setStyle({background:"url("+$Kumbia.path+"img/backoffice/"+b+d+") 7px 9px no-repeat, url("+$Kumbia.path+"img/nextw.gif) 97% center no-repeat, rgba(40, 60, 92, 0.9)"}))},focusNextOption:function(){if(0<this._subMenuOptions.length){for(var a=!1,b=0;b<this._subMenuOptions.length;b++)if(!1==a)this._subMenuOptions[b].hasClassName("item-submenu-over")&&(a=!0);else{this.focusOption(this._subMenuOptions[b]);return}this.focusOption(this._subMenuOptions[0])}},
focusPrevOption:function(){if(0<this._subMenuOptions.length){for(var a=!1,b=this._subMenuOptions.length-1;0<=b;b--)if(!1==a)this._subMenuOptions[b].hasClassName("item-submenu-over")&&(a=!0);else{this.focusOption(this._subMenuOptions[b]);return}this.focusOption(this._subMenuOptions[this._subMenuOptions-1])}},runActiveOption:function(){if(0<this._subMenuOptions.length){for(var a=this._subMenuOptions.length-1;0<=a;a--)if(this._subMenuOptions[a].hasClassName("item-submenu-over")){var b=this._subMenuOptions[a].retrieve("action");
if("undefined"!=typeof b){b();break}}this.hide()}},getActiveOption:function(){if(0<this._subMenuOptions.length)for(var a=this._subMenuOptions.length-1;0<=a;a--)if(this._subMenuOptions[a].hasClassName("item-submenu-over"))return this._subMenuOptions[a];return null}});
var HfosTaskbar=Class.create({_workspace:null,_winToolbarElement:null,initialize:function(a){this._workspace=a},_initWindowToolbar:function(){if(null==this._winToolbarElement){var a=this._workspace.getWindowManager().getSpaceElement();WindowUtilities.getWindowScroll(a);WindowUtilities.getPageSize(a);var b=document.createElement("DIV");b.addClassName("window-toolbar");a.appendChild(b);this._winToolbarElement=b}},setNoneActive:function(){null!==this._winToolbarElement&&this._winToolbarElement.select(".window-thumb").each(function(a){a.removeClassName("window-thumb-active")})},
setActive:function(a){this.setNoneActive();$(a.getId()+"win-thumb").addClassName("window-thumb-active")},add:function(a){var b=this._workspace.getWindowManager().getWindow(a.id);this._initWindowToolbar();var c=document.createElement("DIV");c.addClassName("window-thumb");c.setAttribute("id",b.getId()+"win-thumb");"undefined"!=typeof a.icon?c.update('<table><tr><td><div class="window-icon" style="background-image:url('+$Kumbia.path+"img/backoffice/hover/"+a.icon+')"/></div></td><td><div class="window-caption">'+
b.getTitle()+"</div></td></tr></table>"):c.update('<table><tr><td><div class="window-icon"></div></td><td><div class="window-caption">'+b.getTitle()+"</div></td></tr></table>");this._winToolbarElement.appendChild(c);c.observe("click",this._handleButtonClick.bind(this,b));c.observe("mouseenter",this._showThumbnail.bind(this,b,c));c.observe("mouseleave",this._hideThumbnail.bind(this,b,c))},remove:function(a){(a=$(a.getId()+"win-thumb"))&&this._winToolbarElement.removeChild(a);if(null!==this._winToolbarElement&&
0==this._winToolbarElement.childNodes.length)this._workspace.getWindowManager().getSpaceElement().removeChild(this._winToolbarElement),this._winToolbarElement=null},_handleButtonClick:function(a){!1==a.getWindowManager().hasModalWindow()&&("normal"==a.getStatus()?a.getWindowManager().setActiveWindow(a,!0):a.getWindowManager().setActiveWindow(a,!1))},_showThumbnail:function(a,b){a.showThumbnail(b)},_hideThumbnail:function(a,b){a.hideThumbnail(b)},hideThumbnail:function(){"minimized"==this._status&&
(new CoreAnimation).opaque(this,{to:0.2,duration:0.3,afterFinish:function(){this.hide()}})}});
var HfosSystemTray=Class.create({_element:null,_workspace:null,initialize:function(a){this._workspace=a;this._element=document.createElement("DIV");this._element.addClassName("system-tray")},getElement:function(){return this._element},loadWidgets:function(){for(var a=0;a<HfosSystemTrayWidgets.length;a++)this._addWidget(HfosSystemTrayWidgets[a])},_addWidget:function(a){var b=document.createElement("DIV");b.addClassName("system-tray-parent-div");var c=document.createElement("DIV");c.addClassName("system-tray-div");
var d=document.createElement("IMG");d.addClassName("system-tray-widget");d.title=a.title;d.src=$Kumbia.path+"img/backoffice/"+a.icon;c.appendChild(d);b.appendChild(c);this._element.appendChild(b);a.initialize(this,a,c)},getWorkspace:function(){return this._workspace}});
var HfosSystemTrayWidgets=[{title:"Cambiar Aplicaci\u00f3n",icon:"change-apps.png",options:[{title:"Contabilidad",icon:"document-library.png",click:function(){Hfos.bootApp("Contabilidad","CO","contab","document-library.png",!0)}},{title:"Inventarios",icon:"shipping.png",click:function(){Hfos.bootApp("Inventarios","IN","inve","shipping.png",!0)}},{title:"Facturador",icon:"invoice.png",click:function(){Hfos.bootApp("Facturador","FC","invoicer","invoice.png",!0)}},{title:"Tiempo Compartido",icon:"suppliers.png",
click:function(){Hfos.bootApp("Tiempo Compartido","TC","tpc","suppliers.png",!0)}},{title:"Socios",icon:"users.png",click:function(){Hfos.bootApp("Socios","SO","socios","users.png",!0)}},{title:"Administraci\u00f3n",icon:"administrative-docs.png",click:function(){Hfos.bootApp("Administraci\u00f3n","IM","identity","administrative-docs.png",!0)}}],initialize:function(a,b,c){a=a.getWorkspace().getToolbar();b=new HfosSubmenu(a,b,c);c.observe("mouseover",b.show.bind(b));a.addSubmenu(b)}},{title:"Usuario",
icon:"user-icon.png",options:[{title:"Datos de la Cuenta",icon:"user.png",click:function(){Hfos.showAccountData()}},{title:"Consola de Soporte",icon:"terminal.png",click:function(){Hfos.getApplication().run({id:"win-console",title:"Consola de Soporte",icon:"terminal.png",height:450,width:750,externAction:"identity/console/index"})}},{title:"Ayuda",icon:"consulting.png",click:function(){Hfos.getApplication().run({id:"win-magenta",title:"Soporte T\u00e9cnico",icon:"key.png",height:270,width:500,externAction:"identity/magenta/index"})}},
{title:"Salida Segura",icon:"door-open-out.png",click:function(){Hfos.closeApp()}}],initialize:function(a,b,c){a=a.getWorkspace().getToolbar();b=new HfosSubmenu(a,b,c);c.observe("mouseover",b.show.bind(b));a.addSubmenu(b)}}];
var HfosNotifierServer={_notifications:{},_number:0,_lock:!1,add:function(a,b){if(!1==HfosNotifierServer._lock){HfosNotifierServer._lock=!0;var c=new HfosNotifier(a);HfosNotifierServer._notifications[c.getId()]=c;HfosNotifierServer._number++;c.show();HfosNotifierServer._lock=!1}else window.setTimeout(HfosNotifierServer.add.bind(window,b),100)},get:function(a){if(!1==HfosNotifierServer._lock){HfosNotifierServer._lock=!0;var b=new HfosNotifier;HfosNotifierServer._notifications[b.getId()]=b;HfosNotifierServer._number++;
HfosNotifierServer._lock=!1;a(b)}else window.setTimeout(HfosNotifierServer.add.bind(window,"",a),100)},drop:function(a){"undefined"!=typeof HfosNotifierServer._notifications[a.getId()]&&(delete HfosNotifierServer._notifications[a.getId()],HfosNotifierServer._number--)},getPosition:function(){var a=1,b;for(b in HfosNotifierServer._notifications)"visible"==HfosNotifierServer._notifications[b].getState()&&a++;return a}},HfosNotifier=Class.create({_element:null,_id:null,_state:null,initialize:function(a,
b){this._state="hidden";"undefined"!=typeof a&&(this.update(a,b),this.show())},update:function(a,b){try{if(null==this._element)this._element=document.createElement("DIV"),document.body.appendChild(this._element);this._element.className="undefined"!=typeof b?"undefined"==typeof b.classNames?"notify":"notify "+b.classNames:"notify";var c=HfosNotifierServer.getPosition();this._element.update("<table><tr><td></td><td>"+a+"</td></tr></table>");this._element.setStyle({bottom:10+50*c-5})}catch(d){HfosException.show(d)}},
show:function(a){null!=this._element&&(this._element.show(),new Effect.Move(this._element,{duration:0.5,y:-5}));this._state="visible";this.hide(5,a)},getId:function(){if(null===this._id)this._id=(new Date).getTime();return this._id},hide:function(a,b){window.setTimeout(function(a){new Effect.Fade(this._element,{afterFinish:function(a){this._state="hidden";"undefined"==typeof a&&this.destroy()}.bind(this,a)})}.bind(this,b),1E3*a)},getState:function(){return this._state},destroy:function(){this._element.erase();
HfosNotifierServer.drop(this)}});
var HfosScreenSaver=Class.create({_startTimeout:null,_started:!1,_waitTime:9E5,initialize:function(){new Event.observe(window,"click",this.cancelStart.bind(this));this._startTimeout=window.setTimeout(this.start.bind(this),this._waitTime)},start:function(){var a=document.createElement("DIV");a.id="screen-saver";a.update('<div id="screen-saver-container"></div>');document.body.appendChild(a);swfobject.embedSWF($Kumbia.path+"files/backoffice/aurora.swf","screen-saver-container","1280","700","9.0.0",
"expressInstall.swf",null,{wmode:"transparent"});this._started=!0},stop:function(){$("screen-saver").erase();this._started=!1},cancelStart:function(){!0==this._started&&this.stop();if(null!=this._startTimeout)window.clearTimeout(this._startTimeout),this._startTimeout=null;this._startTimeout=window.setTimeout(this.start.bind(this),this._waitTime)}});Event.KEY_C=67;Event.KEY_E=69;Event.KEY_I=73;Event.KEY_M=77;Event.KEY_N=78;Event.KEY_P=80;Event.KEY_V=86;Event.KEY_X=88;Event.KEY_F1=112;
Event.KEY_F2=113;Event.KEY_F3=114;Event.KEY_F4=115;Event.KEY_F5=116;Event.KEY_F6=117;Event.KEY_F7=118;Event.KEY_F8=119;Event.KEY_F9=120;Event.KEY_F10=121;Event.KEY_SUPR=46;Event.KEY_COMMAND=224;
var HfosShortcuts={_inactive:!1,disable:function(){HfosShortcuts._inactive=!0},enable:function(){HfosShortcuts._inactive=!1},globalKeyUpHandler:function(a){if(a.keyCode==Event.KEY_BACKSPACE)switch(document.activeElement.tagName){case "INPUT":case "TEXTAREA":return!0;default:return new Event.stop(a),new Event.cancelBubble(a),!1}if(!1==HfosShortcuts._inactive){if(!0==a.ctrlKey||a.metaKey)if(a.keyCode==Event.KEY_V||a.keyCode==Event.KEY_C||a.keyCode==Event.KEY_X)return!0;if(a.keyCode==Event.KEY_UP||a.keyCode==
Event.KEY_DOWN||a.keyCode==Event.KEY_LEFT||a.keyCode==Event.KEY_RIGHT||a.keyCode==Event.KEY_RETURN||a.keyCode==Event.KEY_F2||a.keyCode==Event.KEY_F4||a.keyCode==Event.KEY_F7||a.keyCode==Event.KEY_F8||a.keyCode==Event.KEY_F10||a.keyCode==Event.KEY_ESC||a.keyCode==Event.KEY_SUPR||!0==a.ctrlKey){var b=Hfos.getApplication().getWorkspace().getWindowManager();if(0==b.getNumberWindows())return b=Hfos.getApplication().getWorkspace().getToolbar(),!1==b.isSomeVisible()?a.keyCode==Event.KEY_UP?b.deployLast():
a.keyCode==Event.KEY_DOWN&&b.deployFirst():a.keyCode==Event.KEY_RIGHT?b.deployNext():a.keyCode==Event.KEY_LEFT?b.deployPrev():(b=b.getActiveMenu(),a.keyCode==Event.KEY_UP?b.focusPrevOption():a.keyCode==Event.KEY_DOWN?b.focusNextOption():a.keyCode==Event.KEY_RETURN?b.runActiveOption():b.hide()),new Event.stop(a),!1;if(a.keyCode==Event.KEY_ESC)return b.closeActiveWindow(),new Event.stop(a),!1;b=b.getActiveWindow();if(!0==a.ctrlKey&&a.keyCode==Event.KEY_M)return b.maximize(),new Event.stop(a),!1;if(b)return b.sendKeyEvent(a)}}}};
var HfosWindowDefinition={WINDOW_MIN_TOP:5,WINDOW_MIN_LEFT:230},HfosWorkspace=Class.create({_windowManager:null,_toolbar:null,_taskbar:null,_systemTray:null,_application:null,initialize:function(a){this._application=a;this._windowManager=new HfosWindowManager(this);this._toolbar=new HfosToolbar(this);this._taskbar=new HfosTaskbar(this);this._systemTray=new HfosSystemTray(this);this._createSpace();this._application.activeShortcuts()},_modifySpace:function(){var a=WindowUtilities.getWindowScroll(document.body),
b=WindowUtilities.getPageSize(document.body),b=b.windowHeight-a.top-34+"px";this._windowManager.getSpaceElement().style.height=b;if(null!=this._windowManager.winToolbarElement)WindowUtilities.getWindowScroll(document.body),b=WindowUtilities.getPageSize(document.body),a=this._windowManager.winToolbarElement,a.setStyle({top:b.windowHeight-a.getHeight()+"px"})},_createSpace:function(){var a=WindowUtilities.getWindowScroll(document.body),a=WindowUtilities.getPageSize(document.body).windowHeight-a.top-
34+"px",b=document.createElement("DIV");b.addClassName("workspace");b.style.height=a;document.body.selectOne("div#app-cont-"+this._application.getContainerId()).appendChild(b);this._windowManager.setSpaceElement(b);a=Hfos.getProductivity();this._application.observe("onHasAccess",a.show.bind(a));new Event.observe(window,"resize",this._modifySpace.bind(this))},select:function(a){return this._windowManager.select(a)},getToolbar:function(){return this._toolbar},getTaskbar:function(){return this._taskbar},
getSystemTray:function(){return this._systemTray},getWindowManager:function(){return this._windowManager},getSpaceElement:function(){return this._windowManager.getSpaceElement()},getApplication:function(){return this._application},notify:function(a){switch(a){case "hibernateCompleted":this._application.notify("hibernateCompleted")}},sleep:function(){this._toolbar.sleep();this._windowManager.sleep()},wakeup:function(){this._toolbar.wakeup();this._windowManager.wakeup()},hibernate:function(){this._windowManager.hibernate()}});
var HfosTableSort=Class.create({_element:null,_thElements:[],_sortTableBody:null,initialize:function(a){this._element=$(a);for(var a=this._element.select("th"),b=0;b<a.length;b++)a[b].hasClassName("sortcol")&&(a[b].observe("click",this._columnSortHandler.bind(this,a[b],b)),this._thElements.push(a[b]));this._sortTableBody=this._element.tBodies[0];for(b=0;b<a.length;b++)if(a[b].hasClassName("sortcol")){for(var c=this._sortTableBody.select("td:nth-of-type("+(b+1)+")"),d="",e=0;e<c.length;e++)if(""!=
c[e].innerHTML)if(/^[0-9]+$/.test(c[e].innerHTML))d="number";else if("number"==d){d="text";break}""==d&&(d="text");a[b].store("sort-type",d)}},_columnSortHandler:function(a,b){for(var c=a.hasClassName("sortasc"),d=0;d<this._thElements.length;d++)this._thElements[d].removeClassName("sortasc"),this._thElements[d].removeClassName("sortdesc");c?(this._sortColumn(b,a.retrieve("sort-type"),!1),a.addClassName("sortdesc")):(this._sortColumn(b,a.retrieve("sort-type"),!0),a.addClassName("sortasc"))},_sortColumn:function(a,
b,c){for(var d=[],a=this._sortTableBody.select("td:nth-of-type("+(a+1)+")"),e=0;e<a.length;e++)d.push(a[e]);!0==c?"text"==b?d.sort(this._ascendingSortText):d.sort(this._ascendingSortNumber):"text"==b?d.sort(this._descendingSortText):d.sort(this._descendingSortNumber);for(e=0;e<d.length;e++)this._sortTableBody.appendChild(d[e].parentNode)},_ascendingSortText:function(a,b){return a.innerHTML<b.innerHTML?-1:a.innerHTML>b.innerHTML?1:0},_descendingSortText:function(a,b){return a.innerHTML>b.innerHTML?
-1:a.innerHTML<b.innerHTML?1:0},_ascendingSortNumber:function(a,b){a=a.innerHTML.toString();b=b.innerHTML.toString();return a.length==b.length?a<b?-1:a>b?1:0:a.length>b.length?-1:a.length<b.length?1:0},_descendingSortNumber:function(a,b){a=a.innerHTML.toString();b=b.innerHTML.toString();return a.length==b.length?a>b?-1:a<b?1:0:a<b?-1:a>b?1:0}});
var HfosForm=Class.create({_processContainer:null,_formElement:null,_options:null,_submitButton:null,initialize:function(a,b,c){var d=this._submitForm.bind(this);if(this._formElement=a.getContainer().getElement(b))this._formElement.observe("beforesubmit",function(a){new Event.stop(a)}),(this._submitButton=this._formElement.getInputs("submit")[0])&&this._submitButton.observe("click",d);if("undefined"==typeof c.onLoading)c.onLoading=function(){this._processContainer.setIgnoreTermSignal(!0);this._formElement.disable();
this._formElement.getElement("formSpinner").show()}.bind(this),c.onCreate=function(){this._processContainer.setIgnoreTermSignal(!0);this._formElement.disable();this._formElement.getElement("formSpinner").show()}.bind(this);if("undefined"!=typeof c.onSuccess)c.onSuccess=function(a,b){this._submitButton.enable();this._formElement.getElement("formSpinner").hide();a.bind(this)(b)}.bind(this,c.onSuccess);if("undefined"==typeof c.onComplete)c.onComplete=function(){this._processContainer.setIgnoreTermSignal(!1);
this._formElement.enable();this._formElement.getElement("formSpinner").hide()}.bind(this);this._options=c;this._processContainer=a;this._formElement&&this._formElement.getInputs()[0].focus()},_submitForm:function(a){new HfosAjax.JsonFormRequest(this._formElement,this._options);new Event.stop(a)},getFormElement:function(){return this._formElement},getMessages:function(){return this._processContainer.getMessages()},getElement:function(a){return this._processContainer.getElement(a)},getContainer:function(){return this._processContainer}});
var HfosModalForm=Class.create(HfosProcessContainer,{_element:null,_options:{},initialize:function(a,b,c){this.setContainer(this);Hfos.getUI().showScreenShadow();this._options=c;if("undefined"==typeof c.parameters)c.parameters="";if("undefined"==typeof c.checkAcl)c.checkAcl=!1;new HfosAjax.Request(b,{checkAcl:c.checkAcl,parameters:c.parameters,onSuccess:function(a){var b=Hfos.getApplication().getWorkspace().getWindowManager();!0!=b.hasModalWindow()&&b.setModalWindow(this,function(){this._element=
document.createElement("DIV");this._element.addClassName("window-modal");this._element.addClassName("formExternalContainer");this._element.update(a.responseText);document.body.appendChild(this._element);"undefined"!=typeof this._options.style&&this._element.getElement("formExternal").setStyle(this._options.style);if("undefined"!=typeof this._options.defaults)for(var b in this._options.defaults){var c=this._element.selectOne("#"+b);null!==c&&c.setValue(this._options.defaults[b])}this._messages=new HfosMessages(this);
b=!1;if("undefined"!=typeof this._options.notSubmit)b=this._options.notSubmit;!1==b&&(b=this._element.selectOne('input[type="submit"]'),null!==b&&(b.observe("click",function(a,b){new HfosAjax.JsonFormRequest(a.form,{onCreate:function(){if("undefined"!=typeof this._options.onSubmit)this._options.onSubmit(this)}.bind(this),onSuccess:function(a){"FAILED"==a.status?(this._messages.error(a.message),"undefined"!=typeof a.fields&&(a=this._element.selectOne("#"+a.fields[0]))&&a.activate()):this.closeForm(!1,
a)}.bind(this)});new Event.stop(b)}.bind(this,b)),b.form.observe("beforesubmit",function(a){new Event.stop(a)}),window.setTimeout(function(a){a.form.getInputs()[0].activate()}.bind(this,b),100)));this._options.messageDefault&&this._messages.success(this._options.messageDefault);this._element.getElement("window-close").observe("click",this.closeForm.bind(this,!0));new Effect.Move(this._element,{duration:0.5,y:500});"undefined"!=typeof this._options.afterShow&&this._options.afterShow(this)}.bind(this))}.bind(this)})},
closeForm:function(a,b){!0==this._onCloseProcess()&&("undefined"!=typeof this._options.beforeClose&&this._options.beforeClose(this,a,b),Hfos.getApplication().getWorkspace().getWindowManager().removeModalWindow(),this._element.erase(),Hfos.getUI().hideScreenShadow())},getElement:function(a){return this._element.getElement(a)},getContentElement:function(){return this._element},select:function(a){return this._element.select(a)},selectOne:function(a){return this._element.selectOne(a)},getWindowElement:function(){return this._element},
getTitle:function(){return this._element.selectOne("h1").innerHTML},getContainer:function(){return this},notifyContentChange:function(){},close:function(){this.closeForm()},sendKeyEvent:function(){}});
var HfosTabs=Class.create({_container:null,_tabsContents:[],_tabsTexts:[],_tabs:[],initialize:function(a,b,c){try{this._tabsContents=a.select("fieldset."+b);this._tabsTexts=[];for(b=0;b<this._tabsContents.length;b++){var d=this._tabsContents[b].selectOne("legend");d.hide();this._tabsTexts.push(d.innerHTML);0<b&&this._tabsContents[b].hide()}this._tabs=[];var e=document.createElement("UL"),f=document.createDocumentFragment();e.addClassName("tabs");for(b=0;b<this._tabsTexts.length;b++)this._tabs[b]=
document.createElement("LI"),0==b?this._tabs[b].update('<a class="active">'+this._tabsTexts[b]+"</a>"):this._tabs[b].update("<a>"+this._tabsTexts[b]+"</a>"),this._tabs[b].observe("click",this._changeTab.bind(this,b)),f.appendChild(this._tabs[b]);e.appendChild(f);this._tabsContents[0].insert({before:e});this._options=c||{};this._container=a}catch(g){HfosException.show(g)}},_changeTab:function(a){for(var b=0;b<this._tabsContents.length;b++)b==a?this._tabsContents[b].show():this._tabsContents[b].hide();
for(b=0;b<this._tabs.length;b++)b==a?this._tabs[b].selectOne("a").addClassName("active"):this._tabs[b].selectOne("a").removeClassName("active");if("undefined"!=typeof this._options.onChange)this._options.onChange(this._tabsTexts[a]);this._container._notifyContentChange()}});
var HfosMessagesTypes={M_NOTICE:1,M_ERROR:2,M_SUCCESS:3},HfosMessages=Class.create({_container:null,_default:null,_notify:null,initialize:function(a){this._container=a;this._default=this._container.getElement("messages").innerHTML},addMessage:function(a,b,c){"undefined"==typeof c&&(c=!1);var d="";b==HfosMessagesTypes.M_NOTICE?d="notice":b==HfosMessagesTypes.M_SUCCESS?d="success":b==HfosMessagesTypes.M_ERROR&&(d="error");var e=this._container.getElement("messages"),f=e.getElement("error");e.getElement("notice");
e.show();e.update('<div class="'+d+'">'+a+"</div>");if(this._container.getContentElement().scrollTop<e.offsetTop){if("test"!=Hfos.getMode())if(b==HfosMessagesTypes.M_ERROR||!0==c)f||new Effect.Highlight(e.descendants()[0],{startcolor:"#DDF4FF",keepBackgroundImage:!0,duration:1.5});else if(b==HfosMessagesTypes.M_NOTICE||!0==c)f||new Effect.Highlight(e.descendants()[0],{startcolor:"#F0F6FF",keepBackgroundImage:!0,duration:1.5})}else null==this._notify?HfosNotifierServer.get(function(a,b){this._notify=
b;this._notify.update(a);this._notify.show(!1)}.bind(this,a)):this._notify.update(a)},setDefault:function(){this._container.getElement("messages").update(this._default)},setActiveToDefault:function(){this._default=this._container.getElement("messages").innerHTML;this.setDefault()},success:function(a,b){return this.addMessage(a,HfosMessagesTypes.M_SUCCESS,b)},notice:function(a,b){return this.addMessage(a,HfosMessagesTypes.M_NOTICE,b)},error:function(a,b){return this.addMessage(a,HfosMessagesTypes.M_ERROR,
b)},clear:function(){this._container.getElement("messages").update("")},hide:function(){this._container.getElement("messages").hide()}});
var HfosAutocompleter=Class.create({_element:null,_action:null,_options:[],_results:[],_cachedKeyUp:null,_cachedKeyDown:null,_cachedOnBlur:null,_cachedId:null,initialize:function(a,b,c){this._element=$(a);if(null!==this._element){a=Hfos.getApplication();this._parentNode=null!==a?(a=a.getWorkspace().getWindowManager().getActiveWindow())?a.getContentElement():this._element.up(3):this._element.up(3);if(!this._parentNode)return this._element=null,!1;this._action=b;this._options=c;this._cachedKeyUp=this._onKeyUp.bind(this);
this._element.observe("keyup",this._cachedKeyUp);this._cachedKeyDown=this._onKeyDown.bind(this);this._element.observe("keydown",this._cachedKeyDown);this._cachedOnclick=this._hideAutocompleter.bind(this);this._parentNode.observe("click",this._cachedOnclick);this._cachedId="completerChoices"+Math.ceil(100*Math.random())}},_moveCursorDown:function(){for(var a=$(this._cachedId),b=-1,c=this._results.length,d=0;d<c;d++)if(!0==this._results[d].selected){b=d;break}b<c-1&&b++;this._showChoices(a,b)},_moveCursorUp:function(){for(var a=
$(this._cachedId),b=-1,c=this._results.length,d=0;d<c;d++)if(!0==this._results[d].selected){b=d;break}0<b&&b--;this._showChoices(a,b)},_onBlur:function(){},_hideAutocompleter:function(){0<this._results.length&&this._hideResults()},_onKeyUp:function(a){if(a.keyCode!=Event.KEY_TAB&&a.keyCode!=Event.KEY_LEFT&&a.keyCode!=Event.KEY_RIGHT&&a.keyCode!=Event.KEY_DOWN&&a.keyCode!=Event.KEY_ESC&&a.keyCode!=Event.KEY_RETURN&&a.keyCode!=Event.KEY_PAGEUP&&a.keyCode!=Event.KEY_PAGEDOWN)if(a=this._element.getValue(),
2<a.length){a=this._options.paramName+"="+a;if(this._options.paramNames)for(var b=0;b<this._options.paramNames.length;b++){var c=this._options.paramNames[b],d="",e=$(c);e?d=e.getValue():alert("not found element #"+c);a=a+"&"+this._options.paramName+"_tipo="+d}new HfosAjax.JsonRequest(this._action,{parameters:a,onSuccess:function(a){this._results=a;this._showResults()}.bind(this)})}else this._hideResults()},_onKeyDown:function(a){if((a.keyCode==Event.KEY_UP||a.keyCode==Event.KEY_DOWN||a.keyCode==Event.KEY_TAB||
a.keyCode==Event.KEY_RETURN||a.keyCode==Event.KEY_ESC)&&0<this._results.length){if(a.keyCode==Event.KEY_UP||a.keyCode==Event.KEY_DOWN)a.keyCode==Event.KEY_DOWN?this._moveCursorDown():this._moveCursorUp();else if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||a.keyCode==Event.KEY_ESC)a.keyCode==Event.KEY_RETURN||a.keyCode==Event.KEY_TAB?this._takeResult():this._hideResults();a.keyCode!=Event.KEY_TAB&&new Event.stop(a)}},_takeResult:function(){for(var a=this._results.length,b=0;b<a;b++)if(!0==
this._results[b].selected){this._element.value=this._results[b].selectText;this._hideResults();"undefined"!=typeof this._options.afterUpdateElement&&(this._options.afterUpdateElement(this._results[b]),this._element.fire("external:changed"));break}},_mouseOverChoice:function(a,b){var c=$(this._cachedId);if(c){for(var d=this._results.length,e=0;e<d;e++)this._results[e].selected=!1;c=c.getElement("selected");null!==c&&c.removeClassName("selected");this._results[a].selected=!0;b.addClassName("selected")}},
_selectThisChoice:function(a,b){if("undefined"!=typeof this._results[a])this._element.value=this._results[a].selectText,"undefined"!=typeof this._options.afterUpdateElement&&(this._options.afterUpdateElement(this._results[a]),this._element.fire("external:changed")),this._hideResults();new Event.stop(b)},_hideResults:function(){var a=$(this._cachedId);a&&a.hide()},_showResults:function(){try{var a=$(this._cachedId);if(!a)a=document.createElement("DIV"),a.id=this._cachedId,a.addClassName("autocomplete"),
this._element.insert({after:a}),a.hide();!1==a.visible()&&Position.clone(this._element,a,{setHeight:!1,offsetTop:this._element.offsetHeight});this._showChoices(a,0)}catch(b){HfosException.show(b)}},_showChoices:function(a,b){var c=this._results.length;if(0<c){for(var d=document.createElement("UL"),e=document.createDocumentFragment(),f=0;f<c;f++){var g=document.createElement("LI");f==b?(g.addClassName("selected"),this._results[f].selected=!0):this._results[f].selected=!1;g.setAttribute("id",this._results[f].value);
g.update(this._results[f].optionText);g.observe("mouseenter",this._mouseOverChoice.bind(this,f,g));g.observe("click",this._selectThisChoice.bind(this,f));e.appendChild(g)}d.appendChild(e);a.innerHTML="";a.appendChild(d);a.show()}else a.hide()},destroy:function(){this._hideResults();this._cachedKeyDown&&new Event.stopObserving(this._element,"keydown",this._cachedKeyDown);this._cachedKeyUp&&new Event.stopObserving(this._element,"keyup",this._cachedKeyUp);this._cachedOnclick&&new Event.stopObserving(this._parentNode,
"click",this._cachedOnclick)}});
var HfosDraggable=Class.create({_element:null,_mouseDownEvent:null,_mouseUpEvent:null,_mouseMoveEvent:null,_options:null,_active:!1,_dragElement:null,initialize:function(a,b){this._element=a;"undefined"!=typeof b?(this._options=b,this._dragElement=b.handle):(this._options={},this._dragElement=a);this._mouseDownEvent=this._startDrag.bind(this);this._mouseMoveEvent=this._updateDrag.bind(this);this._mouseUpEvent=this._stopDrag.bind(this);this._mouseLeaveEvent=this._stopDrag.bind(this);this._dragElement.observe("mousedown",
this._mouseDownEvent);this._element.observe("mousemove",this._mouseMoveEvent);this._element.observe("mouseup",this._mouseUpEvent);this._element.observe("mouseleave",this._mouseLeaveEvent)},_startDrag:function(a){if(Event.isLeftClick(a)&&"INPUT"!=a.target.tagName&&"SELECT"!=a.target.tagName){var a=[Event.pointerX(a),Event.pointerY(a)],b=this._element.positionedOffset();this._offset=[];this._offset[0]=a[0]-b[0];this._offset[1]=a[1]-b[1];this._active=!0}},_updateDrag:function(a){!0==this._active&&(a=
[Event.pointerX(a),Event.pointerY(a)],this._element.setStyle({left:a[0]-this._offset[0]+"px",top:a[1]-this._offset[1]+"px"}))},_stopDrag:function(){this._active=!1;if("function"==typeof this._options.onEnd)this._options.onEnd({element:this._element})},_leaveDrag:function(a){if(!0==this._active&&Event.pointerY(a)>this._element.offsetTop-200)this._active=!1}});
var HfosBrowseData=Class.create({_container:null,_id:null,_pagePointer:1,_rowPointer:0,_numberResults:0,_numberPages:0,_rowsPerPage:0,_enableDetailsButton:!0,_enableDeleteButton:!0,_autoRowsPerPage:!1,initialize:function(a,b){this._container="undefined"!=typeof a.notifyContentChange?a:a.getContainer();if("undefined"!=typeof this._container)this._id=this._container.getId();this._rowsPerPage="undefined"==typeof b?19:b},setEnableDetailsButton:function(a){this._enableDetailsButton=a},setEnableDeleteButton:function(a){this._enableDeleteButton=
a},setAutoRowsPerPage:function(a){this._autoRowsPerPage=a},build:function(a,b){if(!0==this._autoRowsPerPage){for(var c='<table class="hyBrowseTab zebraSt sortable" cellspacing="0" width="95%" align="center"><tbody><tr>',d=0;d<b.results.data.length;d++){for(var e=b.results.data[d],c=c+'<tr class="hySortRow">',f=0;f<e.data.length;f++)c+="<td>"+e.data[f].value+"</td>";c+="</tr>"}a.update(c+"</tbody></table>");var c=a.selectOne("td"),d=Hfos.getApplication().getWorkspace().getWindowManager().getActiveWindow().getContentElement(),
g=a.positionedOffset();this._rowsPerPage=parseInt((d.offsetHeight-g[1])/(c.getHeight()+3),10)-3;if(5>this._rowsPerPage)this._rowsPerPage=5}for(var h=[],l=[],g=0,c='<table class="hyBrowseTab zebraSt sortable" cellspacing="0" width="95%" align="center"><thead><tr>',d=0;d<b.results.headers.length;d++){e=b.results.headers[d];c="S"==e.ordered?c+('<th class="sortcol sortasc">'+e.name+"</th>"):c+('<th class="sortcol">'+e.name+"</th>");l[g]="undefined"==typeof e.type?"left":"int"==e.type||"decimal"==e.type?
"right":"left";if(e.class)h[g]=e.class;g++}c+="</th>";!0==this._enableDetailsButton&&(c+='<th class="nosort">&nbsp;</th>');!0==this._enableDeleteButton&&(c+='<th class="nosort">&nbsp;</th>');c+="</tr></thead><tbody>";for(d=g=0;d<b.results.data.length;d++){e=b.results.data[d];if(Object.isArray(e.primary))e.primary=e.primary.join("&");c=g<this._rowsPerPage?c+('<tr class="hySortRow" title="'+e.primary+"&n="+g+'">'):c+('<tr class="hySortRow" style="display:none" title="'+e.primary+"&n="+g+'">');for(f=
0;f<e.data.length;f++){var k="";h[f]&&(k='class="'+h[f]+'"');c+='<td align="'+l[f]+'" '+k+">"+e.data[f].value+"</td>"}!0==this._enableDetailsButton&&(c+='<td class="hyDetailsTd"><div class="hyDetails" title="'+e.primary+"&n="+g+'"></div></td>');!0==this._enableDeleteButton&&(c+='<td class="hyDeleteTd"><div class="hyDelete" title="'+e.primary+"&n="+g+'"></div></td>');c+="</tr>";g++}h=parseInt(b.numberResults/this._rowsPerPage+(0<b.numberResults%this._rowsPerPage?1:0),10);if(g>this._rowsPerPage){c+=
"</tbody><tbody>";for(d=b.numberResults;d<=h*this._rowsPerPage;d++)c+='<tr class="hyDummyRow" style="display:none"><td colspan="'+(b.results.headers.length+2)+'">&nbsp;</td></tr>';c+='<tr class="hyTrPager"><td align="right" colspan="'+(b.results.headers.length+2)+'"><table class="hyPager" cellspacing="0"><tr><td><div class="hyPagePrev"></div></td>';20<=h?(l=5,e=h-5,f=parseInt(0.5*h,10),k=parseInt(0.5*h,10)):(l=h,e=1,f=h,k=1);for(var o=this._container.getId(),d=1;d<=h;d++)c=1==d?c+('<td><div class="hyPage hyPageSelected" id="'+
o+"hyPage"+d+'">'+d+"</div></td>"):d<l?c+('<td><div class="hyPage hyPageMin" id="'+o+"hyPage"+d+'">'+d+"</div></td>"):d>e?c+('<td><div class="hyPage hyPageMax" id="'+o+"hyPage"+d+'">'+d+"</div></td>"):d>f&&d<k?c+('<td><div class="hyPage hyPageMedium" id="'+o+"hyPage"+d+'">'+d+"</div></td>"):c+('<td style="display:none"><div class="hyPage hyPageHidden" id="'+o+"hyPage"+d+'">'+d+"</div></td>");c+='<td><div class="hyPageNext"></div></td></tr></table></td></tr>'}a.update(c+"</tbody></table>");g>this._rowsPerPage&&
this._addPageHandlers(this._container,h);this._numberPages=h;this._numberResults=b.numberResults;this._pagePointer=1;this._rowPointer=0;this._addRowHandlers();new HfosTableSort(this._container.getElement("hyBrowseTab"))},_addPageHandlers:function(a,b){for(var c=a.select("div.hyPage"),d=0;d<c.length;d++)c[d].observe("click",function(a){this._showPage(parseInt(a.innerHTML,10))}.bind(this,c[d]));c=a.getElement("hyPagePrev");null!==c&&(2<b?c.observe("click",this.moveToPrevPage.bind(this)):c.hide());c=
a.getElement("hyPageNext");null!==c&&(2<b?c.observe("click",this.moveToNextPage.bind(this)):c.hide())},_addRowHandlers:function(){this._markPageRows();for(var a=0;a<this._pageResultsRows.length;a++)this._pageResultsRows[a].observe("click",this._selectRow.bind(this,a))},_removeSelected:function(){for(var a=this._container.select("table.hyBrowseTab tr.selected"),b=0;b<a.length;b++)a[b].removeClassName("selected")},_selectRow:function(a){this._removeSelected();this._pageResultsRows[a].addClassName("selected");
this._rowPointer=a},moveToPrevPage:function(){1<this._pagePointer&&(this._pagePointer--,this._showPage(this._pagePointer))},moveToNextPage:function(){this._pagePointer<parseInt(this._numberPages)&&(this._pagePointer++,this._showPage(this._pagePointer))},moveRecordUp:function(){1<this._rowPointer&&(this._rowPointer--,0==this._rowPointer%this._rowsPerPage&&this._showPage(parseInt(this._rowPointer/this._rowsPerPage,10)),this._selectRow(this._rowPointer))},moveRecordDown:function(){this._rowPointer<this._numberResults&&
(this._rowPointer++,0==this._rowPointer%(this._rowsPerPage+1)&&this._showPage(parseInt(this._rowPointer/this._rowsPerPage,10)+1),this._selectRow(this._rowPointer))},fromHtmlTable:function(a,b,c){this._container=a;var d=b.selectOne("tbody").select("tr");if(c<d.length){for(var e=0;e<d.length;e++)d[e].addClassName("hySortRow"),c<=e&&d[e].hide();e=b.select("th").length;a="";d=parseInt(d.length/c+(0<d.length%c?1:0),10);0==d&&(d=1);var a='<tbody><tr class="hyTrPager"><td align="right" colspan="'+e+'"><table class="hyPager" cellspacing="0"><tr><td><div class="hyPagePrev"></div></td>',
f,g,h,l;20<=d?(f=5,g=d-5,l=parseInt(0.5*d,10),h=parseInt(0.5*d,10)):(f=d,g=1,l=d,h=1);for(var k=b.id,e=1;e<=d;e++)a=1==e?a+('<td><div class="hyPage hyPageSelected" id="'+k+"hyPage"+e+'">'+e+"</div></td>"):e<f?a+('<td><div class="hyPage hyPageMin" id="'+k+"hyPage"+e+'">'+e+"</div></td>"):e>g?a+('<td><div class="hyPage hyPageMax" id="'+k+"hyPage"+e+'">'+e+"</div></td>"):e>l&&e<h?a+('<td><div class="hyPage hyPageMedium" id="'+k+"hyPage"+e+'">'+e+"</div></td>"):a+('<td style="display:none"><div class="hyPage hyPageHidden" id="'+
k+"hyPage"+e+'">'+e+"</div></td>");b.innerHTML+=a+'<td><div class="hyPageNext"></div></td></tr></table></td></tr></tbody>';this._addPageHandlers(b,d)}this._id=b.id;this._rowsPerPage=c},_markPageRows:function(){if(null==this._pageResultsRows)this._pageResultsRows=this._container.select("table.hyBrowseTab tr")},_showPage:function(a){try{this._markPageRows();var b=this._container.getElement("hyPageSelected");if(b){b.removeClassName("hyPageSelected");var c=$(this._id+"hyPage"+a);if(c){c.addClassName("hyPageSelected");
if(c.hasClassName("hyPageHidden")){var d,e;b.id.replace(this._id+"hyPage","")<a?(d=a,e=a+4):(d=a-4,e=a);for(var f=this._container.select("div.hyPageMedium"),b=0;b<f.length;b++)f[b].parentNode.hide();for(var g=this._container.select("div.hyPageHidden"),b=0;b<g.length;b++)g[b].parentNode.hide();for(b=d;b<=e;b++)$(this._id+"hyPage"+b).parentNode.show()}this._pagePointer=a;this._paginateResult();this._container.notifyContentChange()}}}catch(h){HfosException.show(h)}},_paginateResult:function(){for(var a=
1,b=0,c=(this._rowsPerPage+1)*(this._pagePointer-1)+1,d=this._pageResultsRows.length-1,e=0;e<=d;e++)1<a&&(a>=c&&b<this._rowsPerPage?(this._pageResultsRows[e].show(),b++):d>a&&this._pageResultsRows[e].hide()),a++},deleteRow:function(a){this._markPageRows();a.erase();this._paginateResult();this._numberResults--;this._pagePointer<this._numberPages?this._showPage(this._pagePointer):(a=this._container.getElement("hyTrPager"),null!==a&&a.hide());this._removeSelected();this._rowPointer=0},setNumberResults:function(a){this._numberResults=
a},getNumberResults:function(){return parseInt(this._numberResults,10)},setPagePointer:function(a){this._pagePointer=a},getPagePointer:function(){return this._pagePointer},getRowPointer:function(){return this._rowPointer},getSelectedRow:function(){return this._container.selectOne("table.hyBrowseTab tr.selected")},getRows:function(){return this._container.select("tr.hySortRow")},getDetailsButtons:function(){return this._container.select("div.hyDetails")},getDeleteButtons:function(){return this._container.select("div.hyDelete")},
restore:function(a){this._element=a;var b=this._container.selectOne("table.hyBrowseTab");if(null!==b){b=b.select("tr.hySortRow");this._numberResults=b.length;for(var c=0,d=-1,e=0;e<b.length;e++)b[e].visible()&&(c++,-1==d&&(d=e));var f=1;if(0<c)for(e=c;e<b.length;e+=c)if(d<e){this._pagePointer=f;break}else f++;else this._pagePointer=1;this._rowsPerPage=c;this._addPageHandlers(a,parseInt(b.length/c,10))}},reset:function(){delete this._pageResultsRows;this._pageResultsRows=null;this._numberResults=0;
this._pagePointer=1;this._rowsPerPage=0}});
var HfosReportType={_showSelect:function(a,b,c,d){a.show();b.hide();c.setStyle({width:"180px"});d.store("previous",d.getValue())},_onChangeType:function(a,b,c){this.blur();a.hide();b.show();c.setStyle({width:"100px"});var a=0,c=this.getValue(),d=this.retrieve("previous");switch(c){case "screen":switch(d){case "html":a=1;break;case "excel":a=2;break;case "pdf":a=3;break;case "pdf":a=4}break;case "html":switch(d){case "screen":a=-1;break;case "excel":a=1;break;case "pdf":a=2;break;case "text":a=3}break;
case "excel":switch(d){case "screen":a=-2;break;case "html":a=-1;break;case "pdf":a=1;break;case "text":a=2}break;case "pdf":switch(d){case "screen":a=-3;break;case "html":a=-2;break;case "excel":a=-1;break;case "text":a=1}break;case "text":switch(d){case "screen":a=-4;break;case "html":a=-3;break;case "excel":a=-2;break;case "text":a=-1}}new Effect.Move(b,{duration:0.5,y:50*a})},observeReportType:function(a){"undefined"==typeof a&&(a=Hfos.getApplication().getWorkspace().getWindowManager().getActiveWindow());
var b=a.getElement("hyReportType");if(b){var c=a.getElement("hyChReportType"),d=a.getElement("hyReportTable"),a=a.getElement("reportType"),e=HfosReportType._onChangeType.bind(a,c,d,b);d.observe("click",HfosReportType._showSelect.bind(window,c,d,b,a));a.observe("change",e);e()}},changeReportType:function(a,b){"undefined"==typeof b&&(b=Hfos.getApplication().getWorkspace().getWindowManager().getActiveWindow());var c=b.getElement("hyReportType");if(c){var d=b.getElement("hyChReportType"),e=b.getElement("hyReportTable"),
f=b.getElement("reportType"),c=HfosReportType._onChangeType.bind(f,d,e,c);f.setValue(a);c()}}};var HfosVideo={toFullScreen:function(){}};
var HfosCommunications=Class.create({_enabled:null,_communicationInterval:null,initialize:function(){},listen:function(){var a=2E4;window.location.host.include("bhteck.net")?a*=15:window.location.host.include("wepax.com.co")?a*=5:window.location.host.include("localhost")&&(a*=10);this._communicationInterval=window.setInterval(this._pollMessages.bind(this),a)},_pollMessages:function(){navigator.onLine&&new HfosAjax.JsonApplicationRequest("identity/workspace/getMessages",{onSuccess:this._onMessage.bind(this)})},
_onMessage:function(a){if("OK"==a.status)for(var b=0;b<a.messages.length;b++)this.fire(a.messages[b])},stop:function(){window.clearInterval(this._communicationInterval)},observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a){try{var b=a.type;if(!Object.isUndefined(this["_"+b]))for(var c=0;c<this["_"+b].length;c++)if(!1===this["_"+b][c](a))return!1;return!0}catch(d){HfosException.show(d)}}});
var HfosHttpReadyState={onReadyStateChange:function(a,b){try{switch(a.readyState){case 0:if("undefined"!=typeof b.onUninitialized)b.onUninitialized(a);break;case 1:if("undefined"!=typeof b.onLoading)b.onLoading(a);break;case 2:case 3:if("undefined"!=typeof b.onInteractive)b.onInteractive(a);break;case 4:if(200==a.status){if("undefined"!=typeof b.onSuccess)b.onSuccess(a)}else if(400<=a.status&&599>=a.status&&"undefined"!=typeof b.onFailure)b.onFailure(a);if("undefined"!=typeof b.onComplete)b.onComplete(a);
delete this._xmlHttpRequest;delete this._options}}catch(c){if("undefined"!=typeof b.onException)b.onException(c,a);else HfosException.show(c,a)}}},HfosHttpRequest=Class.create({_xmlHttpRequest:null,_options:{},initialize:function(a,b,c){try{this._xmlHttpRequest=new XMLHttpRequest;"undefined"==typeof b&&(b={});b.method="undefined"==typeof b.method?"POST":b.method.toUpperCase();if("undefined"!=typeof b.parameters&&"string"!=typeof b.parameters)b.parameters=$H(b.parameters).toQueryString();"GET"==b.method&&
"undefined"!=typeof b.parameters&&(a+="?"+b.parameters);"undefined"==typeof c&&(c=!0);this._xmlHttpRequest.open(b.method,a,!0);this._xmlHttpRequest.onreadystatechange=HfosHttpReadyState.onReadyStateChange.bind(this,this._xmlHttpRequest,b);this._options=b;if("undefined"!=typeof this._options.onCreate)this._options.onCreate(this._xmlHttpRequest);this._xmlHttpRequest.setRequestHeader("Accept","text/html, application/xml, text/xml, */*");this._xmlHttpRequest.setRequestHeader("X-Requested-With","XMLHttpRequest");
b.contentTypeJson&&this._xmlHttpRequest.setRequestHeader("X-Json-Accept","text/json");"POST"==b.method&&this._xmlHttpRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}catch(d){HfosException.show(d)}!0==c&&this.send()},send:function(){try{"undefined"==typeof this._options.parameters?this._xmlHttpRequest.send():"GET"==this._options.method?this._xmlHttpRequest.send():this._xmlHttpRequest.send(this._options.parameters)}catch(a){HfosException.show(a)}},getHttpRequest:function(){return this._xmlHttpRequest}}),
HfosAjax={setCallbacks:function(a){"undefined"==typeof a&&(a={});if("undefined"==typeof a.onFailure)a.onFailure=HfosAjax.onFailure;if("undefined"==typeof a.onException)a.onException=HfosAjax.onException;return a},bindHtml:function(a,b,c){if("undefined"!=typeof c[a]&&"undefined"==typeof c[a].wasBinded){var d=!1;if("undefined"!=typeof c.checkAcl)d=c.checkAcl;c[a]=!1==d?function(a,b){a(b)}.bind(this,c[a]):HfosWallet.has(b)?function(a,b){a(b)}.bind(this,c[a]):function(a,b,c){var d=c.getResponseHeader("X-Application-State");
"null"==typeof d&&(d="OK");if("OK"==d)HfosWallet.store(a,!0),b(c);else if(d&&"Unauthorized"==d.split(", ")[0]){var a=c.getResponseHeader("X-Acl-Description"),d=c.getResponseHeader("X-Acl-Elevation"),l=c.getResponseHeader("X-Resource"),k=c.getResponseHeader("X-Action");HfosAcl.handleFailedCheck({elevation:d,description:a},l+"/"+k,b.shift(c))}else b(c)}.bind(this,b,c[a]);c[a].wasBinded=!0}return c},bindJson:function(a,b,c){c.contentTypeJson=!0;if("undefined"!=typeof c[a]&&"undefined"==typeof c[a].wasBinded){var d=
!1;if("undefined"!=typeof c.checkAcl)d=c.checkAcl;c[a]=!1==d?function(a,b){a(Json.decode(b.responseText),b)}.bind(this,c[a]):HfosWallet.has(b)?function(a,b){a(Json.decode(b.responseText),b)}.bind(this,c[a]):function(a,b,c){if(!c.responseText.trim())return alert("Error: responseText is empty result"),!1;var d=Json.decode(c.responseText);"undefined"==typeof d.status?b(d,c):"SECURITY"==d.status?HfosAcl.handleFailedCheck(d.accessInfo,d.resource+"/"+d.action,b.shift(d)):(HfosWallet.store(a,!0),b(d,c))}.bind(this,
b,c[a]);c[a].wasBinded=!0}return c},onFailure:function(a){HfosException.showRemote(a)},onException:function(a,b){HfosException.show(a,b)}};HfosAjax.Request=function(a,b){b=HfosAjax.setCallbacks(b);b=HfosAjax.bindHtml("onSuccess",a,b);return new HfosHttpRequest(Utils.getKumbiaURL(a),b)};HfosAjax.ApplicationRequest=function(a,b){if(null!==a)return b=HfosAjax.setCallbacks(b),new HfosHttpRequest(Utils.getURL(a),b)};
HfosAjax.JsonApplicationRequest=function(a,b){if(null!==a)return b=HfosAjax.setCallbacks(b),b=HfosAjax.bindJson("onSuccess",a,b),new HfosHttpRequest(Utils.getURL(a),b)};HfosAjax.JsonRequest=function(a,b){if(null!==a)return b=HfosAjax.setCallbacks(b),b=HfosAjax.bindJson("onSuccess",a,b),new HfosHttpRequest(Utils.getKumbiaURL(a),b)};
HfosAjax.Updater=function(a,b,c){c=HfosAjax.setCallbacks(c);c.onSuccess="undefined"==typeof c.onSuccess?function(a,b){a.update(b.responseText)}.bind(this,a):function(a,b,c){a.update(c.responseText);b()}.bind(this,a,c.onSuccess);new HfosAjax.Request(b,c)};HfosAjax.FormRequest=function(a,b){b=HfosAjax.setCallbacks(b);b.parameters=a.serialize();b.method=a.method;return new HfosHttpRequest(a.getAttribute("action"),b)};
HfosAjax.JsonFormRequest=function(a,b){b=HfosAjax.setCallbacks(b);b=HfosAjax.bindJson("onSuccess",a.getAttribute("action"),b);b.parameters=a.serialize();b.method=a.getAttribute("method");if("undefined"==typeof b.longProcess)return new HfosHttpRequest(a.getAttribute("action"),b);(new HfosBgProcess).request(a.getAttribute("action"),b)};
HfosAjax.Autocompleter=function(a,b,c){var d=$("completerChoices");d||(d=document.createElement("DIV"),d.addClassName("autocomplete"),a.insert({after:d}));if("undefined"==typeof c.minChars)c.minChars=3;c=HfosAjax.setCallbacks(c);return new Ajax.Autocompleter(a,d,Utils.getKumbiaURL(b),c)};HfosAjax.UploadFile=function(a){a.disable()};
var HfosCommon={getContext:function(a){if(Object.isElement(a))return a;var b=Hfos.getApplication();return null!==b?(b=b.getWorkspace().getWindowManager().getActiveWindow(),"undefined"!=typeof a?b.getElement(a):b):document.body},_queryByCuenta:function(a,b){""!=a.getValue()?new HfosAjax.JsonRequest("cuentas/queryByCuenta",{method:"GET",parameters:"cuenta="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)}):b.setValue("")},_updateCodigoCuenta:function(a,
b){a.setValue(b.value)},addCuentaCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"cuentas/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoCuenta.bind(this,c)});c.observe("blur",HfosCommon._queryByCuenta.bind(this,c,d));""!=c.getValue()&&""==d.getValue()&&HfosCommon._queryByCuenta.bind(this,c,d)()}}catch(e){HfosException.show(e)}},_queryByCentro:function(a,b){""!=a.getValue()?
new HfosAjax.JsonRequest("centros/queryByCentro",{method:"GET",parameters:"centro="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)}):b.setValue("")},_updateCodigoCentro:function(a,b){a.setValue(b.value)},addCentroCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"centros/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoCentro.bind(this,
c)});c.observe("blur",HfosCommon._queryByCentro.bind(this,c,d));""!=c.getValue()&&""==d.getValue()&&HfosCommon._queryByCentro.bind(this,c,d)()}}catch(e){HfosException.show(e)}},_queryBySocio:function(a,b){""!=a.getValue()?new HfosAjax.JsonRequest("socios/queryBySocios",{method:"GET",parameters:"socio="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)}):b.setValue("")},_updateCodigoSocio:function(a,b){a.setValue(b.value)},addSocioCompleter:function(a,
b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"socios/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoSocio.bind(this,c)});c.observe("blur",HfosCommon._queryBySocio.bind(this,c,d));""!=c.getValue()&&""==d.getValue()&&HfosCommon._queryBySocio.bind(this,c,d)()}}catch(e){HfosException.show(e)}},_queryBySocioTc:function(a,b){""!=a.getValue()?new HfosAjax.JsonRequest("contratos/queryBySocios",
{method:"GET",parameters:"socio="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)}):b.setValue("")},_updateCodigoSocioTc:function(a,b){a.setValue(b.value)},addSocioTcCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"contratos/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoSocioTc.bind(this,c)});c.observe("blur",
HfosCommon._queryBySocioTc.bind(this,c,d));""!=c.getValue()&&""==d.getValue()&&HfosCommon._queryBySocioTc.bind(this,c,d)()}}catch(e){HfosException.show(e)}},_queryByComprob:function(a,b){""!=a.getValue()?new HfosAjax.JsonRequest("comprobantes/queryByComprob",{method:"GET",parameters:"comprob="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)}):b.setValue("")},_updateCodigoComprob:function(a,b){a.setValue(b.value)},addComprobCompleter:function(a,
b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"comprobantes/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoComprob.bind(this,c)});c.observe("blur",HfosCommon._queryByComprob.bind(this,c,d));""!=c.getValue()&&""==d.getValue()&&HfosCommon._queryByComprob.bind(this,c,d)()}}catch(e){HfosException.show(e)}},_queryByNit:function(a,b,c){""!=a.getValue()&&new HfosAjax.JsonRequest("terceros/queryByNit",
{method:"GET",parameters:"nit="+a.getValue(),onSuccess:function(a,b,c,g){"OK"==g.status?(b.setValue(g.nombre),"undefined"!=typeof c&&c.hide()):(b.setValue(g.message),"undefined"!=typeof c&&c.show())}.bind(this,a,b,c)})},afterShowNitCrear:function(a){var b=a.selectOne("select#clase");b.observe("change",function(a){var b=this.selectOne("label#nombreLabel"),a=a.getValue();"A"==a?b.update("Raz\u00f3n Social"):b.update("Apellidos y Nombres");new HfosAjax.JsonRequest("tipodoc/queryByClase",{parameters:"clase="+
a,onSuccess:function(a){var b=this.selectOne("select#tipodoc");b.innerHTML="";for(var c=0;c<a.length;c++){var d=document.createElement("OPTION");d.value=a[c].value;d.innerHTML=a[c].text;b.appendChild(d)}}.bind(this)})}.bind(a,b))},_createTercero:function(a,b,c){var d=b.getValue();d.include("NO EXISTE")&&(d="");new HfosModalForm(this,"terceros/crear",{defaults:{nit:a.getValue(),nombre:d},beforeClose:function(a,b,c,d,l){var k=d.selectOne("input#nombre"),c=d.selectOne("input#nit");a.setValue(c.getValue());
b.setValue(k.getValue());a.focus();!0==l?c.show():c.hide()}.bind(this,a,b,c)})},_updateNitTercero:function(a,b){a.setValue(b.value)},addTerceroCompleter:function(a,b,c){try{if(c=HfosCommon.getContext(c)){var d,e=c.selectOne("input#"+a);if(e){var f=c.selectOne("input#"+a+"_det");"undefined"!=typeof b&&!0==b&&(d=c.selectOne("input#"+a+"_create"),d.observe("click",HfosCommon._createTercero.bind(this,e,f,d)),d.hide());new HfosAutocompleter(f,"terceros/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateNitTercero.bind(this,
e)});e.observe("blur",HfosCommon._queryByNit.bind(this,e,f,d))}}}catch(g){HfosException.show(g)}},_updateCodigoComprob:function(a,b){a.setValue(b.value)},_queryByCodigoComprob:function(a,b,c){""!=a.getValue()&&new HfosAjax.JsonRequest("comprobantes/queryByCodigo",{method:"GET",parameters:"codigo="+a.getValue(),onSuccess:function(a,b,c,g){"OK"==g.status?(b.setValue(g.nombre),"undefined"!=typeof c&&c.hide()):(b.setValue(g.message),"undefined"!=typeof c&&c.show())}.bind(this,a,b,c)})},addComprobCompleter:function(a,
b,c){try{var c=HfosCommon.getContext(c),d=c.selectOne("input#"+a);if(d){var e=c.selectOne("input#"+a+"_det");new HfosAutocompleter(e,"comprobantes/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoComprob.bind(this,d)});d.observe("blur",HfosCommon._queryByCodigoComprob.bind(this,d,e,void 0))}}catch(f){HfosException.show(f)}},_createUsuario:function(a,b,c){var d=b.getValue();d.include("NO EXISTE")&&(d="");new HfosModalForm(this,"Usuarios/crear",{defaults:{nit:a.getValue(),
nombre:d},beforeClose:function(a,b,c,d,l){d=d.selectOne("input#nombres");b.setValue(d.getValue());a.focus();!0==l?c.show():c.hide()}.bind(this,a,b,c)})},_updateNitUsuario:function(a,b){a.setValue(b.value)},addUsuarioCompleter:function(a,b,c){try{var c=HfosCommon.getContext(c),d,e=c.selectOne("input#"+a);if(e){var f=c.selectOne("input#"+a+"_det");"undefined"!=typeof b&&!0==b&&(d=c.selectOne("input#"+a+"_create"),d.observe("click",HfosCommon._createUsuario.bind(this,e,f,d)),d.hide());new HfosAutocompleter(f,
"usuarios/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateNitUsuario.bind(this,e)});e.observe("blur",HfosCommon._queryByNit.bind(this,e,f,d))}}catch(g){HfosException.show(g)}},_queryByActivo:function(a,b){""!=a.getValue()&&new HfosAjax.JsonRequest("activos/queryByCodigo",{method:"GET",parameters:"codigo="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)})},_updateCodigoActivo:function(a,b){a.setValue(b.value)},addActivoCompleter:function(a,
b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(activeElement){var d=b.selectOne("input#"+a+"_det");c&&d&&(new HfosAutocompleter(d,"activos/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoActivo.bind(this,c)}),c.observe("blur",HfosCommon._queryByActivo.bind(this,c,d)))}}catch(e){HfosException.show(e)}},_queryByItem:function(a,b){""!=a.getValue()&&new HfosAjax.JsonRequest("referencias/queryByItem",{method:"GET",parameters:"codigo="+a.getValue(),onSuccess:function(a,
b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)})},_queryByItemReceta:function(a,b,c){""!=a.getValue()&&new HfosAjax.JsonRequest("referencias/queryByItemReceta",{method:"GET",parameters:"codigo="+a.getValue()+"&tipoDet="+c.getValue(),onSuccess:function(a,b,c){"OK"==c.status?(console.log(c),b.setValue(c.nombre)):b.setValue(c.message)}.bind(this,a,b)})},_queryByDiferidos:function(a,b){""!=a.getValue()&&new HfosAjax.JsonRequest("diferidos/queryByCodigo",{method:"GET",parameters:"codigo="+
a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)})},_updateCodigoDiferidos:function(a,b){a.setValue(b.value)},addDiferidosCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");c&&d&&(new HfosAutocompleter(d,"diferidos/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoDiferidos.bind(this,c)}),c.observe("blur",HfosCommon._queryByDiferidos.bind(this,
c,d)))}}catch(e){HfosException.show(e)}},_updateItem:function(a,b){a.setValue(b.value)},addItemCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");new HfosAutocompleter(d,"referencias/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateItem.bind(this,c)});c.observe("blur",HfosCommon._queryByItem.bind(this,c,d))}}catch(e){HfosException.show(e)}},addItemRecetaCompleter:function(a,b){try{var b=HfosCommon.getContext(b),
c=b.selectOne("input#"+a);if(c){var d=a+"_tipo",e=b.selectOne("select#"+d),f=b.selectOne("input#"+a+"_det");new HfosAutocompleter(f,"referencias/queryByNameItemReceta",{paramName:"nombre",paramNames:[d],afterUpdateElement:HfosCommon._updateItem.bind(this,c)});c.observe("blur",HfosCommon._queryByItemReceta.bind(this,c,f,e))}}catch(g){HfosException.show(g)}},addLocationCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det"),e=b.selectOne("div#"+
a+"_choices"),f=$Kumbia.path+"common/getLocations";300>d.getWidth()&&(f+="?short");new Ajax.Autocompleter(d,e,f,{paramName:"id",minChars:2,afterUpdateElement:function(a,b,c){a.setValue(c.id)}.bind(this,c)})}}catch(g){HfosException.show(g)}},_queryByEmpleado:function(a,b){""!=a.getValue()&&new HfosAjax.JsonRequest("empleados/queryByEmpleado",{method:"GET",parameters:"codigo="+a.getValue(),onSuccess:function(a,b,e){"OK"==e.status?b.setValue(e.nombre):b.setValue(e.message)}.bind(this,a,b)})},_updateEmpleadoActivo:function(a,
b){a.setValue(b.value)},_updateCodigoEmpleado:function(a,b){a.setValue(b.value)},addEmpleadoCompleter:function(a,b){try{var b=HfosCommon.getContext(b),c=b.selectOne("input#"+a);if(c){var d=b.selectOne("input#"+a+"_det");c&&d&&(new HfosAutocompleter(d,"empleados/queryByName",{paramName:"nombre",afterUpdateElement:HfosCommon._updateCodigoEmpleado.bind(this,c)}),c.observe("blur",HfosCommon._queryByEmpleado.bind(this,c,d)))}}catch(e){HfosException.show(e)}},findWindow:function(a){for(var a=a.ancestors(),
b=0;b<a.length;b++)if(a[b].hasClassName("window-main")){var c=Hfos.getApplication();return null!==c?c.getWorkspace().getWindowManager().getWindow(a[b].id):document.body}return null},restoreCompleters:function(a){for(var b=["tercero","item","cuenta"],c=0;c<b.length;c++)for(var d=a.select("."+b[c]+"Completer"),e=0;e<d.length;e++){var f=d[e].getElement(b[c]+"Detalle");if(f){var g=f.id.replace("_det",""),f=f.up(2);switch(b[c]){case "tercero":HfosCommon.addTerceroCompleter(g,!1,f);break;case "item":HfosCommon.addItemCompleter(g,
f);break;case "cuenta":HfosCommon.addCuentaCompleter(g,f)}}}}};
var HfosLogin=Class.create({_onSuccess:null,_cachedKeyDown:null,initialize:function(a,b){this._onSuccess=b;new HfosAjax.ApplicationRequest("identity/login",{parameters:"appCode="+a,onSuccess:function(a){var b=document.createElement("DIV");b.update(a.responseText);document.body.appendChild(b);this._addCallbacks()}.bind(this)})},_addCallbacks:function(){$("login").observe("focus",function(){if("Nombre de Usuario"==this.value)this.removeClassName("dummy"),this.value=""});$("login").observe("blur",function(){if(""==
this.value)this.addClassName("dummy"),this.value="Nombre de Usuario"});$("passwordDummy").observe("focus",function(){this.hide();$("password").show();$("password").activate()});$("password").observe("blur",function(){""==this.value&&(this.hide(),$("passwordDummy").show())});$("loginButton").observe("click",this._onLogin.bind(this));this._cachedKeyDown=function(a){a.keyCode==Event.KEY_RETURN&&this._onLogin()}.bind(this);new Event.observe(window,"keydown",this._cachedKeyDown)},_onLogin:function(){new HfosAjax.JsonRequest("session/start/"+
$F("login")+"/"+$F("password"),{onLoading:function(){$("login").form.disable()},onSuccess:function(a){!0==a?new Effect.Fade("login-view",{duration:0.5,afterFinish:function(){this._onSuccess();this._cachedKeyDown&&new Event.stopObserving(window,"keydown",this._cachedKeyDown);this._cachedKeyDown=null;var a=$("login-view");a&&a.erase()}.bind(this)}):(new Effect.Shake("login-box",{duration:0.5}),window.setTimeout(function(){""==$F("login")?$("login").activate():$("password").activate()},550))}.bind(this),
onComplete:function(){$("login").form.enable()}})}});var HyperRecordData=Class.create(Enumerable,{_data:null,initialize:function(a){this._data=a},getValueFromName:function(a){if("undefined"!=typeof this._data)for(var b=0;b<this._data.length;b++)if(this._data[b].name==a)return this._data[b].value;return null}});
var HyperGridGroup=Class.create(Enumerable,{_rows:[],_onlyChanged:!1,addRow:function(a){this._rows.push(a)},_each:function(a){for(var b=0;b<this._rows.length;b++)!0==this._onlyChanged?!0==this._rows[b].wasChanged()&&a(this._rows[b]):a(this._rows[b])},eachRowChanged:function(a){this._onlyChanged=!0;this.each(a)},findFirst:function(a,b){for(var c=0;c<this._rows.length;c++)if(this._rows[c].getValue(a)==b)return this._rows[c];return!1},alter:function(a){for(var b=0;b<this._rows.length;b++)this._rows[b].getValue("idGrid")==
a.getValue("idGrid")&&(this._rows[b]=a,alert(b))}});
var HyperGridRow=Class.create(Enumerable,{_data:{},_changed:!1,_onlyChanged:!1,setValue:function(a,b,c){"undefined"==typeof c&&(c=!0);if(!0==c)this._changed=!0;this._data[a]={value:b,changed:c}},getValue:function(a){return"undefined"!=typeof this._data[a]?this._data[a].value:null},wasChanged:function(){return this._changed},_each:function(a){$H(this._data).each(function(b){!0==this._onlyChanged?!0==b.changed&&a(b):a(b)}.bind(this))},eachColumnChanged:function(a){this._onlyChanged=!0;this.each(a)}});
var HyperGridData={},HyperGrid=Class.create({_hyperForm:null,_rows:[],_idGrid:1,_editId:0,_bulkLoad:!1,_numberChanged:0,_element:null,_field:{},initialize:function(a,b,c){this._fields=$H(b);this._hyperForm=a;a.observe("beforeSendForm",this._setPostDataDetail.bind(this));a.observe("beforeInput",this._prepareForInput.bind(this));a=a.getLateGridBindings();Object.isUndefined(a)||$H(a).each(function(a){this.observe(a[0],a[1])}.bind(this));!1==c?this.fire("afterInitialize"):(this._prepareForInput(),this.clear(),
this.restoreState())},_setPostDataDetail:function(){for(var a=this._fields.keys(),b=0;b<a.length;b++)this.getField(a[b]).disable();this._hyperForm.getActiveSection().getElement("hyGridDataDetail").update("");return!0},loadBaseData:function(a,b){if("undefined"!=typeof HyperGridData[a]){this._bulkLoad=!0;for(var c=HyperGridData[a],d=0;d<c.length;d++){for(var e=c[d],f=0;f<b.length;f++){var g=b[f],h=this.getField(g);null!==h&&h.setValue(e[g])}this.addRow(!0)}delete HyperGridData[a];this._storeRows();
this._bulkLoad=!1}},setBulkLoad:function(a){this._bulkLoad=a},addRow:function(a){if(!1==this._bulkLoad){if(!1===this.fire("beforeValidate")||!1===this._validateEntry())return;if(0<this._editId){if(!1===this.fire("beforeUpdate"))return}else if(!1===this.fire("beforeInsert"))return}var b=this._element.getElement("hyGridBodyTable"),c=document.createElement("TR");c.addClassName("hySortRow");c.id=0<this._editId?"tr"+this._editId:"tr"+this._idGrid;var d=document.createElement("TD");d.addClassName("row-number");
d.update('<span class="row-number-span">0</span><input type="hidden" name="action[]" value="add"/>');c.appendChild(d);for(var e=$H({}),f=this._fields.keys(),g=0;g<f.length;g++){var h=f[g],l=this._fields.get(h),k="undefined"!=typeof l.align?l.align:l.type.match(/int|decimal/)?"right":"left",d=document.createElement("TD"),o=this._getTextValue(h)+"<input type='hidden' name='"+h+"[]' class='"+h+"' value='"+this.getField(h).getValue()+"'/>";d.update(o);d.setAttribute("align",k);d.addClassName(h);c.appendChild(d);
!0!=l.ignore&&e.set(h,this.getField(h).getValue());this.getField(h).setValue(l.type.match(/domain|relation/)?"@":"");d=this.getField(h+"_det");null!=d&&(e.set(h+"_det",$F(d)),d.setValue(""))}f=!1;e.set("action","add");if(0<this._editId)for(g=0;g<this._rows.length;g++){if(this._rows[g].get("idGrid")==this._editId){e.set("idGrid",parseInt(this._editId,10));this._rows[g]=e;f=!1;break}}else e.set("idGrid",this._idGrid++),this._rows.push(e);d=document.createElement("TD");d.addClassName("hyGridEdtImage");
d.update('<img src="'+$Kumbia.path+'img/backoffice/edit.png" id="img'+e.get("idGrid")+'" title="Editar"/>');d.observe("click",this._editItem.bind(this,e.get("idGrid")));c.appendChild(d);d=document.createElement("TD");d.addClassName("hyGridDelImage");d.update('<img src="'+$Kumbia.path+'img/backoffice/delete.gif" id="img'+e.get("idGrid")+'" title="Eliminar"/>');d.observe("click",this._removeItem.bind(this,e.get("idGrid")));c.appendChild(d);0<this._editId?(g=b.select("tr"),g.length<this._editId?b.appendChild(c):
g[this._editId-1].insert({before:c})):b.appendChild(c);this._editId=0;!1==this._bulkLoad&&this._activateFirstField();b=1;c=$$("span.row-number-span");for(g=0;g<c.length;g++)c[g].update(b),b++;!1==this._bulkLoad&&this._hyperForm._notifyContentChange();!1==a&&(this._numberChanged++,this._storeRows());if(!1==this._bulkLoad){if(!0===f){if(!1===this.fire("afterUpdate"))return}else if(!1===this.fire("afterInsert"))return;this.fire("afterModify")}},_storeRows:function(){var a=Hfos.getApplication().getStorage();
null!==a&&a.save("HyperGrids",{id:this._hyperForm.getName(),rows:this._rows})},getRowGroup:function(){for(var a=new HyperGridGroup,b=0;b<this._rows.length;b++){var c=new HyperGridRow;this._rows[b].each(function(a){c.setValue(a[0],a[1],!1)});a.addRow(c,!0)}return a},setRowGroup:function(a){a.eachRowChanged(function(a){a.eachColumnChanged(function(a){alert(a.value)})}.bind(this))},isEmpty:function(){return 0==this._rows.length},getNumberChanged:function(){return this._numberChanged},_removeItem:function(a){if(!1===
this.fire("beforeDelete"))return!1;var b=this._element.selectOne("#tr"+a);null!==b&&(b.erase(),this._hyperForm._notifyContentChange());for(b=0;b<this._rows.length;b++)if(this._rows[b].get("idGrid")==a){this._rows[b].set("action","del");break}this._numberChanged++;if(!1===this.fire("afterDelete"))return!1;this.fire("afterModify");return!0},_removeItemAll:function(){if(!1!==this.fire("beforeDelete")){if("undefined"!==typeof this._rows)for(var a=0;a<this._rows.length;a++)this._element.selectOne("#tr"+
a)&&(this._element.selectOne("#tr"+a).erase(),this._rows[a].get("idGrid")&&(this._rows[a].set("action","del"),this._numberChanged++));!1!==this.fire("afterDelete")&&this.fire("afterModify")}},_editItem:function(a){if(!1!==this.fire("beforeEdit")){var b=this._element.selectOne("#tr"+a);if(b&&(b.erase(),"undefined"!=typeof this._rows)){for(b=0;b<this._rows.length;b++)if(this._rows[b].get("idGrid")==a){this._rows[b].set("action","edt");break}for(var c=this._fields.keys(),d=0;d<c.length;d++){var e=c[d];
"undefined"!=typeof this._rows[b]&&(this.getField(e).setValue(this._rows[b].get(e)),null!=this.getField(e+"_det")&&this.getField(e+"_det").setValue(this._rows[b].get(e+"_det")))}this._editId=a;this._activateFirstField();this._numberChanged++;this.fire("afterEdit")}}},_updateRowOnGrid:function(a){if("object"!=typeof a||"object"!=typeof this._rows||0>=$H(a).length)return!1;$H(a).each(function(a){a=a[1];if(a.item)for(var c=0;c<this._rows.length;c++)if("undefined"!=typeof this._rows[c]&&null!==this._rows[c]&&
this._rows[c].get("item")==a.item.toString()){var d=this._rows[c].get("idGrid");this._rows[c].set("valor",a.valor);this._rows[c].set("action","add");(d=this._element.selectOne("#tr"+d+" td.valor"))&&d.update(a.valor)}}.bind(this))},_getTextValue:function(a){var b=this._fields.get(a);return"domain"==b.type||"relation"==b.type?(a=this.getField(a),a.options[a.selectedIndex].text):"undefined"!=typeof b.format?this._format.execute(b.format,this.getField(a).getValue()):null!=this.getField(a+"_det")?$F(this.getField(a))+
" - "+$F(this.getField(a+"_det")):this.getField(a).getValue()},_activateFirstField:function(){this.getField(this._fields.keys()[0]).activate()},_validateEntry:function(){for(var a=this._fields.keys(),b=[],c=0,d=[],e=0;e<a.length;e++){var f=a[e],g=this._fields.get(f),h=$F(this.getField(f));!Object.isUndefined(g.notNull)&&!0==g.notNull&&h.blank()&&(b.push(f),d.push("El campo "+g.single+" es requerido"),c++)}if(0==c)return!0;this.getField(b[0]).activate();this._hyperForm.getMessages().error(d.join("<br/>"));
return!1},_prepareForInput:function(){this._activeSection=this._hyperForm.getActiveSection();this._element=this._activeSection.getElement("hyGridTable");this._activeSection.getElement("hyGridAdd").observe("click",this.addRow.bind(this,!1));this._activateFirstField();this._fields.each(function(a){this.getField(a[0]).observe("keydown",function(a){a.keyCode==Event.KEY_RETURN&&(this.addRow(!1),new Event.stop(a))}.bind(this))}.bind(this));return!0},observe:function(a,b){this["_"+a]=b},fire:function(a){return Object.isUndefined(this["_"+
a])?!0:this["_"+a](this)},getElement:function(a){return this._element.getElement(a)},selectOne:function(a){return this._activeSection.selectOne(a)},getField:function(a){return this._element.selectOne("#"+a)},getSummatory:function(a){for(var b=0,a=this._element.select("input."+a),c=0;c<a.length;c++)""!==a[c].value&&(b+=parseFloat(a[c].value,10));return b},getColumn:function(a){var b=this._fields.get(a),c=[];if(Object.isUndefined(b))return c;for(b=0;b<this._rows.length;b++)"add"==this._rows[b].get("action")&&
c.push(this._rows[b].get(a));return c},getRow:function(a){for(var b=0;b<this._rows.length;b++)if(this._rows[b].get("idGrid")==a)return this._rows[b];return!1},getEditRow:function(){if(0<this._editId)for(var a=0;a<this._rows.length;a++)if(this._rows[a].get("idGrid")==this._editId)return this._rows[a];return!1},getActiveForm:function(){return this._hyperGrid.getHyperForm().getActiveSection().getElement("hySaveFrom")},getHyperForm:function(){return this._hyperForm},clearData:function(){this._rows.clear()},
clear:function(){this._element.getElement("hyGridBodyTable").select("TR").each(function(a){a.erase()});this._rows.clear()},restoreState:function(){var a=Hfos.getApplication().getStorage();null!==a?a.findFirst("HyperGrids",this._hyperForm.getName(),function(a){if("undefined"!=typeof a&&"undefined"!=typeof a.rows)for(var c=this._fields.keys(),d=0;d<a.rows.length;d++){for(var e=a.rows[d],f=0;f<c.length;f++){var g=c[f],h=this.getField(g);null!==h&&h.setValue(e._object[g]);g+="_det";h=this.getField(g);
null!==h&&h.setValue(e._object[g])}this.addRow(!0)}this.fire("afterRestore")}.bind(this)):this.fire("afterRestore")}});
var HyperTabs=Class.create(Enumerable,{_hyperForm:null,_activeSection:null,_tabs:[],_contents:[],_tabPointer:0,initialize:function(a){this._hyperForm=a;this._activeSection=a.getActiveSection();this._tabs=this._activeSection.select("a.tab");for(a=0;a<this._tabs.length;a++)this._tabs[a].observe("click",this.changeTab.bind(this,a));this._contents=this._activeSection.select("div.content")},changeTabByLabel:function(a){for(var b=0;b<this._tabs.length;b++)this._tabs[b].innerHTML==a&&this.changeTab(b)},
changeTab:function(a){for(var b=null,c=0;c<this._tabs.length;c++)a==c?b=this._tabs[c]:this._tabs[c].removeClassName("active");if(null!==b){b.addClassName("active");for(c=0;c<this._contents.length;c++)a==c?this._contents[c].show():this._contents[c].hide();b=b.getAttribute("title");this._hyperForm.notifyContentChange();this._tabPointer=a;this.fire("tabChanged",b,this._contents[a],a)}},movePrev:function(){0<this._tabPointer?this._tabPointer--:this._tabPointer=this._tabs.length-1;this.changeTab(this._tabPointer)},
moveNext:function(){this._tabPointer<this._tabs.length-1?this._tabPointer++:this._tabPointer=0;this.changeTab(this._tabPointer)},observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a){try{if(!Object.isUndefined(this["_"+a]))for(var b=0;b<this["_"+a].length;b++)if(!1===this["_"+a][b].apply(this,arguments))return!1;return!0}catch(c){HfosException.show(c)}}});
var HyperFormManager={_hyperForms:{},_lateEvents:{},_lateGridEvents:{},add:function(a,b,c,d,e,f){try{if(HyperFormManager._hyperForms[a]=new HyperForm(a,b,c,d,e,f),!1==f){var g=Hfos.getApplication().getStorage();null!==g&&g.save("HyperForms",{id:a,plural:b,single:c,genre:d,gridConfig:e})}}catch(h){HfosException.show(h)}},get:function(a){return HyperFormManager._hyperForms[a]},restore:function(a){var b=Hfos.getApplication().getStorage();null!==b?b.findFirst("HyperForms",a,function(b){b&&(HyperFormManager._hyperForms[a]=
new HyperForm(b.id,b.plural,b.single,b.genre,b.gridConfig,!0))}):alert(null)},lateBinding:function(a,b,c){"undefined"==typeof HyperFormManager._lateEvents[a]&&(HyperFormManager._lateEvents[a]={});"undefined"==typeof HyperFormManager._lateEvents[a][b]&&(HyperFormManager._lateEvents[a][b]=[]);HyperFormManager._lateEvents[a][b].push(c)},lateGridBinding:function(a,b,c){"undefined"==typeof HyperFormManager._lateGridEvents[a]&&(HyperFormManager._lateGridEvents[a]={});HyperFormManager._lateGridEvents[a][b]=
c},getLateGridBindings:function(a){return HyperFormManager._lateGridEvents[a]},getLateBindings:function(a){return HyperFormManager._lateEvents[a]},notifyClosedForm:function(a){delete HyperFormManager._hyperForms[a.getName()];var b=Hfos.getApplication().getStorage();null!==b&&(b.remove("HyperSearch",a.getName()),b.remove("HyperForms",a.getName()),b.remove("HyperGrids",a.getName()),b.findAllBy("InputFields","containerKey",a.getName(),function(a,b){for(var e=0;e<b.length;e++)a.remove("InputFields",b[e].id)}.bind(this,
b)),b.free())}};var HyperMessagesTypes={M_NOTICE:HfosMessages.M_NOTICE,M_ERROR:HfosMessages.M_ERROR,M_SUCCESS:HfosMessages.M_SUCCESS},HyperMessages=Class.create(HfosMessages,{});var HyperBrowseData=Class.create(HfosBrowseData,{});
var HyperForm=Class.create({_formName:null,_plural:null,_single:null,_formElement:null,_gridConfig:null,_window:null,_lastResultset:[],_recordPointer:0,_pageResultsRows:null,_browse:null,_browseChanged:null,_messages:null,_tabs:null,_lastPrimary:null,_lastResponse:null,_grid:null,_currentState:null,_currentRecord:null,initialize:function(a,b,c,d,e,f){this._formName=a;this._plural=b;this._single=c;this._genre=d;this._gridConfig=e;this._formElement=$(a+"Form");if(null===this._formElement)new HfosModal.alert({title:this._plural,
message:"El m\u00f3dulo podr\u00eda no haberse ejecutado correctamente, si es necesario intente abrirlo nuevamente"});else{a=this._formElement.ancestors();for(b=0;b<a.length;b++)if(a[b].hasClassName("window-main")){this._window=Hfos.getApplication().getWorkspace().getWindowManager().getWindow(a[b].id);this._window.setSubprocess(this);this._window.observe("afterClose",HyperFormManager.notifyClosedForm.bind(window,this));this._window.observe("onKeyPress",this._onContainerKeyPress.bind(this));break}this._addCallbacks();
a=this.getLateBindings();Object.isUndefined(a)||$H(a).each(function(a){for(var b=0;b<a[1].length;b++)this.observe(a[0],a[1][b])}.bind(this));this._messages=new HyperMessages(this);this._browse=new HyperBrowseData(this);this._browse.setAutoRowsPerPage(!0);HfosReportType.observeReportType(this);if(!1==f){this.fire("afterInitialize");if(null!=e)this._grid=new HyperGrid(this,e,!1);this._observeInputChanges();this.setCurrentState("index")}else this._restoreState(),this.fire("afterRestore")}},_addCallbacks:function(){this.getElement("searchButton").observe("click",
this._doSearch.bind(this));this.getElement("newButton").observe("click",this._doNew.bind(this));this.getElement("editButton").observe("click",this._doEdit.bind(this));var a=this.getElement("saveButton");a.observe("click",this._sendForm.bind(this,a));this.getElement("deleteButton").observe("click",this._doDelete.bind(this));this.getElement("revisionButton").observe("click",this._doRevision.bind(this));this.getElement("backButton").observe("click",this._doBack.bind(this));a=this.getElement("importButton");
Object.isElement(a)&&a.observe("click",this._doImport.bind(this));a=this.getElement("loadButton");a.observe("click",this._loadImport.bind(this,a));a=this.getElement("hySearchForm").findFirstElement();null!=a&&a.activate()},_onContainerKeyPress:function(a,b){if(!1===this.fire("onKeyPress",b))return new Event.stop(b),new Event.cancelBubble(b),!1;switch(this._currentState){case "index":if(b.keyCode==Event.KEY_RETURN)return this._doSearch(),new Event.stop(b),!1;if(b.ctrlKey&&b.keyCode==Event.KEY_N)return this._doNew(),
new Event.stop(b),new Event.cancelBubble(b),!1;break;case "new":case "edit":if(b.keyCode==Event.KEY_RETURN||b.keyCode==Event.KEY_F7){var c=document.activeElement;return c&&"TEXTAREA"!=c.tagName?(this.save(),new Event.stop(b),new Event.cancelBubble(b),!1):!0}if(b.ctrlKey&&b.keyCode==Event.KEY_LEFT&&(c=this.getTabs(),null!==c))return c.movePrev(),new Event.stop(b),new Event.cancelBubble(b),!1;if(b.ctrlKey&&b.keyCode==Event.KEY_RIGHT&&(c=this.getTabs(),null!==c))return c.moveNext(),new Event.stop(b),
new Event.cancelBubble(b),!1;break;case "browse":if(b.keyCode==Event.KEY_RETURN&&(c=this._browse.getSelectedRow(),null!==c))return this._showRecordToScreen(c.lang),new Event.stop(b),!1;if(b.keyCode==Event.KEY_UP)return this._browse.moveRecordUp(),new Event.stop(b),!1;if(b.keyCode==Event.KEY_DOWN)return this._browse.moveRecordDown(),new Event.stop(b),!1;if(b.keyCode==Event.KEY_RIGHT)return this._browse.moveToNextPage(),new Event.stop(b),!1;if(b.keyCode==Event.KEY_LEFT)return this._browse.moveToPrevPage(),
new Event.stop(b),!1;if(b.ctrlKey&&b.keyCode==Event.KEY_N)return this._doNew(),new Event.stop(b),new Event.cancelBubble(b),!1;break;case "detail":if(b.keyCode==Event.KEY_RIGHT)return this._showNextRecord(),new Event.stop(b),!1;if(b.keyCode==Event.KEY_LEFT)return this._showPrevRecord(),new Event.stop(b),!1;if(b.keyCode==Event.KEY_SUPR)return this._doDelete(),new Event.stop(b),!1;if(b.ctrlKey&&b.keyCode==Event.KEY_E||b.keyCode==Event.KEY_RETURN)return this._doEdit(),new Event.stop(b),new Event.cancelBubble(b),
!1}return b.keyCode==Event.KEY_F10?(this._doBack(),new Event.stop(b),new Event.cancelBubble(b),!1):!0},_scrollToTop:function(){null!==this._window&&this._window.scrollToTop()},_notifyContentChange:function(){null!==this._window&&this._window.notify("contentChanged")},notifyContentChange:function(){this._notifyContentChange()},_showSpinner:function(){this.getElement("hySpinner").show()},_hideSpinner:function(){this.getElement("hySpinner").hide()},_showToolbarSpinner:function(){this.getElement("hyToolbarSpinner").show()},
_hideToolbarSpinner:function(){this.getElement("hyToolbarSpinner").hide()},_recordPreview:function(a){this._recordPointer=a.number;this.getElement("hyDetailsDiv").lang=a.number;for(var b=13<a.data.length?parseInt(this._window.getWidth()/450,10):1,c='<table class="hyDetailsTab" cellspacing="0" width="95%" align="center"><tr>',d=0;d<a.data.length;d++){var e=a.data[d],c=c+('<td align="right" class="hyDetailsTdLeft" width="20%"><label for="'+e.name+'">'+e.caption+'</b></td><td align="left" width="25%">'+
e.value+"&nbsp;</td>");0==(d+1)%b&&(c+="</tr><tr>")}return c+"</table>"},_renderDetails:function(a){a='<div align="right" class="hyNavBar"><input class="firstNavButton" type="button" value="Primero"><input class="prevNavButton" type="button" value="Anterior"><input class="nextNavButton" type="button" value="Siguiente"><input class="lastNavButton" type="button" value="\u00daltimo"></div><div class="hyRecordPreview">'+this._recordPreview(a);this.getElement("hyDetailsDiv").update(a+"</div>");this._addNavigationCallbacks();
this._notifyContentChange();this.setCurrentState("detail")},_addNavigationCallbacks:function(){this.getElement("firstNavButton").observe("click",this._showFirstRecord.bind(this));this.getElement("prevNavButton").observe("click",this._showPrevRecord.bind(this));this.getElement("nextNavButton").observe("click",this._showNextRecord.bind(this));this.getElement("lastNavButton").observe("click",this._showLastRecord.bind(this))},_renderPartialDetails:function(a){this.getElement("hyRecordPreview").update(this._recordPreview(a));
this._notifyContentChange()},_showFirstRecord:function(){try{this._getRecordDetails(this._lastResultset[0].primary+"&n=0")}catch(a){HfosException.show(a)}},_showPrevRecord:function(){try{if(0<this._recordPointer){var a=this._recordPointer-1;"undefined"!=typeof this._lastResultset[a]&&this._getRecordDetails(this._lastResultset[a].primary+"&n="+a)}else new HfosModal.alert({title:this._plural,message:"Ya est\u00e1 en el primer registro"})}catch(b){HfosException.show(b)}},_showNextRecord:function(){try{if(this._recordPointer!=
this._browse.getNumberResults()-1){var a=this._recordPointer+1;"undefined"!=typeof this._lastResultset[a]&&this._getRecordDetails(this._lastResultset[a].primary+"&n="+a)}else new HfosModal.alert({title:this._plural,message:"Ya est\u00e1 en el \u00faltimo registro"})}catch(b){HfosException.show(b)}},_showLastRecord:function(){try{var a=this._browse.getNumberResults()-1;this._getRecordDetails(this._lastResultset[a].primary+"&n="+a)}catch(b){HfosException.show(b)}},_prepareInputTabs:function(){this._tabs=
new HyperTabs(this)},_renderNew:function(a){this._showFormPanel("hyNewDiv");this.getElement("hyNewDiv").update(a);a=this.getElement("hySaveForm");null!==a?(this._messages.notice('Ingrese los datos en los campos y presione "Grabar"'),a=a.getInputs(),0<a.length&&a[0].activate(),this.setCurrentState("new"),this._prepareInputTabs(),this._observeInputChanges(),this.fire("beforeInput")):this._messages.hide();this.fire("onNew");this._notifyContentChange()},_observeInputChanges:function(){for(var a=this.getActiveSection().select("input, select, textarea"),
b=0;b<a.length;b++)""!=a[b].id&&a[b].observe("change",this._storeInputField.bind(this,a[b]))},_storeInputField:function(){var a=Hfos.getApplication().getStorage();if(null!==a){for(var b={},c=this.getActiveSection().select("input, select, textarea"),d=0;d<c.length;d++)""!=c[d].id&&(c[d].id.include("[")||(b[c[d].id]=c[d].getValue()));a.save("InputFields",{id:this._formName+"-"+this._currentState,containerKey:this._formName,fields:b})}},_renderImport:function(a){this._showFormPanel("hyImportDiv");this.getElement("hyImportDiv").update(a);
this._messages.notice('Adjunte el archivo y haga click en "Cargar"');this.getElement("loadButton").enable();a=this.getElement("subirFrame");a.hide();window.setTimeout(function(a){a.observe("load",function(a){this._browseChanged=!0;this.getElement("loadButton").enable();this.getElement("subirBar").hide();a.show();this._notifyContentChange()}.bind(this,a))}.bind(this,a),1E3);this.setCurrentState("import");this._notifyContentChange()},_renderEdit:function(a){this._showFormPanel("hyEditDiv");this.getElement("hyEditDiv").update(a);
a=this.getElement("hySaveForm");null!==a&&((a=a.findFirstElement())&&a.activate(),this.setCurrentState("edit"),this._prepareInputTabs(),this._observeInputChanges(),this.fire("beforeInput"));this.fire("onEdit");this._notifyContentChange()},_renderRcs:function(a){this._showFormPanel("hyRcsDiv");this.getElement("hyRcsDiv").update(a);a=this.select("div.record_block").length;0<a?1==a?this._messages.notice("Hay una revisi\u00f3n"):this._messages.notice("Hay "+a+" revisiones"):this._messages.hide();this._notifyContentChange();
this.setCurrentState("rcs")},_hideControlButtons:function(){this._formElement.select("input.hyControlButton").each(function(a){a.parentNode.hide()})},showControlButton:function(a){a=this.getElement(a);Object.isElement(a)&&a.parentNode.show()},_renderBrowse:function(a){var b=Hfos.getApplication().getStorage();null!==b&&b.save("HyperSearch",{id:this._formName,results:a.results.data});this._browse.reset();this._browse.build(this.getElement("hyBrowseDiv"),a);this._addBrowseCallbacks();this._lastResultset=
a.results.data;this._notifyContentChange();this.setCurrentState("browse")},_addBrowseCallbacks:function(){for(var a=this._browse.getRows(),b=0;b<a.length;b++){if(""==a[b].lang)a[b].lang=a[b].title,a[b].title="";a[b].observe("dblclick",this._editHandler.bind(this,a[b]))}a=this._browse.getDetailsButtons();for(b=0;b<a.length;b++){if(""==a[b].lang)a[b].lang=a[b].title,a[b].title="Ver/Editar";a[b].observe("click",this._editHandler.bind(this,a[b]))}for(var c=this._browse.getDeleteButtons(),b=0;b<a.length;b++){if(""==
c[b].lang)c[b].lang=c[b].title,c[b].title="Borrar";c[b].observe("click",this._deleteHandler.bind(this,c[b]))}},_editHandler:function(a,b){this._showRecordToScreen(a.lang);new Event.stop(b)},_deleteHandler:function(a,b){this._deleteRecord(a.lang,a);new Event.stop(b)},_showRecordToScreen:function(a){this._hideControlButtons();this.showControlButton("revisionButton");this.showControlButton("editButton");this.showControlButton("deleteButton");this._getRecordDetails(a)},_showError:function(a){"undefined"!=
typeof a.code&&(a.message+=' <a href="http://localhost/site/kb/es_CO/'+a.code+'" target="_new" class="error-code">Ayuda</a>');this._messages.error(a.message)},_getRecordDetails:function(a){this._doJsonRequest(this._formName+"/getRecordDetails",{parameters:a,onSuccess:function(a,c,d){"OK"==c.status?(d=this._browse.getNumberResults(),0<d?this._messages.notice(c.message+" "+d):this._messages.notice(c.message),this._lastPrimary=a,this._lastResponse=c,this._formElement.lang=a,this._messages.setActiveToDefault(),
this.fire("beforeRecordPreview",c),!1==this.getElement("hyEditDiv").visible()?(this._showFormPanel("hyDetailsDiv"),this.showControlButton("backButton"),this._renderDetails(c),this.fire("afterDetails")):this._renderPartialDetails(c),2>d&&this.getElement("hyNavBar").invisible()):"FAILED"==c.status?this._showError(c):this._messages.notice(d.responseText)}.bind(this,a)})},_loadImport:function(a){a.disable();this.getElement("subirBar").hide();var b=this.selectOne("input#archivo");if(0==b.files.length)new HfosModal.alert({title:this._plural,
message:"Seleccione el archivo a importar"}),a.enable();else if(1<b.files.length)new HfosModal.alert({title:this._plural,message:"Solo se puede importar un archivo al tiempo"}),a.enable();else{for(var c=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","text/x-comma-separated-values"],d=!1,e=0;e<c.length;e++)if(c[e]==b.files[0].type){d=!0;break}!1==d?(new HfosModal.alert({title:this._plural,message:"El archivo no es de Microsoft Excel, por favor revise"}),
a.enable()):(this.getElement("importTable").hide(),this.getElement("subirBar").show(),this.getElement("subirForm").submit(),this._notifyContentChange())}},_doEdit:function(){null==this._lastPrimary?new HfosModal.alert({title:this._plural,message:"No hay un registro en pantalla"}):(this._showToolbarSpinner(),this._doRequest(this._formName+"/edit",{parameters:this._lastPrimary,onSuccess:function(a){this._messages.notice('Ingrese los datos en los campos y presione "Guardar"');this._hideControlButtons();
this.showControlButton("backButton");this.showControlButton("saveButton");this._renderEdit(a.responseText)},onComplete:function(){this._hideToolbarSpinner()}}))},_doDelete:function(){null==this._lastPrimary?new HfosModal.alert({title:this._plural,message:"No hay un registro en pantalla"}):this._deleteRecord(this._lastPrimary)},_doRevision:function(){null==this._lastPrimary?new HfosModal.alert({title:this._plural,message:"No hay un registro en pantalla"}):(this._showToolbarSpinner(),this._doRequest(this._formName+
"/rcs",{parameters:this._lastPrimary,onSuccess:function(a){this._renderRcs(a.responseText);this._hideControlButtons();this.showControlButton("backButton")},onComplete:function(){this._hideToolbarSpinner()}}))},_deleteRecord:function(a,b){new HfosModal.confirm({title:this._plural,message:"Seguro desea eliminar "+this._single+"?",onAccept:function(a,b){this._doJsonRequest(this._formName+"/delete/?"+a,{method:"GET",onSuccess:function(b,d){"OK"==d.status?(this._messages.success(d.message),"undefined"!=
typeof b?(this._browse.deleteRow(b.ancestors()[1]),0==this._browse.getNumberResults()&&this._doBack()):"detail"==this._currentState&&window.setTimeout(function(){for(var b=this._browse.getRows(),d=0;2>d;d++)"undefined"!=typeof b[d]&&b[d].lang==a&&this._browse.deleteRow(b[d]);this._doBack()}.bind(this),1E3),this._lastPrimary=null,this._formElement.lang=""):this._showError(d)}.bind(this,b)})}.bind(this,a,b)})},_showFormPanel:function(a){this._formElement.select("div.hyFormDiv").each(function(a){a.hide()});
this.getElement(a).show()},_setReportType:function(a){HfosReportType.changeReportType(a)},_doSearch:function(){this._showSpinner();this._browseChanged=!1;this._doJsonFormRequest(this.getElement("hySearchForm"),{onSuccess:this._afterSearch,onComplete:function(a){this._hideSpinner();a.enable()}})},_afterSearch:function(a,b){"OK"==b.status&&("screen"==b.type?(this._messages.notice(b.message),0<b.numberResults&&(this._showFormPanel("hyBrowseDiv"),this._renderBrowse(b),this._hideControlButtons(),this.showControlButton("newButton"),
this.showControlButton("importButton"),this.showControlButton("backButton"),this.setCurrentState("browse"))):"undefined"!=typeof b.url?window.open(b.url):this._messages.notice(b.message))},_doNew:function(){this._showToolbarSpinner();this._doRequest(this._formName+"/new",{method:"GET",onSuccess:function(a){this._hideControlButtons();this.showControlButton("backButton");this.showControlButton("saveButton");this._renderNew(a.responseText)},onComplete:function(){this._hideToolbarSpinner()}})},_doImport:function(){this._browseChanged=
!1;this._showToolbarSpinner();this._doRequest(this._formName+"/import",{method:"GET",onSuccess:function(a){this._renderImport(a.responseText);this._hideControlButtons();this.showControlButton("backButton");this.showControlButton("loadButton")},onComplete:function(){this._hideToolbarSpinner()}})},_doBack:function(){try{if("index"==this._currentState)return!1;this._hideControlButtons();switch(this._currentState){case "new":this.showControlButton("newButton");this.getElement("hyNewDiv").update("");var a=
this._browse.getNumberResults();0==a?(this._restoreSearchMessage(),this._showFormPanel("hySearchDiv"),this.showControlButton("importButton"),this.getElement("hySearchForm").enable(),this.setCurrentState("index")):!0==this._browseChanged?(this._setReportType("screen"),this._doSearch()):(this._messages.setDefault(),this._showFormPanel("hyBrowseDiv"),this.showControlButton("backButton"),this.setCurrentState("browse"));break;case "browse":this._lastResultset=[];this._restoreSearchMessage();this._showFormPanel("hySearchDiv");
this.showControlButton("newButton");this.showControlButton("importButton");this.getElement("hySearchForm").enable();this.setCurrentState("index");break;case "import":!0==this._browseChanged?(this._setReportType("screen"),this._doSearch()):(this._lastResultset=[],this._restoreSearchMessage(),this._showFormPanel("hySearchDiv"),this.showControlButton("newButton"),this.showControlButton("importButton"),this.getElement("hySearchForm").enable(),this.setCurrentState("index"));break;case "edit":case "rcs":this._messages.setDefault();
this._showFormPanel("hyDetailsDiv");this.showControlButton("revisionButton");this.showControlButton("editButton");this.showControlButton("deleteButton");this.showControlButton("backButton");this.getElement("hyEditDiv").update("");this.getElement("hyRcsDiv").update("");this.setCurrentState("detail");this.fire("afterDetails");!1==this._browseChanged&&this.fire("beforeRecordPreview",this._lastResponse);break;case "detail":!0==this._browseChanged?(this._setReportType("screen"),this._doSearch()):(a=this._browse.getNumberResults(),
0<a?(this._messages.setDefault(),this.showControlButton("newButton"),this.showControlButton("importButton"),this.showControlButton("backButton"),this._showFormPanel("hyBrowseDiv"),this.getElement("hyDetailsDiv").update(""),this.setCurrentState("browse")):(this._lastResultset=[],this._restoreSearchMessage(),this._showFormPanel("hySearchDiv"),this.showControlButton("newButton"),this.showControlButton("importButton"),this.getElement("hySearchForm").enable(),this.setCurrentState("index")))}this._notifyContentChange();
this.fire("afterBack")}catch(b){HfosException.show(b)}},_restoreSearchMessage:function(){"M"==this._genre?this._messages.notice('Ingrese un criterio de b\u00fasqueda \u00f3 presione "Consultar" para ver todos los '+this._plural.toLowerCase()):this._messages.notice('Ingrese un criterio de b\u00fasqueda \u00f3 presione "Consultar" para ver todas las '+this._plural.toLowerCase())},save:function(){var a=this.getElement("saveButton");null!==a&&this._sendForm(a)},_sendForm:function(a){this._showToolbarSpinner();
a.disable();!1!==this.fire("beforeSendForm")&&(this._scrollToTop(),this._doJsonFormRequest(this.getElement("hySaveForm"),{onSuccess:this.sendFormHandler,onComplete:function(a){this.getElement("saveButton").enable();this._hideToolbarSpinner();a.enable()}}))},sendFormHandler:function(a,b){this._browseChanged=!1;"OK"==b.status?(this._messages.notice(b.message),window.setTimeout(function(a){var b=this._browse.getNumberResults();0<b?("insert"==a.type?this._showRecordToScreen(a.primary+"&n="+(b-1)):this._showRecordToScreen(a.primary+
"&n="+this._recordPointer),this._browseChanged=!0):this._showRecordToScreen(a.primary);this._showFormPanel("hyDetailsDiv");this.showControlButton("backButton");this.getElement("hyEditDiv").update("");this.getElement("hyNewDiv").update("");this.fire("afterDetails");this.fire("afterBack");this.fire("beforeRecordPreview",a)}.bind(this,b),1E3)):"FAILED"==b.status&&(this._showError(b),"undefined"!=typeof b.fields&&0<b.fields.length&&(a.enable(),this._scrollToTop(),"undefined"!=typeof a[b.fields[0]]&&a[b.fields[0]].activate()));
if(!1!==this.fire("afterSendForm",b))this._lastPrimary=null,this._formElement.lang=""},back:function(a){for(var b=0;b<a;b++)this._doBack()},addControlButton:function(a){try{var b=Object.isUndefined(a.className)?"":Object.isArray(a.className)?a.className.join(" "):a.className,c=this.getElement(b);if(null!==c)return this.showControlButton(b),c;var d=document.createElement("TD");d.addClassName("hyTdLeftControlButton");d.update('<input type="button" class="hyControlButton '+b+'" value="'+a.value+'"/>');
this.getElement("hyTrControlButtons").insert({top:d});this.showControlButton(b);var e=this.getElement(b);"undefined"!=typeof a.onClick&&e.observe("click",a.onClick);return e}catch(f){HfosException.show(f)}},removeControlButton:function(a){(a=this.getElement(a))&&a.up().erase()},_doFormRequest:function(a,b){b.onLoading=function(a){a.disable()}.bind(this,a);if("undefined"!=typeof b.onSuccess)b.onSuccess=b.onSuccess.bind(this,a);b.checkAcl=!0;return HfosAjax.FormRequest(a,b)},_doRequest:function(a,b){if("undefined"!=
typeof b.onSuccess)b.onSuccess=b.onSuccess.bind(this);if("undefined"!=typeof b.onComplete)b.onComplete=b.onComplete.bind(this);b.checkAcl=!0;return new HfosAjax.Request(a,b)},_doJsonFormRequest:function(a,b){b.onLoading=function(a){a.disable()}.bind(this,a);if("undefined"!=typeof b.onSuccess)b.onSuccess=b.onSuccess.bind(this,a);if("undefined"!=typeof b.onComplete)b.onComplete=b.onComplete.bind(this,a);b.checkAcl=!0;console.log(a);return HfosAjax.JsonFormRequest(a,b)},_doJsonRequest:function(a,b){b.checkAcl=
!0;return new HfosAjax.JsonRequest(a,b)},_restoreBrowse:function(){this._browse.restore(this.getElement("hyBrowseDiv"));this._addBrowseCallbacks()},_restoreDetails:function(){var a=Hfos.getApplication().getStorage();null!==a&&a.findFirst("HyperSearch",this._formName,function(a){if("undefined"!=typeof a)this._lastPrimary=this._formElement.lang,this._lastResultset=a.results,this._recordPointer=parseInt(this.getElement("hyDetailsDiv").lang,10),2>a.results.length?this.getElement("hyNavBar").invisible():
this._addNavigationCallbacks()}.bind(this))},_restoreInput:function(){this._prepareInputTabs();this._observeInputChanges();if(null!=this._gridConfig)this._grid=new HyperGrid(this,this._gridConfig,!0)},_restoreInputFields:function(a){var b=Hfos.getApplication().getStorage();if(null!==b){var c=this.getActiveSection();b.findFirst("InputFields",this._formName+"-"+a,function(a,b){"undefined"!=typeof b&&$H(b.fields).each(function(b){var c=a.selectOne("#"+b[0]);c&&c.setValue(b[1])})}.bind(this,c))}},_restoreCompleters:function(){HfosCommon.restoreCompleters(this)},
_restoreState:function(){this._hideSpinner();this._hideToolbarSpinner();var a=this._window.getState();this.setCurrentState(a);switch(a){case "index":this._restoreInputFields("index");break;case "new":this._restoreBrowse();this._restoreInput();this._restoreInputFields("new");break;case "browse":this._restoreBrowse();break;case "detail":this._restoreBrowse();this._restoreDetails();break;case "edit":this._restoreBrowse(),this._restoreDetails(),this._restoreInput(),this._restoreInputFields("edit")}this._restoreCompleters()},
externalProcedureCall:function(a){switch(a){case "new":this._doNew();break;case "edit":this._doEdit()}},setFieldValue:function(a,b){switch(this._currentState){case "new":case "edit":case "search":var c=this.getActiveSection().selectOne("#"+a);null!==c&&c.setValue(b)}},setFieldValues:function(a){switch(this._currentState){case "new":case "edit":case "search":var b=this.getActiveSection();$H(a).each(function(a){var d=b.selectOne("#"+a[0]);null!==d&&d.setValue(a[1])})}},addFieldInput:function(a,b,c){var d=
this.getActiveSection().getElement("hySaveForm").selectOne("table");null!==d&&(a='<tr><td align="right"><label for="'+a+'">'+b+"</label></td>"+('<td><input type="text" id="'+a+'" name="'+a+'" value="'+c+'" readonly/></td></tr>'),d.selectOne("tbody").insert({before:a}))},addFieldLabelInput:function(a,b,c,d,e){var d=this.getActiveSection().getElement("hySaveForm"),f=this.getActiveSection().selectOne("#tr"+a);f&&f.remove();d=d.selectOne("table");null!==d&&(a='<tr id="tr'+a+'"><td align="right"><label for="'+
a+'">'+b+"</label></td>"+('<td><input type="hidden" id="'+a+'" name="'+a+'" value="'+c+'"/>')+("<label>"+e+"</label></td></tr>"),d.selectOne("tbody").insert({before:a}))},observe:function(a,b){Object.isUndefined(this["_"+a])&&(this["_"+a]=[]);this["_"+a].push(b)},fire:function(a){try{if(!Object.isUndefined(this["_"+a]))for(var b=0;b<this["_"+a].length;b++)if(!1===this["_"+a][b].apply(this,arguments))return!1;return!0}catch(c){HfosException.show(c)}},getId:function(){return this._formElement.id},getName:function(){return this._formName},
getFormElement:function(){return this._formElement},getElement:function(a){return this._formElement.getElement(a)},getActiveSection:function(){switch(this._currentState){case "new":return this.getElement("hyNewDiv");case "edit":return this.getElement("hyEditDiv");case "search":return this.getElement("hySearchDiv");case "detail":return this.getElement("hyDetailsDiv");default:return this._formElement}},getWindow:function(){return null!==this._window?this._window:document.body},getContentElement:function(){return null!==
this._window?this._window.getContentElement():this._formElement},select:function(a){return this._formElement.select(a)},selectOne:function(a){return this._formElement.selectOne(a)},getField:function(a){return this._formElement.select("#"+a)[0]},getLastPrimary:function(){return this._lastPrimary},getMessages:function(){return this._messages},getTabs:function(){return this._tabs},getLateBindings:function(){return HyperFormManager.getLateBindings(this._formName)},getLateGridBindings:function(){return HyperFormManager.getLateGridBindings(this._formName)},
getCurrentState:function(){return this._currentState},setCurrentState:function(a){this._currentState=a;null!==this._window&&this._window.setState(this._currentState)},hideStatusBar:function(){if("undefined"!=typeof this._window.hideStatusBar)this._window.hideStatusBar();else{var a=$("processStatusBar");a&&a.hide()}},showStatusBar:function(a){if("undefined"!=typeof this._window.showStatusBar)this._window.showStatusBar(a);else{var b=$("processStatusBar");b||(b=document.createElement("DIV"),b.setAttribute("id",
"processStatusBar"),document.body.appendChild(b));b.update(a)}},getStatusBarElement:function(a){if("undefined"!=typeof this._window.showStatusBar)return this._window.getStatusBar().getElement(a);var b=$("processStatusBar");return b?b.getElement(a):null}});function hyOL(a){a.call()};
