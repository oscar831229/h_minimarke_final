var Impresion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"impresionForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-impresion","afterCreateOrRestore",function(a){new Impresion(a)});var Consumos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"consumosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-consumos","afterCreateOrRestore",function(a){new Consumos(a)});var Horti=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"hortiForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-horti","afterCreateOrRestore",function(a){new Horti(a)});var Comportamiento=Class.create(HfosProcessContainer,{_queryChartData:function(){var a=this.getElement("chart");new Proto.Chart(a,[{data:[["201102",25800],["201103",27500],["201104",20500]],label:"ROBALO"},{data:[["201102",35800],["201103",23100],["201104",32700],["201105",26700]],label:"SIERRA"}],{colors:["#4A618C","#BC6B1C"],legend:{show:!0,backgroundColor:"transparent"},xaxis:{mode:"string",tickDecimals:0},yaxis:{min:2E4,max:4E4,tickSize:5E3},grid:{}})},_agregarReferencia:function(){""==this.selectOne("input#item").getValue()&&
new HfosModal.alert({title:"Comportamiento del Costo",message:"El \u00edtem a agregar es requerido"})},initialize:function(a){this.setContainer(a);Hfos.loadSource("canvas/chart");this.getElement("verButton").observe("click",this._queryChartData.bind(this));this.getElement("addButton").observe("click",this._agregarReferencia.bind(this))}});HfosBindings.late("win-comportamiento","afterCreateOrRestore",function(a){new Comportamiento(a)});var MatrizProveedores=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this._setIndexCallbacks()},_setIndexCallbacks:function(){var a=this.selectOne("input#referenciaId");if(a){var b=this.selectOne("input#referenciaId_det"),c=this.getElement("saveButton");a.observe("change",this._showMatriz.bind(this,a,b));b.observe("change",this._showMatriz.bind(this,a,b));c.observe("click",this._saveMatriz.bind(this))}a.activate();this.getMessages().notice("Seleccione una referencia para ver sus proveedores",
!1)},_showMatriz:function(a,b){a.getValue()&&0>b.getValue().indexOf("NO EXISTE")?(this.getElement("chooseReferencia").hide(),this.getElement("matrizProveedoresContent").hide(),this._generarMatriz(a)):(this.getElement("chooseReferencia").show(),this.getElement("saveButton").hide())},_generarMatriz:function(a){new HfosAjax.Request("matriz_proveedores/generarMatriz",{parameters:{referenciaId:a.getValue()},onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){var c=
this.getElement("matrizProveedoresContent");c.update(a.responseText);c.show();(a=this.getElement("addButton"))&&a.observe("click",this._addProveedor.bind(this));this._updateMessage();this._observeDelete();this._addSortable();this._notifyContentChange()}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("saveButton").show()}.bind(this)})},_addProveedor:function(){var a=this.selectOne("input#nuevoProveedor"),b=this.selectOne("input#nuevoProveedor_det");if(""==
a.getValue()||""==b.getValue())a.activate(),this.getMessages().error("Indique los datos del proveedor a agregar",!0);else{for(var c=this.getElement("proveedorOrder"),e=c.select('input[type="hidden"]'),d=0;d<e.length;d++)if(e[d].getValue()==a.getValue()){this.getMessages().error("El proveedor ya hab\u00eda sido agregado anteriormente",!0);return}c.insert('<li id="proveedor_'+(e.length+1)+'"><table width="80%" cellspacing="0" cellpadding="0" class="hyBrowseTab zebraSt sortable"><tr><td width="7"><img src="'+
$Kumbia.path+'img/backoffice/grippy.png"/></td><td width="100"><input type="hidden" name="nit[]" value="'+a.getValue()+'">'+a.getValue()+'</td><td align="left">'+b.getValue()+'</td><td width="20"><img src="'+$Kumbia.path+'img/backoffice/delete.gif" class="delete"/></td></tr></table></li>');a.setValue("");b.setValue("");this._updateMessage();this._observeDelete();this._addSortable();this._makeZebra();this._notifyContentChange()}},_observeDelete:function(){for(var a=this.getElement("proveedorOrder").select("img.delete"),
b=0;b<a.length;b++)a[b].retrieve("observed")||(a[b].observe("click",function(a){a.up(4).erase();this._updateMessage()}.bind(this,a[b])),a[b].store("observed",!0))},_updateMessage:function(){var a=this.getElement("proveedorOrder").select('input[type="hidden"]');0==a.length?this.getMessages().notice("Agregue proveedores a los que le compre esta referencia",!1):1==a.length?this.getMessages().notice("Agregue otros proveedores a los que le compre esta referencia",!1):this.getMessages().notice("Agregue otros proveedores y arr\u00e1strelos de una posici\u00f3n a otra para indicar su preferencia. Entre m\u00e1s arriba mayor ser\u00e1 su relevancia",
!1)},_addSortable:function(){var a=this.getElement("proveedorOrder");Sortable.destroy(a);Sortable.create(a,{onUpdate:this._makeZebra.bind(this)})},_makeZebra:function(){for(var a=this.getElement("proveedorOrder").select("tr"),b=0;b<a.length;b++)0==(b+1)%2?a[b].setStyle("background:#E5EEFF"):a[b].setStyle("background:#ffffff")},_saveMatriz:function(){var a=this.getElement("matrizForm");new HfosAjax.JsonFormRequest(a,{onLoading:function(){this.getElement("headerSpinner").show()}.bind(this),onSuccess:function(a){"OK"==
a.status?this.getMessages().success(a.message):this.getMessages().error(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide()}.bind(this)})}});HfosBindings.late("win-matriz-proveedores","afterCreateOrRestore",function(a){new MatrizProveedores(a)});var TransaccionInve=Class.create({_hyperGrid:null,_hyperForm:null,_activeSection:null,_form:null,_items:[],_data:{},_type:null,_totales:"iva16r,iva16d,iva10r,iva10d,iva5r,iva5d,retencion,ica,horti,cree,impo,saldo,total".split(","),_wasLoaded:!1,_restored:!1,_blockTaxes:!1,_statusBar:null,_almacenAnterior:null,_puedoGrabar:!0,_initializeTransaction:function(a,b,c){this._type=a;b=this._hyperGrid=b;b.observe("beforeInsert",this._beforeInsert.bind(this));b.observe("afterEdit",this._afterEdit.bind(this));
b.observe("afterModify",this._afterModify.bind(this));b.observe("afterDelete",this._afterDelete.bind(this));this._hyperForm=a=b.getHyperForm();a.getWindow().observe("beforeClose",this._beforeClose.bind(this));a.observe("beforeInput",this._prepareForInput.bind(this));a.observe("afterDetails",this._addPrintButton.bind(this));a.observe("afterBack",this._hideStatusBar.bind(this));a.observe("beforeRecordPreview",this._addReopenButton.bind(this));a.observe("pedidoUpdated",this._loadPedido.bind(this));a.observe("ordenUpdated",
this._loadOrden.bind(this));a.observe("onKeyPress",this._onKeyPress.bind(this));this._restored=c;!0==this._restored&&this._restoreTransaction()},_beforeClose:function(){var a=this._hyperForm.getCurrentState();return("new"==a||"edit"==a)&&0<this._hyperGrid.getNumberChanged()?(new HfosModal.confirm({title:this._hyperForm.getWindow().getTitle(),message:"\u00bfDesea descartar los cambios?",onAccept:function(){this._hyperForm.getWindow().close(!0)}.bind(this)}),!1):!0},_onKeyPress:function(a,b){var c=
this._hyperForm.getCurrentState();if("new"==c||"edit"==c)if(b.keyCode==Event.KEY_RETURN||b.keyCode==Event.KEY_F7){if(0==this._hyperGrid.getNumberChanged())return!0;new HfosModal.confirm({title:this._hyperForm.getWindow().getTitle(),message:"\u00bfDesea guardar ahora?",onAccept:function(){this._hyperForm.save()}.bind(this)});return!1}return!0},_onChangeTab:function(a,b,c,e){if(0==e)this._showDefaultMessage();else{a="";switch(b){case "Detalle":a='Indique referencias y haga click en "Agregar" para adicionarla a la lista';
break;case "Criterios":b=this._form.selectOne("#nit");a=""!=b.getValue()?"Califique al proveedor aumentando \u00f3 reduciendo los puntos en cada criterio":"No ha indicado el proveedor. Los criterios se cargan de acuerdo al proveedor asociado";break;case "Totales":b=this._form.selectOne("#nit");a=""!=b.getValue()?"Los impuestos se calculan autom\u00e1ticamente al ingresar las referencias e indicar el proveedor.De cualquier manera puede modificar los valores en las casillas al finalizar el ingreso de referencias.":
"No ha indicado el proveedor. Los impuestos solo se calculan al indicar el proveedor e ingresar las referencias";break;default:return}this._hyperForm.getMessages().notice(a,!1)}c=c.selectOne('input[type="text"]');null!==c&&c.activate()},_showDefaultMessage:function(){var a='Ingrese los datos en los campos y presione "Grabar"';switch(this._type){case "O":a="Indique el proveedor y forma de pago de la orden de compra";break;case "E":a="Indique el proveedor y forma de pago de la orden de compra"}this._hyperForm.getMessages().notice(a,
!1)},_getQuantityField:function(){switch(this._type){default:return"cantidad"}},_getTransactionType:function(){switch(this._type){case "O":return"ordenes";case "E":return"entradas";case "C":return"salidas";case "A":return"ajustes";case "T":return"traslados";case "P":return"pedidos";case "R":return"transformaciones"}},_prepareForInput:function(){this._hyperGrid.getField("item_tipo");var a=this._hyperGrid.getField("item");a.observe("change",this._getReferenciaOrReceta.bind(this));var b=this._hyperGrid.getField("item_det");
b.observe("change",this._getReferenciaOrReceta.bind(this));b.observe("external:changed",this._getReferenciaOrReceta.bind(this));this._hyperGrid.getField("unidad").setAttribute("readOnly","readonly");b=this._hyperGrid.getField(this._getQuantityField());b.observe("change",this._actualizeValor.bind(this,b,a));this._hyperGrid.clearData();this._statusBar=null;this._activeSection=this._hyperForm.getActiveSection();this._form=this._activeSection.getElement("hySaveForm");window.setTimeout(function(){this._preLoad=
!0;if("E"==this._type||"O"==this._type){this._form.selectOne("#nit").observe("change",this._calculaTaxes.bind(this));var a=this._form.selectOne("#nit_det");a.observe("change",this._calculaTaxes.bind(this));a.observe("external:changed",this._calculaTaxes.bind(this));for(a=0;a<this._totales.length;a++){var b=this._form.selectOne("#"+this._totales[a]);b&&(b.store("changed",!1),b.observe("change",this._updateTotales.bind(this,b)))}for(var d=["total_neto","saldo","total"],a=0;a<d.length;a++)if(b=this._form.selectOne("#"+
d[a]))b.addClassName("readOnlyOnTab"),b.setAttribute("readonly",!0);a=this._form.selectOne("#Totales");null!=a&&(b=this._form.selectOne("a#detailedCalculation"),null===b&&(b=document.createElement("DIV"),b.update("<div align='right' class='detailed-calculation'><a href='#' id='detailedCalculation'>Detalle del Calculo</a></div>"),a.appendChild(b),b=this._form.selectOne("a#detailedCalculation")),b.observe("click",this._detailedCalculation.bind(this)));this._updateTotales()}a=this._form.selectOne("#almacen");
if("E"==this._type||"C"==this._type||"T"==this._type)if(b=this._form.selectOne("#n_pedido"),"new"==this._hyperForm.getCurrentState()){if("E"==this._type)a.observe("change",this._getOrden.bind(this,a,b)),b.observe("change",this._getOrden.bind(this,a,b));else if("C"==this._type||"T"==this._type)a.observe("change",this._getPedido.bind(this,a,b)),b.observe("change",this._getPedido.bind(this,a,b));b.activate()}else b.setAttribute("readonly",!0);if(("C"==this._type||"A"==this._type||"T"==this._type)&&null!==
a&&"undefined"!=typeof a.selectedIndex)this._almacenAnterior=a.options[a.selectedIndex].text,a.observe("change",this._actualizaLastSaldo.bind(this,a));if("R"==this._type){a=this._form.selectOne("#v_total");a.setAttribute("readonly",!0);a.observe("change",f);f=this._form.selectOne("#unidad_objetivo");f.disable();var b=this._form.selectOne("#item_objetivo"),d=this._form.selectOne("#cantidad_objetivo"),f=this._getTransformacionCosto.bind(this,b,f,d,a);b.observe("change",f);d.observe("change",f)}this._hyperGrid.loadBaseData(this._getTransactionType(this._type),
"item,item_det,unidad,cantidad,valor,iva".split(","));this._hyperForm.getTabs().observe("tabChanged",this._onChangeTab.bind(this));this._totalize();("E"==this._type||"O"==this._type)&&this._updateTotales();this._preLoad=!1}.bind(this),50);return!0},_detailedCalculation:function(){0<this._form.select("input.changedOnTab").length?new HfosModal.confirm({title:"Detalle del Calculo",message:"Algunos totales de impuestos han sido modificados manualmente. El detalle del calculo autom\u00e1tico podr\u00eda ser diferente. \u00bfDesea continuar?",
onAccept:function(){this._getDetailedCalculation()}.bind(this)}):this._getDetailedCalculation()},_getDetailedCalculation:function(){this._getTransactionType();var a={};a.tipo=this._type;a.nit=this._form.selectOne("#nit").getValue();a.almacen=this._form.selectOne("#almacen").getValue();a.items=Json.encode(this._hyperGrid.getColumn("item"));a.iva=Json.encode(this._hyperGrid.getColumn("iva"));a.valor=Json.encode(this._hyperGrid.getColumn("valor"));new HfosAjax.JsonRequest("tatico/getDetailedCalculation",
{parameters:a,onSuccess:function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file)}.bind(this)})},_totalize:function(){var a=this._hyperGrid.getSummatory("valor");("E"==this._type||"O"==this._type)&&this._form.selectOne("#total_neto").setValue(a);a=Utils.numberFormat(a);this._showStatus(a,"total")},_addPrintButton:function(){this._hyperForm.addControlButton({className:"printButton",value:"Imprimir",onClick:this._printTransaction.bind(this)})},
_addReopenButton:function(a,b){if("O"==this._type||"P"==this._type){this._hyperForm.removeControlButton("reopenButton");this._hyperForm.removeControlButton("sendButton");var c=new HyperRecordData(b.data),e=c.getValueFromName("estado");"CERRADA"==e||"CERRADO"==e?this._hyperForm.addControlButton({className:"reopenButton",value:"Re-Abrir",onClick:this._reOpenTransaction.bind(this,c)}):this._hyperForm.addControlButton({className:"sendButton",value:"Enviar Correo",onClick:this._sendTransaction.bind(this,
c)})}},_showStatus:function(a,b){if(null===this._statusBar)this._hyperForm.showStatusBar('<table cellspacing="0" width="100%" class="totales"><tr><td class="saldo"></td><td align="right"><b>Total</b> <span class="total">0.00</span></tr></table>'),this._statusBar=!0;this._hyperForm.getStatusBarElement(b).update(a)},_hideStatusBar:function(){this._hyperForm.hideStatusBar()},_getTransformacionCosto:function(a,b,c,e){var d=this._form.selectOne("#almacen");new Tatico.getReferencia(a.getValue(),function(a,
b,c,e){"FAILED"==e.status?this._hyperForm.getMessages().error(e.message):(this._showDefaultMessage(),a.setValue(e.data.unidad),""!=b.getValue()?(b=parseFloat(b.getValue(),10),c.setValue(Utils.round(b*e.data.costo,2))):c.setValue(e.data.costo));a.disable();c.disable()}.bind(this,b,c,e),d.getValue())},_getReferenciaOrReceta:function(){var a=this._hyperGrid.getField("item_tipo"),b="I";a&&(b=a.getValue());a=this._hyperGrid.getField("item");a.setValue(a.getValue().toUpperCase());if(!a.getValue().blank()){this._form.disable();
var c=this._form.selectOne("#almacen");Tatico.getReferenciaOrReceta(c.getValue(),a.getValue(),b,function(a){this._form.enable();if("OK"==a.status)this._showData(a.data),this._showDefaultMessage();else{this._hyperForm.getMessages().error(a.message);for(var a=["item","item_det","unidad","iva"],b=0;b<a.length;b++){var c=this._hyperGrid.getField(a[b]);null!==c&&c.setValue("")}a=["cantidad","valor"];for(b=0;b<a.length;b++)c=this._hyperGrid.getField(a[b]),null!==c&&""!=c.getValue()&&c.setValue("")}}.bind(this))}},
_showData:function(a){var b=this._hyperGrid.getField("unidad");null!==b&&b.setValue(a.unidad);b=this._hyperGrid.getField("valor");null!==b&&b.setValue(a.costo);b=this._hyperGrid.getField("iva");null!==b&&b.setValue(a.iva);b=this._hyperGrid.getField("cantidad");if(""==b.getValue()||0==b.getValue())b.setValue(1),b.activate();if("I"==a.type)this._tipo="I",this._items.push(a.data);else{this._tipo="R";for(var c in a.components)a.components[c].item=c,this._items.push(a.components[c])}this._data=a;this._updateMessageSaldo(a);
this._disableCustomFields()},_updateMessageSaldo:function(a){if("O"==this._type||"C"==this._type||"T"==this._type||"A"==this._type)"undefined"!=typeof a.saldo?"OK"==a.saldo.status?this._showStatus('<div class="con-saldo">'+a.saldo.message+"</div>","saldo"):"FAILED"==a.saldo.status?this._showStatus('<div class="sin-saldo">'+a.saldo.message+"</div>","saldo"):this._showStatus("","saldo"):this._showStatus("","saldo")},_actualizeValor:function(a){var b=this._form.selectOne("input.hyGridAdd");b.disable();
var c=a.getValue();if("E"==this._type){if(""==c)return;var e=this._hyperGrid.getField("cantidad").getValue();c>e&&!0==this._wasLoaded&&(this._hyperForm.getMessages().error("La cantidad a entregar no puede superar la cantidad pedida"),c=e,a.setValue(c),window.setTimeout(function(){a.activate()},20))}if("C"==this._type){if(""==c)return;this._checkExistenciasSalidas()}""!=c&&(this._hyperGrid.getField("valor").setValue(Utils.round(this._data.costo*c,2)),b.enable())},_checkExistenciasSalidas:function(){var a=
this._hyperGrid.getField("item");if(a){var b=this._hyperGrid.getField("cantidad").getValue(),c=this._form.selectOne("#almacen").getValue();Tatico.getReferenciaOrReceta(c,a.getValue(),function(a){this._form.enable();if("OK"==a.status&&a.data&&a.data.existencias){a=Utils.round(a.data.existencias,3);if(a<b){new HfosModal.alert({title:"Cantidad Excedida",message:"La cantidad ingresada excede las existencis actuales ("+a+")"});fields=["cantidad","valor"];for(var c=0;c<fields.length;c++){var f=this._hyperGrid.getField(fields[c]);
null!==f&&""!=f.getValue()&&f.setValue("")}this._hyperGrid.getField("cantidad").setValue(a)}this._hyperGrid.getField("valor").setValue(Utils.round(this._data.costo*b,2))}}.bind(this))}else alert("Item not found")},_actualizaLastSaldo:function(a){""!=this._hyperForm.getStatusBarElement("saldo").innerHTML&&(this._showStatus("","saldo"),!1==this._hyperGrid.isEmpty()&&new HfosModal.confirm({title:this._hyperForm.getWindow().getTitle(),message:'Los costos que est\u00e1n cargados en el detalle del movimiento fueron tomados del alm\u00e1cen "'+
this._almacenAnterior+'", estos costos pueden ser diferentes a los del almac\u00e9n "'+a.options[a.selectedIndex].text+'". \u00bfDesea continuar?'}))},_afterEdit:function(a){this._disableCustomFields();a=a.getEditRow();if(!a||"function"!=typeof a.get)new HfosModal.alert({title:"Inventarios",message:"Ocurri\u00f3 un problema al editar el movimiento"});else{if("O"==this._type||"C"==this._type||"A"==this._type||"T"==this._type){var b=this._form.selectOne("#almacen");new Tatico.getSaldoReferencia(a.get("item"),
b.getValue(),function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):this._updateMessageSaldo(a.data)}.bind(this))}this._data.costo=Utils.round(a.get("valor")/a.get("cantidad"),2);this._totalize()}},_disableCustomFields:function(){this._hyperGrid.getField("unidad").disable();"E"==this._type?this._hyperGrid.getField("iva").disable():"C"==this._type||"T"==this._type||"P"==this._type?this._hyperGrid.getField("valor").disable():"R"==this._type&&(this._form.selectOne("#unidad_objetivo").disable(),
this._form.selectOne("input#valor").disable());"E"==this._type&&(!0==this._wasLoaded?this._hyperGrid.getField("cantidad").disable():this._hyperGrid.getField("cantidad").enable())},_beforeInsert:function(){if("R"==this._tipo)return this._preLoad=!0,this._cantidad=this._hyperGrid.getField("cantidad").getValue(),this._loadDetail(),this._preLoad=!1,this._afterModify(),!1},_loadDetail:function(){this._cantidad=parseFloat(this._cantidad,10);this._tipo="I";this._items.each(function(a){if("undefined"!=typeof a){var b=
parseFloat(a.cantidad,10)*this._cantidad,c=parseFloat(a.costo,10)*this._cantidad,b=Utils.round(b,3),c=Utils.round(c,2);this._hyperGrid.getField("item_tipo").setValue(a.item_tipo);this._hyperGrid.getField("item").setValue(a.item);this._hyperGrid.getField("item_det").setValue(a.descripcion);this._hyperGrid.getField("unidad").setValue(a.unidad);this._hyperGrid.getField("cantidad").setValue(b);this._hyperGrid.getField("valor").setValue(c);b=this._hyperGrid.getField("iva");null!==b&&b.setValue(a.iva);
this._hyperGrid.addRow()}}.bind(this));this._items.clear()},_afterModify:function(){if(!0==this._preLoad)return!0;("E"==this._type||"O"==this._type)&&this._calculaTaxes();"R"==this._type&&this._calcularTransformacion();this._totalize()},_afterDelete:function(){this._totalize()},_calculaTaxes:function(){if(!1==this._blockTaxes){var a={},b=this._form.selectOne("#nit");""==b.getValue()?"O"==this._type?this._hyperForm.getMessages().notice("Indique un proveedor para calcular los impuestos de la orden de compra"):
"E"==this._type&&this._hyperForm.getMessages().notice("Indique un proveedor para calcular los impuestos de la entrada al almac\u00e9n"):(a.tipo=this._type,a.nit=b.getValue(),a.almacen=this._form.selectOne("#almacen").getValue(),a.items=Json.encode(this._hyperGrid.getColumn("item")),a.iva=Json.encode(this._hyperGrid.getColumn("iva")),a.valor=Json.encode(this._hyperGrid.getColumn("valor")),Tatico.getTaxes(a,function(a){if("FAILED"==a.status)this._hyperForm.getMessages().error(a.message);else{for(var b=
0;b<this._totales.length;b++){var d=this._form.selectOne("#"+this._totales[b]);null!==d&&d.setValue(a[this._totales[b]])}this._updateTotales();"undefined"!=typeof a.criterios&&$H(a.criterios).each(function(a){var b=this._form.selectOne("#criterio"+a[0]);null!==b&&b.setValue(a[1])}.bind(this));this._showDefaultMessage();this._blockTaxes=!1}}.bind(this)));this._hyperGrid.getField("iva").enable();this._hyperGrid.getField("item_det").enable()}},_updateTotales:function(a){var b=0;this._hyperGrid.getSummatory("valor");
for(var c=["iva16d","iva10d","iva5d"],e=0;e<c.length;e++){var d=this._form.selectOne("#"+c[e]);null!==d?""!=d.getValue()&&(b+=parseFloat(d.getValue(),10)):alert("No encontrado en la vista: "+c[e])}c=["iva16r","iva10r","iva5r"];for(e=0;e<c.length;e++)d=this._form.selectOne("#"+c[e]),null!==d?""!=d.getValue()&&(b-=parseFloat(d.getValue(),10)):alert("No encontrado en la vista: "+c[e]);this._form.selectOne("#saldo").setValue(b);"undefined"!=typeof a&&(a.addClassName("changedOnTab",!0),a.store("changed",
!0))},_loadOrden:function(){if(null!==this._activeSection){var a=this._hyperForm.getCurrentState(),b=this._activeSection.selectOne("#almacen"),c=this._activeSection.selectOne("#n_pedido");"new"==a?this._getOrden(b,c):"edit"==a&&(c.setValue(""),new HfosModal.alert({title:"Entradas al Almac\u00e9n",message:"La orden no puede ser cargada porque la entrada al almac\u00e9n no puede ser modificada"}))}},_getOrden:function(a,b){if(0<parseInt(b.getValue(),10))this._blockTaxes=!0,this._form.disable(),Tatico.getOrdenDeCompra(a.getValue(),
b.getValue(),function(a){this._form.enable();"OK"==a.status?(this._hyperForm.getMessages().notice("Se carg\u00f3 la orden de compra correctamente",!1),!0==this._hyperGrid.isEmpty()?this._showDataOrden(a.data):new HfosModal.confirm({title:"Entradas al almac\u00e9n",message:"La entrada al almac\u00e9n ya tiene referencias cargadas. Desea reemplazarlas?",onAccept:function(a){this._hyperGrid.clear();this._showDataOrden(a.data)}.bind(this,a)})):this._hyperForm.getMessages().error(a.message);this._blockTaxes=
!1}.bind(this))},_showDataOrden:function(a){this._form.selectOne("#nit").setValue(a.nit);this._form.selectOne("#nit_det").setValue(a.nit_det);var b=this._form.selectOne("#observaciones");null!==b&&b.setValue(a.observaciones);for(b=0;b<this._totales.length;b++){var c=this._form.selectOne("#"+this._totales[b]);null!==c&&(c.addClassName("changedOnTab",!0),c.store("changed",!0),c.setValue(a.taxes[this._totales[b]]))}for(b=0;b<a.movilin.length;b++)c=a.movilin[b],this._hyperGrid.getField("item").setValue(c.item),
this._hyperGrid.getField("item_det").setValue(c.descripcion),this._hyperGrid.getField("unidad").setValue(c.unidad),this._hyperGrid.getField("cantidad").setValue(c.cantidad),this._hyperGrid.getField("valor").setValue(c.valor),("E"==this._type||"O"==this._type)&&this._hyperGrid.getField("iva").setValue(c.iva),this._hyperGrid.addRow();this._form.selectOne("#factura_c").activate();window.setTimeout(function(){this._updateTotales()}.bind(this),700)},_loadPedido:function(){if(null!==this._activeSection){var a=
this._hyperForm.getCurrentState(),b=this._activeSection.selectOne("#almacen"),c=this._activeSection.selectOne("#n_pedido");"new"==a?this._getPedido(b,c):"edit"==a&&(c.setValue(""),"T"==this._type?new HfosModal.alert({title:"Traslados",message:"El pedido no puede ser cargado porque el traslado no puede ser modificado"}):"C"==this._type&&new HfosModal.alert({title:"Salidas",message:"El pedido no puede ser cargado porque la salida no puede ser modificada"}))}},_getPedido:function(a,b){var c=parseInt(b.getValue(),
10),e=parseInt(a.getValue(),10);if(0<c&&0<e)this._form.disable(),this._wasLoaded=!1,Tatico.getPedido(e,c,function(a,b){this._form.enable();"OK"==b.status?(this._wasLoaded=!0,this._showDataPedido(b.data),this._hyperForm.getMessages().notice('Se carg\u00f3 el pedido "'+a+'" correctamente')):this._hyperForm.getMessages().error(b.message)}.bind(this,c))},_showDataPedido:function(a){"C"==this._type&&(this._form.selectOne("#nit").setValue(a.nit),this._form.selectOne("#nit_det").setValue(a.nit_det));var b=
this._form.selectOne("#observaciones");null!==b&&b.setValue(a.observaciones);b=this._form.selectOne("#almacen_destino");null!==b&&b.setValue(a.almacen_destino);b=this._form.selectOne("#centro_costo");null!==b&&b.setValue(a.centro_costo);for(b=0;b<a.movilin.length;b++){var c=a.movilin[b];this._hyperGrid.getField("item").setValue(c.item);this._hyperGrid.getField("item_det").setValue(c.descripcion);this._hyperGrid.getField("unidad").setValue(c.unidad);this._hyperGrid.getField("cantidad").setValue(c.cantidad);
this._hyperGrid.getField("valor").setValue(c.valor);this._hyperGrid.addRow()}"C"==this._type&&this._form.selectOne("#nota").activate();this._preLoad=!1},_printTransaction:function(){var a=this._getTransactionType(),b=this._hyperForm.getLastPrimary();new HfosModalForm(this,"impresion/getFormato",{parameters:b+"&controller="+a,beforeClose:function(a,b,d,f){!1==d&&("OK"==f.status?"undefined"!=typeof f.file&&window.open($Kumbia.path+f.file):"FAILED"==f.status&&this._hyperForm.getMessages().error(f.message))}.bind(this,
b)})},_reOpenTransaction:function(a){var b=a.getValueFromName("almacen"),a=a.getValueFromName("numero");"O"==this._type?new HfosAjax.JsonRequest("ordenes/puedeReAbrir",{parameters:{almacen:b,numero:a},onSuccess:function(a,b,d){"OK"==d.status?new HfosModalForm(this,"ordenes/getFechaLimite",{checkAcl:!0,parameters:{almacen:a,numero:b},beforeClose:function(a,b){!1==b&&(this._hyperForm.back(2),this._hyperForm.getMessages().notice("Se re-abri\u00f3 correctamente la orden de compra",!0))}.bind(this)}):
"FAILED"==d.status&&this._hyperForm.getMessages().error(d.message)}.bind(this,b,a)}):new HfosAjax.JsonRequest("pedidos/puedeReAbrir",{parameters:{almacen:b,numero:a},onSuccess:function(a,b,d){"OK"==d.status?new HfosModalForm(this,"pedidos/getFechaLimite",{checkAcl:!0,parameters:{almacen:a,numero:b},beforeClose:function(a,b){!1==b&&(this._hyperForm.back(2),this._hyperForm.getMessages().notice("Se re-abri\u00f3 correctamente el pedido",!0))}.bind(this)}):"FAILED"==d.status&&this._hyperForm.getMessages().error(d.message)}.bind(this,
b,a)})},_sendTransaction:function(a){var b=a.getValueFromName("almacen"),a=a.getValueFromName("numero");"O"==this._type&&new HfosAjax.JsonRequest("ordenes/send",{parameters:{almacen:b,numero:a},onSuccess:function(a,b,d){"OK"==d.status?this._hyperForm.getMessages().success(d.message):"FAILED"==d.status&&this._hyperForm.getMessages().error(d.message)}.bind(this,b,a)})},_calcularTransformacion:function(){this._activeSection=this._hyperForm.getActiveSection();var a=this._form.selectOne("#item_objetivo"),
b=this._form.selectOne("#v_total"),c=this._form.selectOne("#nota"),e=this._form.selectOne("#cantidad_objetivo"),d=0;if(a)d=a.getValue();else return new HfosModal.alert({title:"Transformaciones",message:"El itemBase no se pudo leer"}),!1;a=0;if(e)a=""==e.getValue()?0:e.getValue();else return new HfosModal.alert({title:"Transformaciones",message:"La cantidad base no se pudo leer"}),!1;vTotalI=b?b.getValue():0;b=c.getValue();if("@"==b)return this._hyperForm.getMessages().notice("Ingrese el tipo de transformaci\u00f3n"),
!1;d={itemBase:d,cantidad_objetivo:a,items:Json.encode(this._hyperGrid.getColumn("item")),cantidades:Json.encode(this._hyperGrid.getColumn("cantidad")),nota:b,valorBase:vTotalI};new Tatico.getCalcularTransformacion(d,function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):a.datos&&this._hyperGrid._updateRowOnGrid(a.datos)}.bind(this))},_restoreTransaction:function(){var a=this._hyperForm.getCurrentState();if("new"==a||"edit"==a)this._prepareForInput(),this._showDefaultMessage(),
("E"==this._type||"O"==this._type)&&this._updateTotales()}});var Fisico=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);if(!1==a.wasRestored())this._setIndexCallbacks();else switch(a.getState()){case "index":this._setIndexCallbacks();break;case "query":this._setQueryCallbacks()}},_setIndexCallbacks:function(){this._setBuscarFormCallbacks();this.setState("index")},_setBuscarFormCallbacks:function(){var a=this.getElement("consultarButton");null!==a&&a.observe("click",function(a){this.go("fisico/consultar",{parameters:a.form.serialize(),
onSuccess:this._setQueryCallbacks.bind(this)})}.bind(this,a))},_setQueryCallbacks:function(){var a=this.getElement("backSearchButton"),b=this.getElement("saveButton");if(null!==this.getElement("hyBrowseTab")){var c=this.getElement("hyBrowseTab").selectOne(".cantidadesFisicas");null!==c&&c.activate()}null!==b&&b.observe("click",this._saveFisico.bind(this,b));null!==a&&a.observe("click",this._backConsultar.bind(this));this._setBuscarFormCallbacks();this.setState("query")},_backConsultar:function(){this.go("fisico/index",
{onSuccess:this._setIndexCallbacks.bind(this)})},_saveFisico:function(a){a.disable();this.getElement("headerSpinner").show();var b=this.getElement("saveForm");new HfosAjax.JsonRequest("fisico/guardar",{parameters:b.serialize(),checkAcl:!0,onSuccess:function(a,b){"OK"==b.status?this.getMessages().success(b.message):(this.getMessages().error(b.message),a.enable())}.bind(this,a),onComplete:function(a){this.getElement("headerSpinner").hide();a.enable()}.bind(this,a)})}});
HfosBindings.late("win-fisico","afterCreateOrRestore",function(a){new Fisico(a)});var Transformaciones={onCreate:function(a){new Transformacion(a,!1)},onRestore:function(a){new Transformacion(a,!0)}},Transformacion=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("R",a,b)}});HyperFormManager.lateGridBinding("transformaciones","afterInitialize",Transformaciones.onCreate);HyperFormManager.lateGridBinding("transformaciones","afterRestore",Transformaciones.onRestore);var ListadoProveedores=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"listadoProveedoresForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-listado-proveedores","afterCreateOrRestore",function(a){new ListadoProveedores(a)});var ListadoReferencias=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"listadoReferenciasForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-listado-referencias","afterCreateOrRestore",function(a){new ListadoReferencias(a)});var Trasunto=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"trasuntoForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-trasunto","afterCreateOrRestore",function(a){new Trasunto(a)});var MovimientosInve=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"movimientosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-movimientos-inve","afterCreateOrRestore",function(a){new MovimientosInve(a)});var Consecutivos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"consecutivosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-consecutivos","afterCreateOrRestore",function(a){new Consecutivos(a)});var SaldosAlmacenConsolidado=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"saldosAlmacenConsolidadoForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-saldos-almacen-consolidado","afterCreateOrRestore",function(a){new SaldosAlmacenConsolidado(a)});var Ajustes={onCreate:function(a){new Ajuste(a,!1)},onRestore:function(a){new Ajuste(a,!0)}},Ajuste=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("A",a,b)}});HyperFormManager.lateGridBinding("ajustes","afterInitialize",Ajustes.onCreate);HyperFormManager.lateGridBinding("ordenes","afterRestore",Ajustes.onRestore);var Cerrar=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cerrarForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cierre de inventarios, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onLoading:function(a){this.getMessages().notice("Se est\u00e1 realizando el cierre de inventarios, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el cierre correctamente"),this.selectOne("#proximoCierre").update(a.proximoCierre),this.selectOne("#cierreActual").update(a.cierreActual))}.bind(this),
onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cerrar","afterCreateOrRestore",function(a){new Cerrar(a)});var Reabrir=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("reabrirForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 reabriendo el periodo de inventarios, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onLoading:function(a){this.getMessages().notice("Se est\u00e1 reabriendo el periodo de inventarios, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se reabri\u00f3 el mes correctamente"),this.selectOne("#anteriorCierre").update(a.anteriorCierre),this.selectOne("#cierreActual").update(a.cierreActual))}.bind(this),
onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-reabrir","afterCreateOrRestore",function(a){new Reabrir(a)});var Stocks=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"stocksForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-stocks","afterCreateOrRestore",function(a){new Stocks(a)});var SaldosAlmacen=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"saldosAlmacenForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-saldos-almacen","afterCreateOrRestore",function(a){new SaldosAlmacen(a)});var SalidaBuffet=Class.create(HfosProcessContainer,{_subirForm:null,initialize:function(a){this.setContainer(a);if(!1==a.wasRestored())this._setIndexCallbacks();else switch(a.getState()){case "index":this._setIndexCallbacks();break;case "query":this._setQueryCallbacks()}},_setIndexCallbacks:function(){this._setBuscarFormCallbacks();this.setState("index")},_setBuscarFormCallbacks:function(){var a=this.getElement("consultarButton");null!==a&&a.observe("click",function(a){this.go("salidas_buffet/consultar",
{parameters:a.form.serialize(),onSuccess:this._setQueryCallbacks.bind(this)})}.bind(this,a))},_setQueryCallbacks:function(){var a=this.getElement("backSearchButton"),b=this.getElement("saveButton");if(null!==this.getElement("hyBrowseTab")){var c=this.getElement("hyBrowseTab").selectOne(".cantidadesFisicas");null!==c&&c.activate()}null!==b&&b.observe("click",this._saveFisico.bind(this,b));null!==a&&a.observe("click",this._backConsultar.bind(this));this._setBuscarFormCallbacks();this.setState("query")},
_backConsultar:function(){this.go("salidas_buffet/index",{onSuccess:this._setIndexCallbacks.bind(this)})},_saveFisico:function(a){a.disable();this.getElement("headerSpinner").show();var b=this.getElement("saveForm");new HfosAjax.JsonRequest("salidas_buffet/guardar",{parameters:b.serialize(),checkAcl:!0,onSuccess:function(a,b){"OK"==b.status?this.getMessages().success(b.message):(this.getMessages().error(b.message),a.enable())}.bind(this,a),onComplete:function(a){this.getElement("headerSpinner").hide();
a.enable()}.bind(this,a)})}});HfosBindings.late("win-salidas-buffet","afterCreateOrRestore",function(a){new SalidaBuffet(a)});var Salidas={onCreate:function(a){new Salida(a,!1)},onRestore:function(a){new Salida(a,!0)}},Salida=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("C",a,b)}});HyperFormManager.lateGridBinding("salidas","afterInitialize",Salidas.onCreate);HyperFormManager.lateGridBinding("salidas","afterRestore",Salidas.onRestore);var Traslados={onCreate:function(a){new Traslado(a,!1)},onRestore:function(a){new Traslado(a,!0)}},Traslado=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("T",a,b)}});HyperFormManager.lateGridBinding("traslados","afterInitialize",Traslados.onCreate);HyperFormManager.lateGridBinding("traslados","afterRestore",Traslados.onRestore);var Conversiones={onCreate:function(){new Conversion(this)}},Conversion=Class.create({_hyperForm:{},_unidadBase:"@",initialize:function(a){this._hyperForm=a;a.observe("beforeInput",this._prepareForInput.bind(this))},_getUnidadBase:function(a,b,c){new HfosAjax.JsonRequest("conversion/getUnidadBase",{parameters:{unidad:a.value},onSuccess:function(a){"OK"==a.status?(this._unidadBase=a.unidadBase,b.setValue(a.unidadBase)):b.setValue("@");c.focus()}.bind(this)})},_prepareForInput:function(){return!0}});
HyperFormManager.lateBinding("conversion","afterInitialize",Conversiones.onCreate);var Kardex=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"buscarForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-kardex","afterCreateOrRestore",function(a){new Kardex(a)});var Entradas={onCreate:function(a){new Entrada(a)},onRestore:function(a){new Entrada(a,!0)}},Entrada=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("E",a,b)}});HyperFormManager.lateGridBinding("entradas","afterInitialize",Entradas.onCreate);HyperFormManager.lateGridBinding("entradas","afterRestore",Entradas.onRestore);var Tatico={getReferenciaOrReceta:function(a,b,c,e){new HfosAjax.JsonRequest("tatico/getReferenciaOrReceta",{method:"GET",checkAcl:!0,parameters:{almacen:a,codigoItem:b,tipoDetalle:c},onSuccess:e})},getReferencia:function(a,b,c){c||(c="");new HfosAjax.JsonRequest("tatico/getReferencia",{method:"GET",checkAcl:!0,parameters:{codigoItem:a,almacen:c},onSuccess:b})},getSaldoReferencia:function(a,b,c){new HfosAjax.JsonRequest("tatico/getSaldoReferencia",{method:"GET",checkAcl:!0,parameters:{codigoItem:a,
almacen:b},onSuccess:c})},getOrdenDeCompra:function(a,b,c){new HfosAjax.JsonRequest("tatico/getOrdenDeCompra",{method:"GET",checkAcl:!0,parameters:{nAlmacen:a,nPedido:b},onSuccess:c})},getPedido:function(a,b,c){new HfosAjax.JsonRequest("tatico/getPedido",{method:"GET",checkAcl:!0,parameters:{nAlmacen:a,nPedido:b},onSuccess:c})},getTaxes:function(a,b){new HfosAjax.JsonRequest("tatico/getTaxes",{parameters:a,checkAcl:!0,onSuccess:b})},getCalcularTransformacion:function(a,b){new HfosAjax.JsonRequest("tatico/getCalcularTransformacion",
{parameters:a,checkAcl:!0,onSuccess:b})},queryOrden:function(a){var a=HfosCommon.findWindow(a).getSubprocess(),b=a.getActiveSection();new HfosModalForm(a,"ordenes/consultar",{notSubmit:!0,parameters:{almacen:b.selectOne("#almacen").getValue()},style:{width:"650px"},afterShow:function(a,b,d){Tatico.addQueryOrdenCallbacks(d,a,b);d.getElement("consultarButton").observe("click",function(){var f=this.getElement("ordenForm");new HfosAjax.FormRequest(f,{onLoading:function(){this.getElement("formSpinner").show()}.bind(this),
onSuccess:function(a,b,c,d){this.getElement("ordenes").update(d.responseText);Tatico.addQueryOrdenCallbacks(a,b,c)}.bind(this,d,a,b),onComplete:function(){this.getElement("formSpinner").hide()}.bind(this)})}.bind(d))}.bind(this,a,b)})},addQueryOrdenCallbacks:function(a,b,c){var e=a.selectOne("table#ordenesTable");if(null!=e){(new HfosBrowseData(a)).fromHtmlTable(a,e,5);for(var e=e.select("input.seleccionarButton"),d=0;d<e.length;d++)e[d].lang=e[d].title,e[d].title="Seleccionar la orden de compra",
e[d].observe("click",function(a,b,c,d){var e=d.selectOne("#almacen"),d=d.selectOne("#n_pedido"),a=a.lang.split("-");e.setValue(a[0]);d.setValue(a[1]);b.close();d.activate();c.fire("ordenUpdated")}.bind(this,e[d],a,b,c))}else a.getMessages().notice("No se encontraron orden de compra")},queryPedido:function(a){var a=HfosCommon.findWindow(a).getSubprocess(),b=a.getActiveSection();new HfosModalForm(a,"pedidos/consultar",{notSubmit:!0,parameters:{almacen:b.selectOne("#almacen").getValue()},style:{width:"650px"},
afterShow:function(a,b,d){Tatico.addQueryPedidoCallbacks(d,a,b);d.getElement("consultarButton").observe("click",function(){var f=this.getElement("pedidoForm");new HfosAjax.FormRequest(f,{onLoading:function(){this.getElement("formSpinner").show()}.bind(this),onSuccess:function(a,b,c,d){this.getElement("pedidos").update(d.responseText);Tatico.addQueryPedidoCallbacks(a,b,c)}.bind(this,d,a,b),onComplete:function(){this.getElement("formSpinner").hide()}.bind(this)})}.bind(d))}.bind(this,a,b)})},addQueryPedidoCallbacks:function(a,
b,c){var e=a.selectOne("table#pedidosTable");if(null!=e){(new HfosBrowseData(a)).fromHtmlTable(a,e,5);for(var e=e.select("input.seleccionarButton"),d=0;d<e.length;d++)e[d].lang=e[d].title,e[d].title="Seleccionar el pedido",e[d].observe("click",function(a,b,c,d){var e=d.selectOne("#almacen"),d=d.selectOne("#n_pedido"),a=a.lang.split("-");e.setValue(a[0]);d.setValue(a[1]);b.close();d.activate();c.fire("pedidoUpdated")}.bind(this,e[d],a,b,c))}else a.getMessages().notice("No se encontraron pedidos")},
getRodizioReferencias:function(a){new HfosAjax.JsonRequest("tatico/getRodizioReferencias",{checkAcl:!0,onSuccess:a})}};var Pedidos={onCreate:function(a){new Pedido(a,!1)},onRestore:function(a){new Pedido(a,!0)}},Pedido=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("P",a,b)}});HyperFormManager.lateGridBinding("pedidos","afterInitialize",Pedidos.onCreate);HyperFormManager.lateGridBinding("pedidos","afterRestore",Pedidos.onRestore);var Ordenes={onCreate:function(a){new Orden(a,!1)},onRestore:function(a){new Orden(a,!0)}},Orden=Class.create(TransaccionInve,{initialize:function(a,b){this._initializeTransaction("O",a,b)}});HyperFormManager.lateGridBinding("ordenes","afterInitialize",Ordenes.onCreate);HyperFormManager.lateGridBinding("ordenes","afterRestore",Ordenes.onRestore);HfosBindings.late("win-ordenes","afterRestore",HyperFormManager.restore.bind(this,"ordenes"));HfosBindings.late("win-entradas","afterRestore",HyperFormManager.restore.bind(this,"entradas"));HfosBindings.late("win-ajustes","afterRestore",HyperFormManager.restore.bind(this,"ajustes"));HfosBindings.late("win-traslados","afterRestore",HyperFormManager.restore.bind(this,"traslados"));HfosBindings.late("win-salidas","afterRestore",HyperFormManager.restore.bind(this,"salidas"));
HfosBindings.late("win-pedidos","afterRestore",HyperFormManager.restore.bind(this,"pedidos"));HfosBindings.late("win-transformaciones","afterRestore",HyperFormManager.restore.bind(this,"transformaciones"));HfosBindings.late("win-referencias","afterRestore",HyperFormManager.restore.bind(this,"referencias"));HfosBindings.late("win-lineas","afterRestore",HyperFormManager.restore.bind(this,"lineas"));HfosBindings.late("win-producto","afterRestore",HyperFormManager.restore.bind(this,"producto"));
HfosBindings.late("win-almacenes","afterRestore",HyperFormManager.restore.bind(this,"almacenes"));HfosBindings.late("win-centros","afterRestore",HyperFormManager.restore.bind(this,"centros"));HfosBindings.late("win-formapago","afterRestore",HyperFormManager.restore.bind(this,"formapago"));HfosBindings.late("win-terceros","afterRestore",HyperFormManager.restore.bind(this,"terceros"));HfosBindings.late("win-criterios","afterRestore",HyperFormManager.restore.bind(this,"criterios"));
HfosBindings.late("win-unidades","afterRestore",HyperFormManager.restore.bind(this,"unidades"));HfosBindings.late("win-magnitudes","afterRestore",HyperFormManager.restore.bind(this,"magnitudes"));HfosBindings.late("win-conversion","afterRestore",HyperFormManager.restore.bind(this,"conversion"));
