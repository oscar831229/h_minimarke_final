var EstadoCuentaValidacion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("printButton");a.observe("click",this._getReporte.bind(this,a))},_getReporte:function(){var a=this.selectOne("#fecha"),b=this.selectOne("#reportType");new HfosAjax.JsonRequest("estado_cuenta_validacion/reporte",{parameters:{fecha:a.getValue(),reportType:b.getValue()},onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generaci\u00f3n, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();this.getElement("printButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("printButton").enable();this.setIgnoreTermSignal(!1)}.bind(this)})}});
HfosBindings.late("win-estado-cuenta-validacion-socios","afterCreateOrRestore",function(a){new EstadoCuentaValidacion(a)});var InformePagosPeriodo=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("printButton");a.observe("click",this._getReporte.bind(this,a))},_getReporte:function(){var a=this.selectOne("#periodo"),b=this.selectOne("#reportType");new HfosAjax.JsonRequest("pagos_periodo/reporte",{parameters:{periodo:a.getValue(),reportType:b.getValue()},onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando el informe, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();this.getElement("printButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("printButton").enable();this.setIgnoreTermSignal(!1)}.bind(this)})}});
HfosBindings.late("win-informe-pagos-periodo-socios","afterCreateOrRestore",function(a){new InformePagosPeriodo(a)});var EstadoCuentaConsolidado=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);this.getElement("sendButton");a=this.getElement("printButton");a.observe("click",this._getReporte.bind(this,a))},_getReporte:function(){var a=this.selectOne("#fecha"),b=this.selectOne("#reportType");new HfosAjax.JsonRequest("estado_cuenta_consolidado/reporte",{parameters:{fecha:a.getValue(),reportType:b.getValue()},onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generaci\u00f3n, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();this.getElement("sendButton").disable();this.getElement("printButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("sendButton").enable();this.getElement("printButton").enable();this.setIgnoreTermSignal(!1)}.bind(this)})}});
HfosBindings.late("win-estado-cuenta-consolidado-socios","afterCreateOrRestore",function(a){new EstadoCuentaConsolidado(a)});var EstadoCuenta=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("sendButton");a.observe("click",this._getSend.bind(this,a));a=this.getElement("saveButton");a.observe("click",this._getGenerar.bind(this,a));a=this.getElement("printButton");a.observe("click",this._getReporte.bind(this,a))},_getGenerar:function(a){this.selectOne("#socios_id");var b=this.getElement("estadoCuentaForm");new HfosModal.confirm({title:"Generar Esatdos de Cuenta",message:"Desea generar los estados de cuenta?",
onAccept:function(){b.setAttribute("action",$Kumbia.path+"socios/estado_cuenta/verificar");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 verificando estados de cuenta, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable();this.getElement("printButton").disable();this.getElement("sendButton").disable();this.getElement("saveButton").disable()}.bind(this,a),onSuccess:function(a){"FAILED"==
a.status?this.getMessages().error(a.message):0<a.count?new HfosModal.confirm({title:"Generar Esatdos de Cuenta",message:"Parece que existe(n) un(os) estado de cuenta igual con la misma fecha. Desea reemplazarlo(s)?(Total: "+a.count+")",onAccept:function(){this._generarEstadosCuenta(b,a.count)}.bind(this),onRemove:function(){alert("salio")}}):this._generarEstadosCuenta(b,a.count)}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.getElement("sendButton").enable();
this.getElement("printButton").enable();this.getElement("saveButton").enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}.bind(this)})},_generarEstadosCuenta:function(a,b){var c=!0==b?$Kumbia.path+"socios/estado_cuenta/generar/1":$Kumbia.path+"socios/estado_cuenta/generar";if(!a)return alert("Formulario no encontrado"),!1;a.setAttribute("action",c);new HfosAjax.JsonFormRequest(a,{onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();this.getElement("printButton").disable();this.getElement("sendButton").disable();this.getElement("saveButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();this.getElement("sendButton").enable();this.getElement("printButton").enable();this.getElement("saveButton").enable();this.setIgnoreTermSignal(!1)}.bind(this,
a)})},_getReporte:function(a){this.selectOne("#socios_id");var b=this.getElement("estadoCuentaForm");b.setAttribute("action",$Kumbia.path+"socios/estado_cuenta/reporte");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable();this.getElement("printButton").disable();this.getElement("sendButton").disable();this.getElement("saveButton").disable()}.bind(this,
a),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.getElement("sendButton").enable();this.getElement("printButton").enable();this.getElement("saveButton").enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})},_getSend:function(){this.getElement("facturarForm");new HfosModalForm(this,
"estado_cuenta/sendCorreo",{parameters:{},style:"width: 50%;",beforeClose:function(a,b,c){!1==b&&("OK"==c.status?"undefined"!=typeof c.message&&this.getMessages().success(c.message):"FAILED"==c.status&&this.getMessages().error(c.message))}.bind(this)})}});HfosBindings.late("win-estado-cuenta-socios","afterCreateOrRestore",function(a){new EstadoCuenta(a)});var InformeConvenios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"informeConveniosForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-informe-convenios-socios","afterCreateOrRestore",function(a){new InformeConvenios(a)});var InformeCartera=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);new HfosForm(this,"informeCarteraForm",{update:"resultados",onSuccess:function(a){"OK"==a.status?(this.getMessages().success("Se gener\u00f3 el reporte correctamente"),window.open(Utils.getURL(a.file))):"FAILED"==a.status&&this.getMessages().error(a.message)}})}});HfosBindings.late("win-informe-cartera-socios","afterCreateOrRestore",function(a){new InformeCartera(a)});var ConceptosCausados=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");if(!a)return alert("conceptosCausadosButton not found"),!1;a.observe("click",this._consultaAccion.bind(this,a))},_consultaAccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("conceptosCausadosForm");if(!b)return alert('form ".conceptosCausadosForm" not found'),!1;new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando la consulta, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-conceptos-causados-socios","afterCreateOrRestore",function(a){new ConceptosCausados(a)});var FacturasGeneradas=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");if(!a)return alert("facturasGeneradasButton not found"),!1;a.observe("click",this._consultaAccion.bind(this,a))},_consultaAccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("facturasGeneradasForm");if(!b)return alert('form ".facturasGeneradasForm" not found'),!1;new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando la consulta, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-facturas-generadas-socios","afterCreateOrRestore",function(a){new FacturasGeneradas(a)});var SuspendidosMora=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");if(!a)return alert("suspendidosMoraButton not found"),!1;a.observe("click",this._consultaAccion.bind(this,a))},_consultaAccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("suspendidosMoraForm");if(!b)return alert('form ".suspendidosMoraForm" not found'),!1;new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando la consulta, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-suspendidos-socios","afterCreateOrRestore",function(a){new SuspendidosMora(a)});var AjustePagos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._ajustePagos.bind(this,a));a=this.getElement("deleteButton");a.observe("click",this._borrarPagos.bind(this,a));a=this.getElement("formatoButton");a.observe("click",this._formatoPagos.bind(this,a))},fileUpload:function(a,b,c){var d=document.createElement("iframe");d.setAttribute("id","upload_iframe");d.setAttribute("name","upload_iframe");d.setAttribute("width",
"0");d.setAttribute("height","0");d.setAttribute("border","0");d.setAttribute("style","width: 0; height: 0; border: none;");a.parentNode.appendChild(d);window.frames.upload_iframe.name="upload_iframe";iframeId=document.getElementById("upload_iframe");var e=function(){iframeId.detachEvent?iframeId.detachEvent("onload",e):iframeId.removeEventListener("load",e,!1);if(iframeId.contentDocument)content=iframeId.contentDocument.body.innerHTML;else if(iframeId.contentWindow)content=iframeId.contentWindow.document.body.innerHTML;
else if(iframeId.document)content=iframeId.document.body.innerHTML;document.getElementById(c).innerHTML=content;setTimeout("iframeId.parentNode.removeChild(iframeId)",250);var a=content.evalJSON(!0);"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success("Se realiz\u00f3 el ajuste de saldos correctamente");this.getElement("headerSpinner").hide();this.getElement("importButton").enable();this.getElement("deleteButton").enable();this.getElement("formatoButton").enable()}.bind(this);
iframeId.addEventListener&&iframeId.addEventListener("load",e,!0);iframeId.attachEvent&&iframeId.attachEvent("onload",e);a.setAttribute("target","upload_iframe");a.setAttribute("action",b);a.setAttribute("method","post");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");a.submit();this.getElement("headerSpinner").show();this.getElement("importButton").disable();this.getElement("deleteButton").disable();this.getElement("formatoButton").disable();document.getElementById(c).innerHTML=
"Uploading..."},_ajustePagos:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("ajustePagosForm");this.fileUpload(b,$Kumbia.path+"socios/ajuste_pagos/generar","archivo");this.getElement("headerSpinner").hide();b.enable();a.enable();this.setIgnoreTermSignal(!1)},_borrarPagos:function(a){a.disable();new HfosModal.confirm({title:"Borrar Ajustes de Pagos",message:"Desea borrar todos los ajustes de pagos del periodo junto con su movimiento contable?",onAccept:function(){new HfosAjax.JsonRequest("ajuste_pagos/borrar",
{parameters:{},onCreate:function(){a.disable();this.getMessages().notice("Se estan borrando los ajustes de pagos del periodo actual, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();this.getElement("importButton").disable();this.getElement("formatoButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message)}.bind(this),onComplete:function(){this.getElement("importButton").enable();this.getElement("formatoButton").enable();
this.getElement("headerSpinner").hide();a.enable()}.bind(this)})}.bind(this)})},_formatoPagos:function(a){a.disable();new HfosAjax.JsonRequest("ajuste_pagos/formato",{parameters:{},onCreate:function(){a.disable();this.getMessages().notice("Se esta generando formato de los ajustes de pagos, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();this.getElement("deleteButton").disable();this.getElement("importButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?
this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(){this.getElement("deleteButton").enable();this.getElement("importButton").enable();this.getElement("headerSpinner").hide();a.enable()}.bind(this)})}});HfosBindings.late("win-ajuste-pagos-socios","afterCreateOrRestore",function(a){new AjustePagos(a)});var prestamosSocios={_active:null,setActive:function(a){prestamosSocios._active=new prestamosSocio(a)},hasActive:function(){return null!==prestamosSocios._active},getActive:function(){return prestamosSocios._active},unsetActive:function(){prestamosSocios._active=null}},prestamosSocio=Class.create({_hyperForm:null,initialize:function(a){this._hyperForm=a;a.observe("beforeRecordPreview",this._addEstadoCuentaButton.bind(this))},_addEstadoCuentaButton:function(a,b){this._hyperForm.removeControlButton("printButton");
this._hyperForm.getActiveSection();var c=new HyperRecordData(b.data);c.getValueFromName("cuenta")&&this._hyperForm.addControlButton({className:"printButton",value:"Estado de Cuenta",onClick:this._abrirEstadoCuenta.bind(this,c)})},_abrirEstadoCuenta:function(a){this._hyperForm.getActiveSection();(a=a.getValueFromName("id"))?new HfosModalForm(this,"prestamos_socios/estadoCuenta",{parameters:{id:a},style:"width: 50%;",beforeClose:function(a,c,d,e){!1==d&&("OK"==e.status?"undefined"!=typeof e.message&&
this._hyperForm.getMessages().success(e.message):"FAILED"==e.status&&this._hyperForm.getMessages().error(e.message))}.bind(this,a)}):alert("No encontro prestamo")}});HyperFormManager.lateBinding("prestamos_socios","afterInitialize",function(){prestamosSocios.setActive(this);prestamosSocios.getActive()});var AjustePrestamos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);(a=this.getElement("importButton"))?a.observe("click",this._ajustePrestamos.bind(this,a)):alert(".importButton not found");a=this.getElement("deleteButton");a.observe("click",this._borrarPrestamos.bind(this,a))},fileUpload:function(a,b,c){if(!a)return!1;var d=document.createElement("iframe");d.setAttribute("id","upload_iframe");d.setAttribute("name","upload_iframe");d.setAttribute("width","0");d.setAttribute("height",
"0");d.setAttribute("border","0");d.setAttribute("style","width: 0; height: 0; border: none;");a.parentNode.appendChild(d);window.frames.upload_iframe.name="upload_iframe";iframeId=document.getElementById("upload_iframe");var e=function(){iframeId.detachEvent?iframeId.detachEvent("onload",e):iframeId.removeEventListener("load",e,!1);if(iframeId.contentDocument)content=iframeId.contentDocument.body.innerHTML;else if(iframeId.contentWindow)content=iframeId.contentWindow.document.body.innerHTML;else if(iframeId.document)content=
iframeId.document.body.innerHTML;document.getElementById(c).innerHTML=content;setTimeout("iframeId.parentNode.removeChild(iframeId)",250);var a=content.evalJSON(!0);"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success("Se realiz\u00f3 el ajuste de saldos correctamente")}.bind(this);iframeId.addEventListener&&iframeId.addEventListener("load",e,!0);iframeId.attachEvent&&iframeId.attachEvent("onload",e);a.setAttribute("target","upload_iframe");a.setAttribute("action",b);
a.setAttribute("method","post");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");a.submit();document.getElementById(c).innerHTML="Uploading..."},_ajustePrestamos:function(a){if(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("ajustePrestamosForm");b?(this.fileUpload(b,$Kumbia.path+"socios/ajuste_prestamos/generar","archivo"),this.getElement("headerSpinner").hide(),b.enable()):alert(".ajustePrestamosForm not found");a.enable();this.setIgnoreTermSignal(!1)}},
_borrarPrestamos:function(a){a.disable();new HfosModal.confirm({title:"Borrar Ajustes de Convenios",message:"Desea borrar todos los ajustes de consumos del periodo junto con su movimiento contable?",onAccept:function(){new HfosAjax.JsonRequest("ajuste_prestamos/borrar",{parameters:{},onCreate:function(){a.disable();this.getMessages().notice("Se estan borrando los ajustes de convenios del periodo actual, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();this.getElement("importButton").disable()}.bind(this),
onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message)}.bind(this),onComplete:function(){this.getElement("importButton").enable();this.getElement("headerSpinner").hide();a.enable()}.bind(this)})}.bind(this)})}});HfosBindings.late("win-ajuste-prestamos-socios","afterCreateOrRestore",function(a){new AjustePrestamos(a)});var AjusteSaldos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._ajusteSaldos.bind(this,a));a=this.getElement("deleteButton");a.observe("click",this._borrarSaldos.bind(this,a))},fileUpload:function(a,b,c){var d=document.createElement("iframe");d.setAttribute("id","upload_iframe");d.setAttribute("name","upload_iframe");d.setAttribute("width","0");d.setAttribute("height","0");d.setAttribute("border","0");d.setAttribute("style",
"width: 0; height: 0; border: none;");a.parentNode.appendChild(d);window.frames.upload_iframe.name="upload_iframe";iframeId=document.getElementById("upload_iframe");var e=function(){iframeId.detachEvent?iframeId.detachEvent("onload",e):iframeId.removeEventListener("load",e,!1);if(iframeId.contentDocument)content=iframeId.contentDocument.body.innerHTML;else if(iframeId.contentWindow)content=iframeId.contentWindow.document.body.innerHTML;else if(iframeId.document)content=iframeId.document.body.innerHTML;
document.getElementById(c).innerHTML=content;setTimeout("iframeId.parentNode.removeChild(iframeId)",250);var a=content.evalJSON(!0);"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success("Se realiz\u00f3 el ajuste de saldos correctamente");this.getElement("headerSpinner").hide();this.getElement("importButton").enable();this.getElement("deleteButton").enable()}.bind(this);iframeId.addEventListener&&iframeId.addEventListener("load",e,!0);iframeId.attachEvent&&iframeId.attachEvent("onload",
e);a.setAttribute("target","upload_iframe");a.setAttribute("action",b);a.setAttribute("method","post");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");a.submit();document.getElementById(c).innerHTML="Uploading...";this.getElement("headerSpinner").show();this.getElement("importButton").disable();this.getElement("deleteButton").disable()},_ajusteSaldos:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("ajusteSaldosForm");this.fileUpload(b,
$Kumbia.path+"socios/ajuste_saldos/generar","archivo");this.getElement("headerSpinner").hide();b.enable();a.enable();this.setIgnoreTermSignal(!1)},_borrarSaldos:function(a){a.disable();new HfosModal.confirm({title:"Borrar Ajustes de Saldos",message:"Desea borrar todos los ajustes de saldos del periodo junto con su movimiento contable?",onAccept:function(){new HfosAjax.JsonRequest("ajuste_saldos/borrar",{parameters:{},onCreate:function(){a.disable();this.getMessages().notice("Se estan borrando los ajustes de saldos del periodo actual, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();this.getElement("importButton").disable();this.getElement("deleteButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().success(a.message)}.bind(this),onComplete:function(){this.getElement("importButton").enable();this.getElement("deleteButton").enable();this.getElement("headerSpinner").hide();a.enable()}.bind(this)})}.bind(this)})}});
HfosBindings.late("win-ajuste-saldos-socios","afterCreateOrRestore",function(a){new AjusteSaldos(a)});var Reabrir=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("reabrirForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 reabriendo el periodo de inventarios, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se reabri\u00f3 el mes correctamente"),this.selectOne("#anteriorCierre").update(a.anteriorCierre))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-reabrir-socios","afterCreateOrRestore",function(a){new Reabrir(a)});var CierrePeriodo=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cierreContable.bind(this,a))},_cierreContable:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cierreForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cierre de periodo, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):(this.getMessages().success("Se realiz\u00f3 el cierre correctamente"),this.selectOne("#proximoCierre").update(a.proximoCierre),this.selectOne("#cierreActual").update(a.cierreActual),"undefined"!=typeof a.url&&a.url&&window.open($Kumbia.path+a.url))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});
HfosBindings.late("win-cierre-socios","afterCreateOrRestore",function(a){new CierrePeriodo(a)});var ConsultaSocios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._consultaAccion.bind(this,a))},_consultaAccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("consultaSociosForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando la consulta, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el informe correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-consulta-socios","afterCreateOrRestore",function(a){new ConsultaSocios(a)});var Proyeccion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._proyeccion.bind(this,a))},_cuotaInicial:function(a){var a=this.getElement("valorTotal"),b=this.getElement("cuotaInicial"),c=this.getElement("saldoPagar");a.getValue()&&new HfosAjax.JsonRequest("socios/getCuotaInicial",{parameters:{valorTotal:a.getValue(),cuotaInicial:b.getValue()},onSuccess:function(d){"FAILED"==d.status?(this.getMessages().error(d.message),
b.setValue(0),c.setValue(a.getValue())):(b&&b.setValue(d.cuotaInicial),c&&c.setValue(d.saldoPagar))}.bind(this)})},_proyeccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("proyeccionForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 proyectando la amortizaci\u00f3n...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=
typeof a.url&&window.open($Kumbia.path+a.url)):(this.getMessages().success("Se realiz\u00f3 el proyecci\u00f3n correctamente"),"undefined"!=typeof a.file&&window.open($Kumbia.path+a.file))}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-proyeccion-socios","afterCreateOrRestore",function(a){new Proyeccion(a)});var FacturarPersonal=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._facturar.bind(this,a));a=this.getElement("printButton");a.observe("click",this._getReporteFacturacion.bind(this,a));a=this.getElement("deleteButton");a.observe("click",this._delete.bind(this,a))},_getReporteFacturacion:function(a){var b=HfosCommon.findWindow(a);new HfosModalForm(b,"facturar/selectfecha/P/P",{notSubmit:!0,style:{width:"550px"},
afterShow:function(b,d){d.getElement("selectFechaButton").observe("click",function(b){var c=b.selectOne("#sociosId");if(!c.getValue())return alert("Es necesario dar el socio a imprimir la factura"),!1;var d=b.selectOne("#dateIni").getValue(),l=b.getElement("selectFechaButton");new HfosAjax.JsonRequest("facturar_personal/reporteFactura",{parameters:{sociosId:c.getValue(),dateIni:d},onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();b.getElement("formSpinner").show();a.disable();l.disable();this.getElement("importButton").disable();this.getElement("deleteButton").disable()}.bind(this,a),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this.getMessages().success(a.message))}.bind(this),onComplete:function(a){this.getElement("headerSpinner").hide();b.getElement("formSpinner").hide();a.enable();l.enable();
this.getElement("importButton").enable();this.getElement("deleteButton").enable();this.setIgnoreTermSignal(!1);b.close()}.bind(this,a)})}.bind(this,d))}.bind(this,b)})},_facturar:function(a){var b=this.getElement("facturarPersonalForm");new HfosModal.confirm({title:"Facturas del Periodo",message:"Desea generar la factura de este socio del actual periodo junto con su movimiento contable? Si acepta y hay movimiento antiguo esto se acumular\u00e1.",onAccept:function(a,b){this.generarFactura(b,a,!1)}.bind(this,
b,a),onError:function(){this.getMessages().error("Error 1")}.bind(this)})},generarFactura:function(a,b,c){c||(c=!1);b=HfosCommon.findWindow(a);new HfosModalForm(b,"facturar/selectperiodo/P",{notSubmit:!0,style:{width:"650px"},afterShow:function(b,c){var f=c.getElement("selectPeriodoButton");f.observe("click",function(b){var c=b.selectOne("#sociosId");if(!c.getValue())return alert("Es necesario dar el socio a imprimir la factura"),!1;var d=b.selectOne("#dateIni"),e=b.selectOne("#dateFin"),g=b.selectOne("#sostenimiento").getValue(),
h=b.selectOne("#administracion").getValue(),i=b.selectOne("#novedades").getValue(),j=b.selectOne("#consumoMinimo").getValue(),n=b.selectOne("#interesesMora").getValue(),o=b.selectOne("#ajusteSostenimiento").getValue();new HfosAjax.JsonRequest("facturar_personal/generar",{parameters:{sociosId:c.getValue(),dateIni:d.getValue(),dateFin:e.getValue(),sostenimiento:g,administracion:h,novedades:i,consumoMinimo:j,interesesMora:n,ajusteSostenimiento:o},onCreate:function(){b.getElement("formSpinner").show();
this.setIgnoreTermSignal(!0);this.getMessages().notice("Se estan realizando las facturas del periodo actual, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable();f.disable();d.disable();e.disable();this.getElement("printButton").disable();this.getElement("deleteButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):"OK"==a.status&&this.getMessages().notice(a.message)}.bind(this),onComplete:function(a){b.getElement("formSpinner").hide();
this.getElement("headerSpinner").hide();a.enable();f.enable();d.enable();e.enable();this.getElement("printButton").enable();this.getElement("deleteButton").enable();this.setIgnoreTermSignal(!1);b.close()}.bind(this,a)})}.bind(this,c))}.bind(this,b)})},_delete:function(a){var b=this.getElement("facturarPersonalForm");new HfosModal.confirm({title:"Facturas del Periodo",message:"Desea anular todas las facturas del periodo junto con su movimiento contable?",onAccept:function(){var b=HfosCommon.findWindow(a);
new HfosModalForm(b,"facturar/selectfecha/D/P",{notSubmit:!0,style:{width:"550px"},afterShow:function(b,c){c.getElement("selectFechaButton").observe("click",function(b){var c=b.selectOne("#sociosId");if(!c.getValue())return alert("Es necesario dar el socio a borrar la factura"),!1;var d=b.selectOne("#dateIni").getValue(),e=b.getElement("selectFechaButton");new HfosAjax.JsonRequest("facturar_personal/borrar",{parameters:{sociosId:c.getValue(),dateIni:d},onCreate:function(){this.setIgnoreTermSignal(!0);
this.getMessages().notice("Se est\u00e1 realizando el borrado de facturas, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();b.getElement("formSpinner").show();a.disable();e.disable();this.getElement("importButton").disable();this.getElement("printButton").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this.getMessages().error(a.message):this.getMessages().notice(a.message)}.bind(this),onComplete:function(a){this.getElement("headerSpinner").hide();b.getElement("formSpinner").hide();
a.enable();e.enable();this.getElement("importButton").enable();this.getElement("printButton").enable();this.setIgnoreTermSignal(!1);b.close()}.bind(this,a)})}.bind(this,c))}.bind(this,b)})}.bind(this,b)})}});HfosBindings.late("win-facturar-personal-socios","afterCreateOrRestore",function(a){new FacturarPersonal(a)});function checkAll(a){var b=!1;!0==a.checked&&(b=!0);a=document.getElementsByClassName("mailCheck");for(check in a)a[check].checked=b}function showListToSend(a){HfosAjax.Updater(document.getElementById("listToSend"),"facturar/showFacturasToSend/"+$(a).getValue())}
var Facturar={_hyperGrid:null,_hyperForm:null,onCreate:function(a){this._hyperForm=a.getHyperForm();this._hyperGrid=a;new Factura(a,!1)},onRestore:function(a){this._hyperForm=a.getHyperForm();this._hyperGrid=a;new Factura(a,!0)}},Factura=Class.create(HfosProcessContainer,{_hyperGrid:null,_hyperForm:null,initialize:function(a){var b=a.getHyperForm();this._hyperForm=b;this._hyperGrid=a;this._setIndexCallbacks();b.observe("afterBack",this._setIndexCallbacks.bind(this))},_setIndexCallbacks:function(){this._hyperForm.observe("beforeInput",
this._prepareForInput.bind(this));var a=this._hyperForm.getCurrentState();"new"==a||"edit"==a||(this._hyperForm.addControlButton({className:"import2Button",value:"Generar Facturas",onClick:this._facturar.bind(this)}),this._hyperForm.addControlButton({className:"delete2Button",value:"Borrar Facturas",onClick:this._delete.bind(this)}),this._hyperForm.addControlButton({className:"print2Button",value:"Imprimir Facturas",onClick:this._getReporteFacturacion.bind(this)}),this._hyperForm.addControlButton({className:"sendButton",
value:"Enviar Facturas",onClick:this._getSendFacturacion.bind(this)}))},_prepareForInput:function(){window.setTimeout(function(){this._hyperGrid.loadBaseData("facturar",["item","descripcion","valor","iva","total"])}.bind(this),80)},_facturar:function(){var a=this._hyperForm.getElement("import2Button");new HfosModal.confirm({title:"Facturas del Periodo",message:"Desea generar todas las facturas del periodo junto con su movimiento contable?",onAccept:function(){var b=HfosCommon.findWindow(a);new HfosModalForm(b,
"facturar/selectperiodo",{notSubmit:!0,style:{width:"650px"},afterShow:function(b,d){var e=d.getElement("selectPeriodoButton");e.observe("click",function(b){var c=b.selectOne("#dateIni"),d=b.selectOne("#dateFin"),m=b.selectOne("#sostenimiento").getValue(),k=b.selectOne("#administracion").getValue(),g=b.selectOne("#novedades").getValue(),h=b.selectOne("#consumoMinimo").getValue(),i=b.selectOne("#interesesMora").getValue(),j=b.selectOne("#ajusteSostenimiento").getValue();new HfosAjax.JsonRequest("facturar/generar",
{parameters:{dateIni:c.getValue(),dateFin:d.getValue(),sostenimiento:m,administracion:k,novedades:g,consumoMinimo:h,interesesMora:i,ajusteSostenimiento:j},onCreate:function(){b.getElement("formSpinner").show();this.setIgnoreTermSignal(!0);this._hyperForm.getMessages().notice("Se estan realizando las facturas del periodo actual, esto tardar\u00e1 algunos minutos...");this._hyperForm.getElement("hyToolbarSpinner").show();a.disable();e.disable();c.disable();d.disable();this._hyperForm.getElement("print2Button").disable();
this._hyperForm.getElement("delete2Button").disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):"OK"==a.status&&this._hyperForm.getMessages().notice(a.message)}.bind(this),onComplete:function(a){b.getElement("formSpinner").hide();this._hyperForm.getElement("hyToolbarSpinner").hide();a.enable();e.enable();c.enable();d.enable();this._hyperForm.getElement("print2Button").enable();this._hyperForm.getElement("delete2Button").enable();this.setIgnoreTermSignal(!1);
b.close()}.bind(this,a)})}.bind(this,d))}.bind(this,b)})}.bind(this)})},_delete:function(){var a=this._hyperForm.getElement("delete2Button");new HfosModal.confirm({title:"Facturas del Periodo",message:"Desea anular todas las facturas del periodo junto con su movimiento contable?",onAccept:function(){var b=HfosCommon.findWindow(a);new HfosModalForm(b,"facturar/selectfecha/D",{notSubmit:!0,style:{width:"550px"},afterShow:function(b,d){d.getElement("selectFechaButton").observe("click",function(b){var c=
b.selectOne("#dateIni").getValue(),d=b.getElement("selectFechaButton");new HfosAjax.JsonRequest("facturar/borrar",{parameters:{dateIni:c},onCreate:function(){this.setIgnoreTermSignal(!0);this._hyperForm.getMessages().notice("Se est\u00e1 realizando el borrado de facturas, esto tardar\u00e1 algunos minutos...");this._hyperForm.getElement("hyToolbarSpinner").show();b.getElement("formSpinner").show();a.disable();d.disable();this._hyperForm.getElement("import2Button").disable();this._hyperForm.getElement("print2Button").disable()}.bind(this),
onSuccess:function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):this._hyperForm.getMessages().notice(a.message)}.bind(this),onComplete:function(a){this._hyperForm.getElement("hyToolbarSpinner").hide();b.getElement("formSpinner").hide();a.enable();d.enable();this._hyperForm.getElement("import2Button").enable();this._hyperForm.getElement("print2Button").enable();this.setIgnoreTermSignal(!1);b.close()}.bind(this,a)})}.bind(this,d))}.bind(this,b)})}.bind(this)})},_getSendFacturacion:function(){this._hyperForm.getElement("sendButton");
new HfosModalForm(this,"facturar/sendCorreo",{parameters:{},style:"width: 70%;",beforeClose:function(a,b,c){!1==b&&("OK"==c.status?("undefined"!=typeof c.message&&this._hyperForm.getMessages().success(c.message),this.close()):"FAILED"==c.status&&this._hyperForm.getMessages().error(c.message))}.bind(this)})},_getReporteFacturacion:function(){var a=this._hyperForm.getElement("print2Button"),b=HfosCommon.findWindow(a);new HfosModalForm(b,"facturar/selectfecha/P",{notSubmit:!0,style:{width:"550px"},afterShow:function(b,
d){d.getElement("selectFechaButton").observe("click",function(b){var c=b.selectOne("#dateIni").getValue(),d=b.getElement("selectFechaButton");new HfosAjax.JsonRequest("facturar/reporteFactura",{parameters:{dateIni:c},onCreate:function(){this.setIgnoreTermSignal(!0);this._hyperForm.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");this._hyperForm.getElement("hyToolbarSpinner").show();b.getElement("formSpinner").show();a.disable();d.disable();this._hyperForm.getElement("import2Button").disable();
this._hyperForm.getElement("delete2Button").disable()}.bind(this,a),onSuccess:function(a){"FAILED"==a.status?this._hyperForm.getMessages().error(a.message):("undefined"!=typeof a.file&&window.open($Kumbia.path+a.file),this._hyperForm.getMessages().success(a.message))}.bind(this),onComplete:function(a){this._hyperForm.getElement("hyToolbarSpinner").hide();b.getElement("formSpinner").hide();a.enable();d.enable();this._hyperForm.getElement("import2Button").enable();this._hyperForm.getElement("delete2Button").enable();
this.setIgnoreTermSignal(!1);b.close()}.bind(this,a)})}.bind(this,d))}.bind(this,b)})}});HyperFormManager.lateGridBinding("facturar","afterInitialize",Facturar.onCreate);HyperFormManager.lateGridBinding("facturar","afterRestore",Facturar.onRestore);HyperFormManager.lateGridBinding("facturar","afterDetails",Facturar.onRestore);var MovimientoCargos=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._movimientoCargos.bind(this,a))},_movimientoCargos:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("movimientoCargosForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();
a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success(a.message)}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-movimiento-cargos-socios","afterCreateOrRestore",function(a){new MovimientoCargos(a)});var CargosSocios=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);(a=this.getElement("importButton"))&&a.observe("click",this._cargosSocios.bind(this,a));(a=this.getElement("printButton"))&&a.observe("click",this._getReporteFacturacion.bind(this))},_getReporteFacturacion:function(){new HfosModalForm(this,"cargos_socios/getFormato",{parameters:{},onSubmit:function(a){a.getElement("printButton2").disable();a.getElement("formSpinner").show()}.bind(this),beforeClose:function(a,
b,c){!1==b&&("OK"==c.status?(a.getMessages().notice(c.message),"undefined"!=typeof c.file&&window.open($Kumbia.path+c.file)):"FAILED"==c.status&&a.getMessages().error(c.message));a.getElement("formSpinner").hide();a.getElement("printButton2").enable()}.bind(this)})},_cargosSocios:function(a){var b=this.selectOne("#periodo");new HfosModal.confirm({title:"Generar Cargos de periodo",message:"Desea recalcular todos los cargos de los socios en el periodo ("+b.getValue()+")?",onAccept:function(){var b=
HfosCommon.findWindow(a);new HfosModalForm(b,"facturar/selectperiodo",{notSubmit:!0,style:{width:"650px"},afterShow:function(b,c){c.getElement("selectPeriodoButton").observe("click",function(b){var c=b.selectOne("#dateIni"),d=b.selectOne("#dateFin"),e=b.selectOne("#sostenimiento").getValue(),k=b.selectOne("#administracion").getValue(),g=b.selectOne("#novedades").getValue(),h=b.selectOne("#consumoMinimo").getValue(),i=b.selectOne("#interesesMora").getValue(),j=b.selectOne("#ajusteSostenimiento").getValue();
new HfosAjax.JsonRequest("cargos_socios/generar",{parameters:{dateIni:c.getValue(),dateFin:d.getValue(),sostenimiento:e,administracion:k,novedades:g,consumoMinimo:h,interesesMora:i,ajusteSostenimiento:j},onCreate:function(){this.setIgnoreTermSignal(!0);this.getMessages().notice("Se est\u00e1 realizando la generacion, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();b.getElement("formSpinner").show();a.disable()}.bind(this),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),
"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success(a.message)}.bind(this),onComplete:function(){this.getElement("headerSpinner").hide();b.getElement("formSpinner").hide();a.enable();this.setIgnoreTermSignal(!1);b.close()}.bind(this)})}.bind(this,c))}.bind(this,b)})}.bind(this)})}});HfosBindings.late("win-cargos-socios-socios","afterCreateOrRestore",function(a){new CargosSocios(a)});var AsignacionCargosGrupo=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._asignarcargoFijoGrupo.bind(this,a));(a=this.getElement("deleteButton"))&&a.observe("click",this._borrarCargoFijoGrupo.bind(this,a))},_asignarcargoFijoGrupo:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("asignarCargoFijoGrupoForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cambio, esto tardar\u00e1 algunos minutos...");
this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success(a.message)}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})},_borrarCargoFijoGrupo:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("asignarCargoFijoGrupoForm"),
c=this.getElement("tipo"),d=this.getElement("tipo_socios_id"),e=this.getElement("cargos_fijos_id");new HfosAjax.JsonRequest("asignacion_cargos_grupo/borrar",{parameters:{tipo:c.getValue(),tipo_socios_id:d.getValue(),cargos_fijos_id:e.getValue()},onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cambio, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),
"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success(a.message)}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-asignacion-cargos-grupo-socios","afterCreateOrRestore",function(a){new AsignacionCargosGrupo(a)});var CambioAccion=Class.create(HfosProcessContainer,{initialize:function(a){this.setContainer(a);a=this.getElement("importButton");a.observe("click",this._cambioAccion.bind(this,a))},_cambioAccion:function(a){a.disable();this.setIgnoreTermSignal(!0);var b=this.getElement("cambioAccionForm");new HfosAjax.JsonFormRequest(b,{onCreate:function(a){this.getMessages().notice("Se est\u00e1 realizando el cambio, esto tardar\u00e1 algunos minutos...");this.getElement("headerSpinner").show();a.disable()}.bind(this,
b),onSuccess:function(a){"FAILED"==a.status?(this.getMessages().error(a.message),"undefined"!=typeof a.url&&window.open($Kumbia.path+a.url)):this.getMessages().success("Se realiz\u00f3 el cambio correctamente")}.bind(this),onComplete:function(a,b){this.getElement("headerSpinner").hide();a.enable();b.enable();this.setIgnoreTermSignal(!1)}.bind(this,b,a)})}});HfosBindings.late("win-cambio-accion-socios","afterCreateOrRestore",function(a){new CambioAccion(a)});var Socios={_active:null,setActive:function(a){Socios._active=new Socio(a)},hasActive:function(){return null!==Socios._active},getActive:function(){return Socios._active},unsetActive:function(){Socios._active=null}},Socio=Class.create({_hyperForm:null,initialize:function(a){this._hyperForm=a;a.observe("beforeInput",this._addValidations.bind(this))},_addValidations:function(){var a=this._hyperForm.getActiveSection();console.log(a);var b=a.selectOne("img.addEstudio");b&&b.observe("click",this._addEstudioRow.bind(this));
(b=a.selectOne("img.addExpLaboral"))&&b.observe("click",this._addExpLaboralRow.bind(this));(b=a.selectOne("img.addOtrosSocios"))&&b.observe("click",this._addOtrosSociosRow.bind(this));(b=a.selectOne("input.subirArchivosButton"))&&b.observe("click",this._subirArchivosModal.bind(this,b));$$("img.delRowTemp").each(function(a){a.observe("click",this._delRowTemp.bind(this,a))}.bind(this));b=this._hyperForm.getCurrentState();if("edit"==b||"new"==b)(a=a.selectOne("input#titular_id"))&&a.observe("change",
this._getInfoByTitular.bind(this,a))},_getInfoByTitular:function(a){var b=a.getValue(),c=this._hyperForm;this._hyperForm.getActiveSection();b?new HfosModal.confirm({title:"Asignaci\u00f3n de Titular",message:"Desea asignar la informaci\u00f3n del titular?",onAccept:function(){new HfosAjax.JsonRequest("socios/getInfoSocios",{parameters:{sociosId:b},onSuccess:function(a){"FAILED"==a.status&&c.getMessages().error(a.message)}})}.bind(this)}):alert("No encontro codigo")},_addOtrosSociosRow:function(){var a=
this._hyperForm.getActiveSection(),b=a.selectOne("input#otrosSociosId1"),c=a.selectOne("input#otrosSociosId1_det"),a=a.selectOne("select#tipoAsociacionSocioId1");b&&this._makeRow({mainTable:"mainTableOtrosSocios",configRows:[{asignacionSocioId:{type:"hidden",value:null},otrosSociosId:{type:"hidden",value:b.getValue()},otrosSociosIdDet:{type:"text",value:c.getValue()},tipoAsociacionSocioId:{type:"select",value:a.getValue(),text:a.options[a.selectedIndex].text}}],required:{otrosSociosId:{name:"Otro Socio"},
tipoAsociacionSocioId:{name:"Tipo de Asociaci\u00f3n con Socio"}}})},_addExpLaboralRow:function(){var a=this._hyperForm.getActiveSection(),b=a.selectOne("input#expLaboralesEmpresa1"),c=a.selectOne("input#expLaboralesDireccion1"),d=a.selectOne("input#expLaboralesCargo1"),e=a.selectOne("input#expLaboralesTelefono1"),f=a.selectOne("input#expLaboralesFax1"),a=a.selectOne("input#expLaboralesFecha1");b&&this._makeRow({mainTable:"mainTableExpLaboral",configRows:[{expLaboralesId:{type:"hidden",value:null},
expLaboralesEmpresa:{type:"text",value:b.getValue()},expLaboralesDireccion:{type:"text",value:c.getValue()},expLaboralesCargo:{type:"text",value:d.getValue()},expLaboralesTelefono:{type:"text",value:e.getValue()},expLaboralesFax:{type:"text",value:f.getValue()},expLaboralesFecha:{type:"text",value:a.getValue()},expLaboralesDummy:{type:"text",value:""}}],required:{expLaboralesEmpresa:{name:"Empresa"},expLaboralesDireccion:{name:"Direcci\u00f3n"},expLaboralesCargo:{name:"Cargo"},expLaboralesTelefono:{name:"Tel\u00e9fono"}}})},
_addEstudioRow:function(){var a=this._hyperForm.getActiveSection(),b=a.selectOne("input#estudiosInstitucion1"),c=a.selectOne("input#estudiosFechaGrado1"),d=a.selectOne("input#estudiosTitulo1"),e=a.selectOne("input#estudiosCiudadId1"),a=a.selectOne("input#estudiosCiudadId1_det");b&&(this._makeRow({mainTable:"mainTableEstudios",configRows:[{estudiosId:{type:"hidden",value:null},estudiosInstitucion:{type:"text",value:b.getValue()},estudiosCiudadId:{type:"hidden",value:e.getValue()},estudiosCiudadId_det:{type:"text",
value:a.getValue()},estudiosFechaGrado:{type:"text",value:c.getValue()},estudiosTitulo:{type:"text",value:d.getValue()}}],required:{estudiosInstitucion:{name:"Intituci\u00f3n"},estudiosFechaGrado:{name:"Fecha de Grado"},estudiosTitulo:{name:"Titulo"},estudiosCiudadId:{name:"Ciudad"}}}),$$("img.delRowTemp").each(function(a){a.observe("click",this._delRowTemp.bind(this,a))}.bind(this)))},_delRowTemp:function(a){if(a=a.parentNode)(a=a.parentNode)&&a.remove()},_makeRow:function(a){if(!a)return!1;var b=
this._hyperForm.getActiveSection(),c=b.selectOne("#"+a.mainTable+" tbody"),d="",e=0;if(!c)return!1;trs=b.select("#"+a.mainTable+" tbody tr");e=2<trs.length?trs.length-2:1;$(a.configRows).each(function(b){var c=this._validateRequired({required:a.required,row:b});if(!1==c.bool)return this._hyperForm.getMessages().error(c.msg),!1;d+="<tr>";d+='<td align="center">'+e+"</td>";$H(b).each(function(a){var b=a.value,a=a.key;"text"==b.type&&(d+='<td align="center"><input type="hidden" name="'+a+'[]" id="'+
a+'" value="'+b.value+'"/>'+b.value+"</td>");if("select"==b.type){var c=b.value;if(b.text)c=b.text;d+='<td align="center"><input type="hidden" name="'+a+'[]" id="'+a+'" value="'+b.value+'"/>'+c+"</td>"}"hidden"==b.type&&(d+='<input type="hidden" name="'+a+'[]" id="'+a+'" value="'+b.value+'"/>')}.bind(this));d+='<td align="center"><img title="Borrar linea" alt="" class="delRowTemp" src="/h/img/backoffice/delete-l.gif"></td>';d+="</tr>";e++}.bind(this));c.insert(d)},_validateRequired:function(a){var b=
a.required,c={bool:!0,fields:[],msg:""};$H(a.row).each(function(a){var e=a.value,f=a.key;$H(b).each(function(a){var b=a.value;if(f==a.key&&(!e.value||"@"==e.value))c.fields.push(b.name),c.bool=!1})});c.msg="Los campos "+c.fields.join(", ")+" son requeridos";return c},_subirArchivosModal:function(a,b){var c=this._hyperForm.getActiveSection().selectOne("#socios_id");!c&&b&&b.data?(c=b.data.last().value)?(contratoAsociadoArray=c.split("/"),sociosId=contratoAsociadoId=parseInt(contratoAsociadoArray[0])):
sociosId=b.data[0].value:sociosId=c.getValue();0<sociosId&&new HfosModalForm(this,"socios/subirCorrespondencia",{notSubmit:!0,style:"width: 50%;",parameters:{sociosId:sociosId},messageDefault:"Al subir el archivo cierre la ventana para terminar el proceso",beforeClose:function(a){this._actualizarCorrespondencia(a)}.bind(this,sociosId)})},_subirCorrespondencia:function(){var a=this._hyperForm.getActiveSection().selectOne("#correspondenciaSociosFormId");a?(this.fileUpload(a,$Kumbia.path+"socios/socios/correspondenciaSocios",
"archivo"),a.enable()):alert("correspondenciaSociosForm not found")},_actualizarCorrespondencia:function(a){var b=this._hyperForm.getActiveSection();new HfosAjax.Request("socios/correspondencia",{parameters:{sociosId:a},onSuccess:function(a){b.selectOne("#mainTableCorrespondencia").update(a.responseText)}.bind(this)})},fileUpload:function(a,b,c){var d=this._hyperForm(),e=document.createElement("iframe");e.setAttribute("id","upload_iframe");e.setAttribute("name","upload_iframe");e.setAttribute("width",
"0");e.setAttribute("height","0");e.setAttribute("border","0");e.setAttribute("style","width: 0; height: 0; border: none;");a.parentNode.appendChild(e);window.frames.upload_iframe.name="upload_iframe";iframeId=document.getElementById("upload_iframe");var f=function(){iframeId.detachEvent?iframeId.detachEvent("onload",f):iframeId.removeEventListener("load",f,!1);if(iframeId.contentDocument)content=iframeId.contentDocument.body.innerHTML;else if(iframeId.contentWindow)content=iframeId.contentWindow.document.body.innerHTML;
else if(iframeId.document)content=iframeId.document.body.innerHTML;document.getElementById(c).innerHTML=content;setTimeout("iframeId.parentNode.removeChild(iframeId)",250);var a=content.evalJSON(!0);"FAILED"==a.status?d.getMessages().error(a.message):d.getMessages().success("Se subio correspondencia correctamente");d.getElement("headerSpinner").hide();d.getElement("importButton").enable()}.bind(this);iframeId.addEventListener&&iframeId.addEventListener("load",f,!0);iframeId.attachEvent&&iframeId.attachEvent("onload",
f);a.setAttribute("target","upload_iframe");a.setAttribute("action",b);a.setAttribute("method","post");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");a.submit();document.getElementById(c).innerHTML="Uploading...";d.getElement("headerSpinner").show();d.getElement("importButton").disable()}});HyperFormManager.lateBinding("socios","afterInitialize",function(){Socios.setActive(this);Socios.getActive()});
